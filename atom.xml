<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>H多看源码多读书 - 勤于思考善领悟</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2026-03-01T16:07:38.350Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>ZHB</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【置顶】超级有用的html/css/js/vue等技巧 持续更新中</title>
    <link href="http://example.com/posts/8e2e021e.html"/>
    <id>http://example.com/posts/8e2e021e.html</id>
    <published>2030-08-22T11:22:13.000Z</published>
    <updated>2026-03-01T16:07:38.350Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、HTML"><a href="#一、HTML" class="headerlink" title="一、HTML"></a><strong>一、HTML</strong></h2><p>暂无</p><br><h2 id="二、CSS"><a href="#二、CSS" class="headerlink" title="二、CSS"></a><strong>二、CSS</strong></h2><h3 id="1、清除浮动"><a href="#1、清除浮动" class="headerlink" title="1、清除浮动"></a><strong><font color='red'>1、清除浮动</font></strong></h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 清除浮动（双伪元素）</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br><span class="line">// ie6 <span class="number">7</span> 专门清除浮动的样式</span><br><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  *<span class="attribute">zoom</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>清除浮动的原理</strong></p><p><code>clear:both</code>清除浮动的关键</p><p><code>clear</code>是CSS中的定位属性，规定元素的哪一侧不允许其他浮动元素。那么<code>clear:both</code>就是规定在左右两侧均不允许浮动元素。</p><p><code>clear</code>属性只能在块级元素上其作用，这就是清除浮动样式中<code>display:table</code>的作用。</p><br><h2 id="三、JavaScript"><a href="#三、JavaScript" class="headerlink" title="三、JavaScript"></a><strong>三、JavaScript</strong></h2><h3 id="1、基于URLSearchParams或URL获取queryString的值"><a href="#1、基于URLSearchParams或URL获取queryString的值" class="headerlink" title="1、基于URLSearchParams或URL获取queryString的值"></a><strong><font color='red'>1、基于URLSearchParams或URL获取queryString的值</font></strong></h3><p>测试链接：</p><p><a href="https://cf.cmpay.com/mpl/credit_orderResult.html?orderNo=50620520605&orderDate=2052">https://cf.cmpay.com/mpl/credit_orderResult.html?orderNo=50620520605&amp;orderDate=2052</a></p><p><strong>URLSearchParams</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// location.search 取到的是&quot;?orderNo=50620520605&amp;orderDate=2052&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> urlSP = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(location.<span class="property">search</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryString</span>(<span class="params">key</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> urlSP.<span class="title function_">get</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getQueryString</span>(<span class="string">&#x27;orderNo&#x27;</span>) <span class="comment">// 50620520605</span></span><br></pre></td></tr></table></figure><p><strong>URL</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> urlObj = <span class="keyword">new</span> <span class="title function_">URL</span>(location.<span class="property">href</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryString</span>(<span class="params">key</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> urlObj.<span class="property">searchParams</span>.<span class="title function_">get</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getQueryString</span>(<span class="string">&#x27;orderNo&#x27;</span>) <span class="comment">// 50620520605</span></span><br></pre></td></tr></table></figure><br><h3 id="2、基于atob和btoa的base64编码和解码"><a href="#2、基于atob和btoa的base64编码和解码" class="headerlink" title="2、基于atob和btoa的base64编码和解码"></a><strong><font color='red'>2、基于atob和btoa的base64编码和解码</font></strong></h3><p>浏览器内置了base64编码和解码的能力</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># <span class="built_in">encodeURIComponent</span>() 函数可把字符串作为 <span class="variable constant_">URI</span> 组件进行编码</span><br><span class="line"># <span class="built_in">unescape</span>() 函数可对通过 <span class="built_in">escape</span>() 编码的字符串进行解码</span><br><span class="line"># <span class="title function_">btoa</span>() 方法用于创建一个 base-<span class="number">64</span> 编码的字符串</span><br><span class="line"># <span class="title function_">atob</span>() 方法用于解码使用 base-<span class="number">64</span> 编码的字符串</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">utf8_to_b64</span>(<span class="params"> str </span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="title function_">btoa</span>(<span class="built_in">unescape</span>(<span class="built_in">encodeURIComponent</span>( str )));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b64_to_utf8</span>(<span class="params"> str </span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(<span class="built_in">escape</span>(<span class="variable language_">window</span>.<span class="title function_">atob</span>( str )));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">utf8_to_b64</span>(<span class="string">&#x27;✓ à la mode&#x27;</span>); <span class="comment">// &quot;4pyTIMOgIGxhIG1vZGU=&quot;</span></span><br><span class="line"><span class="title function_">b64_to_utf8</span>(<span class="string">&#x27;4pyTIMOgIGxhIG1vZGU=&#x27;</span>); <span class="comment">// &quot;✓ à la mode&quot;</span></span><br></pre></td></tr></table></figure><br><h3 id="3、相对地址转换为绝对地址"><a href="#3、相对地址转换为绝对地址" class="headerlink" title="3、相对地址转换为绝对地址"></a><strong><font color='red'>3、相对地址转换为绝对地址</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">realativeToAbs</span>(<span class="params">href</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> aEl = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    aEl.<span class="property">href</span> = href;</span><br><span class="line">    <span class="keyword">const</span> result = aEl.<span class="property">href</span>;</span><br><span class="line">    aEl = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">realativeToAbs</span>(<span class="string">&quot;../a/b/b/index.html&quot;</span>) <span class="comment">// http://127.0.0.1:5500/a/b/b/index.html</span></span><br></pre></td></tr></table></figure><br><h3 id="4-、禁止图片拖拽、禁止右键、禁止选择、禁止复制"><a href="#4-、禁止图片拖拽、禁止右键、禁止选择、禁止复制" class="headerlink" title="4 、禁止图片拖拽、禁止右键、禁止选择、禁止复制"></a><strong><font color='red'>4 、禁止图片拖拽、禁止右键、禁止选择、禁止复制</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;dragstart&#x27;</span>,<span class="string">&#x27;contextmenu&#x27;</span>, <span class="string">&#x27;selectstart&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>].<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">ev</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(ev, <span class="keyword">function</span> (<span class="params">ev</span>) &#123;</span><br><span class="line">        ev.<span class="title function_">preventDefault</span>();</span><br><span class="line">        ev.<span class="property">returnValue</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><h3 id="5、es6的解构赋值"><a href="#5、es6的解构赋值" class="headerlink" title="5、es6的解构赋值"></a><strong><font color='red'>5、es6的解构赋值</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>:<span class="number">2</span>,</span><br><span class="line">    <span class="attr">c</span>:<span class="number">3</span>,</span><br><span class="line">    <span class="attr">d</span>:<span class="number">4</span>,</span><br><span class="line">    <span class="attr">e</span>:<span class="number">5</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#吐槽：</span><br><span class="line"><span class="keyword">const</span> a = obj.<span class="property">a</span>;</span><br><span class="line"><span class="keyword">const</span> b = obj.<span class="property">b</span>;</span><br><span class="line"><span class="keyword">const</span> c = obj.<span class="property">c</span>;</span><br><span class="line"><span class="keyword">const</span> d = obj.<span class="property">d</span>;</span><br><span class="line"><span class="keyword">const</span> e = obj.<span class="property">e</span>;</span><br><span class="line"></span><br><span class="line">#改进：</span><br><span class="line"><span class="keyword">const</span> &#123;a,b,c,d,e&#125; = obj;</span><br><span class="line"></span><br><span class="line">#其他：</span><br><span class="line"><span class="comment">// 属性名和变量名不一样时</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">a</span>: f, <span class="attr">b</span>: l &#125; = obj;</span><br><span class="line">f <span class="comment">// 1</span></span><br><span class="line">l <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定默认值</span></span><br><span class="line"><span class="keyword">let</span> &#123; x = <span class="number">11</span> &#125; = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> [a = <span class="number">66</span>] = [];</span><br><span class="line">x <span class="comment">// 11</span></span><br><span class="line">a <span class="comment">// 66</span></span><br></pre></td></tr></table></figure><p>注意解构的对象不能为<code>undefined</code>、<code>null</code>。否则会报错，故要给被解构的对象一个默认值。</p><p><strong>const {a,b,c,d,e} &#x3D; obj || {};</strong></p><br><h3 id="6、合并数据"><a href="#6、合并数据" class="headerlink" title="6、合并数据"></a><strong><font color='red'>6、合并数据</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#吐槽：</span><br><span class="line"><span class="keyword">const</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> b = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"><span class="keyword">const</span> c = a.<span class="title function_">concat</span>(b);<span class="comment">//[1,2,3,1,5,6]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">33</span> &#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">66</span> &#125;</span><br><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, obj1, obj2) <span class="comment">//&#123;a: 1, b: 2, c: 66&#125; 属性名相同最后对象覆盖前面对象</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#改进：</span><br><span class="line"><span class="keyword">const</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> b = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">const</span> c = [...a, ...b] <span class="comment">//[1,2,3,1,5,6] 不去重</span></span><br><span class="line"><span class="keyword">const</span> c = [...<span class="keyword">new</span> <span class="title class_">Set</span>([...a, ...b])] <span class="comment">//[1,2,3,5,6] 去重</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">33</span> &#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">66</span> &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;...obj1, ...obj2&#125;); <span class="comment">//&#123;a: 1, b: 2, c: 66&#125;</span></span><br></pre></td></tr></table></figure><br><h3 id="7、关于拼接字符串"><a href="#7、关于拼接字符串" class="headerlink" title="7、关于拼接字符串"></a><strong><font color='red'>7、关于拼接字符串</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;小明&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> score = <span class="number">59</span>;</span><br><span class="line"></span><br><span class="line">#吐槽：</span><br><span class="line"><span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(score &gt; <span class="number">60</span>)&#123;</span><br><span class="line">  result = <span class="string">`<span class="subst">$&#123;name&#125;</span>的考试成绩及格`</span>; </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  result = <span class="string">`<span class="subst">$&#123;name&#125;</span>的考试成绩不及格`</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#改进：</span><br><span class="line"><span class="keyword">const</span> result = <span class="string">`<span class="subst">$&#123;name&#125;</span><span class="subst">$&#123;score &gt; <span class="number">60</span>?<span class="string">&#x27;的考试成绩及格&#x27;</span>:<span class="string">&#x27;的考试成绩不及格&#x27;</span>&#125;</span>`</span>; <span class="comment">// 小明的考试成绩不及格</span></span><br></pre></td></tr></table></figure><br><h3 id="8、扁平化数组"><a href="#8、扁平化数组" class="headerlink" title="8、扁平化数组"></a><strong><font color='red'>8、扁平化数组</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deps = &#123;</span><br><span class="line">    <span class="string">&#x27;采购部&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">    <span class="string">&#x27;人事部&#x27;</span>:[<span class="number">5</span>,<span class="number">8</span>,<span class="number">12</span>],</span><br><span class="line">    <span class="string">&#x27;行政部&#x27;</span>:[<span class="number">5</span>,<span class="number">14</span>,<span class="number">79</span>],</span><br><span class="line">    <span class="string">&#x27;运输部&#x27;</span>:[<span class="number">3</span>,<span class="number">64</span>,<span class="number">105</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#吐槽：</span><br><span class="line"><span class="keyword">let</span> member = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">in</span> deps)&#123;</span><br><span class="line">    <span class="keyword">const</span> value = deps[item];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(value))&#123;</span><br><span class="line">        member = [...member,...value]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">member = [...<span class="keyword">new</span> <span class="title class_">Set</span>(member)]  <span class="comment">// [1, 2, 3, 5, 8, 12, 14, 79, 64, 105]</span></span><br><span class="line"></span><br><span class="line">#改进：</span><br><span class="line"><span class="keyword">let</span> member = <span class="title class_">Object</span>.<span class="title function_">values</span>(deps).<span class="title function_">flat</span>(<span class="title class_">Infinity</span>); <span class="comment">// [1, 2, 3, 5, 8, 12, 14, 79, 64, 105]</span></span><br></pre></td></tr></table></figure><br><h3 id="9、添加对象属性"><a href="#9、添加对象属性" class="headerlink" title="9、添加对象属性"></a><strong><font color='red'>9、添加对象属性</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#吐槽：</span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> index = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> key = <span class="string">`topic<span class="subst">$&#123;index&#125;</span>`</span>;</span><br><span class="line">obj[key] = <span class="string">&#x27;话题内容&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#改进：es6</span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> index = <span class="number">1</span>;</span><br><span class="line">obj[<span class="string">`topic<span class="subst">$&#123;index&#125;</span>`</span>] = <span class="string">&#x27;话题内容&#x27;</span>;</span><br></pre></td></tr></table></figure><br><h3 id="10、非空的判断"><a href="#10、非空的判断" class="headerlink" title="10、非空的判断"></a><strong><font color='red'>10、非空的判断</font></strong></h3><p><strong>空值合并操作符</strong>（<strong><code>??</code></strong>）</p><p>只有当左侧为null和undefined时，才会返回右侧的值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(a === <span class="literal">null</span> || a === <span class="literal">undefined</span>) &#123;    </span><br><span class="line"><span class="title function_">doSomething</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也就是如果需要验证一个值是否等于null或者undefined，可以使用null合并操作符来简化上面的代码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a ?? <span class="title function_">doSomething</span>()</span><br></pre></td></tr></table></figure><p>这样，仅当 a 未定义或为空时，才会执行控制合并运算符之后的代码。空合并运算符 ??是一个逻辑运算符，当左侧操作数为 null 或未定义时返回其右侧操作数，否则返回左侧操作数。</p><p>例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nullValue = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> emptyText = <span class="string">&quot;&quot;</span>; <span class="comment">// 空字符串，是一个假值，Boolean(&quot;&quot;) === false</span></span><br><span class="line"><span class="keyword">const</span> someNumber = <span class="number">42</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> valA = nullValue ?? <span class="string">&quot;valA 的默认值&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> valB = emptyText ?? <span class="string">&quot;valB 的默认值&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> valC = someNumber ?? <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(valA); <span class="comment">// &quot;valA 的默认值&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(valB); <span class="comment">// &quot;&quot;（空字符串虽然是假值，但不是 null 或者 undefined）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(valC); <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><br><h3 id="11、获取对象属性值"><a href="#11、获取对象属性值" class="headerlink" title="11、获取对象属性值"></a><strong><font color='red'>11、获取对象属性值</font></strong></h3><p>可选链操作符 （?.）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#吐槽：</span><br><span class="line"><span class="keyword">const</span> name = obj &amp;&amp; obj.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">#改进：es6</span><br><span class="line"><span class="keyword">const</span> name = obj?.<span class="property">name</span>;</span><br></pre></td></tr></table></figure><br><h3 id="12、html编码和解码"><a href="#12、html编码和解码" class="headerlink" title="12、html编码和解码"></a><strong><font color='red'>12、html编码和解码</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>用浏览器内部转换器实现html编码（转义）</span><br><span class="line"><span class="attr">htmlEncode</span>: <span class="keyword">function</span> (<span class="params">html</span>) &#123;</span><br><span class="line">    <span class="comment">//1.首先动态创建一个容器标签元素，如DIV</span></span><br><span class="line">    <span class="keyword">var</span> temp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    <span class="comment">//2.然后将要转换的字符串设置为这个元素的innerText或者textContent</span></span><br><span class="line">    (temp.<span class="property">textContent</span> != <span class="literal">undefined</span>) ? (temp.<span class="property">textContent</span> = html) : (temp.<span class="property">innerText</span> = html);</span><br><span class="line">    <span class="comment">//3.最后返回这个元素的innerHTML，即得到经过HTML编码转换的字符串了</span></span><br><span class="line">    <span class="keyword">var</span> output = temp.<span class="property">innerHTML</span>;</span><br><span class="line">    temp = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">htmlEncode</span>(<span class="string">&quot;&lt;div class=&#x27;demo&#x27;&gt;测试&lt;/div&gt;&quot;</span>));</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>用浏览器内部转换器实现html解码（反转义）</span><br><span class="line"><span class="attr">htmlDecode</span>: <span class="keyword">function</span> (<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="comment">//1.首先动态创建一个容器标签元素，如DIV</span></span><br><span class="line">    <span class="keyword">var</span> temp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    <span class="comment">//2.然后将要转换的字符串设置为这个元素的innerHTML(ie，火狐，google都支持)</span></span><br><span class="line">    temp.<span class="property">innerHTML</span> = text;</span><br><span class="line">    <span class="comment">//3.最后返回这个元素的innerText或者textContent，即得到经过HTML解码的字符串了。</span></span><br><span class="line">    <span class="keyword">var</span> output = temp.<span class="property">innerText</span> || temp.<span class="property">textContent</span>;</span><br><span class="line">    temp = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">htmlDecode</span>(<span class="string">&quot;&amp;lt;div class=&#x27;demo&#x27;&amp;gt;测试&amp;lt;/div&amp;gt;&quot;</span>));</span><br></pre></td></tr></table></figure><br><h3 id="13、箭头函数"><a href="#13、箭头函数" class="headerlink" title="13、箭头函数"></a><strong><font color='red'>13、箭头函数</font></strong></h3><p>var func &#x3D; () &#x3D;&gt; ({ foo: 1 });  返回的是括号里面的对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="title function_">prompt</span>(<span class="string">&quot;What is your age?&quot;</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> welcome = (age &lt; <span class="number">18</span>) ? <span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">&#x27;Hello&#x27;</span>) : <span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">&quot;Greetings!&quot;</span>);</span><br><span class="line"><span class="title function_">welcome</span>();</span><br></pre></td></tr></table></figure><p><strong><font color='red' size="3">重要特性</font></strong></p><p><strong><font color='cornflowerblue' size="3">1）没有arguments </font></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1</span>、普通函数中的<span class="variable language_">arguments</span>正确使用：</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">n</span>) &#123;   </span><br><span class="line"> <span class="comment">// arguments[0] 表示传给foo函数的第一个参数，也就是n    </span></span><br><span class="line">    <span class="keyword">var</span> <span class="title function_">f</span> = (<span class="params"></span>) =&gt; <span class="variable language_">arguments</span>[<span class="number">0</span>] + n;    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">f</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">3</span>); <span class="comment">// 6</span></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">3</span>, <span class="number">2</span>);<span class="comment">//6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="number">2</span>、箭头函数中无法使用<span class="variable language_">arguments</span></span><br><span class="line"><span class="comment">// ReferenceError: arguments is not defined</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">func</span> = (<span class="params">a, b</span>) =&gt; &#123;<span class="keyword">return</span> <span class="variable language_">arguments</span>[<span class="number">0</span>];&#125;</span><br></pre></td></tr></table></figure><p><strong><font color='cornflowerblue' size="3">2）没有prototype属性 </font></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">Foo</span> = (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p><strong><font color='cornflowerblue' size="3">3）不能使用new </font></strong></p><p>箭头函数没有this，不能用作构造函数，也就无法使用 new</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">Foo</span> = (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> <span class="title class_">Foo</span>(); <span class="comment">// TypeError: Foo is not a constructor</span></span><br></pre></td></tr></table></figure><br><h3 id="14、初始化一个数组"><a href="#14、初始化一个数组" class="headerlink" title="14、初始化一个数组"></a><strong><font color='red'>14、初始化一个数组</font></strong></h3><p>如果你想初始化一个指定长度的一维数组并指定默认值，你可以这样做。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = <span class="title class_">Array</span>(<span class="number">6</span>).<span class="title function_">fill</span>(<span class="string">&#x27;&#x27;</span>); </span><br><span class="line"><span class="comment">// [&#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]</span></span><br></pre></td></tr></table></figure><p>如果你想初始化一个指定长度的二维数组并指定默认值，你可以这样做。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> matrix = <span class="title class_">Array</span>(<span class="number">6</span>).<span class="title function_">fill</span>(<span class="number">0</span>).<span class="title function_">map</span>(<span class="function">() =&gt;</span> <span class="title class_">Array</span>(<span class="number">5</span>).<span class="title function_">fill</span>(<span class="number">0</span>)); </span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">// [0, 0, 0, 0, 0],</span></span><br><span class="line"><span class="comment">// [0, 0, 0, 0, 0],</span></span><br><span class="line"><span class="comment">// [0, 0, 0, 0, 0],</span></span><br><span class="line"><span class="comment">// [0, 0, 0, 0, 0],</span></span><br><span class="line"><span class="comment">// [0, 0, 0, 0, 0],</span></span><br><span class="line"><span class="comment">// [0, 0, 0, 0, 0],</span></span><br><span class="line"><span class="comment">// ]</span></span><br></pre></td></tr></table></figure><br><h3 id="15、数组求和-最大值-最小值"><a href="#15、数组求和-最大值-最小值" class="headerlink" title="15、数组求和&#x2F;最大值&#x2F;最小值"></a><strong><font color='red'>15、数组求和&#x2F;最大值&#x2F;最小值</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array  = [<span class="number">5</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">2</span>];</span><br></pre></td></tr></table></figure><p><font color='orange'>1）求和 </font></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a,b</span>) =&gt;</span> a+b);</span><br></pre></td></tr></table></figure><p><font color='orange'>2）寻找最大值</font></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a,b</span>) =&gt;</span> a &gt; b ? a : b);  <span class="title class_">Math</span>.<span class="title function_">max</span>(...array)</span><br></pre></td></tr></table></figure><p><font color='orange'>2）寻找最小值</font></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a,b</span>) =&gt;</span> a &lt; b ? a : b);  <span class="title class_">Math</span>.<span class="title function_">min</span>(...array)</span><br></pre></td></tr></table></figure><p>请记住：数组的reduce方法可以用来解决很多数组求值问题。</p><br><h3 id="16、滤错误值"><a href="#16、滤错误值" class="headerlink" title="16、滤错误值"></a><strong><font color='red'>16、滤错误值</font></strong></h3><p>如果要过滤数组中的值，例如 false、0、null、undefined 等，可以这样做。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">0</span>, <span class="literal">undefined</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="string">&#x27;&#x27;</span>, <span class="literal">false</span>];</span><br><span class="line">array.<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line"><span class="comment">// [1, 6, 7]</span></span><br></pre></td></tr></table></figure><br><h3 id="17、空数组"><a href="#17、空数组" class="headerlink" title="17、空数组"></a><strong><font color='red'>17、空数组</font></strong></h3><p>如果要清空数组，可以将数组的长度设置为 0。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>]</span><br><span class="line">array.<span class="property">length</span> = <span class="number">0</span> </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array)  <span class="comment">// []</span></span><br></pre></td></tr></table></figure><br><h3 id="18、计算性能"><a href="#18、计算性能" class="headerlink" title="18、计算性能"></a><strong><font color='red'>18、计算性能</font></strong></h3><p>以下操作可用于计算代码的性能。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> startTime = performance.<span class="title function_">now</span>(); </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;    </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> endTime = performance.<span class="title function_">now</span>();</span><br><span class="line"><span class="keyword">const</span> totaltime = endTime - startTime;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(totaltime); <span class="comment">// 10.3333333</span></span><br></pre></td></tr></table></figure><br><h3 id="19、将数组元素转换为数字"><a href="#19、将数组元素转换为数字" class="headerlink" title="19、将数组元素转换为数字"></a><strong><font color='red'>19、将数组元素转换为数字</font></strong></h3><p>如果有一个数组，并且你想将数组的元素转换为数字，你可以使用 map 方法来完成。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;3.1415&#x27;</span>, <span class="string">&#x27;-10.01&#x27;</span>];</span><br><span class="line">array.<span class="title function_">map</span>(<span class="title class_">Number</span>);  <span class="comment">// [12, 1, 3.1415, -10.01]</span></span><br></pre></td></tr></table></figure><p>这样，map 对数组的每个元素执行 Number 构造函数，并在遍历数组时返回结果。</p><br><h3 id="20、将类数组转换为数组"><a href="#20、将类数组转换为数组" class="headerlink" title="20、将类数组转换为数组"></a><strong><font color='red'>20、将类数组转换为数组</font></strong></h3><p>可以使用以下方法将类数组转换为数组。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br></pre></td></tr></table></figure><p>此外，还可以使用扩展运算符来实现。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[...<span class="variable language_">arguments</span>]</span><br></pre></td></tr></table></figure><br><h3 id="21、对象属性的动态声明"><a href="#21、对象属性的动态声明" class="headerlink" title="21、对象属性的动态声明"></a><strong><font color='red'>21、对象属性的动态声明</font></strong></h3><p>如果你想动态地为一个对象声明属性，你可以这样做。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dynamic = <span class="string">&#x27;color&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> item = &#123;    </span><br><span class="line"><span class="attr">brand</span>: <span class="string">&#x27;Ford&#x27;</span>,</span><br><span class="line">    [dynamic]: <span class="string">&#x27;Blue&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(item); <span class="comment">// &#123; brand: &quot;Ford&quot;, color: &quot;Blue&quot; &#125;</span></span><br></pre></td></tr></table></figure><br><h3 id="22、缩短console-log"><a href="#22、缩短console-log" class="headerlink" title="22、缩短console.log()"></a><strong><font color='red'>22、缩短console.log()</font></strong></h3><p>每次debug都要写很多console.log()会比较麻烦，可以用下面的形式来简化这段代码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> c = <span class="variable language_">console</span>.<span class="property">log</span>.<span class="title function_">bind</span>(<span class="variable language_">document</span>) </span><br><span class="line"><span class="title function_">c</span>(<span class="number">222</span>) </span><br><span class="line"><span class="title function_">c</span>(<span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure><p>这将每次只执行 c 方法。</p><br><h3 id="23、删除数组元素"><a href="#23、删除数组元素" class="headerlink" title="23、删除数组元素"></a><strong><font color='red'>23、删除数组元素</font></strong></h3><p>如果我们想删除一个数组的元素，可以使用delete来完成，但是删除后元素会变成undefined，不会消失，而且执行会消耗很多时间，所以大部分情况下不会满足我们的需求。所以我们可以使用数组的 slice() 方法来删除数组的元素。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>]</span><br><span class="line"><span class="keyword">const</span> arrayRemoveed = array.<span class="title function_">splice</span>(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array)  <span class="comment">// [&quot;c&quot;, &quot;d&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arrayRemoveed)  <span class="comment">// [&quot;a&quot;, &quot;b&quot;]</span></span><br></pre></td></tr></table></figure><br><h3 id="24、检查对象是否为空"><a href="#24、检查对象是否为空" class="headerlink" title="24、检查对象是否为空"></a><strong><font color='red'>24、检查对象是否为空</font></strong></h3><p>如果我们想检查对象是否为空，我们可以使用以下内容。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(&#123;&#125;).<span class="property">length</span>  <span class="comment">// 0</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(&#123;<span class="attr">key</span>: <span class="number">1</span>&#125;).<span class="property">length</span>  <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>Object.keys() 方法用于获取对象的键，它将返回一个包含这些键值的数组。如果返回数组的长度为 0，则该对象必须为空。</p><br><h3 id="25、获取数组中的最后一项"><a href="#25、获取数组中的最后一项" class="headerlink" title="25、获取数组中的最后一项"></a><strong><font color='red'>25、获取数组中的最后一项</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br></pre></td></tr></table></figure><p>1、如果要获取数组中的最后一项，通常会这样编写代码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr[arr.<span class="property">length</span> - <span class="number">1</span>]  <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><p>2、我们也可以使用数组的 slice 方法来获取最后一个元素。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">slice</span>(-<span class="number">1</span>) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><p>当我们将 slice 方法的参数设置为负值时，它会从数组后面开始截取数组值，如果要截取最后两个值，则传入参数-2。</p><p>3、使用“at方法”读取</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">array.<span class="title function_">at</span>(-<span class="number">1</span>) <span class="comment">// 5</span></span><br><span class="line">array.<span class="title function_">at</span>(<span class="number">0</span>) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><br><h3 id="26、数组元素的随机排序"><a href="#26、数组元素的随机排序" class="headerlink" title="26、数组元素的随机排序"></a><strong><font color='red'>26、数组元素的随机排序</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">99</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">7</span>,]</span><br><span class="line"><span class="keyword">const</span> newArr = arr.<span class="title function_">map</span>(<span class="function"><span class="params">val</span> =&gt;</span> (&#123; <span class="attr">v</span>: val, <span class="attr">r</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>() &#125;));</span><br><span class="line">newArr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">r</span> - b.<span class="property">r</span>);</span><br><span class="line"><span class="keyword">const</span> showList = newArr.<span class="title function_">map</span>(<span class="function"><span class="params">val</span> =&gt;</span> val.<span class="property">v</span>).<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">6</span>); <span class="comment">// 截取长度未6的随机数组</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(showList)</span><br></pre></td></tr></table></figure><br><h2 id="四、Vue"><a href="#四、Vue" class="headerlink" title="四、Vue"></a><strong>四、Vue</strong></h2><h3 id="1、computed中使用this？"><a href="#1、computed中使用this？" class="headerlink" title="1、computed中使用this？"></a><strong><font color='red'>1、computed中使用this？</font></strong></h3><p>我们通过this能访问到的数据，在computed的第一个参数上都能结构出来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">address</span>: <span class="string">&#x27;黄山&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="title function_">haha</span>(<span class="params">&#123; address, $attrs, $route, $store, $listeners, $ref &#125;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(address) <span class="comment">// 黄山</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="2、避免v-if和v-for一起使用"><a href="#2、避免v-if和v-for一起使用" class="headerlink" title="2、避免v-if和v-for一起使用"></a><strong><font color='red'>2、避免v-if和v-for一起使用</font></strong></h3><p>在vue的源码中有一段代码是对指令的优先级的处理</p><p><strong>不好的</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#吐槽：</span><br><span class="line"># 这段代码是先处理v-<span class="keyword">for</span>再处理v-<span class="keyword">if</span>的</span><br><span class="line"><span class="comment">// 比如这个列表有一百条数据，再某种情况下，它们都不需要显示，当vue还是会循环这个100条数据显示，再去判断v-if，因此，我们应该避免这种情况的出现。</span></span><br><span class="line"></span><br><span class="line">&lt;h3 v-<span class="keyword">if</span>=<span class="string">&quot;status&quot;</span> v-<span class="keyword">for</span>=<span class="string">&quot;item in 100&quot;</span> :key=<span class="string">&quot;item&quot;</span>&gt;&#123;&#123;item&#125;&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">#优化</span><br><span class="line">&lt;template v-<span class="keyword">if</span>=<span class="string">&quot;status&quot;</span> &gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-for</span>=<span class="string">&quot;item in 100&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><br><h3 id="3、修饰符sync"><a href="#3、修饰符sync" class="headerlink" title="3、修饰符sync"></a><strong><font color='red'>3、修饰符sync</font></strong></h3><p>vue 修饰符sync的功能是：当一个子组件改变了一个 prop 的值时，这个变化也会同步到父组件中所绑定</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line">template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Toggle</span> <span class="attr">:show.sync</span> = <span class="string">&#x27;isShow&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">Toggle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="title function_">data</span> () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">isShow</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;script&gt;  </span><br><span class="line"> </span><br><span class="line"># 等同于上面的写法</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line">template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Toggle</span> <span class="attr">:show</span> = <span class="string">&#x27;isShow&#x27;</span> @<span class="attr">update:show</span>=<span class="string">&quot;change&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Toggle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">props</span>:&#123;</span><br><span class="line">            <span class="attr">isShow</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Boolean</span></span><br><span class="line">        &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="title function_">data</span> () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">isShow</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">        <span class="attr">method</span>: &#123;</span><br><span class="line">            <span class="title function_">change</span>(<span class="params">val</span>) &#123; <span class="comment">// 子组件传来的false</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isShow</span> = val</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    展示和隐藏组件</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;test&quot;</span>&gt;</span>隐藏组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">props</span>:[<span class="string">&#x27;show&#x27;</span>],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">test</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;update:show&#x27;</span>,<span class="literal">false</span>) <span class="comment">//触发 input 事件，并传入新值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br><h2 id="五、IOS和安卓踩坑"><a href="#五、IOS和安卓踩坑" class="headerlink" title="五、IOS和安卓踩坑"></a><strong>五、IOS和安卓踩坑</strong></h2><h3 id="1、IOS滑动不流畅"><a href="#1、IOS滑动不流畅" class="headerlink" title="1、IOS滑动不流畅"></a><strong><font color='red'>1、IOS滑动不流畅</font></strong></h3><p><strong><font color='#10c300'>表现</font></strong></p><p>上下滑动页面会产生卡顿，手指离开页面，页面立即停止运动。整体表现就是滑动不流畅，没有滑动惯性。</p><br><p><strong><font color='#10c300'>为什么 iOS 的 webview 中 滑动不流畅，它是如何定义的？</font></strong></p><p>原来在 iOS 5.0 以及之后的版本，滑动 -webkit-overflow-scrolling 有定义有两个值 <code>auto</code> 和 <code>touch</code>，默认值为 <code>auto</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-webkit-<span class="attribute">overflow</span>-scrolling: touch; <span class="comment">/* 当手指从触摸屏上移开，会保持一段时间的滚动 */</span></span><br><span class="line"></span><br><span class="line">-webkit-<span class="attribute">overflow</span>-scrolling: auto; <span class="comment">/* 当手指从触摸屏上移开，滚动会立即停止 */</span></span><br></pre></td></tr></table></figure><br><p><strong><font color='#10c300'>解决方案</font></strong></p><p><strong><font color='cornflowerblue' size="3">1）在 滚动容器上 增加滚动 touch 方法 </font></strong></p><p>将<code>-webkit-overflow-scrolling</code> 值设置为 <code>touch</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">overflow</span>-scrolling: touch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>设置滚动条隐藏： <code>.container ::-webkit-scrollbar &#123;display: none;&#125;</code></p></blockquote><p>可能会导致使用<code>position:fixed;</code> 固定定位的元素，随着页面一起滚动</p><p><strong><font color='cornflowerblue' size="3">2）设置 overflow</font></strong></p><p>设置外部 <code>overflow</code> 为 <code>hidden</code>,设置内容元素 <code>overflow</code> 为 <code>auto</code>。内部元素超出 body 即产生滚动，超出的部分 body 隐藏。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">overflow-y</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>两者结合使用更佳！</p><br><h3 id="2、click-点击事件延时与穿透"><a href="#2、click-点击事件延时与穿透" class="headerlink" title="2、click 点击事件延时与穿透"></a><strong><font color='red'>2、click 点击事件延时与穿透</font></strong></h3><p><strong><font color='#10c300'>表现</font></strong></p><p>监听元素 <code>click</code> 事件，点击元素触发时间延迟约 <code>300ms</code>。点击蒙层，蒙层消失后，下层元素点击触发。</p><br><p><strong><font color='#10c300'>为什么会产生 click 延时？</font></strong></p><p>iOS 中的 safari，为了实现双击缩放操作，在单击 300ms 之后，如果未进行第二次点击，则执行 <code>click</code> 单击操作。也就是说来判断用户行为是否为双击产生的。但是，在 App 中，无论是否需要双击缩放这种行为，<code>click</code> 单击都会产生 300ms 延迟。</p><br><p><strong><font color='#10c300'>为什么会产生 click 点击穿透？</font></strong></p><p>双层元素叠加时，在上层元素上绑定 <code>touch</code> 事件，下层元素绑定 <code>click</code> 事件。由于 <code>click</code> 发生在 <code>touch</code> 之后，点击上层元素，元素消失，下层元素会触发 <code>click</code> 事件，由此产生了点击穿透的效果</p><br><p><strong><font color='#10c300'>原理与解决方案</font></strong></p><p><strong><font color='cornflowerblue' size="3">1）使用 touchstart 替换 click</font></strong></p><p>移动设备不仅支持点击还支持触摸事件。那么我们现在基本思路就是用 <code>touch</code> 事件代替<code>click</code> 事件。</p><p>将 <code>click</code> 替换成 <code>touchstart</code> 不仅解决了 <code>click</code> 事件延时问题，还解决了穿透问题。因为穿透问题是在 <code>touch</code> 和 <code>click</code> 混用时产生。</p><p>在原生中使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">el.addEventListener(&quot;touchstart&quot;, () =&gt; &#123; console.log(&quot;ok&quot;); &#125;, false);</span><br></pre></td></tr></table></figure><p>在 vue 中使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @touchstart=&quot;handleTouchstart()&quot;&gt;点击&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>开源解决方案中，也是既提供了 <code>click</code> 事件，又提供了<code>touchstart</code> 事件。如 vant 中的 <code>button</code> 组件</p><p><strong><font color='cornflowerblue' size="3">2）使用 fastclick 库</font></strong></p><p>使用 <code>npm/yarn</code> 安装后使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import FastClick from &#x27;fastclick&#x27;;</span><br><span class="line"></span><br><span class="line">FastClick.attach(document.body, options);</span><br></pre></td></tr></table></figure><p>同样，使用<code>fastclick</code>库后，<code>click</code> 延时和穿透问题都没了</p><br><h3 id="3、软键盘将页面顶起来、收起未回落问题"><a href="#3、软键盘将页面顶起来、收起未回落问题" class="headerlink" title="3、软键盘将页面顶起来、收起未回落问题"></a><strong><font color='red'>3、软键盘将页面顶起来、收起未回落问题</font></strong></h3><p><strong><font color='#10c300'>表现</font></strong></p><p>Android 手机中，点击 <code>input</code> 框时，键盘弹出，将页面顶起来，导致页面样式错乱。</p><p>移开焦点时，键盘收起，键盘区域空白，未回落。</p><br><p><strong><font color='#10c300'>产生原因</font></strong></p><p>我们在app 布局中会有个固定的底部。安卓一些版本中，输入弹窗出来，会将解压 <code>absolute</code> 和 <code>fixed</code> 定位的元素。导致可视区域变小，布局错乱。</p><br><p><strong><font color='#10c300'>原理与解决方案</font></strong></p><p>软键盘将页面顶起来的解决方案，主要是通过监听页面高度变化，强制恢复成弹出前的高度。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 记录原有的视口高度</span></span><br><span class="line"><span class="keyword">const</span> originalHeight = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> || <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onresize</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> resizeHeight = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span> || <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span>;</span><br><span class="line">  <span class="keyword">if</span>(resizeHeight &lt; originalHeight )&#123;</span><br><span class="line">    <span class="comment">// 恢复内容区域高度</span></span><br><span class="line">    <span class="comment">// const container = document.getElementById(&quot;container&quot;)</span></span><br><span class="line">    <span class="comment">// 例如 container.style.height = originalHeight;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>键盘不能回落问题出现在 iOS 12+ 和 wechat 6.7.4+ 中，而在微信 H5 开发中是比较常见的 Bug。</p><p>兼容原理，1.判断版本类型 2.更改滚动的可视区域</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isWechat = <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">userAgent</span>.<span class="title function_">match</span>(<span class="regexp">/MicroMessenger\/([\d\.]+)/i</span>);</span><br><span class="line"><span class="keyword">if</span> (!isWechat) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">const</span> wechatVersion = wechatInfo[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">const</span> version = (navigator.<span class="property">appVersion</span>).<span class="title function_">match</span>(<span class="regexp">/OS (\d+)_(\d+)_?(\d+)?/</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 如果设备类型为iOS 12+ 和wechat 6.7.4+，恢复成原来的视口</span></span><br><span class="line"><span class="keyword">if</span> (+wechatVersion.<span class="title function_">replace</span>(<span class="regexp">/\./g</span>, <span class="string">&#x27;&#x27;</span>) &gt;= <span class="number">674</span> &amp;&amp; +version[<span class="number">1</span>] &gt;= <span class="number">12</span>) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span>, <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>window.scrollTo(x-coord, y-coord)</code>，其中<code>window.scrollTo(0, clientHeight)</code>恢复成原来的视口</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一、HTML&quot;&gt;&lt;a href=&quot;#一、HTML&quot; class=&quot;headerlink&quot; title=&quot;一、HTML&quot;&gt;&lt;/a&gt;&lt;strong&gt;一、HTML&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;暂无&lt;/p&gt;
&lt;br&gt;

&lt;h2 id=&quot;二、CSS&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="其他" scheme="http://example.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
    <category term="css" scheme="http://example.com/tags/css/"/>
    
    <category term="前端" scheme="http://example.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="javaScript" scheme="http://example.com/tags/javaScript/"/>
    
    <category term="vue" scheme="http://example.com/tags/vue/"/>
    
    <category term="vue3" scheme="http://example.com/tags/vue3/"/>
    
    <category term="html" scheme="http://example.com/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>Sentry集成与hidden-source-map源码溯源指南</title>
    <link href="http://example.com/posts/f8a2c3d9xr.html"/>
    <id>http://example.com/posts/f8a2c3d9xr.html</id>
    <published>2026-03-01T23:50:00.000Z</published>
    <updated>2026-03-01T16:07:38.354Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Sentry集成与hidden-source-map源码溯源指南"><a href="#Sentry集成与hidden-source-map源码溯源指南" class="headerlink" title="Sentry集成与hidden-source-map源码溯源指南"></a>Sentry集成与hidden-source-map源码溯源指南</h1><blockquote><p>📚 本方案将指导你如何在 Webpack 5 项目中集成 Sentry，实现生产环境的自动错误捕获和源码还原。</p></blockquote><hr><h2 id="一、背景知识"><a href="#一、背景知识" class="headerlink" title="一、背景知识"></a>一、背景知识</h2><h3 id="1-1、什么是-SourceMap？"><a href="#1-1、什么是-SourceMap？" class="headerlink" title="1.1、什么是 SourceMap？"></a><strong><font color='red'>1.1、什么是 SourceMap？</font></strong></h3><p>SourceMap（源代码映射）是一个用来生成源代码与构建后代码一一映射的文件的方案。</p><p>它会生成一个 <code>xxx.map</code> 文件，里面包含源代码和构建后代码每一行、每一列的映射关系。当构建后代码出错了，会通过 <code>xxx.map</code> 文件，从构建后代码出错位置找到映射后源代码出错位置，从而让浏览器提示源代码文件出错位置，帮助我们更快的找到错误根源。</p><hr><h3 id="1-2、开发环境的-SourceMap-配置"><a href="#1-2、开发环境的-SourceMap-配置" class="headerlink" title="1.2、开发环境的 SourceMap 配置"></a><strong><font color='red'>1.2、开发环境的 SourceMap 配置</font></strong></h3><p>开发环境推荐使用 <code>cheap-module-source-map</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><table><thead><tr><th>特点</th><th>说明</th></tr></thead><tbody><tr><td>✅ 优点</td><td>打包编译速度快，只包含行映射，可直接查看源码</td></tr><tr><td>❌ 缺点</td><td>没有列映射（不影响开发调试）</td></tr></tbody></table><hr><h3 id="1-3、生产环境的-SourceMap-配置"><a href="#1-3、生产环境的-SourceMap-配置" class="headerlink" title="1.3、生产环境的 SourceMap 配置"></a><strong><font color='red'>1.3、生产环境的 SourceMap 配置</font></strong></h3><p>在生产环境中，是否配置 SourceMap 取决于<strong>公司对性能、安全和调试便利性</strong>的权衡。目前主流的做法有以下几种：</p><h4 id="方案一：配置-source-map（最常见）"><a href="#方案一：配置-source-map（最常见）" class="headerlink" title="方案一：配置 source-map（最常见）"></a>方案一：配置 <code>source-map</code>（最常见）</h4><p>大多数中大型项目的 <code>webpack.prod.js</code> 都会配置此选项。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>特点：</strong></p><ul><li>打包后会生成主 JS 文件（如 <code>main.js</code>）和一个对应的 <code>.map</code> 文件</li><li>打包文件末尾会添加 <code>//# sourceMappingURL=xxx.js.map</code> 注释</li></ul><table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>✅ 错误溯源方便，监控系统可利用 <code>.map</code> 文件还原源码行数</td><td>❌ 打包编译速度慢</td></tr><tr><td>✅ 主包体积不受影响，<code>.map</code> 文件独立，用户访问时不会下载</td><td>❌ 源码暴露风险，懂行的用户可通过控制台查看源码</td></tr></tbody></table><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228165327466.png" alt="image-20260228165327466"></p><blockquote><p><code>//# sourceMappingURL</code> 的核心作用：<strong>告诉浏览器去哪里下载对应的 SourceMap 文件，从而实现生产代码到开发源码的精准映射。</strong></p></blockquote><h4 id="方案二：配置-hidden-source-map（推荐-Sentry）"><a href="#方案二：配置-hidden-source-map（推荐-Sentry）" class="headerlink" title="方案二：配置 hidden-source-map（推荐 + Sentry）"></a>方案二：配置 <code>hidden-source-map</code>（推荐 + Sentry）</h4><p>如果你既想在后台监控错误，又不希望用户在浏览器控制台看到源码，这是最佳方案。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;hidden-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>特点：</strong></p><ul><li>✅ 会生成 <code>.map</code> 文件</li><li>❌ 打包后的 JS 文件结尾<strong>不会产生</strong> <code>//# sourceMappingURL=...</code> 的引用注释</li><li>🔒 浏览器控制台不会自动关联源码，报错只显示压缩后的行数</li><li>📤 可将 <code>.map</code> 文件上传到 Sentry 等私有监控平台，实现内部调试</li></ul><table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td>🔒 <strong>安全性</strong></td><td>生成的 <code>.map</code> 文件不会在代码中引用，用户无法在浏览器控制台直接查看源码</td></tr><tr><td>🔐 <strong>隐私性</strong></td><td>防止源码通过浏览器开发者工具被轻易获取，保护业务逻辑</td></tr><tr><td>🎯 <strong>精准定位</strong></td><td>Sentry 服务器持有 SourceMap，可以精准还原错误位置</td></tr><tr><td>⚖️ <strong>平衡性</strong></td><td>既保证了线上代码的安全性，又能在 Sentry 后台看到详细的错误堆栈</td></tr></tbody></table><h4 id="方案三：不配置-SourceMap（极致安全）"><a href="#方案三：不配置-SourceMap（极致安全）" class="headerlink" title="方案三：不配置 SourceMap（极致安全）"></a>方案三：不配置 SourceMap（极致安全）</h4><p>如果项目非常敏感（比如金融、保密项目），或者是一个极简的小项目，可以选择完全不配置。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="literal">false</span>,  <span class="comment">// 或不写此配置</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>特点：</strong></p><ul><li>❌ 不生成任何映射文件</li><li>❌ 压缩后的代码完全无法调试</li><li>⚠️ 线上出 bug 只能通过”盲猜”或在本地模拟数据来复现</li></ul><hr><h3 id="1-4、生产环境配置总结"><a href="#1-4、生产环境配置总结" class="headerlink" title="1.4、生产环境配置总结"></a><strong><font color='red'>1.4、生产环境配置总结</font></strong></h3><table><thead><tr><th>项目类型</th><th>推荐配置</th><th>说明</th></tr></thead><tbody><tr><td>中小型项目&#x2F;后台管理系统</td><td><code>source-map</code></td><td>调试效率第一</td></tr><tr><td>大型互联网产品&#x2F;C端应用</td><td><code>hidden-source-map</code> + SentrySentry&#x2F;私有监控</td><td>兼顾安全与调试</td></tr><tr><td>金融&#x2F;保密项目</td><td>不配置</td><td>极致安全</td></tr><tr><td>个人练习项目</td><td><code>source-map</code></td><td>方便学习调试</td></tr></tbody></table><hr><h3 id="1-5、hidden-source-map-Sentry-工作原理"><a href="#1-5、hidden-source-map-Sentry-工作原理" class="headerlink" title="1.5、hidden-source-map + Sentry 工作原理"></a><strong><font color='red'>1.5、hidden-source-map + Sentry 工作原理</font></strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────────────────┐</span><br><span class="line">│                      构建阶段                                </span><br><span class="line">├─────────────────────────────────────────────────────────────┤</span><br><span class="line">│  源码 (main.js)  ──编译压缩──&gt;  bundle.js + bundle.js.map </span><br><span class="line">│                                                            </span><br><span class="line">│  hidden-source-map 模式：                                   </span><br><span class="line">│  ✅ 生成 bundle.js.map 文件                                 </span><br><span class="line">│  ❌ 不在 bundle.js 末尾添加 sourceMappingURL 注释           </span><br><span class="line">└─────────────────────────────────────────────────────────────┘</span><br><span class="line">                            │</span><br><span class="line">                            ▼</span><br><span class="line">┌─────────────────────────────────────────────────────────────┐</span><br><span class="line">│                      部署阶段                                </span><br><span class="line">├─────────────────────────────────────────────────────────────┤</span><br><span class="line">│  bundle.js      ──上传到服务器──&gt;  用户访问（无源码暴露）    </span><br><span class="line">│  bundle.js.map  ──上传到 Sentry──&gt; 错误追踪时还原源码       </span><br><span class="line">└─────────────────────────────────────────────────────────────┘</span><br><span class="line">                            │</span><br><span class="line">                            ▼</span><br><span class="line">┌─────────────────────────────────────────────────────────────┐</span><br><span class="line">│                      错误发生时                              </span><br><span class="line">├─────────────────────────────────────────────────────────────┤</span><br><span class="line">│  用户浏览器：只能看到 bundle.js:1:23456                      </span><br><span class="line">│  Sentry 后台：通过 .map 文件还原为 main.js:42:15            </span><br><span class="line">└─────────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure><hr><h2 id="二、准备工作"><a href="#二、准备工作" class="headerlink" title="二、准备工作"></a>二、准备工作</h2><h3 id="2-1、注册-Sentry-账号"><a href="#2-1、注册-Sentry-账号" class="headerlink" title="2.1、注册 Sentry 账号"></a><strong><font color='red'>2.1、注册 Sentry 账号</font></strong></h3><p>访问 <a href="https://sentry.io/">Sentry.io</a> 注册账号</p><h3 id="2-2、创建项目（Project）"><a href="#2-2、创建项目（Project）" class="headerlink" title="2.2、创建项目（Project）"></a><strong><font color='red'>2.2、创建项目（Project）</font></strong></h3><p>选择 Browser JavaScript（根据自己项目来）</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228151819711.png" alt="image-20260228151819711"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228152001432.png" alt="image-20260228152001432"></p><h3 id="2-3、设置-Sentry-SDK"><a href="#2-3、设置-Sentry-SDK" class="headerlink" title="2.3、设置 Sentry SDK"></a><strong><font color='red'>2.3、设置 Sentry SDK</font></strong></h3><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228152054610.png" alt="image-20260228152054610"></p><h3 id="2-4、获取-DSN"><a href="#2-4、获取-DSN" class="headerlink" title="2.4、获取 DSN"></a><strong><font color='red'>2.4、获取 DSN</font></strong></h3><p>格式类似 <code>https://xxxxxx@sentry.io/12345</code>。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228152309729.png" alt="image-20260228152309729"></p><p><strong>或者选择项目后，再鼠标放置设置图标上：</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228155828037.png" alt="image-20260228155828037"></p><hr><h2 id="三、安装依赖"><a href="#三、安装依赖" class="headerlink" title="三、安装依赖"></a>三、安装依赖</h2><p>在项目根目录下执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install @sentry/browser</span><br><span class="line">npm install @sentry/webpack-plugin --save-dev</span><br></pre></td></tr></table></figure><hr><h2 id="四、代码集成"><a href="#四、代码集成" class="headerlink" title="四、代码集成"></a>四、代码集成</h2><h3 id="4-1、SDK-初始化"><a href="#4-1、SDK-初始化" class="headerlink" title="4.1、SDK 初始化"></a><strong><font color='red'>4.1、SDK 初始化</font></strong></h3><p>在入口文件（如 <code>src/main.js</code>）的顶部引入并初始化：</p><p><strong><code>main.js</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Sentry</span> <span class="keyword">from</span> <span class="string">&quot;@sentry/browser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Sentry</span>.<span class="title function_">init</span>(&#123;</span><br><span class="line">  <span class="attr">dsn</span>: <span class="string">&quot;https://5fef42a12263056007b7df042b39a53b@o4510962147393536.ingest.de.sentry.io/4510962153619536&quot;</span>,</span><br><span class="line">  <span class="attr">integrations</span>: [</span><br><span class="line">    <span class="title class_">Sentry</span>.<span class="title function_">browserTracingIntegration</span>(),</span><br><span class="line">    <span class="title class_">Sentry</span>.<span class="title function_">replayIntegration</span>(),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 性能监控采样率</span></span><br><span class="line">  <span class="attr">tracesSampleRate</span>: <span class="number">1.0</span>,</span><br><span class="line">  <span class="comment">// Session Replay 采样率</span></span><br><span class="line">  <span class="attr">replaysSessionSampleRate</span>: <span class="number">0.1</span>,</span><br><span class="line">  <span class="attr">replaysOnErrorSampleRate</span>: <span class="number">1.0</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h2 id="五、Webpack-配置自动上传-SourceMap"><a href="#五、Webpack-配置自动上传-SourceMap" class="headerlink" title="五、Webpack 配置自动上传 SourceMap"></a>五、Webpack 配置自动上传 SourceMap</h2><p>这是生产环境最重要的步骤，确保 Sentry 能根据混淆代码还原源码。</p><p><strong><code>webpack.prod.js</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; sentryWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;@sentry/webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;hidden-source-map&quot;</span>, <span class="comment">// ✨ 安全推荐：生成 map 但不添加关联注释，防止浏览器控制台泄露源码</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ... 其他插件</span></span><br><span class="line">    <span class="title function_">sentryWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">authToken</span>: <span class="string">&quot;你的 Sentry Token&quot;</span>,</span><br><span class="line">      <span class="attr">org</span>: <span class="string">&quot;你的组织名&quot;</span>,</span><br><span class="line">      <span class="attr">project</span>: <span class="string">&quot;你的项目名&quot;</span>,</span><br><span class="line">      <span class="attr">sourcemaps</span>: &#123;</span><br><span class="line">        <span class="attr">assets</span>: [<span class="string">&quot;./dist/**&quot;</span>],</span><br><span class="line">        <span class="attr">ignore</span>: [<span class="string">&quot;node_modules&quot;</span>, <span class="string">&quot;config&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="5-1、authToken"><a href="#5-1、authToken" class="headerlink" title="5.1、authToken"></a><strong><font color='red'>5.1、authToken</font></strong></h3><p><strong>1. 推荐使用：Personal Tokens（个人令牌）</strong></p><p>这是最通用的选择，也是 Sentry 引导页面通常推荐的方式。</p><ul><li><strong>优点</strong>：配置最简单。在 <code>sentryWebpackPlugin</code> 配置中，你只需要提供一个 <code>authToken</code> 即可。它代表的是”你”这个开发者在 Sentry 里的权限。</li><li><strong>权限要求</strong>：创建时至少勾选 <code>project:write</code>、<code>project:releases</code> 和 <code>org:read</code>。</li></ul><p><strong>2. 企业级选择：Organization Tokens（组织令牌）</strong></p><p>这通常用于公司层面的 CI&#x2F;CD 自动化流水线。</p><ul><li><strong>优点</strong>：与具体的个人账号解耦。即使某个员工离职了，只要组织令牌还在，自动化部署就不会挂掉。</li><li><strong>配置差异</strong>：使用组织令牌时，有时在较老的插件版本中需要明确指定组织范围，但在最新的 <code>sentryWebpackPlugin</code> (v2&#x2F;v5) 中，它的使用方式和 Personal Token 基本一致。</li></ul><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228155519933.png" alt="image-20260228155519933"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228154656332.png" alt="image-20260228154656332"></p><h3 id="5-2、org-组织名"><a href="#5-2、org-组织名" class="headerlink" title="5.2、org 组织名"></a><strong><font color='red'>5.2、org 组织名</font></strong></h3><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228155436973.png" alt="image-20260228155436973"></p><h3 id="5-3、project-项目名"><a href="#5-3、project-项目名" class="headerlink" title="5.3、project 项目名"></a><strong><font color='red'>5.3、project 项目名</font></strong></h3><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228155646709.png" alt="image-20260228155646709"></p><hr><h2 id="六、验证"><a href="#六、验证" class="headerlink" title="六、验证"></a>六、验证</h2><p>在代码中手动抛出一个错误：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">pre, cur</span>) =&gt;</span> pre + cur, <span class="number">0</span>)();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure><p>执行 <code>npm run build</code> 打包并运行代码。片刻后，你将在 Sentry 后台看到这个错误，并且它能精准定位到 <code>main.js</code> 的具体行数。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228160213461.png" alt="image-20260228160213461"></p><p>配置 <code>devtool: &quot;hidden-source-map&quot;</code> 后，浏览器控制台定位不到是哪个文件哪一行报错的。</p><p>Sentry 中则可以详细看到那个文件、那一行报错：</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260228160425665.png" alt="image-20260228160425665"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Sentry集成与hidden-source-map源码溯源指南&quot;&gt;&lt;a href=&quot;#Sentry集成与hidden-source-map源码溯源指南&quot; class=&quot;headerlink&quot; title=&quot;Sentry集成与hidden-source-map源码</summary>
      
    
    
    
    <category term="工程化与质量" scheme="http://example.com/categories/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B8%8E%E8%B4%A8%E9%87%8F/"/>
    
    
    <category term="Webpack" scheme="http://example.com/tags/Webpack/"/>
    
    <category term="Sentry" scheme="http://example.com/tags/Sentry/"/>
    
    <category term="SourceMap" scheme="http://example.com/tags/SourceMap/"/>
    
  </entry>
  
  <entry>
    <title>Babel 7 从入门到进阶的全场景指南</title>
    <link href="http://example.com/posts/b41c92e1.html"/>
    <id>http://example.com/posts/b41c92e1.html</id>
    <published>2026-02-27T22:30:00.000Z</published>
    <updated>2026-03-01T16:07:38.354Z</updated>
    
    <content type="html"><![CDATA[<h1 id="🚀-彻底搞懂-Babel：从入门到进阶的全场景指南"><a href="#🚀-彻底搞懂-Babel：从入门到进阶的全场景指南" class="headerlink" title="🚀 彻底搞懂 Babel：从入门到进阶的全场景指南"></a>🚀 彻底搞懂 Babel：从入门到进阶的全场景指南</h1><blockquote><p>📚 本指南旨在帮助开发者彻底掌握 Babel 7+ 的工作机制、配置技巧及核心插件系统的使用。</p></blockquote><hr><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol><li><a href="#%E4%B8%80-babel-%E7%AE%80%E4%BB%8B">Babel 简介</a></li><li><a href="#%E4%BA%8C-5-%E5%88%86%E9%92%9F%E6%90%9E%E6%87%82-babel-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F">工作方式</a></li><li><a href="#%E4%B8%89-%E6%9C%80%E5%B0%8F%E5%8F%AF%E8%BF%90%E8%A1%8C%E7%A4%BA%E4%BE%8B">快速上手</a></li><li><a href="#%E5%9B%9B-%E5%BF%85%E9%A1%BB%E5%BC%84%E6%87%82%E7%9A%84-4-%E4%B8%AA%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">核心概念</a></li><li><a href="#%E4%BA%94-preset-env--core-js">Polyfill 实战</a></li><li><a href="#%E5%85%AD-runtime-%E4%B8%8E-polyfill-%E7%9A%84%E5%8C%BA%E5%88%AB">Runtime 优化</a></li><li><a href="#%E4%B8%83-babel-%E4%B8%8E-ts--react-%E7%BB%93%E5%90%88">生态集成</a></li><li><a href="#%E5%85%AB-babel-%E5%9C%A8-webpack-%E5%92%8C-vite-%E4%B8%AD%E7%9A%84%E7%94%9F%E6%80%81%E5%AE%9A%E4%BD%8D">打包构建</a></li><li><a href="#%E4%B9%9D-ast%E9%81%8D%E5%8E%86%E4%B8%8E%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E9%80%9F%E9%80%9A">高级原理</a></li><li><a href="#%E5%8D%81-%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA-babel-%E6%8F%92%E4%BB%B6">插件开发</a></li><li><a href="#%E5%8D%81%E4%B8%80-%E7%BB%88%E6%9E%81%E4%B8%80%E9%94%AE%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%A8%A1%E6%9D%BF">配置模板</a></li></ol><br><h2 id="一、-Babel-简介"><a href="#一、-Babel-简介" class="headerlink" title="一、 Babel 简介"></a><strong>一、 Babel 简介</strong></h2><h3 id="1-1-Babel-是什么？解决什么问题？"><a href="#1-1-Babel-是什么？解决什么问题？" class="headerlink" title="1.1 Babel 是什么？解决什么问题？"></a><strong><font color='red'>1.1 Babel 是什么？解决什么问题？</font></strong></h3><p><strong>一句话</strong>：Babel 是一个 <strong>JavaScript 编译器（Compiler &#x2F; Transpiler）</strong>，把“你写的现代 JS&#x2F;TS&#x2F;JSX”等代码，转换成“目标环境（老版浏览器&#x2F;Node）能平稳运行的代码”。</p><p>你会在这些场景用到 Babel：</p><ul><li><strong>降级新语法</strong>：把 ES202x 新语法转成旧语法（比如可选链 <code>?.</code>、空值合并 <code>??</code>、class 私有字段等）。</li><li><strong>编译 JSX</strong>：把 React 或 Vue 的 JSX 转成 <code>React.createElement</code> 或 <code>jsx-runtime</code> 的原生函数调用形式。</li><li><strong>擦除 TypeScript</strong>：把 TypeScript 里的类型声明直接去掉（<strong>注意：Babel 不做任何类型检查</strong>）。</li><li><strong>做代码定制化变换</strong>：比如自动注入日志、移除 <code>console.log</code>、按需引入组件库样式、甚至开发自己的宏（Macros），这些通常靠 Babel 插件完成。</li></ul><hr><br><h2 id="二、-5-分钟搞懂-Babel-的工作方式"><a href="#二、-5-分钟搞懂-Babel-的工作方式" class="headerlink" title="二、 5 分钟搞懂 Babel 的工作方式"></a><strong>二、 5 分钟搞懂 Babel 的工作方式</strong></h2><h3 id="2-1-编译流水线"><a href="#2-1-编译流水线" class="headerlink" title="2.1 编译流水线"></a><strong><font color='red'>2.1 编译流水线</font></strong></h3><p>Babel 编译其实就是一条 3 步走的流水线：</p><ol><li><strong>Parse（解析）</strong>：源码字符串 → <strong>AST（抽象语法树）</strong></li><li><strong>Transform（转换）</strong>：对 AST 节点做各种增删改操作（<strong>Babel 插件全在这里工作</strong>）</li><li><strong>Generate（生成）</strong>：修改后的 AST → 新代码字符串（以及对应的 SourceMap）</li></ol><blockquote><p>💡 <strong>核心结论</strong>：</p><ul><li>Babel 自己的“本能”其实很弱，所有的实际能力都来自 <strong>插件（Plugins）</strong>。</li><li>但你不可能为了编译一个项目一个个去手写或安装几十个插件，所以官方提供了 <strong>预设（Presets）</strong>（即一组打包好的插件集合）。</li></ul></blockquote><hr><br><h2 id="三、-最小可运行示例"><a href="#三、-最小可运行示例" class="headerlink" title="三、 最小可运行示例"></a><strong>三、 最小可运行示例</strong></h2><blockquote><p>⚠️ <strong>避坑指南</strong>：Babel 7 开始，所有官方包都移入了 <code>@babel/</code> 作用域命名空间。如果你在网上查教程，看到 <code>babel-core</code>、<code>babel-preset-env</code>（没有 <code>@</code> 开头的），请直接关闭网页，那是老旧的 Babel 6 黑历史！</p></blockquote><h3 id="3-1-安装核心包"><a href="#3-1-安装核心包" class="headerlink" title="3.1 安装核心包"></a><strong><font color='red'>3.1 安装核心包</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @babel/core @babel/cli</span><br></pre></td></tr></table></figure><h3 id="3-2-写一个最简单的配置"><a href="#3-2-写一个最简单的配置" class="headerlink" title="3.2 写一个最简单的配置"></a><strong><font color='red'>3.2 写一个最简单的配置</font></strong></h3><p>创建 <code>babel.config.json</code>（Babel 7 推荐，放置在项目根目录）：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-3-尝试编译"><a href="#3-3-尝试编译" class="headerlink" title="3.3 尝试编译"></a><strong><font color='red'>3.3 尝试编译</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx babel src --out-dir dist</span><br></pre></td></tr></table></figure><p><em>你会发现：不加任何 preset 或 plugin 时，Babel 输出的代码和源码一模一样。因为它“没有被灌输任何变换规则”。</em></p><hr><br><h2 id="四、-必须弄懂的-4-个核心概念"><a href="#四、-必须弄懂的-4-个核心概念" class="headerlink" title="四、 必须弄懂的 4 个核心概念"></a><strong>四、 必须弄懂的 4 个核心概念</strong></h2><h3 id="4-1-babel-core-是什么？"><a href="#4-1-babel-core-是什么？" class="headerlink" title="4.1 @babel&#x2F;core 是什么？"></a><strong><font color='red'>4.1 @babel&#x2F;core 是什么？</font></strong></h3><p>Babel 核心编译引擎，负责解析代码、调度执行配置好的插件、生成最终代码。但其实它自己什么语法都不会转。</p><h3 id="4-2-Plugin（插件）是什么？"><a href="#4-2-Plugin（插件）是什么？" class="headerlink" title="4.2 Plugin（插件）是什么？"></a><strong><font color='red'>4.2 Plugin（插件）是什么？</font></strong></h3><p>插件就是一个 JS 模块，负责告诉 Babel：遇到某种特定的 AST 节点时，该怎么改。<br><em>例如：遇到“箭头函数”，就把它转成 <code>function () &#123;&#125;</code>；遇到 <code>?.</code>，就改成安全的兼容判断。</em></p><h3 id="4-3-Preset（预设）是什么？"><a href="#4-3-Preset（预设）是什么？" class="headerlink" title="4.3 Preset（预设）是什么？"></a><strong><font color='red'>4.3 Preset（预设）是什么？</font></strong></h3><p>预设解决的是“懒人不用挑插件”的问题。现代项目最常用的老三样：</p><ul><li><strong><code>@babel/preset-env</code></strong>：智能预设，根据你配置的目标浏览器，自动决定需要转哪些 JS 语法。</li><li><strong><code>@babel/preset-react</code></strong>：专门用来编译 JSX。</li><li><strong><code>@babel/preset-typescript</code></strong>：负责把 TS 类型代码擦除成普通的 JS（不做类型检查）。</li></ul><h3 id="4-4-配置文件怎么选？"><a href="#4-4-配置文件怎么选？" class="headerlink" title="4.4 配置文件怎么选？"></a><strong><font color='red'>4.4 配置文件怎么选？</font></strong></h3><ul><li><strong><code>babel.config.json</code>（Babel 7+ 强烈推荐）</strong>：作用于整个项目（甚至跨层级的 monorepo），一劳永逸。</li><li><strong><code>.babelrc</code> &#x2F; <code>.babelrc.json</code></strong>：只针对当前文件夹目录生效（局部配置），在复杂的 monorepo 工程中非常容易出现配置覆盖和失效的深坑。</li></ul><hr><br><h2 id="五、-babel-preset-env-core-js"><a href="#五、-babel-preset-env-core-js" class="headerlink" title="五、 @babel&#x2F;preset-env + core-js"></a><strong>五、 @babel&#x2F;preset-env + core-js</strong></h2><p>这一章是 Babel 学习的分水岭：大家经常把 <strong>语法转换</strong> 与 <strong>API 补齐（Polyfill）</strong> 混为一谈。</p><h3 id="5-1-语法转换-≠-API-补齐"><a href="#5-1-语法转换-≠-API-补齐" class="headerlink" title="5.1 语法转换 ≠ API 补齐"></a><strong><font color='red'>5.1 语法转换 ≠ API 补齐</font></strong></h3><ul><li><strong>Babel（准确说是 preset-env 自身）主要负责语法</strong>：比如 <code>const</code> 改成 <code>var</code>、去掉箭头函数等。</li><li><strong>但是对于新的 API 或内置对象</strong>：比如 <code>Promise</code>、<code>Array.from</code>、<code>Object.assign</code>、<code>[].includes</code>，老浏览器里根本没有这些全局对象和原型方法。Babel 转换后还是 <code>Promise</code> 字母，必定在旧浏览器报错。我们需要 <strong>Polyfill</strong> 给环境打补丁。</li></ul><blockquote><p>⚠️ <strong>废弃提醒</strong>：以前大家常装一个万金油包叫 <code>@babel/polyfill</code>。<strong>从 Babel 7.4 起这个包已被废弃！</strong> 现在的标准做法是直接使用 <code>core-js</code>，靠 <code>preset-env</code> 去自动引入。</p></blockquote><h3 id="5-2-正确的配置姿势（按需注入-Polyfill）"><a href="#5-2-正确的配置姿势（按需注入-Polyfill）" class="headerlink" title="5.2 正确的配置姿势（按需注入 Polyfill）"></a><strong><font color='red'>5.2 正确的配置姿势（按需注入 Polyfill）</font></strong></h3><p>首先安装 <code>core-js</code>（生产依赖）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i core-js</span><br><span class="line"><span class="comment"># 注意，preset 仍然放开发依赖</span></span><br><span class="line">npm i -D @babel/preset-env</span><br></pre></td></tr></table></figure><p>配置 <code>babel.config.json</code>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&gt; 0.2%, not dead&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;useBuiltIns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;usage&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;corejs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.38&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;modules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="1）必懂参数解析"><a href="#1）必懂参数解析" class="headerlink" title="1）必懂参数解析"></a><strong><font color='#10c300'>1）必懂参数解析</font></strong></h4><ul><li><code>targets</code>：你的目标环境。建议将其放到 <code>package.json</code> 的 <code>browserslist</code> 字段中统一定义，这里可以直接不写。</li><li><code>useBuiltIns: &quot;usage&quot;</code>：<strong>真正的神级配置，重点注意！</strong> 这是按需加载模式。这意味着在你项目的<strong>源码文件中，绝对不需要手动写 <code>import &#39;core-js&#39;</code></strong>。Babel 会静态分析你的代码，比如你用到了 <code>Promise</code>，它就在编译后的该文件顶部，自动帮你默默塞入一句 <code>import &quot;core-js/modules/es.promise.js&quot;</code>。这就叫按需补齐，体积最小！<ul><li><em>（补充：如果这里配置成 <code>&quot;entry&quot;</code>，那你才需要在项目入口文件如 <code>main.js</code> 的第一行手动写上一句 <code>import &quot;core-js&quot;</code>，此模式会把浏览器缺失的 API 全量打进来，容易导致包体积过大，不推荐。）</em></li></ul></li><li><code>corejs</code>：指定 core-js 的主版本号（目前标配使用的是 3.x ）。</li><li><code>modules: false</code>：让 Babel 别管 ES6 Module 的 <code>import/export</code>，把模块化的保留权交给 Webpack&#x2F;Vite 这种打包工具，以便它们做无用代码修剪（Tree-shaking）。</li></ul><hr><br><h2 id="六、-Runtime-与-Polyfill-的区别"><a href="#六、-Runtime-与-Polyfill-的区别" class="headerlink" title="六、 Runtime 与 Polyfill 的区别"></a><strong>六、 Runtime 与 Polyfill 的区别</strong></h2><p>很多人到死都没搞清楚 <code>core-js</code> 和 <code>@babel/runtime</code> 为什么同时出现。</p><h3 id="6-1-为什么需要-runtime-插件？"><a href="#6-1-为什么需要-runtime-插件？" class="headerlink" title="6.1 为什么需要 runtime 插件？"></a><strong><font color='red'>6.1 为什么需要 runtime 插件？</font></strong></h3><p>Babel 在转译像 <code>class</code>、<code>async/await</code> 这种复杂新特性时，会在文件里注入一些辅助函数（Helpers）。比如：<code>_classCallCheck</code>。<br>如果项目里有 100 个文件用了 <code>class</code>，这段冗长的 helper 函数就会被内联 100 次，包体积会变得极速膨胀。</p><h3 id="6-2-transform-runtime-的作用"><a href="#6-2-transform-runtime-的作用" class="headerlink" title="6.2 transform-runtime 的作用"></a><strong><font color='red'>6.2 transform-runtime 的作用</font></strong></h3><p>安装配套：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @babel/plugin-transform-runtime</span><br><span class="line">npm i @babel/runtime</span><br></pre></td></tr></table></figure><p>配置（<strong>这通常写在你的 <code>babel.config.json</code> 或对应 Babel 配置文件中</strong>）：</p><blockquote><p>💡 <strong>极其容易困惑的基础知识</strong>：<br>在 Babel 配置文件中，<code>presets</code>（预设数组） 和 <code>plugins</code>（插件数组） 是<strong>完全同级并列</strong>的。</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="comment">// 这里放 Babel 的环境预设、React 预设等</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">// 核心参数：告诉 Babel 帮我把内联的辅助函数（Helpers）替换为以 module 形式引入 @babel/runtime 相关方法</span></span><br><span class="line">        <span class="attr">&quot;helpers&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 是否开启 generator 相关的 polyfill 抽离，避免全局污染全局变量</span></span><br><span class="line">        <span class="attr">&quot;regenerator&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="comment">// (可选) 如果你是开发 npm 包库，不想全局引入 Promise 等 API</span></span><br><span class="line">        <span class="comment">// 你可以把这里的 corejs 设为 3，让 Babel 从 runtime 帮你进行局部的安全 polyfill 加载</span></span><br><span class="line">        <span class="comment">// &quot;corejs&quot;: 3</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="1）核心结论"><a href="#1）核心结论" class="headerlink" title="1）核心结论"></a><strong><font color='#10c300'>1）核心结论</font></strong></h4><p><code>transform-runtime</code> 被召唤出来就是为了 <strong>避免每个文件重复声明 Babel Helper</strong>。它会把那些注入的辅助函数，统统变成 <code>require(&quot;@babel/runtime/helpers/xxx&quot;)</code> 这个包里的引用。包体积瞬间被拯救。</p><blockquote><p>💡 <strong>项目选择建议</strong>：</p><ul><li><strong>做业务项目（Web App）</strong>：用 <code>@babel/preset-env</code> 配上 <code>core-js</code> (useBuiltIns) 做全局 Polyfill。</li><li><strong>开发基础组件库&#x2F;NPM 包</strong>：尽量不要用 <code>useBuiltIns</code> 去污染全局原型，而是完全依赖 <code>@babel/plugin-transform-runtime</code> 做局部沙盒版的 api 隔离降级（配置它的 <code>corejs</code> 选项）。</li></ul></blockquote><hr><br><h2 id="七、-Babel-与-TS-React-结合"><a href="#七、-Babel-与-TS-React-结合" class="headerlink" title="七、 Babel 与 TS &#x2F; React 结合"></a><strong>七、 Babel 与 TS &#x2F; React 结合</strong></h2><h3 id="7-1-React：自动引入-JSX-运行时"><a href="#7-1-React：自动引入-JSX-运行时" class="headerlink" title="7.1 React：自动引入 JSX 运行时"></a><strong><font color='red'>7.1 React：自动引入 JSX 运行时</font></strong></h3><p>配置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;@babel/preset-react&quot;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;runtime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;automatic&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><em><code>runtime: &quot;automatic&quot;</code>（React 17+ 特性）意味着你再也不用在组件第一行手动写 <code>import React from &quot;react&quot;</code> 了。</em></p><h3 id="7-2-TypeScript：编译-TS-这点坑"><a href="#7-2-TypeScript：编译-TS-这点坑" class="headerlink" title="7.2 TypeScript：编译 TS 这点坑"></a><strong><font color='red'>7.2 TypeScript：编译 TS 这点坑</font></strong></h3><p>配置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;@babel/preset-typescript&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="1）关键注意事项"><a href="#1）关键注意事项" class="headerlink" title="1）关键注意事项"></a><strong><font color='#10c300'>1）关键注意事项</font></strong></h4><ol><li>Babel 剥离 TS 极快，但<strong>不负责类型检查</strong>。想要类型检查报错，得加上 <code>tsc --noEmit</code> 命令配合。<ul><li><strong>具体操作</strong>：你应该在根目录下生成一个 <code>tsconfig.json</code> 文件。然后在项目的 <code>package.json</code> 的 <code>scripts</code> 中添加一条脚本，例如 <code>&quot;type-check&quot;: &quot;tsc --noEmit&quot;</code>。在每次打包（如 <code>npm run build</code>）或者提交代码（配合 husky + lint-staged）之前，先运行这条命令，以便把任何类型错误扼杀在摇篮里。这里 <code>--noEmit</code> 的意思是：tsc 编译器只负责报错，坚决不输出任何编译后的 js 文件（因为输出打包的工作已经全权交给 Babel &#x2F; Webpack &#x2F; Vite 了）。</li></ul></li><li><strong>踩坑预警</strong>：如果你直接用 <code>@babel/cli</code> 去编译一个带有 TS 文件的项目，它默认是会忽略 <code>.ts</code> 扩展名的！必须通过 CLI 指定扩展名才能生效：<br><code>npx babel src --out-dir dist --extensions &quot;.ts,.tsx&quot;</code></li></ol><hr><br><h2 id="八、-Babel-在-Webpack-和-Vite-中的生态定位"><a href="#八、-Babel-在-Webpack-和-Vite-中的生态定位" class="headerlink" title="八、 Babel 在 Webpack 和 Vite 中的生态定位"></a><strong>八、 Babel 在 Webpack 和 Vite 中的生态定位</strong></h2><ul><li><strong>Webpack（搭配 <code>babel-loader</code>）</strong>：<br>在 Webpack 中，一切都靠 loader 接入。当 Webpack 遇到 <code>.js/.ts/.jsx</code> 时，会交给 <code>babel-loader</code> 唤醒 Babel 编译，编译后的字符串再吐回给 Webpack 打包。</li><li><strong>Vite（基于 ESBuild）</strong>：<br>Vite 在开发环境下主要使用 go 语言写的 ESBuild 极速转译代码，默认不启用 Babel。但在一些依赖 Babel 生态的场景下（例如 React 的 Fast Refresh 热更新、CSS in JS 宏、旧版本浏览器兼容、按需组件导入等），Vite 依然会借助自身的插件底层调用 Babel 辅助构建。</li></ul><hr><br><h2 id="九、-AST、遍历与编译原理速通"><a href="#九、-AST、遍历与编译原理速通" class="headerlink" title="九、 AST、遍历与编译原理速通"></a><strong>九、 AST、遍历与编译原理速通</strong></h2><p>你不需要成为编译原理专家，但要记住这 3 个词：</p><h3 id="9-1-AST（Abstract-Syntax-Tree，抽象语法树）"><a href="#9-1-AST（Abstract-Syntax-Tree，抽象语法树）" class="headerlink" title="9.1 AST（Abstract Syntax Tree，抽象语法树）"></a><strong><font color='red'>9.1 AST（Abstract Syntax Tree，抽象语法树）</font></strong></h3><p>简单来说：<strong>AST 就是把你写的“源代码字符串”，转换成了计算机（编译器）更容易理解和操作的“树状数据结构”。</strong></p><ul><li><strong>为什么需要 AST？</strong><br>对于计算机来说，代码只是一串字符序列，想要修改、翻译或者检查代码（比如处理复杂的嵌套和作用域），直接操作字符串极其困难。所以需要把一维字符串解析成结构化的树状数据（通常是 JSON 格式）。</li><li><strong>代码是怎么变成 AST 的？</strong><br>这个过程叫做<strong>解析（Parsing）</strong>，通常分为两步：<ul><li><strong>词法分析（Tokenization）</strong>：把代码切成一个个具备独立意义的“词法单元”（Tokens）。例如 <code>let a = 1;</code> 会被切成：<code>let</code>, <code>a</code>, <code>=</code>, <code>1</code>, <code>;</code>。</li><li><strong>语法分析（Syntax Analysis）</strong>：把切出来的 Tokens 数组，根据 JS 语法规则组合拼装成树状结构（AST）。比如 <code>let a = 1;</code> 会被解析成包含 <code>VariableDeclaration</code>、<code>Identifier</code>、<code>NumericLiteral</code> 等节点的树。</li></ul></li><li><strong>AST 的用处：</strong><br>前端工程化里 90% 的“魔法”（比如 Babel 转译、ESLint 检查、Webpack 构建依赖图谱、Vue&#x2F;React 模板编译）的核心流程都是：<strong>源码 → AST → 操作（修改&#x2F;分析）AST → 重新生成代码</strong>。</li></ul><h3 id="9-2-Visitor（访问者模式）"><a href="#9-2-Visitor（访问者模式）" class="headerlink" title="9.2 Visitor（访问者模式）"></a><strong><font color='red'>9.2 Visitor（访问者模式）</font></strong></h3><p>你可以把这个想成一个事件监听器，设定“当我遍历 AST 遇到特定的节点（比如遇到 <code>BinaryExpression</code> 节点）时，触发我的回调函数”。</p><h3 id="9-3-Path（路径对象）"><a href="#9-3-Path（路径对象）" class="headerlink" title="9.3 Path（路径对象）"></a><strong><font color='red'>9.3 Path（路径对象）</font></strong></h3><p>插件拿到节点不仅仅是拿到节点本身的数据，而是拿到一个 Path 包装对象。它不仅包含了当前节点的信息，还包含了节点之间的父子上下文关联，并通过调用 <code>path.replaceWith()</code>、<code>path.remove()</code> 等提供的一整套 API 让你去安全地修改和操作 these 节点。</p><hr><br><h2 id="十、-手写一个-Babel-插件"><a href="#十、-手写一个-Babel-插件" class="headerlink" title="十、 手写一个 Babel 插件"></a><strong>十、 手写一个 Babel 插件</strong></h2><p><strong>需求</strong>：把代码中的 <code>__DEV__</code> 替换为 <code>process.env.NODE_ENV !== &quot;production&quot;</code>，方便做开发环境包裹。</p><h3 id="10-1-插件代码（replace-dev-flag-js）"><a href="#10-1-插件代码（replace-dev-flag-js）" class="headerlink" title="10.1 插件代码（replace-dev-flag.js）"></a><strong><font color='red'>10.1 插件代码（<code>replace-dev-flag.js</code>）</font></strong></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> <span class="title function_">myPlugin</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;replace-dev-flag&quot;</span>,</span><br><span class="line">    <span class="attr">visitor</span>: &#123;</span><br><span class="line">      <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">        <span class="comment">// 发现不是目标变量，直接放行</span></span><br><span class="line">        <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">name</span> !== <span class="string">&quot;__DEV__&quot;</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成目标表达式</span></span><br><span class="line">        path.<span class="title function_">replaceWith</span>(</span><br><span class="line">          t.<span class="title function_">binaryExpression</span>(</span><br><span class="line">            <span class="string">&quot;!==&quot;</span>,</span><br><span class="line">            t.<span class="title function_">memberExpression</span>(</span><br><span class="line">              t.<span class="title function_">memberExpression</span>(t.<span class="title function_">identifier</span>(<span class="string">&quot;process&quot;</span>), t.<span class="title function_">identifier</span>(<span class="string">&quot;env&quot;</span>)),</span><br><span class="line">              t.<span class="title function_">identifier</span>(<span class="string">&quot;NODE_ENV&quot;</span>),</span><br><span class="line">            ),</span><br><span class="line">            t.<span class="title function_">stringLiteral</span>(<span class="string">&quot;production&quot;</span>),</span><br><span class="line">          ),</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="10-2-在配置中使用它"><a href="#10-2-在配置中使用它" class="headerlink" title="10.2 在配置中使用它"></a><strong><font color='red'>10.2 在配置中使用它</font></strong></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;./babel-plugins/replace-dev-flag.js&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><br><h2 id="十一、-终极一键复制配置模板"><a href="#十一、-终极一键复制配置模板" class="headerlink" title="十一、 终极一键复制配置模板"></a><strong>十一、 终极一键复制配置模板</strong></h2><h3 id="11-1-绝大多数现代工程（Vue-普通-JS-项目，使用打包工具）"><a href="#11-1-绝大多数现代工程（Vue-普通-JS-项目，使用打包工具）" class="headerlink" title="11.1 绝大多数现代工程（Vue&#x2F;普通 JS 项目，使用打包工具）"></a><strong><font color='red'>11.1 绝大多数现代工程（Vue&#x2F;普通 JS 项目，使用打包工具）</font></strong></h3><p><strong><code>babel.config.json</code></strong>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;modules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;useBuiltIns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;usage&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;corejs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.38&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;helpers&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;regenerator&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>依赖清单</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @babel/core @babel/preset-env @babel/plugin-transform-runtime</span><br><span class="line">npm i core-js @babel/runtime</span><br></pre></td></tr></table></figure><h3 id="11-2-React-TS-前端主应用项目"><a href="#11-2-React-TS-前端主应用项目" class="headerlink" title="11.2 React + TS 前端主应用项目"></a><strong><font color='red'>11.2 React + TS 前端主应用项目</font></strong></h3><p><strong><code>babel.config.json</code></strong>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;modules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;useBuiltIns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;usage&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;corejs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.38&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">[</span><span class="string">&quot;@babel/preset-react&quot;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;runtime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;automatic&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;@babel/preset-typescript&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span> <span class="attr">&quot;helpers&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="attr">&quot;regenerator&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;🚀-彻底搞懂-Babel：从入门到进阶的全场景指南&quot;&gt;&lt;a href=&quot;#🚀-彻底搞懂-Babel：从入门到进阶的全场景指南&quot; class=&quot;headerlink&quot; title=&quot;🚀 彻底搞懂 Babel：从入门到进阶的全场景指南&quot;&gt;&lt;/a&gt;🚀 彻底搞懂 </summary>
      
    
    
    
    <category term="框架与生态" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6%E4%B8%8E%E7%94%9F%E6%80%81/"/>
    
    
    <category term="javascript" scheme="http://example.com/tags/javascript/"/>
    
    <category term="babel7" scheme="http://example.com/tags/babel7/"/>
    
    <category term="compiler" scheme="http://example.com/tags/compiler/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript 模块化与 Webpack 5：从原理剖析到工程化实战</title>
    <link href="http://example.com/posts/w41d92f5.html"/>
    <id>http://example.com/posts/w41d92f5.html</id>
    <published>2026-02-27T22:11:00.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h1 id="🚀-JavaScript-模块化与-Webpack-5：从原理剖析到工程化实战"><a href="#🚀-JavaScript-模块化与-Webpack-5：从原理剖析到工程化实战" class="headerlink" title="🚀 JavaScript 模块化与 Webpack 5：从原理剖析到工程化实战"></a>🚀 JavaScript 模块化与 Webpack 5：从原理剖析到工程化实战</h1><blockquote><p>📚 本总结深入剖析了 JavaScript 模块化规范的底层差异（CommonJS vs ESM），并结合 Webpack 5 及最新的 Webpack CLI 6.x 提供了详尽的实测验证与工程化最佳实践。</p></blockquote><hr><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol><li><a href="#%E4%B8%80-javascript-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%A7%84%E8%8C%83%E8%AF%A6%E8%A7%A3">模块化规范详解</a></li><li><a href="#%E4%BA%8C-es6-modules-vs-commonjs-%E6%A0%B8%E5%BF%83%E5%8C%BA%E5%88%AB%E8%AF%A6%E8%A7%A3">核心区别：引用 vs 拷贝</a></li><li><a href="#%E4%B8%89-packagejson-%E4%B8%AD%E7%9A%84-type-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3">package.json 配置项</a></li><li><a href="#%E5%9B%9B-webpack-cli-%E7%89%88%E6%9C%AC%E5%BD%B1%E5%93%8D%E5%AE%9E%E6%B5%8B%E7%BB%93%E6%9E%9C">webpack-cli 智能加载</a></li><li><a href="#%E4%BA%94-%E5%AE%9E%E6%B5%8B%E9%AA%8C%E8%AF%81%E8%AE%B0%E5%BD%95">实测验证记录</a></li><li><a href="#%E5%85%AD-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE%E5%9F%BA%E4%BA%8E%E5%AE%9E%E6%B5%8B">最佳实践建议</a></li><li><a href="#%E4%B8%83-%E9%85%8D%E7%BD%AE%E9%80%89%E6%8B%A9%E6%B5%81%E7%A8%8B%E5%9B%BE">配置选择流程图</a></li><li><a href="#%E5%85%AB-%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9%E6%80%BB%E7%BB%93">关键项总结</a></li><li><a href="#%E4%B9%9D-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-faq">常见问题 FAQ</a></li><li><a href="#%E5%8D%81-%E6%80%BB%E7%BB%93">核心结论总结</a></li></ol><br><h2 id="一、-JavaScript-模块化规范详解"><a href="#一、-JavaScript-模块化规范详解" class="headerlink" title="一、 JavaScript 模块化规范详解"></a><strong>一、 JavaScript 模块化规范详解</strong></h2><h3 id="1-1-CommonJS-CJS"><a href="#1-1-CommonJS-CJS" class="headerlink" title="1.1 CommonJS (CJS)"></a><strong><font color='red'>1.1 CommonJS (CJS)</font></strong></h3><p><strong>使用场景</strong>：Node.js 服务端</p><p><strong>特点</strong>：</p><ul><li>同步加载模块</li><li>运行时加载（值的拷贝）</li><li>每个文件是一个模块</li></ul><p><strong>语法</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">add</span>: <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b &#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">count</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入</span></span><br><span class="line"><span class="keyword">const</span> math = <span class="built_in">require</span>(<span class="string">&quot;./math&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; add &#125; = <span class="built_in">require</span>(<span class="string">&quot;./math&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="1-2-AMD-Asynchronous-Module-Definition"><a href="#1-2-AMD-Asynchronous-Module-Definition" class="headerlink" title="1.2 AMD (Asynchronous Module Definition)"></a><strong><font color='red'>1.2 AMD (Asynchronous Module Definition)</font></strong></h3><p><strong>使用场景</strong>：浏览器端</p><p><strong>特点</strong>：</p><ul><li>异步加载模块</li><li>依赖前置，提前执行</li><li>代表库：RequireJS</li></ul><p><strong>语法</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义模块</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&quot;jquery&quot;</span>, <span class="string">&quot;underscore&quot;</span>], <span class="keyword">function</span> (<span class="params">$, _</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用模块</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&quot;module1&quot;</span>, <span class="string">&quot;module2&quot;</span>], <span class="keyword">function</span> (<span class="params">m1, m2</span>) &#123;</span><br><span class="line">  m1.<span class="title function_">method</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="1-3-UMD-Universal-Module-Definition"><a href="#1-3-UMD-Universal-Module-Definition" class="headerlink" title="1.3 UMD (Universal Module Definition)"></a><strong><font color='red'>1.3 UMD (Universal Module Definition)</font></strong></h3><p><strong>使用场景</strong>：通用环境（浏览器 + Node.js）</p><p><strong>特点</strong>：</p><ul><li>兼容 CommonJS 和 AMD</li><li>可以在多种环境下运行</li><li>通常用于第三方库</li></ul><p><strong>语法</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">root, factory</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.<span class="property">amd</span>) &#123;</span><br><span class="line">    <span class="comment">// AMD</span></span><br><span class="line">    <span class="title function_">define</span>([], factory);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">module</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="variable language_">module</span>.<span class="property">exports</span>) &#123;</span><br><span class="line">    <span class="comment">// CommonJS</span></span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 浏览器全局变量</span></span><br><span class="line">    root.<span class="property">myModule</span> = <span class="title function_">factory</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">method</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125; &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="1-4-ES6-Modules-ESM-⭐-推荐"><a href="#1-4-ES6-Modules-ESM-⭐-推荐" class="headerlink" title="1.4 ES6 Modules (ESM) ⭐ 推荐"></a><strong><font color='red'>1.4 ES6 Modules (ESM) ⭐ 推荐</font></strong></h3><p><strong>使用场景</strong>：现代浏览器和 Node.js</p><p><strong>特点</strong>：</p><ul><li>JavaScript 官方标准</li><li>静态导入，编译时加载</li><li>支持 Tree Shaking（摇树优化）</li><li>值的引用（而非拷贝）</li></ul><p><strong>语法</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">&quot;value&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; name, add &#125; <span class="keyword">from</span> <span class="string">&quot;./module.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> defaultExport <span class="keyword">from</span> <span class="string">&quot;./module.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable language_">module</span> <span class="keyword">from</span> <span class="string">&quot;./module.js&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="1-5-CMD-Common-Module-Definition"><a href="#1-5-CMD-Common-Module-Definition" class="headerlink" title="1.5 CMD (Common Module Definition)"></a><strong><font color='red'>1.5 CMD (Common Module Definition)</font></strong></h3><p><strong>使用场景</strong>：浏览器端（已淘汰）</p><p><strong>特点</strong>：</p><ul><li>SeaJS 推广的规范</li><li>依赖就近，延迟执行</li><li>现在基本不再使用</li></ul><hr><br><h2 id="二、-ES6-Modules-vs-CommonJS-核心区别详解"><a href="#二、-ES6-Modules-vs-CommonJS-核心区别详解" class="headerlink" title="二、 ES6 Modules vs CommonJS 核心区别详解"></a><strong>二、 ES6 Modules vs CommonJS 核心区别详解</strong></h2><h3 id="2-1-值的引用-vs-值的拷贝"><a href="#2-1-值的引用-vs-值的拷贝" class="headerlink" title="2.1 值的引用 vs 值的拷贝"></a><strong><font color='red'>2.1 值的引用 vs 值的拷贝</font></strong></h3><p>这是 <strong>ES6 Modules</strong> 和 <strong>CommonJS</strong> 的一个关键区别。</p><h4 id="1）核心区别"><a href="#1）核心区别" class="headerlink" title="1）核心区别"></a><strong><font color='#10c300'>1）核心区别</font></strong></h4><table><thead><tr><th>模块系统</th><th>导出机制</th><th>特点</th></tr></thead><tbody><tr><td><strong>CommonJS</strong></td><td>值的拷贝 📸</td><td>导出时复制一份值，互不影响</td></tr><tr><td><strong>ES6 Modules</strong></td><td>值的引用（绑定）📹</td><td>导出的是引用，指向同一个值</td></tr></tbody></table><h4 id="2）CommonJS-值的拷贝（拍照片）"><a href="#2）CommonJS-值的拷贝（拍照片）" class="headerlink" title="2）CommonJS - 值的拷贝（拍照片）"></a><strong><font color='#10c300'>2）CommonJS - 值的拷贝（拍照片）</font></strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counter.js (CommonJS)</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">  count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  count, <span class="comment">// 导出的是 count 的拷贝</span></span><br><span class="line">  increment,</span><br><span class="line">  getCount,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> counter = <span class="built_in">require</span>(<span class="string">&quot;./counter.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="property">count</span>); <span class="comment">// 0</span></span><br><span class="line">counter.<span class="title function_">increment</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="property">count</span>); <span class="comment">// 还是 0 ❌（因为是拷贝，不会更新）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">getCount</span>()); <span class="comment">// 1 ✅（通过函数访问到最新值）</span></span><br></pre></td></tr></table></figure><p><strong>说明</strong>：</p><ul><li><code>counter.count</code> 是导出时的<strong>拷贝值</strong></li><li>内部 <code>count</code> 变化了，但导出的拷贝<strong>不会更新</strong></li><li>就像复印了一份文件，原件改了，复印件不会变</li></ul><h4 id="3）ES6-Modules-值的引用（视频直播）"><a href="#3）ES6-Modules-值的引用（视频直播）" class="headerlink" title="3）ES6 Modules - 值的引用（视频直播）"></a><strong><font color='#10c300'>3）ES6 Modules - 值的引用（视频直播）</font></strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counter.js (ES6)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">  count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; count, increment, getCount &#125; <span class="keyword">from</span> <span class="string">&quot;./counter.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// 0</span></span><br><span class="line"><span class="title function_">increment</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// 1 ✅（实时更新！）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getCount</span>()); <span class="comment">// 1 ✅</span></span><br></pre></td></tr></table></figure><p><strong>说明</strong>：</p><ul><li><code>count</code> 是一个<strong>实时绑定</strong>（引用）</li><li>内部 <code>count</code> 变化，外部<strong>立即看到变化</strong></li><li>就像一个<strong>指针</strong>，始终指向同一个值</li></ul><h4 id="4）形象比喻"><a href="#4）形象比喻" class="headerlink" title="4）形象比喻"></a><strong><font color='#10c300'>4）形象比喻</font></strong></h4><p><strong>CommonJS - 拍照片 📸</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">原始文件（counter.js）：</span><br><span class="line">┌─────────┐</span><br><span class="line">│ count:0 │  → 导出时 → ┌─────────┐ 照片（main.js）</span><br><span class="line">│ ↓       │             │ count:0 │</span><br><span class="line">│ count:1 │             │         │</span><br><span class="line">└─────────┘             └─────────┘</span><br><span class="line">                        照片不会自动更新！</span><br></pre></td></tr></table></figure><p><strong>ES6 Modules - 视频直播 📹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">原始文件（counter.js）：</span><br><span class="line">┌─────────┐</span><br><span class="line">│ count:0 │  ←═══════ 实时连接 ═══════┐</span><br><span class="line">│ ↓       │                         │</span><br><span class="line">│ count:1 │  ←═══════ 同步更新 ═════════┤ main.js</span><br><span class="line">│ └─────────┘                         │</span><br><span class="line">                                    看到实时值！</span><br></pre></td></tr></table></figure><h4 id="5）为什么这很重要？"><a href="#5）为什么这很重要？" class="headerlink" title="5）为什么这很重要？"></a><strong><font color='#10c300'>5）为什么这很重要？</font></strong></h4><p><strong>1. 状态管理更直观</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store.js (ES6)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> state = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updateState</span>(<span class="params">newState</span>) &#123;</span><br><span class="line">  state = newState;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; state &#125; <span class="keyword">from</span> <span class="string">&quot;./store.js&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state); <span class="comment">// ✅ 始终是最新的 state</span></span><br></pre></td></tr></table></figure><p><strong>2. 避免常见陷阱</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ CommonJS 的常见错误</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&quot;./config&quot;</span>);</span><br><span class="line">config.<span class="title function_">setDebug</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(config.<span class="property">isDebug</span>); <span class="comment">// 还是 false ❌（拷贝不更新）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ ES6 的正确行为</span></span><br><span class="line"><span class="keyword">import</span> &#123; isDebug &#125; <span class="keyword">from</span> <span class="string">&quot;./config.js&quot;</span>;</span><br><span class="line"><span class="title function_">setDebug</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(isDebug); <span class="comment">// true ✅（引用自动更新）</span></span><br></pre></td></tr></table></figure><p><strong>3. 注意：ES6 模块导入的值是只读的</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counter.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; count &#125; <span class="keyword">from</span> <span class="string">&quot;./counter.js&quot;</span>;</span><br><span class="line">count = <span class="number">10</span>; <span class="comment">// ❌ TypeError: Assignment to constant variable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确做法：通过导出的函数修改</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setCount</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  count = value; <span class="comment">// ✅ 在模块内部可以修改</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6）总结对比"><a href="#6）总结对比" class="headerlink" title="6）总结对比"></a><strong><font color='#10c300'>6）总结对比</font></strong></h4><table><thead><tr><th>特性</th><th>CommonJS</th><th>ES6 Modules</th></tr></thead><tbody><tr><td><strong>导出机制</strong></td><td>值的拷贝 📸</td><td>值的引用 📹</td></tr><tr><td><strong>更新机制</strong></td><td>不会自动更新</td><td>实时同步</td></tr><tr><td><strong>外部修改</strong></td><td>可以修改导入的对象</td><td>只读，不能修改</td></tr><tr><td><strong>适合场景</strong></td><td>服务端同步加载</td><td>现代应用，静态分析</td></tr></tbody></table><hr><h3 id="2-2-Tree-Shaking（摇树优化）详解"><a href="#2-2-Tree-Shaking（摇树优化）详解" class="headerlink" title="2.2 Tree Shaking（摇树优化）详解"></a><strong><font color='red'>2.2 Tree Shaking（摇树优化）详解</font></strong></h3><h4 id="1）什么是-Tree-Shaking？"><a href="#1）什么是-Tree-Shaking？" class="headerlink" title="1）什么是 Tree Shaking？"></a><strong><font color='#10c300'>1）什么是 Tree Shaking？</font></strong></h4><p><strong>Tree Shaking</strong> 是一个术语，通常用于描述<strong>移除 JavaScript 代码中未使用（dead code）的过程</strong>。</p><p><strong>形象比喻</strong>：</p><ul><li>🌳 <strong>树</strong> &#x3D; 你的整个代码库</li><li>🍃 <strong>绿叶</strong> &#x3D; 实际使用的代码（活代码）</li><li>🍂 <strong>枯叶</strong> &#x3D; 未使用的代码（死代码）</li></ul><p><strong>摇树（Shaking）</strong> &#x3D; 摇动这棵树，让<strong>枯叶（未使用的代码）掉落</strong>，只保留<strong>绿叶（使用的代码）</strong></p><h4 id="2）Tree-Shaking-的作用"><a href="#2）Tree-Shaking-的作用" class="headerlink" title="2）Tree Shaking 的作用"></a><strong><font color='#10c300'>2）Tree Shaking 的作用</font></strong></h4><p><strong>优化前（没有 Tree Shaking）</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// math.js - 导出多个函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">subtract</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">multiply</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">divide</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js - 只使用了 add</span></span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&quot;./math.js&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bundle.js - 包含所有函数（浪费）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subtract</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125; <span class="comment">// ❌ 未使用但被打包</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">multiply</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125; <span class="comment">// ❌ 未使用但被打包</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">divide</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a / b;</span><br><span class="line">&#125; <span class="comment">// ❌ 未使用但被打包</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure><p><strong>优化后（有 Tree Shaking）</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bundle.js - 只包含使用的函数（优化）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125; <span class="comment">// ✅ 使用了，保留</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure><p><strong>效果</strong>：</p><ul><li>📦 减小打包体积（可能减少 50%+ 的代码）</li><li>⚡ 加快加载速度</li><li>🚀 提升性能</li></ul><h4 id="3）Tree-Shaking-的工作原理"><a href="#3）Tree-Shaking-的工作原理" class="headerlink" title="3）Tree Shaking 的工作原理"></a><strong><font color='#10c300'>3）Tree Shaking 的工作原理</font></strong></h4><p><strong>1. 依赖 ES6 Modules（ESM）</strong></p><p>Tree Shaking <strong>只对 ES6 模块（import&#x2F;export）有效</strong>，对 CommonJS（require&#x2F;module.exports）<strong>无效</strong>。</p><p><strong>为什么？</strong></p><table><thead><tr><th>特性</th><th>ES6 Modules</th><th>CommonJS</th></tr></thead><tbody><tr><td><strong>加载时机</strong></td><td>编译时（静态）</td><td>运行时（动态）</td></tr><tr><td><strong>结构</strong></td><td>静态结构，可分析</td><td>动态结构，不可预测</td></tr><tr><td><strong>Tree Shaking</strong></td><td>✅ 支持</td><td>❌ 不支持</td></tr></tbody></table><p><strong>2. 静态分析</strong></p><p>Webpack 在<strong>编译阶段</strong>会分析代码的导入导出关系，标记哪些导出被使用了，并删除未使用的导出。</p><h4 id="4）如何启用-Tree-Shaking"><a href="#4）如何启用-Tree-Shaking" class="headerlink" title="4）如何启用 Tree Shaking"></a><strong><font color='#10c300'>4）如何启用 Tree Shaking</font></strong></h4><p><strong>在 webpack 5 中（自动启用）</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>, <span class="comment">// 生产模式自动启用 Tree Shaking</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>package.json 配置（可选）</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-project&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sideEffects&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="5）sideEffects-配置的影响对比"><a href="#5）sideEffects-配置的影响对比" class="headerlink" title="5）sideEffects 配置的影响对比"></a><strong><font color='#10c300'>5）sideEffects 配置的影响对比</font></strong></h4><table><thead><tr><th>配置</th><th>Tree Shaking 粒度</th><th>删除范围</th></tr></thead><tbody><tr><td><strong>未设置 sideEffects: false</strong></td><td>成员级别</td><td>只删除文件内未使用的导出</td></tr><tr><td><strong>设置 sideEffects: false</strong></td><td>文件级别 + 成员级别</td><td>可删除整个未使用的文件</td></tr></tbody></table><h4 id="6）Tree-Shaking-的限制与最佳实践"><a href="#6）Tree-Shaking-的限制与最佳实践" class="headerlink" title="6）Tree Shaking 的限制与最佳实践"></a><strong><font color='#10c300'>6）Tree Shaking 的限制与最佳实践</font></strong></h4><p>✅ <strong>推荐做法</strong>：使用 ES6 模块、生产模式构建、避免副作用代码、使用支持 Tree Shaking 的库。<br>❌ <strong>避免</strong>：混用 CommonJS 和 ESM、顶层副作用代码、默认导出整个大对象。</p><h4 id="7）常见误区：与-“type”-“module”-的关系"><a href="#7）常见误区：与-“type”-“module”-的关系" class="headerlink" title="7）常见误区：与 “type”: “module” 的关系"></a><strong><font color='#10c300'>7）常见误区：与 “type”: “module” 的关系</font></strong></h4><p><strong>真相</strong>：Tree Shaking 与 package.json 的 <code>&quot;type&quot;</code> 无关。它只取决于源代码是否使用了 <code>import/export</code> 语法。</p><hr><br><h2 id="三、-package-json-中的-“type”-配置详解"><a href="#三、-package-json-中的-“type”-配置详解" class="headerlink" title="三、 package.json 中的 “type” 配置详解"></a><strong>三、 package.json 中的 “type” 配置详解</strong></h2><h3 id="3-1-初始化项目与目录结构"><a href="#3-1-初始化项目与目录结构" class="headerlink" title="3.1 初始化项目与目录结构"></a><strong><font color='red'>3.1 初始化项目与目录结构</font></strong></h3><p>执行以下命令初始化项目并安装 Webpack 相关依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm i webpack webpack-cli -D</span><br></pre></td></tr></table></figure><p>初始化后的推荐工程目录结构如下：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">webpack_code</span><br><span class="line">├── src # 源代码目录</span><br><span class="line">│   ├── js # JS 文件夹</span><br><span class="line">│   │   ├── count.js</span><br><span class="line">│   │   └── sum.js</span><br><span class="line">│   └── main.js # 项目主入口文件</span><br><span class="line">├── package.json # 项目配置文件</span><br><span class="line">└── webpack.config.js # Webpack 配置文件</span><br></pre></td></tr></table></figure><p><strong><code>webpack.config.js</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// __dirname nodejs的变量，表示当前文件的目录</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>), <span class="comment">// 绝对路径</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 加载器</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// loader的配置(执行顺序是 从下往上 或 从右到左)</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><code>运行</code></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><h3 id="3-2-npx-与-xxx-cli-的关系解析"><a href="#3-2-npx-与-xxx-cli-的关系解析" class="headerlink" title="3.2 npx 与 xxx-cli 的关系解析"></a><strong><font color='red'>3.2 npx 与 xxx-cli 的关系解析</font></strong></h3><p>在现代前端工程化中，<code>npx</code> 和 <code>xxx-cli</code>（如 <code>webpack-cli</code>）是相辅相成的协作关系：</p><ul><li><strong><code>xxx-cli</code> (工具箱)</strong>：是功能的实体。例如 <code>webpack-cli</code> 包含了解析命令行参数、读取配置文件、调用 Webpack 内核的核心代码。没有它，Webpack 就无法通过命令行运行。</li><li><strong><code>npx</code> (通行证)</strong>：是命令的执行者。它的核心作用是<strong>自动寻找并执行</strong>安装在项目本地（<code>node_modules/.bin</code>）的二进制命令。</li></ul><p><strong>协作逻辑</strong>：</p><ol><li><strong>安装</strong>：我们将 <code>webpack-cli</code> 安装为项目的本地 <code>devDependencies</code>（非全局安装）。</li><li><strong>寻找</strong>：当你输入 <code>npx webpack</code> 时，<code>npx</code> 会在当前项目的 <code>node_modules</code> 中精准定位到 <code>webpack-cli</code> 的执行入口。</li><li><strong>执行</strong>：<code>npx</code> 唤起 <code>webpack-cli</code>，后者开始读取配置并完成打包任务。</li></ol><p><strong>优势</strong>：这种模式避免了全局安装带来的版本冲突，确保每个项目使用的都是自己 package.json 中指定的特定版本工具。<br><br></p><h3 id="3-3-配置选项一览"><a href="#3-3-配置选项一览" class="headerlink" title="3.3 配置选项一览"></a><strong><font color='red'>3.3 配置选项一览</font></strong></h3><table><thead><tr><th>type 配置值</th><th>.js 处理方式</th><th>.mjs 文件</th><th>.cjs 文件</th></tr></thead><tbody><tr><td><strong>不设置</strong></td><td><strong>CommonJS</strong></td><td>ESM</td><td>CommonJS</td></tr><tr><td><strong>“commonjs”</strong></td><td>CommonJS（强制）</td><td>ESM</td><td>CommonJS</td></tr><tr><td><strong>“module”</strong></td><td>ESM（严格模式）</td><td>ESM</td><td>CommonJS</td></tr></tbody></table><h3 id="3-4-三种模式详解"><a href="#3-4-三种模式详解" class="headerlink" title="3.4 三种模式详解"></a><strong><font color='red'>3.4 三种模式详解</font></strong></h3><h4 id="1）不设置-type（默认行为）⭐⭐⭐⭐⭐"><a href="#1）不设置-type（默认行为）⭐⭐⭐⭐⭐" class="headerlink" title="1）不设置 type（默认行为）⭐⭐⭐⭐⭐"></a><strong><font color='#10c300'>1）不设置 type（默认行为）⭐⭐⭐⭐⭐</font></strong></h4><p>这是最推荐的配置。<code>.js</code> 文件默认为 CommonJS，但由于最新的 <strong>webpack-cli 6.x</strong> 智能加载机制，配置文件依然可以使用 <code>export default</code>。</p><h4 id="2）设置-“type”-“commonjs”"><a href="#2）设置-“type”-“commonjs”" class="headerlink" title="2）设置 “type”: “commonjs”"></a><strong><font color='#10c300'>2）设置 “type”: “commonjs”</font></strong></h4><p>强制 <code>.js</code> 文件为 CommonJS。在此模式下，<code>webpack.config.js</code> <strong>不能</strong>使用 ESM 语法。</p><h4 id="3）设置-“type”-“module”"><a href="#3）设置-“type”-“module”" class="headerlink" title="3）设置 “type”: “module”"></a><strong><font color='#10c300'>3）设置 “type”: “module”</font></strong></h4><p>所有 <code>.js</code> 文件遵循 ESM 严格模式。<strong>注意</strong>：在此模式下，<code>import</code> 必须携带完整的文件扩展名（如 <code>.js</code>）。</p><hr><br><h2 id="四、-webpack-cli-版本影响（实测结果）"><a href="#四、-webpack-cli-版本影响（实测结果）" class="headerlink" title="四、 webpack-cli 版本影响（实测结果）"></a><strong>四、 webpack-cli 版本影响（实测结果）</strong></h2><h3 id="4-1-webpack-cli-6-x-智能加载机制-🎉"><a href="#4-1-webpack-cli-6-x-智能加载机制-🎉" class="headerlink" title="4.1 webpack-cli 6.x 智能加载机制 🎉"></a><strong><font color='red'>4.1 webpack-cli 6.x 智能加载机制 🎉</font></strong></h3><table><thead><tr><th>package.json 配置</th><th>config 可用语法</th><th>源代码 import</th><th>实测结果</th></tr></thead><tbody><tr><td><strong>不设置 type</strong> ⭐</td><td><strong>CJS ✅ &#x2F; ESM ✅</strong></td><td>不需要 .js ✅</td><td>✅ 通过</td></tr><tr><td><strong>“type”: “commonjs”</strong></td><td>CJS ✅ &#x2F; ESM ❌</td><td>不需要 .js ✅</td><td>⚠️ ESM 报错</td></tr><tr><td><strong>“type”: “module”</strong></td><td>CJS ❌ &#x2F; ESM ✅</td><td><strong>必须加 .js</strong> ⚠️</td><td>⚠️ import 受限</td></tr></tbody></table><h3 id="4-2-智能加载原理解析"><a href="#4-2-智能加载原理解析" class="headerlink" title="4.2 智能加载原理解析"></a><strong><font color='red'>4.2 智能加载原理解析</font></strong></h3><p>webpack-cli 6.x 会先尝试 <code>require</code> 配置文件，如果遇到 ESM 语法抛出的报错，则会自动捕获并改用动态 <code>import()</code> 加载。这一特性让“不设置 type”成为了灵活性最高的选择。</p><hr><br><h2 id="五、-实测验证记录"><a href="#五、-实测验证记录" class="headerlink" title="五、 实测验证记录"></a><strong>五、 实测验证记录</strong></h2><h3 id="5-1-测试-1：不设置-type-export-default-✅"><a href="#5-1-测试-1：不设置-type-export-default-✅" class="headerlink" title="5.1 测试 1：不设置 type + export default ✅"></a><strong><font color='red'>5.1 测试 1：不设置 type + export default ✅</font></strong></h3><p>Node.js 环境下成功编译。说明 webpack-cli 6.x 成功兼容了不设 type 时的 ESM 配置。</p><h3 id="5-2-测试-2：type-“commonjs”-export-default-❌"><a href="#5-2-测试-2：type-“commonjs”-export-default-❌" class="headerlink" title="5.2 测试 2：type: “commonjs” + export default ❌"></a><strong><font color='red'>5.2 测试 2：type: “commonjs” + export default ❌</font></strong></h3><p>抛出 <code>SyntaxError: Unexpected token &#39;export&#39;</code>。因为显式声明为 CJS 后，尝试使用 ESM 语法会被捕获为非法。</p><h3 id="5-3-测试-3：type-“module”-export-default-⚠️"><a href="#5-3-测试-3：type-“module”-export-default-⚠️" class="headerlink" title="5.3 测试 3：type: “module” + export default ⚠️"></a><strong><font color='red'>5.3 测试 3：type: “module” + export default ⚠️</font></strong></h3><p>虽然配置文件通过，但源代码中的 <code>import</code> 因为没有写 <code>.js</code> 后缀而导致路径解析失败。</p><hr><br><h2 id="六、-最佳实践建议（基于实测）"><a href="#六、-最佳实践建议（基于实测）" class="headerlink" title="六、 最佳实践建议（基于实测）"></a><strong>六、 最佳实践建议（基于实测）</strong></h2><h3 id="6-1-推荐配置：五星级方案-⭐⭐⭐⭐⭐"><a href="#6-1-推荐配置：五星级方案-⭐⭐⭐⭐⭐" class="headerlink" title="6.1 推荐配置：五星级方案 ⭐⭐⭐⭐⭐"></a><strong><font color='red'>6.1 推荐配置：五星级方案 ⭐⭐⭐⭐⭐</font></strong></h3><ol><li><strong>package.json</strong>: 不设置 <code>type</code>。</li><li><strong>webpack.config.js</strong>: 使用 ESM 语法（<code>import path from &#39;path&#39;</code> 和 <code>export default</code>）。</li><li><strong>源代码</strong>: 使用标准的 ES6 模块（<code>import count from &quot;./js/count&quot;</code>），享受无需后缀的简洁感。</li></ol><hr><br><h2 id="七、-配置选择流程图"><a href="#七、-配置选择流程图" class="headerlink" title="七、 配置选择流程图"></a><strong>七、 配置选择流程图</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">需要配置 package.json 的 type 吗？</span><br><span class="line">    │</span><br><span class="line">    ├─→ 是否使用 webpack-cli 6.x？</span><br><span class="line">    │   ├─→ 是 → 推荐不设置 type ⭐⭐⭐⭐⭐ (灵活、简洁)</span><br><span class="line">    │   └─→ 否 → 配置文件必须用 CommonJS</span><br><span class="line">    │</span><br><span class="line">    ├─→ 是否纯 ESM 项目（Node.js 原生）？</span><br><span class="line">    │   ├─→ 是 → &quot;type&quot;: &quot;module&quot; (须加 .js 后缀)</span><br><span class="line">    │   └─→ 否 → 不设置 type ⭐ 最推荐</span><br></pre></td></tr></table></figure><hr><br><h2 id="八、-关键要点总结"><a href="#八、-关键要点总结" class="headerlink" title="八、 关键要点总结"></a><strong>八、 关键要点总结</strong></h2><ol><li><strong>默认最强</strong>：不设置 <code>type</code> 是目前最灵活、兼容性最好的方案。</li><li><strong>后缀规则</strong>：<code>.mjs</code> 始终为 ESM，<code>.cjs</code> 始终为 CommonJS。</li><li><strong>智能 cli</strong>：webpack-cli 6.x 的自动切换机制是简化工程配置的关键。</li><li><strong>Tree Shaking</strong>：只看代码语法，不看 <code>package.json</code> 配置。</li></ol><hr><br><h2 id="九、-常见问题-FAQ"><a href="#九、-常见问题-FAQ" class="headerlink" title="九、 常见问题 FAQ"></a><strong>九、 常见问题 FAQ</strong></h2><h3 id="Q1-不设置-type-能使用-Tree-Shaking-吗？"><a href="#Q1-不设置-type-能使用-Tree-Shaking-吗？" class="headerlink" title="Q1: 不设置 type 能使用 Tree Shaking 吗？"></a><strong><font color='red'>Q1: 不设置 type 能使用 Tree Shaking 吗？</font></strong></h3><p><strong>✅ 完全可以！</strong> 这是一个常见的认知误区。Tree Shaking 取决于你的源代码是否使用了 <code>import/export</code> 静态分析，只要代码是 ESM 风格且开启了 <code>production</code> 模式，打包器就能进行优化。</p><hr><br><h2 id="十、-总结"><a href="#十、-总结" class="headerlink" title="十、 总结"></a><strong>十、 总结</strong></h2><h3 id="10-1-核心结论"><a href="#10-1-核心结论" class="headerlink" title="10.1 核心结论"></a><strong><font color='red'>10.1 核心结论</font></strong></h3><p>在这场模块化演进中，<strong>webpack-cli 6.x</strong> 通过智能加载弥合了 CJS 与 ESM 的配置鸿沟。<strong>“不设置 type + 源代码使用 ESM”</strong> 既享受了现代化的开发体验，又避免了原生 ESM 严格的后缀限制。</p><p><strong>这就是 Webpack 5 的终极工程化实践！</strong> 🎯</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;🚀-JavaScript-模块化与-Webpack-5：从原理剖析到工程化实战&quot;&gt;&lt;a href=&quot;#🚀-JavaScript-模块化与-Webpack-5：从原理剖析到工程化实战&quot; class=&quot;headerlink&quot; title=&quot;🚀 JavaScrip</summary>
      
    
    
    
    <category term="开发工具" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="webpack" scheme="http://example.com/tags/webpack/"/>
    
    <category term="javascript" scheme="http://example.com/tags/javascript/"/>
    
    <category term="modules" scheme="http://example.com/tags/modules/"/>
    
  </entry>
  
  <entry>
    <title>WSL2安装与使用指南</title>
    <link href="http://example.com/posts/wsl2534guide6.html"/>
    <id>http://example.com/posts/wsl2534guide6.html</id>
    <published>2026-02-23T17:53:00.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、WSL2安装与卸载"><a href="#一、WSL2安装与卸载" class="headerlink" title="一、WSL2安装与卸载"></a><strong><font color='red'>一、WSL2安装与卸载</font></strong></h3><h4 id="1-1、安装WSL"><a href="#1-1、安装WSL" class="headerlink" title="1-1、安装WSL"></a><strong><font color='#10c300'>1-1、安装WSL</font></strong></h4><h5 id="一键安装（推荐）"><a href="#一键安装（推荐）" class="headerlink" title="一键安装（推荐）"></a><strong><font color='cornflowerblue'>一键安装（推荐）</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --install</span><br></pre></td></tr></table></figure><p>此命令会自动完成：</p><ul><li>启用必要的 Windows 功能</li><li>安装最新的 Linux 内核</li><li>默认安装 Ubuntu 发行版</li></ul><p><strong>安装完成后需要重启计算机</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260120235112242.png" alt="image-20260120235112242"></p><br><h4 id="1-2、WSL常用命令"><a href="#1-2、WSL常用命令" class="headerlink" title="1-2、WSL常用命令"></a><strong><font color='#10c300'>1-2、WSL常用命令</font></strong></h4><table><thead><tr><th align="left">命令</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>wsl</code></td><td align="left">启动默认发行版</td></tr><tr><td align="left"><code>wsl --list --online</code></td><td align="left">查看可安装的发行版</td></tr><tr><td align="left"><code>wsl --list</code></td><td align="left">查看已安装的发行版名称</td></tr><tr><td align="left"><code>wsl --list --verbose</code></td><td align="left">显示已安装的发行版名称、运行状态和WSL版本</td></tr><tr><td align="left"><code>wsl -d Ubuntu-22.04</code></td><td align="left">启动指定发行版</td></tr><tr><td align="left"><code>wsl --shutdown</code></td><td align="left">关闭所有正在运行的发行版</td></tr><tr><td align="left"><code>wsl --update</code></td><td align="left">更新 WSL</td></tr><tr><td align="left"><code>wsl --version</code></td><td align="left">查看 WSL 版本</td></tr><tr><td align="left"><code>wsl --set-default Ubuntu-22.04</code></td><td align="left">设置默认发行版</td></tr><tr><td align="left"><code>wsl --set-version Ubuntu-22.04 2</code></td><td align="left">转换发行版版本（WSL 1 ↔ WSL 2）</td></tr></tbody></table><br><h4 id="1-3、卸载WSL2"><a href="#1-3、卸载WSL2" class="headerlink" title="1-3、卸载WSL2"></a><strong><font color='#10c300'>1-3、卸载WSL2</font></strong></h4><h5 id="方法1：卸载特定-Linux-发行版（推荐）"><a href="#方法1：卸载特定-Linux-发行版（推荐）" class="headerlink" title="方法1：卸载特定 Linux 发行版（推荐）"></a><strong><font color='cornflowerblue'>方法1：卸载特定 Linux 发行版（推荐）</font></strong></h5><p>在 **PowerShell（管理员）**中执行：</p><p><strong>1️⃣ 查看已安装的发行版</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--list</span> <span class="literal">--verbose</span></span><br><span class="line">或</span><br><span class="line">wsl <span class="literal">-l</span> <span class="literal">-v</span>       </span><br></pre></td></tr></table></figure><p><strong>2️⃣ 注销并卸载（特定发行版）</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--unregister</span> Ubuntu</span><br></pre></td></tr></table></figure><p>根据你安装的具体发行版名称，例如：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--unregister</span> Ubuntu<span class="literal">-22</span>.<span class="number">04</span></span><br><span class="line">wsl <span class="literal">--unregister</span> Debian</span><br></pre></td></tr></table></figure><p>⚠️ <strong>注意</strong>：这会删除该发行版的所有数据！</p><br><h5 id="方法2：通过-Windows-设置卸载"><a href="#方法2：通过-Windows-设置卸载" class="headerlink" title="方法2：通过 Windows 设置卸载"></a><strong><font color='cornflowerblue'>方法2：通过 Windows 设置卸载</font></strong></h5><p><strong>卸载 Linux 发行版：</strong></p><ol><li>打开 <strong>设置</strong> → <strong>应用</strong> → <strong>应用和功能</strong></li><li>搜索 <code>Ubuntu</code>（或其他发行版名称）</li><li>点击 <strong>卸载</strong></li></ol><p><strong>禁用 WSL 功能：</strong></p><ol><li>打开 <strong>控制面板</strong> → <strong>程序</strong> → <strong>启用或关闭 Windows 功能</strong></li><li>取消勾选：<ul><li>☑ <strong>适用于 Linux 的 Windows 子系统</strong></li><li>☑ <strong>虚拟机平台</strong></li></ul></li><li>点击 <strong>确定</strong></li><li>重启计算机</li></ol><br><h5 id="验证卸载"><a href="#验证卸载" class="headerlink" title="验证卸载"></a><strong><font color='cornflowerblue'>验证卸载</font></strong></h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查是否还有发行版</span></span><br><span class="line">wsl <span class="literal">--list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 WSL 版本</span></span><br><span class="line">wsl <span class="literal">--version</span></span><br></pre></td></tr></table></figure><p>如果显示为空或报错，说明卸载成功。</p><br><h4 id="1-4、注意事项"><a href="#1-4、注意事项" class="headerlink" title="1-4、注意事项"></a><strong><font color='#10c300'>1-4、注意事项</font></strong></h4><ul><li>安装 WSL 需要管理员权限</li><li>卸载发行版会<strong>完全删除</strong>所有数据，卸载前请备份</li><li>WSL 2 性能更好，推荐使用</li></ul><br><h4 id="1-4、常见问题排查"><a href="#1-4、常见问题排查" class="headerlink" title="1-4、常见问题排查"></a><strong><font color='#10c300'>1-4、常见问题排查</font></strong></h4><h5 id="❌-问题1：计算机不支持WSL2"><a href="#❌-问题1：计算机不支持WSL2" class="headerlink" title="❌ 问题1：计算机不支持WSL2"></a><strong><font color='cornflowerblue'>❌ 问题1：计算机不支持WSL2</font></strong></h5><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260123111656607.png" alt="image-20260123111656607"></p><p>在powershell下输入wsl -l -v 也不显示版本</p><p>首先确保Hyper-v和适用于linux的windows子系统以及虚拟机平台是开启的</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260123111934330.png" alt="image-20260123111934330"></p><p>如果这些都没问题，在powershell（管理员模式）下输入如下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /enum | findstr -i hypervisorlaunchtype</span><br></pre></td></tr></table></figure><p>应该会显示off，那就说明有问题，那就再输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /set hypervisorlaunchtype Auto</span><br></pre></td></tr></table></figure><p>即可解决</p><br><hr><h3 id="二、WSL2基础操作"><a href="#二、WSL2基础操作" class="headerlink" title="二、WSL2基础操作"></a><strong><font color='red'>二、WSL2基础操作</font></strong></h3><h4 id="2-1、查看IP地址"><a href="#2-1、查看IP地址" class="headerlink" title="2-1、查看IP地址"></a><strong><font color='#10c300'>2-1、查看IP地址</font></strong></h4><h5 id="方法一：使用-ip-命令"><a href="#方法一：使用-ip-命令" class="headerlink" title="方法一：使用 ip 命令"></a><strong><font color='cornflowerblue'>方法一：使用 <code>ip</code> 命令</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip addr show eth0</span><br><span class="line">简写</span><br><span class="line">ip a</span><br></pre></td></tr></table></figure><br><h5 id="方法二：使用-hostname-命令（推荐）"><a href="#方法二：使用-hostname-命令（推荐）" class="headerlink" title="方法二：使用 hostname 命令（推荐）"></a><strong><font color='cornflowerblue'>方法二：使用 <code>hostname</code> 命令（推荐）</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname -I</span><br></pre></td></tr></table></figure><br><h5 id="方法三：使用-ifconfig-命令"><a href="#方法三：使用-ifconfig-命令" class="headerlink" title="方法三：使用 ifconfig 命令"></a><strong><font color='cornflowerblue'>方法三：使用 <code>ifconfig</code> 命令</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0</span><br></pre></td></tr></table></figure><p><em>注意：此方法需要先安装 <code>net-tools</code></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install net-tools</span><br></pre></td></tr></table></figure><p><strong>卸载某个软件包：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卸载指定软件包，但保留配置文件和数据文件</span></span><br><span class="line"><span class="built_in">sudo</span> apt remove net-tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将配置文件一起删除，彻底清除，之后 `ifconfig` 命令就完全不能使用了</span></span><br><span class="line"><span class="built_in">sudo</span> apt purge net-tools</span><br></pre></td></tr></table></figure><br><h5 id="关于-IP-地址说明"><a href="#关于-IP-地址说明" class="headerlink" title="关于 IP 地址说明"></a><strong><font color='cornflowerblue'>关于 IP 地址说明</font></strong></h5><ul><li><strong>eth0</strong>: WSL2 虚拟网络接口，通常在 <code>172.x.x.x</code> 段</li><li><strong>lo</strong>: 本地回环地址 <code>127.0.0.1</code></li></ul><p><strong>示例输出：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hostname -I</span><br><span class="line">172.24.240.100</span><br></pre></td></tr></table></figure><p>这个 IP 地址可以用于从 Windows 访问 WSL2 中的服务</p><br><h4 id="2-2、查看用户信息"><a href="#2-2、查看用户信息" class="headerlink" title="2-2、查看用户信息"></a><strong><font color='#10c300'>2-2、查看用户信息</font></strong></h4><h5 id="查看用户信息"><a href="#查看用户信息" class="headerlink" title="查看用户信息"></a><strong><font color='cornflowerblue'>查看用户信息</font></strong></h5><p><strong>查看当前用户</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">whoami</span></span><br></pre></td></tr></table></figure><p><strong>查看所有用户</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>查看所有普通用户（UID &gt;&#x3D; 1000）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F: <span class="string">&#x27;$3 &gt;= 1000 &#123;print $1&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>查看当前登录用户的详细信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">finger $(<span class="built_in">whoami</span>)  <span class="comment"># 需要安装 finger</span></span><br></pre></td></tr></table></figure><br><h5 id="密码管理"><a href="#密码管理" class="headerlink" title="密码管理"></a><strong><font color='cornflowerblue'>密码管理</font></strong></h5><p><strong>⚠️ 重要说明</strong><br><strong>无法直接查看密码</strong>，因为密码是加密存储的，在 <code>/etc/shadow</code> 文件中</p><p><strong>查看密码状态</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> passwd -S username</span><br></pre></td></tr></table></figure><p>会显示状态：</p><ul><li><code>P</code> &#x3D; 已设置密码</li><li><code>NP</code> &#x3D; 未设置密码</li><li><code>L</code> &#x3D; 账户被锁定</li></ul><br><h5 id="设置-修改密码"><a href="#设置-修改密码" class="headerlink" title="设置&#x2F;修改密码"></a><strong><font color='cornflowerblue'>设置&#x2F;修改密码</font></strong></h5><p><strong>修改当前用户密码</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure><p><strong>修改其他用户密码（需要 root 权限）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> passwd username</span><br></pre></td></tr></table></figure><p><strong>从 Windows 重置 WSL 用户密码</strong></p><p>如果忘记了密码，可以在 <strong>PowerShell</strong> 或 <strong>CMD</strong> 中执行：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 以 root 为默认用户</span></span><br><span class="line">wsl <span class="literal">-u</span> root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 在 WSL 中重置密码</span></span><br><span class="line">passwd your_username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 退出并恢复默认用户（可选）</span></span><br><span class="line"><span class="comment"># 编辑 /etc/wsl.conf 来使用默认用户</span></span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure><p>或者一条命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">-u</span> root passwd your_username</span><br></pre></td></tr></table></figure><br><h5 id="查看-sudo-权限用户"><a href="#查看-sudo-权限用户" class="headerlink" title="查看 sudo 权限用户"></a><strong><font color='cornflowerblue'>查看 sudo 权限用户</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 sudo 组成员</span></span><br><span class="line">getent group <span class="built_in">sudo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">grep <span class="string">&#x27;^sudo:&#x27;</span> /etc/group</span><br></pre></td></tr></table></figure><br><h5 id="管理用户和权限"><a href="#管理用户和权限" class="headerlink" title="管理用户和权限"></a><strong><font color='cornflowerblue'>管理用户和权限</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建新用户</span></span><br><span class="line"><span class="built_in">sudo</span> adduser newuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除用户</span></span><br><span class="line"><span class="built_in">sudo</span> deluser username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将用户添加到 sudo 组</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG <span class="built_in">sudo</span> username</span><br></pre></td></tr></table></figure><p><strong>提示</strong>：WSL2 首次安装时需要你创建用户和密码，如果忘记需要重置用户账号。</p><br><hr><h3 id="三、使用FinalShell连接WSL2"><a href="#三、使用FinalShell连接WSL2" class="headerlink" title="三、使用FinalShell连接WSL2"></a><strong><font color='red'>三、使用FinalShell连接WSL2</font></strong></h3><h4 id="3-1、连接原理"><a href="#3-1、连接原理" class="headerlink" title="3-1、连接原理"></a><strong><font color='#10c300'>3-1、连接原理</font></strong></h4><p>WSL2 默认<strong>没有开启 SSH 服务</strong>，需要手动安装和配置。</p><br><h4 id="3-2、安装和配置SSH服务"><a href="#3-2、安装和配置SSH服务" class="headerlink" title="3-2、安装和配置SSH服务"></a><strong><font color='#10c300'>3-2、安装和配置SSH服务</font></strong></h4><h5 id="1️⃣-在-WSL2-中安装-SSH-服务"><a href="#1️⃣-在-WSL2-中安装-SSH-服务" class="headerlink" title="1️⃣ 在 WSL2 中安装 SSH 服务"></a><strong><font color='cornflowerblue'>1️⃣ 在 WSL2 中安装 SSH 服务</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新软件包列表</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 OpenSSH 服务器</span></span><br><span class="line"><span class="built_in">sudo</span> apt install openssh-server -y</span><br></pre></td></tr></table></figure><br><h5 id="2️⃣-配置-SSH-服务"><a href="#2️⃣-配置-SSH-服务" class="headerlink" title="2️⃣ 配置 SSH 服务"></a><strong><font color='cornflowerblue'>2️⃣ 配置 SSH 服务</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 SSH 配置文件</span></span><br><span class="line"><span class="built_in">sudo</span> nano /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p><strong>修改以下配置项</strong>（使用 <code>Ctrl+W</code> 搜索）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Port 22                          <span class="comment"># 确认端口</span></span><br><span class="line">PermitRootLogin no               <span class="comment"># 禁止 root 登录（推荐）</span></span><br><span class="line">PasswordAuthentication <span class="built_in">yes</span>       <span class="comment"># 启用密码认证</span></span><br></pre></td></tr></table></figure><p><strong>保存</strong>：<br>按 <code>Ctrl + O</code>(屏幕底部会提示 <code>File Name to Write:</code>)<br>然后按 <strong>Enter</strong> 确认保存。</p><p><strong>退出</strong>：<br>按 <code>Ctrl + X</code>。</p><br><h5 id="3️⃣-启动-SSH-服务"><a href="#3️⃣-启动-SSH-服务" class="headerlink" title="3️⃣ 启动 SSH 服务"></a><strong><font color='cornflowerblue'>3️⃣ 启动 SSH 服务</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 SSH 服务</span></span><br><span class="line"><span class="built_in">sudo</span> service ssh start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 SSH 服务状态</span></span><br><span class="line"><span class="built_in">sudo</span> service ssh status</span><br></pre></td></tr></table></figure><p>如果看到以下输出，说明 SSH 服务已成功启动：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Active: active (running) since Sat 2026-01-17 19:50:01 CST; 4s ago</span><br></pre></td></tr></table></figure><p><strong>状态是 <code>active (running)</code></strong>，说明服务正在运行。</p><p>关键信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Server listening on 0.0.0.0 port 22.</span><br><span class="line">Server listening on :: port 22.</span><br></pre></td></tr></table></figure><p><strong>SSH 服务正在监听 22 端口</strong>，可以接受连接了。</p><br><h5 id="4️⃣-设置-SSH-自动启动（可选）"><a href="#4️⃣-设置-SSH-自动启动（可选）" class="headerlink" title="4️⃣ 设置 SSH 自动启动（可选）"></a><strong><font color='cornflowerblue'>4️⃣ 设置 SSH 自动启动（可选）</font></strong></h5><p>每次启动 WSL2 时自动启动 SSH：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑或创建 /etc/wsl.conf</span></span><br><span class="line"><span class="built_in">sudo</span> nano /etc/wsl.conf</span><br></pre></td></tr></table></figure><p>添加以下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[boot]</span></span><br><span class="line"><span class="attr">command</span>=<span class="string">&quot;service ssh start&quot;</span></span><br></pre></td></tr></table></figure><br><h5 id="5️⃣-获取-WSL2-的-IP-地址"><a href="#5️⃣-获取-WSL2-的-IP-地址" class="headerlink" title="5️⃣ 获取 WSL2 的 IP 地址"></a><strong><font color='cornflowerblue'>5️⃣ 获取 WSL2 的 IP 地址</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname -I</span><br></pre></td></tr></table></figure><p>记录这个 IP，例如：<code>172.24.240.100</code></p><br><h5 id="6️⃣-在-FinalShell-中创建连接"><a href="#6️⃣-在-FinalShell-中创建连接" class="headerlink" title="6️⃣ 在 FinalShell 中创建连接"></a><strong><font color='cornflowerblue'>6️⃣ 在 FinalShell 中创建连接</font></strong></h5><ol><li><p><strong>打开 FinalShell</strong></p></li><li><p><strong>新建连接</strong> → 选择 <strong>SSH</strong></p></li><li><p>填写信息：</p><ul><li><strong>名称</strong>：WSL2-Ubuntu（自定义）</li><li><strong>主机</strong>：<code>172.x.x.x</code>（你的 WSL2 IP）</li><li><strong>端口</strong>：<code>22</code></li><li><strong>认证方式</strong>：密码</li><li><strong>用户名</strong>：你的 WSL2 用户名</li><li><strong>密码</strong>：你的 WSL2 密码</li></ul></li><li><p><strong>保存并连接</strong></p></li></ol><br><h4 id="3-3、常见问题排查"><a href="#3-3、常见问题排查" class="headerlink" title="3-3、常见问题排查"></a><strong><font color='#10c300'>3-3、常见问题排查</font></strong></h4><h5 id="❌-问题1：连接超时"><a href="#❌-问题1：连接超时" class="headerlink" title="❌ 问题1：连接超时"></a><strong><font color='cornflowerblue'>❌ 问题1：连接超时</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查 SSH 是否运行</span></span><br><span class="line"><span class="built_in">sudo</span> service ssh status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果没有运行，启动服务</span></span><br><span class="line"><span class="built_in">sudo</span> service ssh start</span><br></pre></td></tr></table></figure><br><h5 id="❌-问题2：端口被占用"><a href="#❌-问题2：端口被占用" class="headerlink" title="❌ 问题2：端口被占用"></a><strong><font color='cornflowerblue'>❌ 问题2：端口被占用</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查 22 端口是否占用</span></span><br><span class="line"><span class="built_in">sudo</span> netstat -tlnp | grep :22</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果使用其他端口，如 2222</span></span><br><span class="line"><span class="built_in">sudo</span> nano /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 修改 Port 为 2222</span></span><br><span class="line"><span class="built_in">sudo</span> service ssh restart</span><br></pre></td></tr></table></figure><br><h5 id="❌-问题3：防火墙阻拦"><a href="#❌-问题3：防火墙阻拦" class="headerlink" title="❌ 问题3：防火墙阻拦"></a><strong><font color='cornflowerblue'>❌ 问题3：防火墙阻拦</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看防火墙状态</span></span><br><span class="line"><span class="built_in">sudo</span> ufw status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果已启用，允许 SSH</span></span><br><span class="line"><span class="built_in">sudo</span> ufw allow 22/tcp</span><br></pre></td></tr></table></figure><br><h5 id="❌-问题4：IP-地址变化"><a href="#❌-问题4：IP-地址变化" class="headerlink" title="❌ 问题4：IP 地址变化"></a><strong><font color='cornflowerblue'>❌ 问题4：IP 地址变化</font></strong></h5><p><strong>问题原因：</strong></p><p>WSL2 使用虚拟网络适配器，每次重启 WSL2 或 Windows 时，WSL2 的 IP 地址可能会发生变化（例如从 <code>172.17.114.127</code> 变成 <code>172.24.240.100</code>）。这会导致 FinalShell 中保存的连接配置失效，需要频繁更新 IP 地址。</p><p><strong>解决方案A：使用 localhost + 端口转发（推荐）</strong></p><p>通过 Windows 的端口转发功能，将 Windows 的某个端口映射到 WSL2 的 SSH 端口，这样无论 WSL2 的 IP 如何变化，都可以通过 <code>localhost</code> 连接。</p><p><strong>步骤：</strong></p><ol><li><strong>获取当前 WSL2 的 IP 地址</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 WSL2 中执行</span></span><br><span class="line">hostname -I</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>在 Windows PowerShell（管理员）中配置端口转发</strong></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 Windows 的 2222 端口转发到 WSL2 的 22 端口</span></span><br><span class="line"><span class="comment"># 注意：需要替换 172.x.x.x 为实际的 WSL2 IP</span></span><br><span class="line">netsh interface portproxy add v4tov4 listenport=<span class="number">2222</span> listenaddress=<span class="number">0.0</span>.<span class="number">0.0</span> connectport=<span class="number">22</span> connectaddress=<span class="number">172</span>.x.x.x</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>在 FinalShell 中使用固定地址连接</strong><ul><li><strong>主机</strong>：<code>localhost</code> 或 <code>127.0.0.1</code></li><li><strong>端口</strong>：<code>2222</code></li></ul></li></ol><p>**⚠️ 注意：**每次 WSL2 IP 变化后，需要重新执行端口转发命令。可以创建一个 PowerShell 脚本自动获取 IP 并配置转发。</p><p><strong>解决方案B：使用 Windows Terminal（最简单）</strong></p><p>Windows Terminal 是 Windows 10&#x2F;11 自带的终端工具，可以直接启动 WSL2，无需 SSH 连接。</p><p><strong>优点：</strong></p><ul><li>✅ 无需配置 SSH</li><li>✅ 无需担心 IP 变化</li><li>✅ 启动速度快</li><li>✅ 集成度高</li></ul><p><strong>使用方法：</strong></p><ol><li>打开 <strong>Windows Terminal</strong></li><li>点击下拉箭头，选择 <strong>Ubuntu</strong>（或你的发行版）</li><li>直接使用，就像使用 SSH 客户端一样</li></ol><p><strong>解决方案C：配置静态 IP（高级）</strong></p><p>可以配置 WSL2 使用固定 IP，但需要修改 Windows 和 WSL2 的网络配置，比较复杂，不推荐普通用户使用。</p><br><h5 id="❌-问题5：密码认证失败"><a href="#❌-问题5：密码认证失败" class="headerlink" title="❌ 问题5：密码认证失败"></a><strong><font color='cornflowerblue'>❌ 问题5：密码认证失败</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确认密码认证已启用</span></span><br><span class="line">grep <span class="string">&quot;PasswordAuthentication&quot;</span> /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置密码</span></span><br><span class="line">passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启 SSH 服务</span></span><br><span class="line"><span class="built_in">sudo</span> service ssh restart</span><br></pre></td></tr></table></figure><br><h4 id="3-4、快速测试连接"><a href="#3-4、快速测试连接" class="headerlink" title="3-4、快速测试连接"></a><strong><font color='#10c300'>3-4、快速测试连接</font></strong></h4><p>在 <strong>Windows CMD</strong> 或 <strong>PowerShell</strong> 中测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh your_username@172.x.x.x</span><br></pre></td></tr></table></figure><p>如果能够连接，说明 SSH 配置正确，FinalShell 也应该能连接。</p><p><strong>SSH 连接格式说明：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh 用户名@IP地址</span><br><span class="line">ssh 用户名@IP地址 -p 端口号</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh zheng_hb@172.17.114.127</span><br><span class="line">ssh zheng_hb@172.17.114.127 -p 22</span><br><span class="line">ssh root@192.168.1.100 -p 2222</span><br></pre></td></tr></table></figure><br><hr><h3 id="四、关于IP地址变化的详细说明"><a href="#四、关于IP地址变化的详细说明" class="headerlink" title="四、关于IP地址变化的详细说明"></a><strong><font color='red'>四、关于IP地址变化的详细说明</font></strong></h3><h4 id="4-1、为什么WSL2的IP地址会变化？"><a href="#4-1、为什么WSL2的IP地址会变化？" class="headerlink" title="4-1、为什么WSL2的IP地址会变化？"></a><strong><font color='#10c300'>4-1、为什么WSL2的IP地址会变化？</font></strong></h4><p>WSL2 使用虚拟网络适配器（Virtual Network Adapter）来创建独立的网络环境。每次：</p><ul><li>重启 Windows</li><li>重启 WSL2（<code>wsl --shutdown</code> 后重新启动）</li><li>Windows 网络适配器重置</li></ul><p>WSL2 的虚拟网络可能会重新分配 IP 地址，导致 IP 地址发生变化。</p><p><strong>示例：</strong></p><ul><li>第一次启动：<code>172.17.114.127</code></li><li>重启后：<code>172.24.240.100</code></li><li>再次重启：<code>172.18.56.89</code></li></ul><br><h4 id="4-2、IP地址变化的影响"><a href="#4-2、IP地址变化的影响" class="headerlink" title="4-2、IP地址变化的影响"></a><strong><font color='#10c300'>4-2、IP地址变化的影响</font></strong></h4><p><strong>影响场景：</strong></p><ul><li>❌ FinalShell 中保存的连接配置失效</li><li>❌ 需要频繁更新 IP 地址</li><li>❌ 如果使用 IP 地址访问 WSL2 中的服务（如 Web 服务器），需要重新配置</li></ul><p><strong>不受影响：</strong></p><ul><li>✅ Windows Terminal 直接启动 WSL2（不依赖 IP）</li><li>✅ 在 Windows 中通过 <code>localhost</code> 访问 WSL2 服务（Windows 会自动处理）</li></ul><br><h4 id="4-3、推荐解决方案对比"><a href="#4-3、推荐解决方案对比" class="headerlink" title="4-3、推荐解决方案对比"></a><strong><font color='#10c300'>4-3、推荐解决方案对比</font></strong></h4><table><thead><tr><th align="left">方案</th><th align="left">优点</th><th align="left">缺点</th><th align="left">适用场景</th></tr></thead><tbody><tr><td align="left"><strong>Windows Terminal</strong></td><td align="left">无需配置、稳定可靠、启动快</td><td align="left">界面相对简单</td><td align="left">日常开发使用（最推荐）</td></tr><tr><td align="left"><strong>端口转发</strong></td><td align="left">可以使用 FinalShell 等专业工具</td><td align="left">需要手动配置、IP变化后需重新配置</td><td align="left">需要 FinalShell 的高级功能</td></tr><tr><td align="left"><strong>静态IP</strong></td><td align="left">IP 固定不变</td><td align="left">配置复杂、容易出错</td><td align="left">特殊需求场景</td></tr></tbody></table><br><h4 id="4-4、自动端口转发脚本（可选）"><a href="#4-4、自动端口转发脚本（可选）" class="headerlink" title="4-4、自动端口转发脚本（可选）"></a><strong><font color='#10c300'>4-4、自动端口转发脚本（可选）</font></strong></h4><p>如果你坚持使用 FinalShell，可以创建一个 PowerShell 脚本自动配置端口转发：</p><p><strong>创建脚本 <code>wsl-port-forward.ps1</code>：</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 WSL2 IP 地址</span></span><br><span class="line"><span class="variable">$wslIp</span> = (wsl hostname <span class="literal">-I</span>).Trim()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除旧的端口转发规则</span></span><br><span class="line">netsh interface portproxy delete v4tov4 listenport=<span class="number">2222</span> listenaddress=<span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加新的端口转发规则</span></span><br><span class="line">netsh interface portproxy add v4tov4 listenport=<span class="number">2222</span> listenaddress=<span class="number">0.0</span>.<span class="number">0.0</span> connectport=<span class="number">22</span> connectaddress=<span class="variable">$wslIp</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;端口转发已配置: localhost:2222 -&gt; <span class="variable">$wslIp:22</span>&quot;</span></span><br></pre></td></tr></table></figure><p><strong>使用方法：</strong><br>每次启动 WSL2 后，以管理员身份运行此脚本即可。</p><br><hr><h3 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a><strong><font color='red'>五、总结</font></strong></h3><p>本指南涵盖了 WSL2 的安装、卸载、基础操作和远程连接配置，帮助你快速上手使用 WSL2 开发环境。</p><p><strong>主要功能：</strong></p><ul><li>✅ WSL2 安装与卸载</li><li>✅ IP 地址查看</li><li>✅ 用户管理</li><li>✅ SSH 服务配置</li><li>✅ FinalShell 远程连接</li></ul><p><strong>注意事项：</strong></p><ul><li>安装和卸载操作需要管理员权限</li><li>卸载发行版会删除所有数据，请提前备份</li><li><strong>WSL2 的 IP 地址可能会变化</strong>：<ul><li><strong>推荐方案</strong>：直接使用 <strong>Windows Terminal</strong>，无需配置，稳定可靠</li><li><strong>备选方案</strong>：使用端口转发 + FinalShell，但需要处理 IP 变化问题</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一、WSL2安装与卸载&quot;&gt;&lt;a href=&quot;#一、WSL2安装与卸载&quot; class=&quot;headerlink&quot; title=&quot;一、WSL2安装与卸载&quot;&gt;&lt;/a&gt;&lt;strong&gt;&lt;font color=&#39;red&#39;&gt;一、WSL2安装与卸载&lt;/font&gt;&lt;/strong&gt;</summary>
      
    
    
    
    <category term="后端与运维" scheme="http://example.com/categories/%E5%90%8E%E7%AB%AF%E4%B8%8E%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Windows" scheme="http://example.com/tags/Windows/"/>
    
    <category term="WSL2" scheme="http://example.com/tags/WSL2/"/>
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Hyper-V虚拟机详细安装教程</title>
    <link href="http://example.com/posts/hyper-v-install.html"/>
    <id>http://example.com/posts/hyper-v-install.html</id>
    <published>2026-02-23T10:00:00.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、Hyper-V简介"><a href="#一、Hyper-V简介" class="headerlink" title="一、Hyper-V简介 "></a><strong><font color='red'>一、Hyper-V简介 </font></strong></h3><h4 id="1-1、什么是Hyper-V"><a href="#1-1、什么是Hyper-V" class="headerlink" title="1-1、什么是Hyper-V"></a><strong><font color='#10c300'>1-1、什么是Hyper-V</font></strong></h4><p>Hyper-V 是微软开发的原生虚拟化平台，内置于 Windows 专业版、企业版和教育版系统中。它允许用户在单台物理计算机上创建和管理多个虚拟机，每个虚拟机都可以运行独立的操作系统。</p><br><h4 id="1-2、虚拟机软件对比"><a href="#1-2、虚拟机软件对比" class="headerlink" title="1-2、虚拟机软件对比"></a><strong><font color='#10c300'>1-2、虚拟机软件对比</font></strong></h4><p>下表对比了目前主流的虚拟机软件，帮助您选择合适的虚拟化解决方案：</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118191245387.png" alt="image-20260118191245387"></p><p><strong><code>注意：Hyper-V 作为 Windows 系统自带的虚拟化工具，无需额外安装第三方软件，性能优秀且与 Windows 系统集成度高。</code></strong></p><br><h3 id="二、系统要求与准备"><a href="#二、系统要求与准备" class="headerlink" title="二、系统要求与准备 "></a><strong><font color='red'>二、系统要求与准备 </font></strong></h3><h4 id="2-1、Windows版本要求"><a href="#2-1、Windows版本要求" class="headerlink" title="2-1、Windows版本要求"></a><strong><font color='#10c300'>2-1、Windows版本要求</font></strong></h4><p>Hyper-V 功能仅支持以下 Windows 版本：</p><ul><li>Windows 10 专业版&#x2F;企业版&#x2F;教育版</li><li>Windows 11 专业版&#x2F;企业版&#x2F;教育版</li><li>Windows Server 2016 及以上版本</li></ul><p><strong><code>注意：Windows 家庭版不支持 Hyper-V 功能。如果您使用的是家庭版，需要升级到专业版。可以从官方渠道或电商平台购买升级密钥。</code></strong></p><p>查看当前系统版本：</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118191729848.png" alt="image-20260118191729848"></p><br><h4 id="2-2、硬件要求"><a href="#2-2、硬件要求" class="headerlink" title="2-2、硬件要求"></a><strong><font color='#10c300'>2-2、硬件要求</font></strong></h4><p>使用 Hyper-V 需要满足以下硬件条件：</p><ul><li><strong>处理器：</strong> 64位处理器，支持二级地址转换（SLAT）</li><li><strong>内存：</strong> 至少 4GB RAM（建议 8GB 以上）</li><li><strong>存储空间：</strong> 根据虚拟机数量和用途，建议预留 50GB 以上</li><li><strong>BIOS设置：</strong> 需要在 BIOS 中启用虚拟化技术（Intel VT-x 或 AMD-V）</li></ul><br><h4 id="2-3、准备安装镜像"><a href="#2-3、准备安装镜像" class="headerlink" title="2-3、准备安装镜像"></a><strong><font color='#10c300'>2-3、准备安装镜像</font></strong></h4><p>在创建虚拟机之前，需要下载操作系统的 ISO 镜像文件。本教程以 Windows 10 为例：</p><ul><li><a href="https://www.microsoft.com/zh-cn/software-download/windows10">下载 Windows 10 官方镜像</a></li><li><a href="https://www.microsoft.com/zh-cn/software-download/windows11">下载 Windows 11 官方镜像</a></li></ul><p>也可以下载 Linux 发行版（如 Ubuntu、CentOS）的 ISO 镜像文件用于安装。</p><br><h3 id="三、启用Hyper-V功能"><a href="#三、启用Hyper-V功能" class="headerlink" title="三、启用Hyper-V功能 "></a><strong><font color='red'>三、启用Hyper-V功能 </font></strong></h3><h4 id="3-1、通过Windows功能启用"><a href="#3-1、通过Windows功能启用" class="headerlink" title="3-1、通过Windows功能启用"></a><strong><font color='#10c300'>3-1、通过Windows功能启用</font></strong></h4><h5 id="1）打开Windows功能"><a href="#1）打开Windows功能" class="headerlink" title="1）打开Windows功能"></a><strong><font color='cornflowerblue'>1）打开Windows功能</font></strong></h5><p>在 Windows 搜索框中输入”<strong>启用或关闭Windows功能</strong>“或”<strong>功能</strong>“，打开 Windows 功能设置窗口。</p><br><h5 id="2）勾选Hyper-V选项"><a href="#2）勾选Hyper-V选项" class="headerlink" title="2）勾选Hyper-V选项"></a><strong><font color='cornflowerblue'>2）勾选Hyper-V选项</font></strong></h5><p>在 Windows 功能列表中，找到并勾选以下选项：</p><ul><li><strong>Hyper-V</strong><ul><li>Hyper-V 管理工具</li><li>Hyper-V 平台</li></ul></li></ul><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118191918620.png" alt="image-20260118191918620"></p><p>点击”<strong>确定</strong>“按钮，系统将自动安装 Hyper-V 相关组件。</p><br><h5 id="3）重启计算机"><a href="#3）重启计算机" class="headerlink" title="3）重启计算机"></a><strong><font color='cornflowerblue'>3）重启计算机</font></strong></h5><p>安装完成后，系统会提示重启计算机。点击”<strong>立即重启</strong>“使 Hyper-V 功能生效。</p><p><strong><code>注意：重启后 Hyper-V 服务会自动启动，您可以在开始菜单中找到&quot;Hyper-V 管理器&quot;。</code></strong></p><br><h4 id="3-2、通过PowerShell启用（可选）"><a href="#3-2、通过PowerShell启用（可选）" class="headerlink" title="3-2、通过PowerShell启用（可选）"></a><strong><font color='#10c300'>3-2、通过PowerShell启用（可选）</font></strong></h4><p>也可以使用 PowerShell 命令快速启用 Hyper-V：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Enable-WindowsOptionalFeature</span> <span class="literal">-Online</span> <span class="literal">-FeatureName</span> Microsoft<span class="literal">-Hyper-V</span> <span class="literal">-All</span></span><br></pre></td></tr></table></figure><p>执行命令后，同样需要重启计算机。</p><br><h3 id="四、创建和配置虚拟机"><a href="#四、创建和配置虚拟机" class="headerlink" title="四、创建和配置虚拟机 "></a><strong><font color='red'>四、创建和配置虚拟机 </font></strong></h3><h4 id="4-1、打开Hyper-V管理器"><a href="#4-1、打开Hyper-V管理器" class="headerlink" title="4-1、打开Hyper-V管理器"></a><strong><font color='#10c300'>4-1、打开Hyper-V管理器</font></strong></h4><p>在开始菜单中搜索并打开”<strong>Hyper-V 管理器</strong>“。Hyper-V 管理器是管理所有虚拟机的控制台。</p><br><h4 id="4-2、新建虚拟机"><a href="#4-2、新建虚拟机" class="headerlink" title="4-2、新建虚拟机"></a><strong><font color='#10c300'>4-2、新建虚拟机</font></strong></h4><h5 id="1）启动新建虚拟机向导"><a href="#1）启动新建虚拟机向导" class="headerlink" title="1）启动新建虚拟机向导"></a><strong><font color='cornflowerblue'>1）启动新建虚拟机向导</font></strong></h5><p>在 Hyper-V 管理器中，点击右侧的”<strong>新建</strong>“ &gt; “<strong>虚拟机</strong>“，启动新建虚拟机向导。</p><br><h5 id="2）指定名称和位置"><a href="#2）指定名称和位置" class="headerlink" title="2）指定名称和位置"></a><strong><font color='cornflowerblue'>2）指定名称和位置</font></strong></h5><p>为虚拟机指定一个有意义的名称（如”Win10-Dev”），并选择虚拟机文件的存储位置。</p><p><strong><code>建议：选择空间充足的磁盘驱动器存储虚拟机文件。</code></strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118193131223.png" alt="image-20260118193131223"></p><br><h5 id="3）指定代数"><a href="#3）指定代数" class="headerlink" title="3）指定代数"></a><strong><font color='cornflowerblue'>3）指定代数</font></strong></h5><p>选择虚拟机代数：</p><ul><li><strong>第一代：</strong> 适用于较旧的操作系统（如 Windows 7、Windows Server 2008 及更早版本）</li><li><strong>第二代：</strong> 适用于较新的操作系统（如 Windows 8.1、Windows 10、Windows 11 及 Windows Server 2012 以上版本），支持 UEFI 启动</li></ul><p><strong>本教程以安装 Windows 10 为例，选择”第一代”以获得更好的兼容性。</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118193237778.png" alt="image-20260118193237778"></p><p><strong><code>注意：如果要安装 Windows 11，建议选择&quot;第二代&quot;虚拟机，因为 Windows 11 需要 UEFI 和 TPM 2.0 支持。</code></strong></p><br><h5 id="4）分配内存"><a href="#4）分配内存" class="headerlink" title="4）分配内存"></a><strong><font color='cornflowerblue'>4）分配内存</font></strong></h5><p>为虚拟机分配内存。根据要安装的操作系统和用途决定内存大小：</p><ul><li><strong>Windows 10：</strong> 建议至少 4GB（4096MB）</li><li><strong>Windows Server：</strong> 建议至少 4GB</li><li><strong>Linux桌面版：</strong> 建议至少 2GB</li></ul><p>可以勾选”<strong>为此虚拟机使用动态内存</strong>“选项，让 Hyper-V 自动调整内存分配。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118193445956.png" alt="image-20260118193445956"></p><br><h5 id="5）配置网络"><a href="#5）配置网络" class="headerlink" title="5）配置网络"></a><strong><font color='cornflowerblue'>5）配置网络</font></strong></h5><p>选择默认的虚拟交换机。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118193500644.png" alt="image-20260118193500644"></p><br><h5 id="6）连接虚拟硬盘"><a href="#6）连接虚拟硬盘" class="headerlink" title="6）连接虚拟硬盘"></a><strong><font color='cornflowerblue'>6）连接虚拟硬盘</font></strong></h5><p>配置虚拟硬盘：</p><ul><li><strong>创建虚拟硬盘：</strong> 指定虚拟硬盘大小（建议至少 60GB）和存储位置</li><li><strong>使用现有虚拟硬盘：</strong> 选择已有的 VHD&#x2F;VHDX 文件</li><li><strong>稍后附加虚拟硬盘：</strong> 跳过此步骤，稍后再添加</li></ul><p>本教程选择”<strong>创建虚拟硬盘</strong>“，设置大小为 60GB。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118193653514.png" alt="image-20260118193653514"></p><br><h5 id="7）安装选项"><a href="#7）安装选项" class="headerlink" title="7）安装选项"></a><strong><font color='cornflowerblue'>7）安装选项</font></strong></h5><p>选择操作系统的安装方式：</p><ul><li><strong>从可启动的 CD&#x2F;DVD-ROM 安装操作系统：</strong> 选择之前下载的 ISO 镜像文件</li><li><strong>从网络安装操作系统：</strong> 通过 PXE 网络启动安装</li><li><strong>稍后安装操作系统：</strong> 先创建虚拟机，稍后再安装</li></ul><p>本教程选择”<strong>从映像文件(.iso)安装操作系统</strong>“，并浏览选择 Windows 10 的 ISO 镜像文件。</p><br><h5 id="8）完成创建"><a href="#8）完成创建" class="headerlink" title="8）完成创建"></a><strong><font color='cornflowerblue'>8）完成创建</font></strong></h5><p>检查所有配置信息，确认无误后点击”<strong>完成</strong>“按钮。虚拟机创建成功！</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260118193735999.png" alt="image-20260118193735999"></p><p><strong><code>注意：此时虚拟机仅创建完成，还需要启动虚拟机并安装操作系统。</code></strong></p><br><h3 id="五、启动和安装操作系统"><a href="#五、启动和安装操作系统" class="headerlink" title="五、启动和安装操作系统 "></a><strong><font color='red'>五、启动和安装操作系统 </font></strong></h3><h4 id="5-1、启动虚拟机"><a href="#5-1、启动虚拟机" class="headerlink" title="5-1、启动虚拟机"></a><strong><font color='#10c300'>5-1、启动虚拟机</font></strong></h4><p>在 Hyper-V 管理器中，右键点击新创建的虚拟机，选择”<strong>启动</strong>“。然后右键选择”<strong>连接</strong>“打开虚拟机控制台窗口。</p><br><h4 id="5-2、安装操作系统"><a href="#5-2、安装操作系统" class="headerlink" title="5-2、安装操作系统"></a><strong><font color='#10c300'>5-2、安装操作系统</font></strong></h4><p>虚拟机启动后，会自动从 ISO 镜像文件引导，进入操作系统安装程序。按照安装向导的提示完成操作系统安装：</p><ol><li>选择语言、时间和键盘输入法</li><li>点击”<strong>现在安装</strong>“</li><li>输入产品密钥（或选择”<strong>我没有产品密钥</strong>“跳过）</li><li>选择操作系统版本</li><li>接受许可条款</li><li>选择”<strong>自定义：仅安装 Windows（高级）</strong>“</li><li>选择虚拟硬盘并进行分区</li><li>等待安装完成</li></ol><br><h4 id="5-3、安装集成服务（可选）"><a href="#5-3、安装集成服务（可选）" class="headerlink" title="5-3、安装集成服务（可选）"></a><strong><font color='#10c300'>5-3、安装集成服务（可选）</font></strong></h4><p>对于 Windows 虚拟机，Hyper-V 集成服务通常会自动安装。集成服务提供了增强功能，如：</p><ul><li>鼠标集成</li><li>时间同步</li><li>数据交换</li><li>心跳检测</li></ul><p>对于 Linux 虚拟机，可能需要手动安装集成服务组件。</p><br><h3 id="六、常见问题与解决方案"><a href="#六、常见问题与解决方案" class="headerlink" title="六、常见问题与解决方案 "></a><strong><font color='red'>六、常见问题与解决方案 </font></strong></h3><h4 id="6-1、无法启用Hyper-V"><a href="#6-1、无法启用Hyper-V" class="headerlink" title="6-1、无法启用Hyper-V"></a><strong><font color='#10c300'>6-1、无法启用Hyper-V</font></strong></h4><p><strong>问题：</strong> 勾选 Hyper-V 选项后提示无法安装。</p><p><strong>解决方案：</strong></p><ol><li>检查 Windows 版本是否为专业版&#x2F;企业版&#x2F;教育版</li><li>确认 CPU 支持虚拟化技术（Intel VT-x 或 AMD-V）</li><li>进入 BIOS 设置，启用虚拟化功能（通常在 CPU Configuration 或 Advanced 选项中）</li></ol><br><h4 id="6-2、虚拟机无法联网"><a href="#6-2、虚拟机无法联网" class="headerlink" title="6-2、虚拟机无法联网"></a><strong><font color='#10c300'>6-2、虚拟机无法联网</font></strong></h4><p><strong>问题：</strong> 虚拟机创建后无法访问网络。</p><p><strong>解决方案：</strong></p><ol><li>检查虚拟机网络适配器是否连接到虚拟交换机</li><li>创建外部虚拟交换机并绑定到物理网络适配器</li><li>检查虚拟机内部的网络配置（IP地址、DNS等）</li></ol><br><h4 id="6-3、虚拟机性能较差"><a href="#6-3、虚拟机性能较差" class="headerlink" title="6-3、虚拟机性能较差"></a><strong><font color='#10c300'>6-3、虚拟机性能较差</font></strong></h4><p><strong>问题：</strong> 虚拟机运行缓慢，响应速度慢。</p><p><strong>解决方案：</strong></p><ol><li>增加虚拟机分配的内存和处理器核心数</li><li>启用动态内存功能</li><li>将虚拟硬盘存储在 SSD 固态硬盘上</li><li>确保主机系统有足够的可用资源</li></ol><br><h4 id="6-4、与其他虚拟化软件冲突"><a href="#6-4、与其他虚拟化软件冲突" class="headerlink" title="6-4、与其他虚拟化软件冲突"></a><strong><font color='#10c300'>6-4、与其他虚拟化软件冲突</font></strong></h4><p><strong>问题：</strong> 启用 Hyper-V 后，VMware 或 VirtualBox 无法使用。</p><p><strong>解决方案：</strong></p><p>Hyper-V 会独占虚拟化功能，无法与其他虚拟化软件同时运行。如需使用其他虚拟化软件，需要暂时禁用 Hyper-V：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Disable-WindowsOptionalFeature</span> <span class="literal">-Online</span> <span class="literal">-FeatureName</span> Microsoft<span class="literal">-Hyper-V-Hypervisor</span></span><br></pre></td></tr></table></figure><p>禁用后需要重启计算机。</p><br><h3 id="七、进阶配置与优化"><a href="#七、进阶配置与优化" class="headerlink" title="七、进阶配置与优化 "></a><strong><font color='red'>七、进阶配置与优化 </font></strong></h3><h4 id="7-1、快照功能"><a href="#7-1、快照功能" class="headerlink" title="7-1、快照功能"></a><strong><font color='#10c300'>7-1、快照功能</font></strong></h4><p>Hyper-V 支持虚拟机快照（检查点）功能，可以保存虚拟机的某个时刻的状态。在进行重要操作前创建快照，出现问题时可以快速恢复。</p><p><strong>创建快照：</strong> 在虚拟机上右键选择”<strong>检查点</strong>“。</p><br><h4 id="7-2、导出和导入虚拟机"><a href="#7-2、导出和导入虚拟机" class="headerlink" title="7-2、导出和导入虚拟机"></a><strong><font color='#10c300'>7-2、导出和导入虚拟机</font></strong></h4><p>可以导出虚拟机用于备份或迁移到其他主机：</p><p><strong>导出：</strong> 右键虚拟机 &gt; “<strong>导出</strong>“ &gt; 选择导出路径</p><p><strong>导入：</strong> 在 Hyper-V 管理器中选择”<strong>导入虚拟机</strong>“，选择导出的虚拟机文件夹。</p><br><h4 id="7-3、增强会话模式"><a href="#7-3、增强会话模式" class="headerlink" title="7-3、增强会话模式"></a><strong><font color='#10c300'>7-3、增强会话模式</font></strong></h4><p>启用增强会话模式可以获得更好的用户体验，支持剪贴板共享、文件拖放、USB 重定向等功能。</p><p>在虚拟机设置中启用”<strong>增强会话模式</strong>“选项即可。</p><br>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一、Hyper-V简介&quot;&gt;&lt;a href=&quot;#一、Hyper-V简介&quot; class=&quot;headerlink&quot; title=&quot;一、Hyper-V简介 &quot;&gt;&lt;/a&gt;&lt;strong&gt;&lt;font color=&#39;red&#39;&gt;一、Hyper-V简介 &lt;/font&gt;&lt;/stron</summary>
      
    
    
    
    <category term="后端与运维" scheme="http://example.com/categories/%E5%90%8E%E7%AB%AF%E4%B8%8E%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="虚拟机" scheme="http://example.com/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
    <category term="Hyper-V" scheme="http://example.com/tags/Hyper-V/"/>
    
    <category term="Windows" scheme="http://example.com/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>Claude Code 安装与配置指南</title>
    <link href="http://example.com/posts/claudecodeinstall.html"/>
    <id>http://example.com/posts/claudecodeinstall.html</id>
    <published>2026-02-23T01:30:00.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、系统要求-Prerequisites"><a href="#一、系统要求-Prerequisites" class="headerlink" title="一、系统要求 (Prerequisites) "></a><strong><font color='red'>一、系统要求 (Prerequisites) </font></strong></h3><p>在开始之前，请确保你的系统满足以下要求：</p><h4 id="1-1、硬件与系统"><a href="#1-1、硬件与系统" class="headerlink" title="1-1、硬件与系统"></a><strong><font color='#10c300'>1-1、硬件与系统</font></strong></h4><table><thead><tr><th align="left">项目</th><th align="left">要求</th></tr></thead><tbody><tr><td align="left"><strong>操作系统</strong></td><td align="left">macOS 13.0+<br>Ubuntu 20.04+ &#x2F; Debian 10+<br>Windows 10+ (需配合 WSL 1, WSL 2 或 Git for Windows)</td></tr><tr><td align="left"><strong>硬件</strong></td><td align="left">至少 4 GB RAM</td></tr><tr><td align="left"><strong>Shell环境</strong></td><td align="left">推荐使用 Bash 或 Zsh</td></tr></tbody></table><h4 id="1-2、账号与网络"><a href="#1-2、账号与网络" class="headerlink" title="1-2、账号与网络"></a><strong><font color='#10c300'>1-2、账号与网络</font></strong></h4><ul><li><strong>账号要求</strong>：需要 <strong>Claude Pro</strong> 或 <strong>Team</strong> 订阅才能使用 Claude Code</li><li><strong>网络</strong>：稳定的互联网连接（中国大陆用户需特殊网络配置，详见第五章）</li></ul><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260130012622312.png" alt="SR-IOV设置示意图"></p><br><h3 id="二、安装步骤-Installation"><a href="#二、安装步骤-Installation" class="headerlink" title="二、安装步骤 (Installation) "></a><strong><font color='red'>二、安装步骤 (Installation) </font></strong></h3><p>根据你的操作系统选择对应的安装命令。</p><h4 id="2-1、macOS-Linux-WSL"><a href="#2-1、macOS-Linux-WSL" class="headerlink" title="2-1、macOS, Linux, WSL"></a><strong><font color='#10c300'>2-1、macOS, Linux, WSL</font></strong></h4><p>在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://claude.ai/install.sh | bash</span><br></pre></td></tr></table></figure><br><h4 id="2-2、Windows"><a href="#2-2、Windows" class="headerlink" title="2-2、Windows"></a><strong><font color='#10c300'>2-2、Windows</font></strong></h4><h5 id="1）PowerShell-推荐"><a href="#1）PowerShell-推荐" class="headerlink" title="1）PowerShell (推荐)"></a><strong><font color='cornflowerblue'>1）PowerShell (推荐)</font></strong></h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">irm</span> https://claude.ai/install.ps1 | <span class="built_in">iex</span></span><br></pre></td></tr></table></figure><h5 id="2）CMD"><a href="#2）CMD" class="headerlink" title="2）CMD"></a><strong><font color='cornflowerblue'>2）CMD</font></strong></h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://claude.ai/install.<span class="built_in">cmd</span> -o install.<span class="built_in">cmd</span> &amp;&amp; install.<span class="built_in">cmd</span> &amp;&amp; <span class="built_in">del</span> install.<span class="built_in">cmd</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>⚠️ 网络注意事项：</strong><br>由于网络环境限制，国内用户在安装过程中可能会失败。<br><strong>解决方案</strong>：请确保开启网络代理工具，并启用 <strong>TUN 模式</strong> 以确保终端流量被正确代理。</p></blockquote><br><h3 id="三、环境配置-Configuration"><a href="#三、环境配置-Configuration" class="headerlink" title="三、环境配置 (Configuration) "></a><strong><font color='red'>三、环境配置 (Configuration) </font></strong></h3><h4 id="3-1、配置环境变量"><a href="#3-1、配置环境变量" class="headerlink" title="3-1、配置环境变量"></a><strong><font color='#10c300'>3-1、配置环境变量</font></strong></h4><p>安装完成后，如果系统提示无法识别 <code>claude</code> 命令，你需要手动配置环境变量。</p><ol><li><p><strong>打开系统属性</strong>：<br>按下 <code>Win + R</code>，输入 <code>sysdm.cpl</code> 并回车（或搜索“编辑系统环境变量”）。</p></li><li><p><strong>添加路径</strong>：<br>点击“高级”选项卡 -&gt; “环境变量”。在 <code>Path</code> 中添加 Claude Code 的安装路径。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260130012118216.png" alt="环境变量配置示例"></p></li></ol><br><h4 id="3-2、验证安装"><a href="#3-2、验证安装" class="headerlink" title="3-2、验证安装"></a><strong><font color='#10c300'>3-2、验证安装</font></strong></h4><p>打开新的终端窗口，执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">claude -v</span><br></pre></td></tr></table></figure><p>如果显示版本号，则表示配置成功。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260130012255180.png" alt="版本验证"></p><br><h3 id="四、登录与初始化-Initialization"><a href="#四、登录与初始化-Initialization" class="headerlink" title="四、登录与初始化 (Initialization) "></a><strong><font color='red'>四、登录与初始化 (Initialization) </font></strong></h3><h4 id="4-1、启动登录"><a href="#4-1、启动登录" class="headerlink" title="4-1、启动登录"></a><strong><font color='#10c300'>4-1、启动登录</font></strong></h4><p>在终端执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">claude auth login</span><br></pre></td></tr></table></figure><h4 id="4-2、配置偏好"><a href="#4-2、配置偏好" class="headerlink" title="4-2、配置偏好"></a><strong><font color='#10c300'>4-2、配置偏好</font></strong></h4><ul><li><p><strong>代码风格</strong>：按需选择或直接回车保持默认。<br><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260130013315135.png" alt="代码风格选择"></p></li><li><p><strong>登录方式</strong>：选择默认方式（通常是浏览器验证），浏览器会自动打开授权页面，确认授权即可。<br><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260130013435258.png" alt="官网授权"></p></li></ul><br><h3 id="五、常见问题排查"><a href="#五、常见问题排查" class="headerlink" title="五、常见问题排查 "></a><strong><font color='red'>五、常见问题排查 </font></strong></h3><h4 id="5-1、TUN模式无法上网-DNS-错误"><a href="#5-1、TUN模式无法上网-DNS-错误" class="headerlink" title="5-1、TUN模式无法上网 &#x2F; DNS 错误"></a><strong><font color='#10c300'>5-1、TUN模式无法上网 &#x2F; DNS 错误</font></strong></h4><p><strong>现象描述</strong>：<br>开启代理软件的 TUN 模式后，网络连接断开，但系统代理模式下正常。日志显示 <code>all DNS requests failed</code> 或 <code>tcp4 failed</code>。</p><p><strong>原因分析</strong>：<br>这通常与网卡设置有关，特别是网卡是否支持或开启了 <strong>SR-IOV</strong>（单根输入&#x2F;输出虚拟化）。</p><br><h4 id="5-2、解决方案（以-ROG-主板-Bios-为例）"><a href="#5-2、解决方案（以-ROG-主板-Bios-为例）" class="headerlink" title="5-2、解决方案（以 ROG 主板 Bios 为例）"></a><strong><font color='#10c300'>5-2、解决方案（以 ROG 主板 Bios 为例）</font></strong></h4><ol><li>重启电脑，进入 BIOS (F2 或 Del)。</li><li>进入 <strong>Advanced Mode (高级模式)</strong> -&gt; <strong>Advanced (高级)</strong>。</li><li>进入 <strong>PCI Subsystem Settings</strong> 菜单。</li><li>将 <strong>SR-IOV Support</strong> 开启 (<strong>Enabled</strong>)。</li><li>F10 保存并重启。</li></ol><br><h3 id="六、终端中使用-Claude-Code-接入阿里云百炼-GLM-5"><a href="#六、终端中使用-Claude-Code-接入阿里云百炼-GLM-5" class="headerlink" title="六、终端中使用 Claude Code 接入阿里云百炼 GLM-5"></a><strong><font color='red'>六、终端中使用 Claude Code 接入阿里云百炼 GLM-5</font></strong></h3><p>详细说明了在终端（CLI）中使用官网安装的 <code>claude</code> 命令行工具，并配置阿里云百炼 <strong>Coding Plan 专属 API Key</strong> 以原生调用 <strong>GLM-5</strong> 模型的完整步骤。这使得你无需依赖 Anthropic 官网账单便能享受到强大的 AI 辅助编程能力。</p><h4 id="6-1、前提条件"><a href="#6-1、前提条件" class="headerlink" title="6.1、前提条件"></a><strong><font color='#10c300'>6.1、前提条件</font></strong></h4><ol><li><p><strong>已经全局安装 Claude Code 核心 CL</strong></p></li><li><p><strong>跳过 Anthropic 登录</strong>：如果首次启动强制要求登录 Anthropic 账户，找到 <code>C:\Users\你的用户名\.claude.json</code> 文件，将内容设置为</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hasCompletedOnboarding&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>获取 API Key</strong>：你需要进入<a href="https://bailian.console.aliyun.com/cn-beijing/?tab=model#/efm/coding_plan">阿里云百炼控制台 Coding Plan 页面</a>订阅并获取专属的 API Key（格式为 <code>sk-sp-****</code>）。</p></li></ol><h4 id="6-2、全局环境变量配置（永久生效）"><a href="#6-2、全局环境变量配置（永久生效）" class="headerlink" title="6.2、全局环境变量配置（永久生效）"></a><strong><font color='#10c300'>6.2、全局环境变量配置（永久生效）</font></strong></h4><p>Claude Code 在无界面认证时需要读取终端的环境变量以发起请求。为了防止<strong>每次重启终端后配置丢失</strong>，建议使用 PowerShell 修改系统级（或用户级）环境变量。</p><p><strong><font color='cornflowerblue'>第一步：打开 PowerShell 终端运行配置命令</font></strong></p><p>粘贴并运行以下完整的环境变量设置命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 配置你的 Coding Plan 专属 API Key（请替换为你自己的 key）</span></span><br><span class="line">[<span class="type">Environment</span>]::SetEnvironmentVariable(<span class="string">&quot;ANTHROPIC_API_KEY&quot;</span>, <span class="string">&quot;sk-sp-75af544fcd5d4cd9bf2c7e0148555a5a&quot;</span>, [<span class="type">EnvironmentVariableTarget</span>]::User)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 配置 Coding Plan 专属的 Base URL</span></span><br><span class="line">[<span class="type">Environment</span>]::SetEnvironmentVariable(<span class="string">&quot;ANTHROPIC_BASE_URL&quot;</span>, <span class="string">&quot;https://coding.dashscope.aliyuncs.com/apps/anthropic&quot;</span>, [<span class="type">EnvironmentVariableTarget</span>]::User)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 智能模型调度配置（推荐）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置后无需手动切换模型，Claude Code 会根据任务难度自动在这 3 个模型间切换，帮你节省额度和提高加载速度：</span></span><br><span class="line"><span class="comment"># 复杂度极高的任务（如分析整个项目架构） -&gt; 使用最强模型 GLM-5</span></span><br><span class="line">[<span class="type">Environment</span>]::SetEnvironmentVariable(<span class="string">&quot;ANTHROPIC_DEFAULT_OPUS_MODEL&quot;</span>, <span class="string">&quot;glm-5&quot;</span>, [<span class="type">EnvironmentVariableTarget</span>]::User)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日常编写大段代码、实现功能的核心任务 -&gt; 使用主模型 GLM-5</span></span><br><span class="line">[<span class="type">Environment</span>]::SetEnvironmentVariable(<span class="string">&quot;ANTHROPIC_DEFAULT_SONNET_MODEL&quot;</span>, <span class="string">&quot;glm-5&quot;</span>, [<span class="type">EnvironmentVariableTarget</span>]::User)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单的文件检索、拼写检查等打杂任务 -&gt; 使用精简极速的 qwen3-coder-next</span></span><br><span class="line">[<span class="type">Environment</span>]::SetEnvironmentVariable(<span class="string">&quot;ANTHROPIC_DEFAULT_HAIKU_MODEL&quot;</span>, <span class="string">&quot;qwen3-coder-next&quot;</span>, [<span class="type">EnvironmentVariableTarget</span>]::User)</span><br><span class="line"></span><br><span class="line"><span class="comment"># （注：配置了上方 3 个细分变量后，不要再配置全局的 ANTHROPIC_MODEL，以免被强行覆盖）</span></span><br></pre></td></tr></table></figure><p><strong>注意：</strong> 这些变量已被永久写入操作系统的<strong>用户环境变量</strong>中。</p><p><strong><font color='cornflowerblue'>第二步：彻底重启终端（非常关键！）</font></strong></p><p>由于当前正在运行的 PowerShell 或内嵌终端（如 VS Code 终端）<strong>不会自动重载</strong>底层外部环境变量：</p><ol><li>请完全关闭当前的控制台&#x2F;终端窗口（如果你在 VS Code 里面，请完全关闭整个 VS Code 软件）。</li><li><strong>重新打开一个新的终端窗口</strong>。</li></ol><p>最佳方式可直接重启电脑</p><p><strong><font color='cornflowerblue'>第三步：运行与验证</font></strong></p><p>在重新打开的新终端中进入你的代码项目目录。</p><p><strong>1.  验证变量生效</strong></p><p>在终端中执行测试命令检查：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$env:ANTHROPIC_API_KEY</span></span><br></pre></td></tr></table></figure><p>如果成功输出你的专属 API Key（如 <code>sk-sp-75af5...</code>），说明配置已经<strong>永久生效</strong>！</p><p><strong>2.  启动终端版 Claude Code</strong></p><p>在终端直接输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">claude</span><br></pre></td></tr></table></figure><p>此时你将跳过复杂的 Anthropic 官方验证拦截，直接在终端里启动对话交互模式，开始向 GLM-5 提问和辅助阅读源码、生成文件。</p><h4 id="6-3、（可选）体验项目级局部配置"><a href="#6-3、（可选）体验项目级局部配置" class="headerlink" title="6.3、（可选）体验项目级局部配置"></a><strong><font color='#10c300'>6.3、（可选）体验项目级局部配置</font></strong></h4><p>如果你不想污染系统环境变量，或者想在不同项目间切换不同模型，Claude Code 也支持在你的项目根目录新建一个名为 <code>settings.json</code>（或全局的 <code>~/.claude.json</code>）并写入如下配置：（建议直接配置在 <code>~/.claude.json</code>中，这是目前我自己使用的方式）</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;ANTHROPIC_API_KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sk-sp-75af544fcd5d4cd9bf2c7e0148555a5a&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ANTHROPIC_BASE_URL&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://coding.dashscope.aliyuncs.com/apps/anthropic&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 配置后无需手动切换模型，Claude Code会根据任务难度自动在这3个模型间切换，帮你节省额度和提高加载速度</span></span><br><span class="line">        <span class="comment">// 复杂度极高的任务（如分析整个项目架构） -&gt; 使用最强模型 GLM-5</span></span><br><span class="line">        <span class="attr">&quot;ANTHROPIC_DEFAULT_OPUS_MODEL&quot;</span><span class="punctuation">:</span> <span class="string">&quot;glm-5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 日常编写大段代码、实现功能的核心任务 -&gt; 使用主模型 GLM-5</span></span><br><span class="line">        <span class="attr">&quot;ANTHROPIC_DEFAULT_SONNET_MODEL&quot;</span><span class="punctuation">:</span> <span class="string">&quot;glm-5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 简单的文件检索、拼写检查等打杂任务 -&gt; 使用精简极速的 qwen3-coder-next</span></span><br><span class="line">        <span class="attr">&quot;ANTHROPIC_DEFAULT_HAIKU_MODEL&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qwen3-coder-next&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hasCompletedOnboarding&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>提示： <code>hasCompletedOnboarding: true</code> 用于跳过由于没有官方账号造成的强制登录流程。</p><h4 id="6-4、常见问题排查"><a href="#6-4、常见问题排查" class="headerlink" title="6.4、常见问题排查"></a><strong><font color='#10c300'>6.4、常见问题排查</font></strong></h4><p><strong>Q1：输入 <code>claude</code> 依然提示 <code>Could not resolve authentication method...</code>？</strong></p><ul><li><p><strong>原因：</strong> VS Code 终端仍在使用旧的环境变量进程缓存。</p></li><li><p><strong>解决：</strong> 必须完全退出并关闭 VS Code 主程序，或者在当前终端立刻运行一条<strong>临时热加载命令</strong>：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$env:ANTHROPIC_API_KEY</span>=<span class="string">&quot;你的API_KEY&quot;</span>; <span class="variable">$env:ANTHROPIC_BASE_URL</span>=<span class="string">&quot;https://coding.dashscope.aliyuncs.com/apps/anthropic&quot;</span>; <span class="variable">$env:ANTHROPIC_MODEL</span>=<span class="string">&quot;glm-5&quot;</span>; claude</span><br></pre></td></tr></table></figure></li></ul><p><strong>Q2：想切换到其他支持的模型？</strong></p><ul><li>阿里云百炼 Coding Plan 还支持 <code>qwen3.5-plus</code>, <code>kimi-k2.5</code>, <code>qwen3-coder-next</code> 等。</li><li>在运行中的 <code>claude</code> 会话内，只需输入 <code>/model &lt;模型名&gt;</code> 即可迅速无缝切换。例如：<code>/model qwen3.5-plus</code>。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一、系统要求-Prerequisites&quot;&gt;&lt;a href=&quot;#一、系统要求-Prerequisites&quot; class=&quot;headerlink&quot; title=&quot;一、系统要求 (Prerequisites) &quot;&gt;&lt;/a&gt;&lt;strong&gt;&lt;font color=&#39;re</summary>
      
    
    
    
    <category term="工具" scheme="http://example.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="Claude" scheme="http://example.com/tags/Claude/"/>
    
  </entry>
  
  <entry>
    <title>Git使用SSH拉取代码配置指南</title>
    <link href="http://example.com/posts/65464545tryt435.html"/>
    <id>http://example.com/posts/65464545tryt435.html</id>
    <published>2026-02-23T00:00:00.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、配置-Git-用户信息"><a href="#一、配置-Git-用户信息" class="headerlink" title="一、配置 Git 用户信息"></a><strong><font color='red'>一、配置 Git 用户信息</font></strong></h3><p>这些信息会记录在**每次 Git 提交（commit）**中，用于标识”谁提交了这段代码”。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&#x27;zhenghong&#x27;</span></span><br><span class="line">git config --global user.email <span class="string">&#x27;772198520@qq.com&#x27;</span></span><br></pre></td></tr></table></figure><br><p><strong>验证当前配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --list</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260119231528481.png" alt="image-20260119231528481"></p><br><h3 id="二、生成-SSH-密钥"><a href="#二、生成-SSH-密钥" class="headerlink" title="二、生成 SSH 密钥"></a><strong><font color='red'>二、生成 SSH 密钥</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&#x27;772198520@qq.com&#x27;</span></span><br><span class="line"><span class="comment"># 或使用更安全的 ed25519 算法（推荐）</span></span><br><span class="line">ssh-keygen -t ed25519 -C <span class="string">&#x27;772198520@qq.com&#x27;</span></span><br></pre></td></tr></table></figure><p>连续按 3 次回车（使用默认路径和空密码）</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260119231535380.png" alt="image-20260119231535380"></p><br><h3 id="三、查看并复制公钥"><a href="#三、查看并复制公钥" class="headerlink" title="三、查看并复制公钥"></a><strong><font color='red'>三、查看并复制公钥</font></strong></h3><p>默认生成秘钥的位置C:\Users\zheng_hb.ssh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\Users\zheng_hb\.ssh\id_rsa.pub</span><br><span class="line"><span class="comment"># 或（如果用 ed25519）</span></span><br><span class="line"><span class="built_in">type</span> C:\Users\zheng_hb\.ssh\id_ed25519.pub</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260119232637916.png" alt="image-20260119232637916"></p><br><h3 id="四、添加公钥到-Git-平台"><a href="#四、添加公钥到-Git-平台" class="headerlink" title="四、添加公钥到 Git 平台"></a><strong><font color='red'>四、添加公钥到 Git 平台</font></strong></h3><p><strong>以GitHub为例</strong></p><ol><li>登录 GitHub</li><li>点击头像 → Settings → SSH and GPG keys</li><li>点击 “New SSH key”</li><li>粘贴公钥内容，保存</li></ol><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260119232647077.png" alt="image-20260119232647077"></p><br><h3 id="五、测试连接"><a href="#五、测试连接" class="headerlink" title="五、测试连接"></a><strong><font color='red'>五、测试连接</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GitHub</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># GitLab</span></span><br><span class="line">ssh -T git@gitlab.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gitee</span></span><br><span class="line">ssh -T git@gitee.com            </span><br></pre></td></tr></table></figure><p>成功返回示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi zhbCloud! You<span class="string">&#x27;ve successfully authenticated...</span></span><br></pre></td></tr></table></figure><br><h3 id="六、克隆代码"><a href="#六、克隆代码" class="headerlink" title="六、克隆代码"></a><strong><font color='red'>六、克隆代码</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:username/repository.git</span><br></pre></td></tr></table></figure><br><h3 id="七、如果之前克隆的是-HTTPS-仓库"><a href="#七、如果之前克隆的是-HTTPS-仓库" class="headerlink" title="七、如果之前克隆的是 HTTPS 仓库"></a><strong><font color='red'>七、如果之前克隆的是 HTTPS 仓库</font></strong></h3><p>需要将远程地址改为 SSH 格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前远程地址</span></span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看结果</span></span><br><span class="line">origin  https://github.com/zhbCloud/仓库名.git (fetch)</span><br><span class="line">origin  https://github.com/zhbCloud/仓库名.git (push)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改为 SSH</span></span><br><span class="line">git remote set-url origin git@github.com:zhbCloud/仓库名.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证修改</span></span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改成功</span></span><br><span class="line">origin  git@github.com:zhbCloud/仓库名.git (fetch)</span><br><span class="line">origin  git@github.com:zhbCloud/仓库名.git (push)</span><br></pre></td></tr></table></figure><br><p><strong>TortoiseGit中修改</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260119232657035.png" alt="image-20260119232657035"></p><br><h3 id="八、解决-TortoiseGit-SSH-认证问题"><a href="#八、解决-TortoiseGit-SSH-认证问题" class="headerlink" title="八、解决 TortoiseGit SSH 认证问题"></a><strong><font color='red'>八、解决 TortoiseGit SSH 认证问题</font></strong></h3><p>TortoiseGit 使用的是 <strong>PuTTY</strong> 的 SSH 客户端，而命令行用的是 <strong>OpenSSH</strong>，它们的密钥格式不兼容！</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260119232701820.png" alt="image-20260119232701820"></p><br><p><strong>让 TortoiseGit 使用 OpenSSH</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置 TortoiseGit 使用 Git 的 SSH</span></span><br><span class="line">右键 → TortoiseGit → Settings</span><br><span class="line">→ Network</span><br><span class="line">→ SSH Client: 修改为 Git 的 ssh.exe 路径</span><br></pre></td></tr></table></figure><br><p><strong>常见ssh.exe路径</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Git\usr\bin\ssh.exe</span><br><span class="line"><span class="comment"># 或者直接写</span></span><br><span class="line">ssh.exe</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260119232709254.png" alt="image-20260119232709254"></p><br>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一、配置-Git-用户信息&quot;&gt;&lt;a href=&quot;#一、配置-Git-用户信息&quot; class=&quot;headerlink&quot; title=&quot;一、配置 Git 用户信息&quot;&gt;&lt;/a&gt;&lt;strong&gt;&lt;font color=&#39;red&#39;&gt;一、配置 Git 用户信息&lt;/font&gt;&lt;</summary>
      
    
    
    
    <category term="工具" scheme="http://example.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="Git" scheme="http://example.com/tags/Git/"/>
    
    <category term="SSH" scheme="http://example.com/tags/SSH/"/>
    
    <category term="版本控制" scheme="http://example.com/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>React MobX 全面指南 (MobX 6)</title>
    <link href="http://example.com/posts/mobx-guide-2026.html"/>
    <id>http://example.com/posts/mobx-guide-2026.html</id>
    <published>2026-02-22T15:50:00.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React-MobX-全面指南-现代版-MobX-6"><a href="#React-MobX-全面指南-现代版-MobX-6" class="headerlink" title="React MobX 全面指南 (现代版 MobX 6)"></a>React MobX 全面指南 (现代版 MobX 6)</h1><blockquote><p>🚀 <strong>MobX</strong> 是一个经过战火洗礼的库，它让状态管理变得简单、可扩展。与 Redux 的不可变逻辑不同，MobX 拥抱“响应式编程”，通过透明的函数式响应让状态与 UI 自动同步。</p></blockquote><hr><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol><li><a href="#%E4%B8%80%E5%9F%BA%E7%A1%80%E7%AF%87mobx-%E6%A0%B8%E5%BF%83%E4%B8%8E%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">基础篇：MobX 核心与快速上手</a></li><li><a href="#%E4%BA%8C%E8%BF%9B%E9%98%B6%E7%AF%87%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E4%B8%8Ereact-%E6%B7%B1%E5%BA%A6%E9%9B%86%E6%88%90">进阶篇：异步处理与 React 深度集成</a></li><li><a href="#%E4%B8%89%E9%AB%98%E7%BA%A7%E7%AF%87%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">高级篇：性能优化与架构最佳实践</a></li><li><a href="#%E5%9B%9B%E6%80%BB%E7%BB%93mobx-vs-redux-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9">总结：MobX vs Redux 如何选择</a></li></ol><br><h2 id="一、-基础篇：MobX-核心与快速上手"><a href="#一、-基础篇：MobX-核心与快速上手" class="headerlink" title="一、 基础篇：MobX 核心与快速上手"></a><strong>一、 基础篇：MobX 核心与快速上手</strong></h2><h3 id="1-1-MobX-的核心哲理"><a href="#1-1-MobX-的核心哲理" class="headerlink" title="1.1 MobX 的核心哲理"></a><strong><font color='red'>1.1 MobX 的核心哲理</font></strong></h3><p>MobX 的核心思想是：<strong>任何源自应用状态的东西都应该自动地派生出来。</strong></p><p>想象一下 Excel 表格：</p><ul><li><strong>Observable (状态)</strong>：单元格里的原始数据。</li><li><strong>Computed (派生状态)</strong>：由公式计算出的结果单元格。</li><li><strong>Reactions (响应)</strong>：当数据变化时，Excel 自动重新计算公式并更新图表。</li><li><strong>Actions (动作)</strong>：你手动修改单元格数据的行为。</li></ul><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260223113244196.png" alt="image-20260223113244196"></p><br><h3 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a><strong><font color='red'>1.2 安装</font></strong></h3><p>在现代 React 项目中，你需要安装 <code>mobx</code> 核心库和 <code>mobx-react-lite</code>（专为函数式组件设计）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mobx mobx-react-lite</span><br></pre></td></tr></table></figure><br><h3 id="1-3-核心-API-MobX-6"><a href="#1-3-核心-API-MobX-6" class="headerlink" title="1.3 核心 API (MobX 6)"></a><strong><font color='red'>1.3 核心 API (MobX 6)</font></strong></h3><p>在 MobX 6 中，装饰器语法已不再是必需，推荐使用 <code>makeAutoObservable</code>。</p><h4 id="1）使用-makeAutoObservable"><a href="#1）使用-makeAutoObservable" class="headerlink" title="1）使用 makeAutoObservable"></a><strong><font color='#10c300'>1）使用 makeAutoObservable</font></strong></h4><p>这是目前最简单、最推荐的写法。它能自动推断属性、方法和 getter。</p><p><code>src/store/CounterStore.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; makeAutoObservable &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CounterStore</span> &#123;</span><br><span class="line">  count = <span class="number">0</span>; <span class="comment">// Observable: 状态</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 自动将属性设为 observable，方法设为 action，getter 设为 computed</span></span><br><span class="line">    <span class="title function_">makeAutoObservable</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Action: 修改状态的方法</span></span><br><span class="line">  <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span>++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span>--;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Computed: 派生状态（具有缓存特性）</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">doubleCount</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">count</span> * <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counterStore = <span class="keyword">new</span> <span class="title class_">CounterStore</span>();</span><br></pre></td></tr></table></figure><hr><br><h3 id="1-4-在-React-组件中使用"><a href="#1-4-在-React-组件中使用" class="headerlink" title="1.4 在 React 组件中使用"></a><strong><font color='red'>1.4 在 React 组件中使用</font></strong></h3><p>要在 React 中响应 MobX 状态的变化，必须使用 <code>observer</code> 高阶组件包裹你的组件。</p><p><code>src/App.jsx</code>:</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observer &#125; <span class="keyword">from</span> <span class="string">&quot;mobx-react-lite&quot;</span>; <span class="comment">// 必须引入</span></span><br><span class="line"><span class="keyword">import</span> &#123; counterStore &#125; <span class="keyword">from</span> <span class="string">&quot;./store/CounterStore&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 observer 包裹组件，使其成为“观察者”</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span> = <span class="title function_">observer</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">textAlign:</span> &quot;<span class="attr">center</span>&quot;, <span class="attr">marginTop:</span> &quot;<span class="attr">50px</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>MobX 计数器<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前数值: &#123;counterStore.count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>两倍数值 (Computed): &#123;counterStore.doubleCount&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> counterStore.increment()&#125;&gt;增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> counterStore.decrement()&#125;&gt;减少<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><blockquote><p>[!IMPORTANT]<br><strong>切记</strong>：如果没有用 <code>observer</code> 包裹组件，即使 Store 中的状态变了，组件也不会重新渲染！</p></blockquote><hr><br><h2 id="二、-进阶篇：异步处理与-React-深度集成"><a href="#二、-进阶篇：异步处理与-React-深度集成" class="headerlink" title="二、 进阶篇：异步处理与 React 深度集成"></a><strong>二、 进阶篇：异步处理与 React 深度集成</strong></h2><h3 id="2-1-异步-Action-与-runInAction"><a href="#2-1-异步-Action-与-runInAction" class="headerlink" title="2.1 异步 Action 与 runInAction"></a><strong><font color='red'>2.1 异步 Action 与 runInAction</font></strong></h3><p>在 MobX 默认的<strong>严格模式</strong>下，所有对状态的修改都必须在 <code>action</code> 中完成。但是，<code>await</code> 之后的回调并不在 action 的作用域内，因此需要使用 <code>runInAction</code>。</p><h4 id="1）实战：模拟-API-获取数据"><a href="#1）实战：模拟-API-获取数据" class="headerlink" title="1）实战：模拟 API 获取数据"></a><strong><font color='#10c300'>1）实战：模拟 API 获取数据</font></strong></h4><p><code>src/store/UserStore.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; makeAutoObservable, runInAction &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserStore</span> &#123;</span><br><span class="line">  userInfo = <span class="literal">null</span>;</span><br><span class="line">  loading = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">makeAutoObservable</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 异步获取数据</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetchUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.github.com/users/octocat&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 关键点：await 之后的所有状态修改必须包裹在 runInAction 中</span></span><br><span class="line">      <span class="title function_">runInAction</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">userInfo</span> = data;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="title function_">runInAction</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userStore = <span class="keyword">new</span> <span class="title class_">UserStore</span>();</span><br></pre></td></tr></table></figure><br><h3 id="2-2-使用-React-Context-管理多个-Store-RootStore-模式"><a href="#2-2-使用-React-Context-管理多个-Store-RootStore-模式" class="headerlink" title="2.2 使用 React Context 管理多个 Store (RootStore 模式)"></a><strong><font color='red'>2.2 使用 React Context 管理多个 Store (RootStore 模式)</font></strong></h3><p>在大型项目中，建议创建一个 <code>RootStore</code> 来统一管理所有子 Store，并通过 React Context 注入，以便在组件中方便获取。</p><h4 id="1）第一步：创建-RootStore"><a href="#1）第一步：创建-RootStore" class="headerlink" title="1）第一步：创建 RootStore"></a><strong><font color='#10c300'>1）第一步：创建 RootStore</font></strong></h4><p><code>src/store/index.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext, useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; counterStore &#125; <span class="keyword">from</span> <span class="string">&quot;./CounterStore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&quot;./UserStore&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootStore</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">counterStore</span> = counterStore;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userStore</span> = userStore;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootStore = <span class="keyword">new</span> <span class="title class_">RootStore</span>();</span><br><span class="line"><span class="comment">// 创建 Context</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">RootStoreContext</span> = <span class="title function_">createContext</span>(rootStore);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 Hook，方便组件使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useStore</span> = (<span class="params"></span>) =&gt; <span class="title function_">useContext</span>(<span class="title class_">RootStoreContext</span>);</span><br></pre></td></tr></table></figure><h4 id="2）第二步：在组件中使用"><a href="#2）第二步：在组件中使用" class="headerlink" title="2）第二步：在组件中使用"></a><strong><font color='#10c300'>2）第二步：在组件中使用</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observer &#125; <span class="keyword">from</span> <span class="string">&quot;mobx-react-lite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&quot;../store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserProfile</span> = <span class="title function_">observer</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; userStore, counterStore &#125; = <span class="title function_">useStore</span>(); <span class="comment">// 从 RootStore 中获取</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> userStore.fetchUser()&#125;&gt;加载用户信息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;userStore.loading &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;userStore.userInfo &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名: &#123;userStore.userInfo.login&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>同时也拿到了计数器: &#123;counterStore.count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><br><h2 id="三、-高级篇：性能优化与架构最佳实践"><a href="#三、-高级篇：性能优化与架构最佳实践" class="headerlink" title="三、 高级篇：性能优化与架构最佳实践"></a><strong>三、 高级篇：性能优化与架构最佳实践</strong></h2><h3 id="3-1-细粒度渲染优化"><a href="#3-1-细粒度渲染优化" class="headerlink" title="3.1 细粒度渲染优化"></a><strong><font color='red'>3.1 细粒度渲染优化</font></strong></h3><p>MobX 的性能优势在于“精准打击”。只有真正读取了被修改属性的 <code>observer</code> 组件才会重渲染。</p><p><strong>优化建议</strong>：将大组件拆分为多个小组件。</p><ul><li>❌ 如果一个长列表在父组件里循环读取属性，任何一个属性变了，整个列表都会重绘。</li><li>✅ 将列表项封装为 <code>observer(Item)</code>，这样只有被修改的那一行会动。</li></ul><br><h3 id="3-2-自动响应：reaction-与-autorun"><a href="#3-2-自动响应：reaction-与-autorun" class="headerlink" title="3.2 自动响应：reaction 与 autorun"></a><strong><font color='red'>3.2 自动响应：reaction 与 autorun</font></strong></h3><p>除了 UI 更新，MobX 还能处理副作用。</p><ul><li><strong><code>autorun</code></strong>：只要依赖的状态变了，就执行。常用于自动保存、日志上报。</li><li><strong><code>reaction</code></strong>：更精确。只有指定的属性变了，才执行。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reaction &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只有当 counterStore.count 发生变化时，才会执行后面的回调</span></span><br><span class="line"><span class="title function_">reaction</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> counterStore.<span class="property">count</span>,</span><br><span class="line">  <span class="function">(<span class="params">count, prevCount</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`数值从 <span class="subst">$&#123;prevCount&#125;</span> 变为了 <span class="subst">$&#123;count&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">10</span>) <span class="title function_">alert</span>(<span class="string">&quot;数值过高！&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br><h3 id="3-3-避坑指南：不要在-observer-外解构"><a href="#3-3-避坑指南：不要在-observer-外解构" class="headerlink" title="3.3 避坑指南：不要在 observer 外解构"></a><strong><font color='red'>3.3 避坑指南：不要在 observer 外解构</font></strong></h3><p>这是一个非常常见的错误！</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误写法：在组件体外解构，会失去响应性</span></span><br><span class="line"><span class="keyword">const</span> &#123; count &#125; = counterStore;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = <span class="title function_">observer</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>; <span class="comment">// 这里永远不会更新</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确写法：在组件内部读取，或者传递整个对象</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = <span class="title function_">observer</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; count &#125; = counterStore; <span class="comment">// OK</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><br><h2 id="四、-总结：MobX-vs-Redux-如何选择"><a href="#四、-总结：MobX-vs-Redux-如何选择" class="headerlink" title="四、 总结：MobX vs Redux 如何选择"></a><strong>四、 总结：MobX vs Redux 如何选择</strong></h2><table><thead><tr><th align="left">特性</th><th align="left">MobX</th><th align="left">Redux (RTK)</th></tr></thead><tbody><tr><td align="left"><strong>编程范式</strong></td><td align="left">面向对象、响应式</td><td align="left">函数式、不可变数据</td></tr><tr><td align="left"><strong>样板代码</strong></td><td align="left">非常少</td><td align="left">较多（即使有 RTK）</td></tr><tr><td align="left"><strong>学习曲线</strong></td><td align="left">平缓，像写普通 JS 对象</td><td align="left">较陡，Action&#x2F;Reducer 概念多</td></tr><tr><td align="left"><strong>性能</strong></td><td align="left">极其出色，细粒度依赖追踪</td><td align="left">依赖手动优化（Memo&#x2F;Reselect）</td></tr><tr><td align="left"><strong>调试</strong></td><td align="left">较难追踪（黑盒响应）</td><td align="left">非常强大（Redux DevTools 轨迹清晰）</td></tr><tr><td align="left"><strong>推荐场景</strong></td><td align="left">快速开发、复杂 UI 交互、企业后台、游戏</td><td align="left">大型团队协作、对状态流向要求极其严苛的项目</td></tr></tbody></table><hr><p><em>Happy Coding with MobX! 建议结合项目实践多次演练。</em></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;React-MobX-全面指南-现代版-MobX-6&quot;&gt;&lt;a href=&quot;#React-MobX-全面指南-现代版-MobX-6&quot; class=&quot;headerlink&quot; title=&quot;React MobX 全面指南 (现代版 MobX 6)&quot;&gt;&lt;/a&gt;React </summary>
      
    
    
    
    <category term="前端开发" scheme="http://example.com/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="React" scheme="http://example.com/tags/React/"/>
    
    <category term="MobX" scheme="http://example.com/tags/MobX/"/>
    
    <category term="State Management" scheme="http://example.com/tags/State-Management/"/>
    
  </entry>
  
  <entry>
    <title>React Redux 全面指南 (RTK)</title>
    <link href="http://example.com/posts/rtk-guide-2026.html"/>
    <id>http://example.com/posts/rtk-guide-2026.html</id>
    <published>2026-02-22T15:30:00.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React-Redux-全面指南-Redux-Toolkit"><a href="#React-Redux-全面指南-Redux-Toolkit" class="headerlink" title="React Redux 全面指南 (Redux Toolkit)"></a>React Redux 全面指南 (Redux Toolkit)</h1><blockquote><p>📚 本指南旨在带你从零开始 Mastering React Redux，特别是现代标准的 <strong>Redux Toolkit (RTK)</strong> 写法。</p></blockquote><hr><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol><li><a href="#%E4%B8%80%E5%9F%BA%E7%A1%80%E7%AF%87rtk-%E6%A0%B8%E5%BF%83%E4%B8%8E%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">基础篇：RTK 核心与快速上手</a></li><li><a href="#%E4%BA%8C%E8%BF%9B%E9%98%B6%E7%AF%87%E5%A4%8D%E6%9D%82%E7%8A%B6%E6%80%81%E4%B8%8E%E5%BC%82%E6%AD%A5%E9%80%BB%E8%BE%91">进阶篇：复杂状态与异步逻辑</a></li><li><a href="#%E4%B8%89%E9%AB%98%E7%BA%A7%E7%AF%87rtk-query-%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">高级篇：RTK Query 与性能优化</a></li></ol><br><h2 id="一、-基础篇：RTK-核心与快速上手"><a href="#一、-基础篇：RTK-核心与快速上手" class="headerlink" title="一、 基础篇：RTK 核心与快速上手"></a><strong>一、 基础篇：RTK 核心与快速上手</strong></h2><blockquote><p>[!NOTE]</p><ol><li><strong>Store</strong>：用来存数据的。</li><li><strong>Reducer</strong>：是一个函数，用来处理数据的。</li><li><strong>Action</strong>：是一个具有 <code>type</code> 字段的普通对象，用来描述要进行什么操作。</li><li><strong>Action Creator</strong>：创建并返回 Action 对象的函数。</li><li><strong>Dispatch</strong>：更新 State 的唯一方法，调用 <code>store.dispatch(action)</code>。</li></ol></blockquote><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260213092945181.png" alt="image-20260213092945181"></p><br><h3 id="1-1-Redux-是什么？"><a href="#1-1-Redux-是什么？" class="headerlink" title="1.1 Redux 是什么？"></a><strong><font color='red'>1.1 Redux 是什么？</font></strong></h3><p>Redux 是一个用于 JavaScript 应用的状态容器，提供可预测的状态管理。</p><ul><li><strong>单一数据源</strong>：应用的所有状态都存储在一个对象树中。</li><li><strong>状态是只读的</strong>：唯一改变状态的方法是触发一个 <strong>Action</strong>。</li><li><strong>使用纯函数修改</strong>：编写 <strong>Reducer</strong> 来描述 Action 如何转换 State。</li></ul><blockquote><p>[!TIP]<br><strong>为什么使用 Redux Toolkit (RTK)？</strong><br>官方推荐！RTK 是现代 Redux 的标准写法。它解决了传统 Redux 配置复杂、样板代码多、需手动添加不可变逻辑等痛点。RTK 内置了 <code>Immer</code>（简化不可变更新）、<code>Thunk</code>（异步）、<code>DevTools</code> 等工具。</p></blockquote><br><h3 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a><strong><font color='red'>1.2 安装</font></strong></h3><p>使用 Create React App 或 Vite 创建项目后，安装核心依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @reduxjs/toolkit react-redux</span><br></pre></td></tr></table></figure><br><h3 id="1-3-核心概念与实战-Counter-Example"><a href="#1-3-核心概念与实战-Counter-Example" class="headerlink" title="1.3 核心概念与实战 (Counter Example)"></a><strong><font color='red'>1.3 核心概念与实战 (Counter Example)</font></strong></h3><p>我们将通过一个计数器应用来演示最核心的 API。</p><h4 id="1）第一步：创建-Slice-切片"><a href="#1）第一步：创建-Slice-切片" class="headerlink" title="1）第一步：创建 Slice (切片)"></a><strong><font color='#10c300'>1）第一步：创建 Slice (切片)</font></strong></h4><p><strong>Slice</strong> 是 Redux 逻辑的集合（包含 State，Reducers，Actions）</p><p><code>src\redux\modules\counterSlice.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>, <span class="comment">// Slice 名称，用于生成 Action Type 前缀</span></span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="comment">// Redux Toolkit 允许我们在 reducer 中直接编写&quot;可变&quot;逻辑</span></span><br><span class="line">    <span class="comment">// 它底层使用 Immer 库将 these 操作转换为安全的不可变更新</span></span><br><span class="line">    <span class="attr">increment</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 获取到的是initialState</span></span><br><span class="line">      state.<span class="property">value</span> += <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">decrement</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> -= <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Action Payload 在 action.payload 中</span></span><br><span class="line">    <span class="attr">incrementByAmount</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> += action.<span class="property">payload</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动生成 Action Creators</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increment, decrement, incrementByAmount &#125; = counterSlice.<span class="property">actions</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出 Reducer</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure><h4 id="2）第二步：配置-Store"><a href="#2）第二步：配置-Store" class="headerlink" title="2）第二步：配置 Store"></a><strong><font color='#10c300'>2）第二步：配置 Store</font></strong></h4><p>使用 <code>configureStore</code> 创建 Store，它会自动组合 Slice Reducers 并添加常用中间件。</p><p><code>src\redux\store.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> counterSlice <span class="keyword">from</span> <span class="string">&quot;./modules/counterSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="comment">// 通常会让 store 的 key 和 slice 的 name 保持一致，这里的 key &#x27;counter&#x27; 将决定 state 中的属性名</span></span><br><span class="line">    <span class="attr">counter</span>: counterSlice,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="3）第三步：注入-Store"><a href="#3）第三步：注入-Store" class="headerlink" title="3）第三步：注入 Store"></a><strong><font color='#10c300'>3）第三步：注入 Store</font></strong></h4><p>在应用入口文件中，使用 <code>&lt;Provider&gt;</code> 将 Store 注入到 React 组件树中。</p><p><code>src/main.jsx</code> (或 <code>index.js</code>):</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&quot;./app/store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>)).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="4）第四步：在组件中使用-Hooks"><a href="#4）第四步：在组件中使用-Hooks" class="headerlink" title="4）第四步：在组件中使用 Hooks"></a><strong><font color='#10c300'>4）第四步：在组件中使用 Hooks</font></strong></h4><p>React Redux 提供了两个主要的 Hooks：</p><ul><li><strong><code>useSelector</code></strong>：从 Store 中读取数据。</li><li><strong><code>useDispatch</code></strong>：发送 Action 以触发状态更新。</li></ul><p><code>src\pages\Home.jsx</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  increment,</span><br><span class="line">  decrement,</span><br><span class="line">  incrementByAmount,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../redux/modules/counterSlice&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 读取 State：state.counter 对应 store 配置中的 reducer key</span></span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counter</span>.<span class="property">value</span>);</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>();</span><br><span class="line">  <span class="keyword">const</span> [incrementAmount, setIncrementAmount] = <span class="title function_">useState</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(decrement())&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(increment())&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;incrementAmount&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setIncrementAmount(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span></span></span><br><span class="line"><span class="language-xml">            dispatch(incrementByAmount(Number(incrementAmount) || 0))</span></span><br><span class="line"><span class="language-xml">          &#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          Add Amount</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><hr><br><h2 id="二、-进阶篇：复杂状态与异步逻辑"><a href="#二、-进阶篇：复杂状态与异步逻辑" class="headerlink" title="二、 进阶篇：复杂状态与异步逻辑"></a><strong>二、 进阶篇：复杂状态与异步逻辑</strong></h2><p>实际应用远比计数器复杂。我们需要处理 API 请求、加载状态以及更复杂的数据结构。</p><h3 id="2-1-异步逻辑与数据请求：createAsyncThunk"><a href="#2-1-异步逻辑与数据请求：createAsyncThunk" class="headerlink" title="2.1 异步逻辑与数据请求：createAsyncThunk"></a><strong><font color='red'>2.1 异步逻辑与数据请求：createAsyncThunk</font></strong></h3><p>对于初学者来说，Redux 的异步逻辑可能有点绕。我们先用一个生活中的例子来理解。</p><h4 id="1）为什么需要异步？"><a href="#1）为什么需要异步？" class="headerlink" title="1）为什么需要异步？"></a><strong><font color='#10c300'>1）为什么需要异步？</font></strong></h4><p>Redux 的标准 <code>dispatch</code> 是<strong>同步</strong>的：你点击按钮 -&gt; 发送 action -&gt; store 立即更新 -&gt; 页面刷新。这一切发生在一瞬间。</p><p>但这就像你去快餐店，点完汉堡如果立刻就能拿走，那就是同步。但现实中，很多操作是<strong>异步</strong>的：</p><ul><li><strong>点外卖</strong>：你下单（dispatch action），但饭不会立马到。你需要<strong>等待</strong>（loading），直到骑手送到（success）或者餐厅取消订单（failed）。</li><li><strong>API 请求</strong>：前端向服务器发起请求，服务器处理需要几百毫秒甚至几秒，这段时间内页面通常显示”加载中”。</li></ul><p>Redux Toolkit (RTK) 提供了一个强大的工具 <code>createAsyncThunk</code> 来专门处理这种”下单 -&gt; 等待 -&gt; 收到结果”的流程。它不需要你手动配置复杂的中间件。</p><h4 id="2）实战：实现一个”模拟网络请求的加法”"><a href="#2）实战：实现一个”模拟网络请求的加法”" class="headerlink" title="2）实战：实现一个”模拟网络请求的加法”"></a><strong><font color='#10c300'>2）实战：实现一个”模拟网络请求的加法”</font></strong></h4><p>假设我们有一个”异步加法”按钮，点击后需要等待 1 秒钟（模拟服务器响应），然后数字才会加 1。</p><p><strong>第一步：定义异步 Action (Thunk)</strong></p><p>在 <code>counterSlice.js</code> 中，我们创建一个”点外卖”的动作。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice, createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createAsyncThunk 接收两个参数：</span></span><br><span class="line"><span class="comment">// 1. Action 的名字前缀：&#x27;counter/fetchCount&#x27;。这就好比给你的订单起个名字。</span></span><br><span class="line"><span class="comment">// 2. 一个异步函数 (payloadCreator)：在这里发送网络请求。</span></span><br><span class="line"><span class="comment">// 需要导出供组件调用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementAsync = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/fetchCount&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (amount) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 模拟发送网络请求，等待 1 秒</span></span><br><span class="line">    <span class="comment">// 这里的 Promise 就像是你在等待外卖，pending 状态</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(&#123; <span class="attr">data</span>: amount &#125;), <span class="number">1000</span>),</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 请求成功！返回的数据（外卖到了）</span></span><br><span class="line">    <span class="comment">// 这个返回值会自动变成 action.payload 传给 extraReducers</span></span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>第二步：监听状态变化 (Pending &#x2F; Fulfilled &#x2F; Rejected)</strong></p><p>当 <code>incrementAsync</code> 被 dispatch 触发时，Redux 会自动派发三种状态的 action，就像外卖订单的状态变化：</p><ol><li><strong>pending</strong> (进行中)：外卖刚下单，正在做。</li><li><strong>fulfilled</strong> (成功)：外卖送到了。</li><li><strong>rejected</strong> (失败)：外卖被取消了（网络错误等）。</li></ol><p>我们需要在 <code>createSlice</code> 的 <code>extraReducers</code> 字段中监听这些状态，并更新 store。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterSlice.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice, createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createAsyncThunk 接收两个参数：</span></span><br><span class="line"><span class="comment">// 1. Action 的名字前缀：&#x27;counter/fetchCount&#x27;。这就好比给你的订单起个名字。</span></span><br><span class="line"><span class="comment">// 2. 一个异步函数 (payloadCreator)：在这里发送网络请求。</span></span><br><span class="line"><span class="comment">// 需要导出供组件调用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementAsync = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/fetchCount&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (amount) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 模拟发送网络请求，等待 1 秒</span></span><br><span class="line">    <span class="comment">// 这里的 Promise 就像是你在等待外卖，pending 状态</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(&#123; <span class="attr">data</span>: amount &#125;), <span class="number">1000</span>),</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 请求成功！返回的数据（外卖到了）</span></span><br><span class="line">    <span class="comment">// 这个返回值会自动变成 action.payload 传给 extraReducers</span></span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span>, <span class="comment">// 状态：&#x27;idle&#x27; (空闲) | &#x27;loading&#x27; (加载中) | &#x27;failed&#x27; (失败)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="comment">// 这里放普通的同步 reducers (如 increment, decrement)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// extraReducers 专门用来处理由 createAsyncThunk 生成的 action</span></span><br><span class="line">  <span class="comment">// 这里的 builder 语法不仅类型安全，而且更清晰</span></span><br><span class="line">  <span class="attr">extraReducers</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> &#123;</span><br><span class="line">    builder</span><br><span class="line">      .<span class="title function_">addCase</span>(incrementAsync.<span class="property">pending</span>, <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 刚开始请求 (Pending)</span></span><br><span class="line">        state.<span class="property">status</span> = <span class="string">&quot;loading&quot;</span>; <span class="comment">// 标记状态为&quot;加载中&quot;，界面可以显示转圈圈</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">addCase</span>(incrementAsync.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 2. 请求成功 (Fulfilled)</span></span><br><span class="line">        state.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>; <span class="comment">// 恢复为空闲状态</span></span><br><span class="line">        state.<span class="property">value</span> += action.<span class="property">payload</span>; <span class="comment">// 把请求回来的数据加到 value 上</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">addCase</span>(incrementAsync.<span class="property">rejected</span>, <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 3. 请求失败 (Rejected)</span></span><br><span class="line">        state.<span class="property">status</span> = <span class="string">&quot;failed&quot;</span>; <span class="comment">// 标记失败，界面可以显示错误提示</span></span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure><p><strong>第三步：在组件中使用</strong></p><p>组件中的写法和普通 action 一模一样，使用 <code>dispatch</code> 即可。我们可以利用 state 中的 status 来控制按钮的禁用状态。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; incrementAsync &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/modules/counterSlice&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>();</span><br><span class="line">  <span class="comment">// 获取当前状态，如果是 &#x27;loading&#x27;，我们可以禁用按钮</span></span><br><span class="line">  <span class="keyword">const</span> &#123; value, status &#125; = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counter</span>);</span><br><span class="line">  <span class="keyword">const</span> [incrementAmount, setIncrementAmount] = <span class="title function_">useState</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;incrementAmount&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setIncrementAmount(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">        &#123;/* 点击触发异步操作 如果正在加载，禁用按钮防止重复点击，提升用户体验 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(incrementAsync(Number(incrementAmount) || 0))&#125;</span></span><br><span class="line"><span class="language-xml">          disabled=&#123;status === &quot;loading&quot;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          &#123;status === &quot;loading&quot; ? &quot;计算中...&quot; : &quot;异步加&quot;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* 显示当前值 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>当前值: &#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><p><strong>总结一下流程</strong>：</p><ol><li><strong>Dispatch</strong>: 用户点击按钮 -&gt; <code>dispatch(incrementAsync(5))</code></li><li><strong>Pending</strong>: Redux 自动触发 <code>pending</code> -&gt; <code>status</code> 变为 <code>&#39;loading&#39;</code> -&gt; 按钮变灰。</li><li><strong>Async Work</strong>: <code>incrementAsync</code> 里的 <code>async</code> 函数开始执行（等待 1 秒）。</li><li><strong>Fulfilled</strong>: 1 秒后 Promise 完成 -&gt; Redux 自动触发 <code>fulfilled</code> -&gt; <code>status</code>变回 <code>&#39;idle&#39;</code>，<code>value</code> 更新。</li><li><strong>Re-render</strong>: 组件重新渲染，显示最新的数字。</li></ol><br><h3 id="2-2-异步逻辑的代码优化"><a href="#2-2-异步逻辑的代码优化" class="headerlink" title="2.2 异步逻辑的代码优化"></a><strong><font color='red'>2.2 异步逻辑的代码优化</font></strong></h3><p>随着项目规模扩大，异步逻辑会变得臃肿。我们可以从<strong>结构分离</strong>、<strong>职责单一</strong>和<strong>逻辑复用</strong>三个维度进行优化。</p><h4 id="1-分离-Async-Thunk-定义"><a href="#1-分离-Async-Thunk-定义" class="headerlink" title="1. 分离 Async Thunk 定义"></a><strong><font color='#10c300'>1. 分离 Async Thunk 定义</font></strong></h4><p>将所有 Thunk 放在 <code>Slice</code> 文件中会导致文件过长且容易引发<strong>循环依赖</strong>。建议将异步逻辑提取到独立文件中。</p><ul><li><code>src/features/counter/counterThunks.js</code>: 定义异步操作。</li><li><code>src/features/counter/counterSlice.js</code>: 引入并处理状态。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterThunks.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当天日期的历史数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHistory = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/getHistory&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (params) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://jsonplaceholder.typicode.com/posts&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="2-职责单一与精细化错误处理"><a href="#2-职责单一与精细化错误处理" class="headerlink" title="2. 职责单一与精细化错误处理"></a><strong><font color='#10c300'>2. 职责单一与精细化错误处理</font></strong></h4><ul><li><strong>职责单一</strong>：Thunk 只负责“拿数据”。复杂的数据转换逻辑应放在 <code>reducer</code> 中，保持 Thunk 清洁。</li><li><strong>错误处理</strong>：使用 <code>rejectWithValue</code> 返回自定义错误载荷，以便在界面上展示更有意义的提示。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当天日期的历史数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHistory = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/getHistory&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (params, &#123; rejectWithValue &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(</span><br><span class="line">        <span class="string">&quot;https://jsonplaceholder.typicode.com/posts&quot;</span>,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">rejectWithValue</span>(err.<span class="property">response</span>.<span class="property">data</span>); <span class="comment">// 返回后端错误信息</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="3-使用-addMatcher-减少样板代码"><a href="#3-使用-addMatcher-减少样板代码" class="headerlink" title="3. 使用 addMatcher 减少样板代码"></a><strong><font color='#10c300'>3. 使用 addMatcher 减少样板代码</font></strong></h4><p>如果多个异步操作都有相同的 Loading 或 Error 处理逻辑，可以使用 <code>addMatcher</code> 进行统一拦截，避免在每个 <code>addCase</code> 中重复编写。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterSlice.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getHistory &#125; <span class="keyword">from</span> <span class="string">&quot;../thunks/counterThunks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span>, <span class="comment">// 初始状态设为 idle</span></span><br><span class="line">    <span class="attr">error</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">extraReducers</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> &#123;</span><br><span class="line">    builder</span><br><span class="line">      <span class="comment">// 处理具体的成功逻辑</span></span><br><span class="line">      .<span class="title function_">addCase</span>(getHistory.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        state.<span class="property">value</span> = [];</span><br><span class="line">        state.<span class="property">value</span> = action.<span class="property">payload</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 使用 addMatcher 统一处理所有 pending 状态</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/pending&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;loading&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// 使用 addMatcher 统一处理所有 fulfilled 状态（仅更新状态部分）</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/fulfilled&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// 使用 addMatcher 统一处理所有 rejected 状态</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/rejected&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">          state.<span class="property">error</span> = action.<span class="property">error</span>.<span class="property">message</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure><p><code>addMatcher</code> 在项目后期优化中非常强大，它可以让你像写“拦截器”一样统一管理全局的异步状态。</p><br><h3 id="2-3-综合案例"><a href="#2-3-综合案例" class="headerlink" title="2.3 综合案例"></a><strong><font color='red'>2.3 综合案例</font></strong></h3><p>定义异步操作<code>src\redux\modules\counterThunks.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当天日期的历史数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHistory = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/getHistory&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (params, &#123; rejectWithValue &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;/posts&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">rejectWithValue</span>(err.<span class="property">response</span>.<span class="property">data</span>); <span class="comment">// 返回后端错误信息</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取评论数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getComments = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/getComments&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (postId, &#123; rejectWithValue &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/comments?postId=<span class="subst">$&#123;postId&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">rejectWithValue</span>(err.<span class="property">response</span>.<span class="property">data</span>); <span class="comment">// 返回后端错误信息</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>引入并处理状态<code>src\redux\modules\counterSlice.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getHistory, getComments &#125; <span class="keyword">from</span> <span class="string">&quot;./counterThunks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span>, <span class="comment">// 初始状态设为 idle</span></span><br><span class="line">    <span class="attr">value</span>: [],</span><br><span class="line">    <span class="attr">comments</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">extraReducers</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> &#123;</span><br><span class="line">    builder</span><br><span class="line">      <span class="comment">// 处理具体的成功逻辑</span></span><br><span class="line">      .<span class="title function_">addCase</span>(getHistory.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        state.<span class="property">value</span> = action.<span class="property">payload</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">addCase</span>(getComments.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 假设评论数据存放在另一个字段</span></span><br><span class="line">        state.<span class="property">value</span> = [];</span><br><span class="line">        state.<span class="property">comments</span> = action.<span class="property">payload</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 使用 addMatcher 统一处理所有 pending 状态</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/pending&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;loading&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// 使用 addMatcher 统一处理所有 fulfilled 状态（仅更新状态部分）</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/fulfilled&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// 使用 addMatcher 统一处理所有 rejected 状态</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/rejected&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure><p>组件中使用<code>src\pages\Home.jsx</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getHistory, getComments &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/modules/counterThunks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; value, status, comments &#125; = <span class="title function_">useSelector</span>(</span><br><span class="line">    <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counterSlice</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(getHistory(&#123; count: &quot;5&quot; &#125;))&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        数据请求</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(getComments(1))&#125;&gt;获取评论<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        状态：</span></span><br><span class="line"><span class="language-xml">        &#123;status === &quot;loading&quot;</span></span><br><span class="line"><span class="language-xml">          ? &quot;加载中...&quot;</span></span><br><span class="line"><span class="language-xml">          : status === &quot;idle&quot;</span></span><br><span class="line"><span class="language-xml">            ? &quot;空闲&quot;</span></span><br><span class="line"><span class="language-xml">            : &quot;失败&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;value.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;comments.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><br><h3 id="2-4-记忆化选择器：createSelector"><a href="#2-4-记忆化选择器：createSelector" class="headerlink" title="2.4 记忆化选择器：createSelector"></a><strong><font color='red'>2.4 记忆化选择器：createSelector</font></strong></h3><p>在大型应用中，我们经常需要根据原始数据计算出衍生状态（如：列表过滤、数据转换）。如果直接在 <code>useSelector</code> 中编写复杂的计算逻辑，可能会导致不必要的重渲染。</p><h4 id="1）为什么需要它？"><a href="#1）为什么需要它？" class="headerlink" title="1）为什么需要它？"></a><strong><font color='#10c300'>1）为什么需要它？</font></strong></h4><p>默认情况下，只要 Redux Store 更新，所有的 <code>useSelector</code> 都会重新运行。如果你的 Selector 返回的是一个<strong>新引用</strong>（例如使用 <code>.filter()</code>、<code>.map()</code> 或返回一个新对象），React Redux 会认为数据发生了变化，从而触发组件重渲染——即使数据内容其实没变。</p><p><code>createSelector</code> 可以**记忆（Memoize）**计算结果。只要输入参数没变，它就会直接返回缓存的结果，不会重新计算，也不会触发重渲染。</p><h4 id="2）基本用法：数据预处理"><a href="#2）基本用法：数据预处理" class="headerlink" title="2）基本用法：数据预处理"></a><strong><font color='#10c300'>2）基本用法：数据预处理</font></strong></h4><p>假设后端接口返回的用户信息中，性别是数字代码（1 代表男，2 代表女）。我们希望在组件中直接拿到文字。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice, createSelector &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">hobby</span>: [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;看书&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;写代码&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;打游戏&quot;</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">genderFn</span> = (<span class="params">state</span>) =&gt; state.<span class="property">user</span>.<span class="property">gender</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hobbyFn</span> = (<span class="params">state</span>) =&gt; state.<span class="property">user</span>.<span class="property">hobby</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只有 gender 或 hobby 变化时，才会执行下面逻辑</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> selectUser = <span class="title function_">createSelector</span>(</span><br><span class="line">  [genderFn, hobbyFn],</span><br><span class="line">  <span class="function">(<span class="params">gender, hobby</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在转换数据...&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> genderText = gender === <span class="string">&quot;1&quot;</span> ? <span class="string">&quot;男&quot;</span> : <span class="string">&quot;女&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">gender</span>: genderText,</span><br><span class="line">      <span class="attr">hobbyList</span>: hobby.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === <span class="number">1</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>在组件中使用：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; selectUser &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/modules/userSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; gender, hobbyList &#125; = <span class="title function_">useSelector</span>(selectUser);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：&#123;gender&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span> // 直接使用处理好的属性</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>爱好：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;hobbyList.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><h4 id="3）传参的标准写法"><a href="#3）传参的标准写法" class="headerlink" title="3）传参的标准写法"></a><strong><font color='#10c300'>3）传参的标准写法</font></strong></h4><p>有时我们需要根据组件传入的参数（如 ID）来动态查询数据。<strong>标准做法是将参数作为 Selector 的一个输入项。</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.1 定义获取参数的选择器</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">selectItemId</span> = (<span class="params">state, itemId</span>) =&gt; itemId;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.2 在 createSelector 中引用该参数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> selectItemById = <span class="title function_">createSelector</span>(</span><br><span class="line">  [<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>.<span class="property">hobby</span>, selectItemId], <span class="comment">// 获取外部传入的参数</span></span><br><span class="line">  <span class="function">(<span class="params">hobby, id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 这里的 id 就是上面获取参数选择器对应的 id</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`正在查找 ID 为 <span class="subst">$&#123;id&#125;</span> 的数据...`</span>);</span><br><span class="line">    <span class="keyword">return</span> hobby.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === id);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>在组件中使用：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传递参数：useSelector((state) =&gt; selector(state, param))</span></span><br><span class="line"><span class="keyword">const</span> item = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> <span class="title function_">selectItemById</span>(state, props.<span class="property">id</span>));</span><br></pre></td></tr></table></figure><h4 id="4）高级用法：工厂函数模式-Factory-Function"><a href="#4）高级用法：工厂函数模式-Factory-Function" class="headerlink" title="4）高级用法：工厂函数模式 (Factory Function)"></a><strong><font color='#10c300'>4）高级用法：工厂函数模式 (Factory Function)</font></strong></h4><p>虽然上述传参方式在逻辑上是通用的，但在 <strong>“一个页面渲染多个同类组件”</strong> 时，单例 Selector 的缓存深度只有 1，会导致不同组件实例之间互相竞争缓存，产生不必要的重计算。这时需要使用工厂函数。</p><p><strong>标准工厂模式写法：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 工厂函数：每次调用都返回一个“全新且独立”的 Selector 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">makeSelectTodoById</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="title function_">createSelector</span>(</span><br><span class="line">    [</span><br><span class="line">      <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">todos</span>.<span class="property">list</span>,</span><br><span class="line">      <span class="function">(<span class="params">state, todoId</span>) =&gt;</span> todoId, <span class="comment">// 动态插槽提取参数</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="function">(<span class="params">todos, id</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`实例正在查找 ID 为 <span class="subst">$&#123;id&#125;</span> 的待办事项...`</span>);</span><br><span class="line">      <span class="keyword">return</span> todos.<span class="title function_">find</span>(<span class="function">(<span class="params">todo</span>) =&gt;</span> todo.<span class="property">id</span> === id);</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 💡 深度探讨：为什么不直接写成 makeSelectTodoById(id) ?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ❌ 错误写法：const make = (id) =&gt; createSelector(...)</span></span><br><span class="line"><span class="comment"> * 原因：这会导致该实例被“锁死”在特定 ID 上，丧失了作为选择器工具的通用性和灵活性。</span></span><br><span class="line"><span class="comment"> * 正确写法：实例应该是通用的插槽，具体的 ID 在组件 useSelector 时动态传入。</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><strong>在组件中正确调用：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodoItem</span>(<span class="params">&#123; id &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 使用 useMemo 确保 Selector 实例在组件生命周期内保持唯一</span></span><br><span class="line">  <span class="keyword">const</span> selectTodoById = <span class="title function_">useMemo</span>(makeSelectTodoById, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 动态传参：为该组件专属的实例注入当前 id</span></span><br><span class="line">  <span class="keyword">const</span> todo = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> <span class="title function_">selectTodoById</span>(state, id));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;todo?.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5）最佳实践总结"><a href="#5）最佳实践总结" class="headerlink" title="5）最佳实践总结"></a><strong><font color='#10c300'>5）最佳实践总结</font></strong></h4><ul><li><strong>位置</strong>：尽量在对应的 <code>Slice</code> 文件中定义 Selector，保持逻辑内聚。</li><li><strong>职责</strong>：将“原始数据获取”与“数据预处理”分开调用。</li><li><strong>性能</strong>：不要在组件内部使用 <code>createSelector</code>（每次渲染都会创建新实例），应在组件外部定义。</li></ul><h3 id="2-5-Redux-DevTools"><a href="#2-5-Redux-DevTools" class="headerlink" title="2.5 Redux DevTools"></a><strong><font color='red'>2.5 Redux DevTools</font></strong></h3><p>Redux 最强大的特性之一是调试体验。</p><ul><li>安装 Chrome 扩展程序 <strong>Redux DevTools</strong>。</li><li>RTK 的 <code>configureStore</code> 默认开启 DevTools。</li><li>你可以看到每一个 Action 的触发时间、Payload 内容以及 State 的差异 (Diff)。</li><li><strong>时间旅行 (Time Travel)</strong>：你可以点击 “Jump” 跳转到任意历史状态，重现 Bug 现场。</li></ul><hr><br><h2 id="三、高级篇：RTK-Query-与性能优化"><a href="#三、高级篇：RTK-Query-与性能优化" class="headerlink" title="三、高级篇：RTK Query 与性能优化"></a><strong>三、高级篇：RTK Query 与性能优化</strong></h2><p>RTK Query (RTKQ) 是 RTK 内置的一个强大的数据获取和缓存工具。它不仅帮你发请求，最核心的是它能<strong>自动管理缓存状态</strong>。</p><blockquote><p>[!NOTE]<br><strong>为什么要用它？</strong><br>在没有 RTKQ 之前，我们需要手动管理：请求加载状态 (<code>isLoading</code>)、错误处理 (<code>error</code>)、<code>useEffect</code> 中的请求触发、以及最头疼的“跨页面同步缓存数据”。RTKQ 把这些都自动完成了。</p></blockquote><h3 id="3-1-基础用法"><a href="#3-1-基础用法" class="headerlink" title="3.1 基础用法"></a><strong><font color='red'>3.1 基础用法</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`步骤一：创建api接口`</span>;</span><br><span class="line"><span class="comment">// src\redux\api\todoApi.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApi, fetchBaseQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit/query/react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> todoApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">  <span class="comment">// 导出供 Store 中间件使用</span></span><br><span class="line">  <span class="attr">reducerPath</span>: <span class="string">&quot;createApi&quot;</span>, <span class="comment">// 在 store 中的 key</span></span><br><span class="line">  <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&quot;/api&quot;</span> &#125;), <span class="comment">//配置基础路径</span></span><br><span class="line">  <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 配置请求的详细信息</span></span><br><span class="line">    <span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">      <span class="comment">//默认构建的是get请求</span></span><br><span class="line">      <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>, <span class="comment">// 实际请求的路径</span></span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(todoApi);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动生成 hooks 供组件使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetTodosQuery &#125; = todoApi;</span><br><span class="line"></span><br><span class="line"><span class="string">`步骤二：配置 Store 中间件`</span>;</span><br><span class="line"><span class="comment">// src\redux\store.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; todoApi &#125; <span class="keyword">from</span> <span class="string">&quot;./api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="comment">// 必须添加 api 的 reducer</span></span><br><span class="line">    [todoApi.<span class="property">reducerPath</span>]: todoApi.<span class="property">reducer</span>,</span><br><span class="line">    [xxxx.<span class="property">reducerPath</span>]: xxxx.<span class="property">reducer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 必须添加 api 的中间件，用于启用缓存、轮询、失效等功能</span></span><br><span class="line">  <span class="attr">middleware</span>: <span class="function">(<span class="params">gDM</span>) =&gt;</span></span><br><span class="line">    <span class="comment">// 多参数写法（推荐，更整洁）</span></span><br><span class="line">    <span class="title function_">gDM</span>().<span class="title function_">concat</span>(todoApi.<span class="property">middleware</span>, xxxx.<span class="property">middleware</span>),</span><br><span class="line">  <span class="comment">// 链式调用写法</span></span><br><span class="line">  <span class="comment">// gDM().concat(todoApi.middleware).concat(xxxx.middleware)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="string">`步骤三：组件中使用 Hooks`</span>;</span><br><span class="line"><span class="comment">// src\pages\Home.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useGetTodosQuery &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, isLoading, error &#125; = <span class="title function_">useGetTodosQuery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isLoading &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;error &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>加载失败<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;data &amp;&amp; data.map((todo) =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.title&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><h3 id="3-2-RTK-Query-核心概念详解"><a href="#3-2-RTK-Query-核心概念详解" class="headerlink" title="3.2 RTK Query 核心概念详解"></a><strong><font color='red'>3.2 RTK Query 核心概念详解</font></strong></h3><h4 id="1）获取数据：Query-查询操作"><a href="#1）获取数据：Query-查询操作" class="headerlink" title="1）获取数据：Query (查询操作)"></a><strong><font color='#10c300'>1）获取数据：Query (查询操作)</font></strong></h4><p>Query 是 RTK Query 中最基础的数据获取方式，主要用于从服务器端拉取状态并缓存在本地。</p><p><strong>特点与用法：</strong></p><ul><li>默认情况下，对应的 <code>useXXXQuery</code> Hook 在组件挂载时会<strong>自动发起请求</strong>。</li><li>它返回一个包含 <code>data</code> (数据), <code>isLoading</code> (初次加载状态), <code>isFetching</code> (每次请求状态), <code>error</code> (错误信息) 等丰富属性的对象。</li><li>绝大多数 Query 是 <code>GET</code> 请求，但有些特殊场景（如复杂的搜索查询需要传递大量参数体）也会使用 <code>POST</code> 请求作为 Query。</li></ul><p><strong>代码示例拆解：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 todoApi.js 中定义</span></span><br><span class="line"><span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="comment">// 基础用法：默认发无参的 GET 请求</span></span><br><span class="line">  <span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 带参 GET 请求 (如：/todos?status=completed)</span></span><br><span class="line">  <span class="attr">getTodosByStatus</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="function">(<span class="params">status</span>) =&gt;</span> <span class="string">`/todos?status=<span class="subst">$&#123;status&#125;</span>`</span>,</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 特殊用法：使用 POST 进行复杂的查询</span></span><br><span class="line">  <span class="comment">// 注意：虽然是发送 POST，但因为是&quot;获取查看&quot;数据而不是&quot;修改&quot;系统状态，所以依然用 builder.query</span></span><br><span class="line"><span class="attr">getTodosById</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/posts&quot;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">body</span>: &#123; <span class="attr">postId</span>: id &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetTodosQuery, useGetTodosByStatusQuery, useGetTodosByIdQuery &#125; = todoApi;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">`组件中使用`</span></span><br><span class="line"><span class="comment">// 1. 无参 GET 用法：组件一挂载就自动发请求拉列表</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: allTodos, isLoading &#125; = <span class="title function_">useGetTodosQuery</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 带参 GET 用法：参数如果变化，RTK Query 会自动发新请求</span></span><br><span class="line"><span class="keyword">const</span> [status, setStatus] = <span class="title function_">useState</span>(<span class="string">&quot;completed&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: filteredTodos &#125; = <span class="title function_">useGetTodosByStatusQuery</span>(status);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. POST 查询用法：将复杂的检索条件(如包含各种过滤项的对象)传递过去</span></span><br><span class="line"><span class="keyword">const</span> searchFilters = &#123; <span class="attr">keyword</span>: <span class="string">&quot;React&quot;</span>, <span class="attr">date</span>: <span class="string">&quot;today&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: searchResults, isFetching &#125; = <span class="title function_">useGetTodosByIdQuery</span>(searchFilters);</span><br></pre></td></tr></table></figure><br><h4 id="2）修改数据：Mutation-变更操作"><a href="#2）修改数据：Mutation-变更操作" class="headerlink" title="2）修改数据：Mutation (变更操作)"></a><strong><font color='#10c300'>2）修改数据：Mutation (变更操作)</font></strong></h4><p>在 RTK Query 中，所有的 API 端点 (endpoints) 分为两类：</p><ul><li><strong>Query (查询)</strong>：用于获取数据，在组件挂载时自动触发（如 GET 请求）。对应的 Hook 叫 <code>useXXXQuery</code>。</li><li><strong>Mutation (变更)</strong>：用于修改服务器数据（如 POST、PUT、DELETE 请求）。对应的 Hook 叫 <code>useXXXMutation</code>。</li></ul><p><strong>特点与用法：</strong></p><ul><li><code>mutation</code> <strong>不会在组件挂载时自动触发</strong>。它会返回一个包含两个元素的数组：<code>[触发函数的引用 (trigger), 包含状态的对象 (result)]</code>。</li><li>它通常绑定到表单提交或按钮点击事件上。</li></ul><p><strong>代码示例拆解：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 todoApi.js 中定义</span></span><br><span class="line"><span class="attr">addTodo</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">  <span class="comment">// query 接收调用触发函数时传入的参数 (newTodo)</span></span><br><span class="line">  <span class="attr">query</span>: <span class="function">(<span class="params">newTodo</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>, <span class="comment">// 明确指定是发送 POST 请求</span></span><br><span class="line">    <span class="attr">body</span>: newTodo, <span class="comment">// 发送给后端的请求体数据</span></span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="attr">addUser</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="function">(<span class="params">user</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/users&quot;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">body</span>: user</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useAddUserMutation &#125; = todoApi;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">`组件中使用`</span></span><br><span class="line"><span class="keyword">import</span> &#123; useAddUserMutation &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [addUser, &#123; <span class="attr">isLoading</span>: addUserLoading, <span class="attr">isSuccess</span>: addUserSuccess, <span class="attr">error</span>: addUserError &#125;] = <span class="title function_">useAddUserMutation</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fn</span> = <span class="keyword">async</span>(<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">addUser</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;fn&#125;</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;addUserLoading &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>添加中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;addUserSuccess &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>添加成功<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;addUserError &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>添加失败<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h4 id="4）手动触发查询：useLazyXXXQuery"><a href="#4）手动触发查询：useLazyXXXQuery" class="headerlink" title="4）手动触发查询：useLazyXXXQuery"></a><strong><font color='#10c300'>4）手动触发查询：useLazyXXXQuery</font></strong></h4><p>默认情况下，<code>useXXXQuery</code> 在组件挂载时就会<strong>立即、自动</strong>发起网络请求。但在某些场景下（例如：点击按钮搜索、展开面板时才加载详情），我们希望<strong>手动</strong>去触发这个 GET 请求。这时候就需要用到懒加载钩子 <code>useLazyXXXQuery</code>。</p><p><strong>特点与用法：</strong></p><ul><li>类似于 Mutation 的 Hook 设计，它返回一个数组 <code>[触发函数(trigger), 查询状态结果(result)]</code>。</li><li>不会在组件挂载时自动发送请求。</li><li>当你需要发送请求时，调用触发函数，并可以传递查询参数。</li></ul><p><strong>代码示例拆解：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意导出名字的变化：从 todoApi 自动生成的 hooks 会有一个 `useLazy` 开头的版本</span></span><br><span class="line"><span class="keyword">import</span> &#123; useLazyGetTodosQuery &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 返回数组：第一个是手动发请求的函数，第二个是包含请求结果和状态的对象</span></span><br><span class="line">  <span class="keyword">const</span> [triggerGetTodos, &#123; data, isLoading, isFetching &#125;] = <span class="title function_">useLazyGetTodosQuery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleSearch</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 点击按钮时，才手动触发网络请求</span></span><br><span class="line">    <span class="title function_">triggerGetTodos</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleSearch&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;isLoading || isFetching ? &quot;加载中...&quot; : &quot;点击加载列表&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;data &amp;&amp; data.map((todo) =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.title&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h4 id="4）数据转换：transformResponse"><a href="#4）数据转换：transformResponse" class="headerlink" title="4）数据转换：transformResponse"></a><strong><font color='#10c300'>4）数据转换：transformResponse</font></strong></h4><p>有时后端返回的数据格式并不符合前端的使用要求（比如外面包裹了一层特定的结构，或者缺少某个字段）。<code>transformResponse</code> 允许你在数据被存入 Redux 缓存之前，提前“拦截”并转换它。</p><p><strong>为什么要用？</strong><br>将处理后端“奇葩”数据结构的操作集中在 API 切片里，保持前端组件的数据逻辑纯粹。这样能避免你在每个组件 <code>useSelector</code> 获取数据时都要反复去写 <code>.map()</code> 或解构特定字段。</p><p><strong>代码示例拆解：</strong></p><p>假设后端返回的列表数据长这样：<br><code>&#123; code: 200, message: &quot;成功&quot;, data: &#123; list: [ &#123;id:1, title:&quot;写代码&quot;&#125; ] &#125; &#125;</code></p><p>而我们只想在页面中直接使用 <code>list</code> 数组。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">  <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">  <span class="comment">// 转换响应结果（就像 axios 的响应拦截器）</span></span><br><span class="line">  <span class="attr">transformResponse</span>: <span class="function">(<span class="params">response, meta, arg</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// response 就是后端直接抛回来的原始 JSON 对象</span></span><br><span class="line">    <span class="comment">// 我们只把最核心的 data.list return 出去</span></span><br><span class="line">    <span class="comment">// 这样组件里通过 useGetTodosQuery() 解构出来的 data 就是这个干净的数组！</span></span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><h4 id="5）缓存操作：providesTags-与-invalidatesTags"><a href="#5）缓存操作：providesTags-与-invalidatesTags" class="headerlink" title="5）缓存操作：providesTags 与 invalidatesTags"></a><strong><font color='#10c300'>5）缓存操作：providesTags 与 invalidatesTags</font></strong></h4><p>这是 RTK Query 避免手动写 <code>dispatch</code> 来刷新数据的核心“黑科技”：基于标签 (Tags) 的自动化缓存失效系统。</p><p>把它想象成一个**“贴标签与撕标签”**的游戏：</p><ul><li><strong><code>providesTags</code></strong>：用来**“贴标签”**。告诉 RTKQ，当前通过查询获得回来的这份数据，叫什么名字。</li><li><strong><code>invalidatesTags</code></strong>：用来**“撕标签”** (宣告失效)。当执行增删改等 mutating 操作后，告诉 RTKQ 哪些标签的数据已经过时了，必须重新拉取。</li></ul><p><strong>案例生动解析：</strong></p><p><strong>第一步：查询列表时贴标签</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">  <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">  <span class="comment">// 给这个列表数据贴上一个叫 &quot;Todos&quot; 的特定标签（且指定 id 为 &#x27;LIST&#x27; 代表整个列表）</span></span><br><span class="line">  <span class="attr">providesTags</span>: [&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>此时，RTKQ 内部的记事本上写着：<em>“用 <code>getTodos</code> 获取的数据，被贴上了 <code>Todos-LIST</code> 的标签。如果以后谁撕毁了这个标签，我就得再发一次 <code>GET /todos</code> 重新拿数据。”</em></p><p><strong>第二步：添加数据时撕标签</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">addTodo</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">  <span class="attr">query</span>: <span class="function">(<span class="params">newTodo</span>) =&gt;</span> (&#123; ... &#125;),</span><br><span class="line">  <span class="comment">// 添加成功后，撕毁 &#x27;Todos&#x27; 的 &#x27;LIST&#x27; 标签</span></span><br><span class="line">  <span class="attr">invalidatesTags</span>: [&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>当你调用 <code>addTodo</code> 并在服务端创建成功后，RTKQ 看到你要“撕毁” <code>Todos-LIST</code> 标签。它会去找记事本，发现 <code>getTodos</code> 绑定了这个标签数据，于是它会<strong>自动且静默地</strong>在此刻触发一次 <code>getTodos</code>，实现了前端列表的无缝自动刷新。</p><blockquote><p>如果要做到更细节粒度的缓存控制（比如只修改列表中某一项的数据，不全列表拉取），可以通过给每个具体的 item 贴带 <code>id</code> 的标签（如 <code>&#123; type: &quot;Todos&quot;, id: todo.id &#125;</code>）来实现。这也是为什么我们在前文基础代码里要写 <code>...result.map((&#123; id &#125;) =&gt; (&#123; type: &quot;Todos&quot;, id &#125;))</code> 这样复杂的结构，这正是为了极致的单条数据按需更新。</p></blockquote><br><h3 id="3-3-实战：构建一个-Todo-CRUD-API"><a href="#3-3-实战：构建一个-Todo-CRUD-API" class="headerlink" title="3.3 实战：构建一个 Todo CRUD API"></a><strong><font color='red'>3.3 实战：构建一个 Todo CRUD API</font></strong></h3><p>我们将创建一个完整的待办事项管理 API 接口。</p><p><code>src/redux/api/todoApi.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApi, fetchBaseQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit/query/react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> todoApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">  <span class="attr">reducerPath</span>: <span class="string">&quot;todoApi&quot;</span>, <span class="comment">// 在 store 中的 key</span></span><br><span class="line">  <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&quot;http://localhost:3000&quot;</span> &#125;), <span class="comment">// 基础 URL</span></span><br><span class="line">  <span class="comment">// 🏷️ 定义标签：用于标记哪些数据是相关的，方便后面自动刷新</span></span><br><span class="line">  <span class="attr">tagTypes</span>: [<span class="string">&quot;Todos&quot;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 1. 查询列表 (query)</span></span><br><span class="line">    <span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">      <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">      <span class="comment">// 将返回的列表标记为 &#x27;Todos&#x27; 标签，且 ID 为 &#x27;LIST&#x27;</span></span><br><span class="line">      <span class="attr">providesTags</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> <span class="comment">// 获取接口返回的</span></span><br><span class="line">        result ? [...result.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; id &#125;</span>) =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, id &#125;)),&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;]: [&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;]</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 添加数据 (mutation)</span></span><br><span class="line">    <span class="attr">addTodo</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">      <span class="attr">query</span>: <span class="function">(<span class="params">newTodo</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">body</span>: newTodo,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 关键：添加后使 &#x27;LIST&#x27; 标签失效，触发列表自动重新请求</span></span><br><span class="line">      <span class="attr">invalidatesTags</span>: [&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;],</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 删除数据 (mutation)</span></span><br><span class="line">    <span class="attr">deleteTodo</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">      <span class="attr">query</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/todos/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;DELETE&quot;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 删除后，让该特定 ID 的数据和列表都失效</span></span><br><span class="line">      <span class="attr">invalidatesTags</span>: <span class="function">(<span class="params">result, error, id</span>) =&gt;</span> [</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, id &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动生成的 Hooks (格式：use + 端点名 + Query/Mutation)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetTodosQuery, useAddTodoMutation, useDeleteTodoMutation &#125; =</span><br><span class="line">  todoApi;</span><br></pre></td></tr></table></figure><h4 id="2）配置-Store-中间件"><a href="#2）配置-Store-中间件" class="headerlink" title="2）配置 Store 中间件"></a><strong><font color='#10c300'>2）配置 Store 中间件</font></strong></h4><p>RTKQ 需要专门的 Reducer 和中间件来处理缓存管理。</p><p><code>src/redux/store.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; todoApi &#125; <span class="keyword">from</span> <span class="string">&quot;./api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="comment">// 必须添加 api 的 reducer</span></span><br><span class="line">    [todoApi.<span class="property">reducerPath</span>]: todoApi.<span class="property">reducer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 必须添加 api 的中间件，用于启用缓存、轮询、失效等功能</span></span><br><span class="line">  <span class="attr">middleware</span>: <span class="function">(<span class="params">getDefaultMiddleware</span>) =&gt;</span></span><br><span class="line">    <span class="title function_">getDefaultMiddleware</span>().<span class="title function_">concat</span>(todoApi.<span class="property">middleware</span>),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="3）在组件中使用-Hooks"><a href="#3）在组件中使用-Hooks" class="headerlink" title="3）在组件中使用 Hooks"></a><strong><font color='#10c300'>3）在组件中使用 Hooks</font></strong></h4><p>RTKQ 返回的 Hook 包含了所有你需要的状态，无需额外定义 <code>useState</code>。</p><p><code>src/pages/TodoPage.jsx</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  useGetTodosQuery,</span><br><span class="line">  useAddTodoMutation,</span><br><span class="line">  useDeleteTodoMutation,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../redux/api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodoPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 获取数据：自动触发请求，且带有丰富的状态</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: todos, error, isLoading, isFetching &#125; = <span class="title function_">useGetTodosQuery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 变更操作：返回一个触发函数 (trigger) 和操作状态 (rest)</span></span><br><span class="line">  <span class="keyword">const</span> [addTodo, &#123; <span class="attr">isLoading</span>: isAdding &#125;] = <span class="title function_">useAddTodoMutation</span>();</span><br><span class="line">  <span class="keyword">const</span> [deleteTodo] = <span class="title function_">useDeleteTodoMutation</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isLoading) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>初次加载中...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>请求出错: &#123;error.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>待办事项 &#123;isFetching &amp;&amp; &quot; (同步中...)&quot;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">disabled</span>=<span class="string">&#123;isAdding&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> addTodo(&#123; title: &quot;新任务&quot;, completed: false &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        &#123;isAdding ? &quot;添加中...&quot; : &quot;添加任务&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;todos.map((todo) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;todo.title&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> deleteTodo(todo.id)&#125;&gt;删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4）核心机制详解：Tags-标签-系统"><a href="#4）核心机制详解：Tags-标签-系统" class="headerlink" title="4）核心机制详解：Tags (标签) 系统"></a><strong><font color='#10c300'>4）核心机制详解：Tags (标签) 系统</font></strong></h4><p>这是 RTK Query 的灵魂。它通过“发布-订阅”模式管理缓存：</p><ol><li><strong><code>providesTags</code> (发布)</strong>：告诉 RTKQ 这份数据贴了什么标签（比如 <code>Todos</code>）。</li><li><strong><code>invalidatesTags</code> (撤销)</strong>：当执行修改操作后，高速 RTKQ 哪些标签过期了。</li><li><strong>自动重刷新</strong>：RTKQ 发现当前页面正在使用的 <code>getTodos</code> 订阅了 <code>Todos</code> 标签，而该标签由于 <code>addTodo</code> 变成了“失效”状态，于是 RTKQ 会<strong>自动</strong>重新发起网络请求，同步最新的列表。</li></ol><blockquote><p>[!TIP]<br><strong>缓存自动清理</strong><br>如果没有任何组件订阅某个 API 端点的数据（即没在任何地方调用该 Hook），RTKQ 会在一段时间后（默认 60 秒）自动从内存中删除这些垃圾数据。</p></blockquote><br><h3 id="3-4-性能优化：Memoization"><a href="#3-4-性能优化：Memoization" class="headerlink" title="3.4 性能优化：Memoization"></a><strong><font color='red'>3.4 性能优化：Memoization</font></strong></h3><p>每当 Redux Store 更新时，所有使用 <code>useSelector</code> 的组件都会重新计算其 Selector。</p><ul><li><strong>避免引用陷阱</strong>：如果在 Selector 中返回了新数组或对象（如 <code>state.items.filter(...)</code>），必须使用记忆化工具。</li><li><strong>推荐方案</strong>：使用 <strong><code>createSelector</code></strong>。它不仅能缓存昂贵的计算结果，还能通过保持引用一致性来防止子组件的不必要重渲染。</li></ul><blockquote><p>[!TIP]<br>详细的 <code>createSelector</code> 配置与代码片段请参考前文：<a href="#24-%E8%AE%B0%E5%BF%86%E5%8C%96%E9%80%89%E6%8B%A9%E5%99%A8createselector">2.4 记忆化选择器：createSelector</a>。</p></blockquote><br><h3 id="3-5-目录结构最佳实践"><a href="#3-5-目录结构最佳实践" class="headerlink" title="3.5 目录结构最佳实践"></a><strong><font color='red'>3.5 目录结构最佳实践</font></strong></h3><p>推荐基于<strong>功能 (Feature-based)</strong> 的文件夹结构，而不是按文件类型（actions&#x2F;reducers）分类。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">├── 📁 src/</span><br><span class="line">│   ├── 📁 app/                # 全局配置 (Store, 路由配置)</span><br><span class="line">│   │   └── store.js</span><br><span class="line">│   ├── 📁 assets/             # 静态资源 (图片, 字体, 全局样式)</span><br><span class="line">│   ├── 📁 components/         # 通用基础组件 (非业务 logic)</span><br><span class="line">│   ├── 📁 features/           # 业务功能模块 (Slice + 业务组件 + API)</span><br><span class="line">│   │   └── 📁 counter/        # 示例功能</span><br><span class="line">│   │       ├── counterSlice.js</span><br><span class="line">│   │       └── Counter.jsx</span><br><span class="line">│   ├── 📁 hooks/              # 通用 Hooks (useAuth, useTheme 等)</span><br><span class="line">│   ├── 📁 pages/              # 页面级组件 (路由入口)</span><br><span class="line">│   ├── 📁 utils/              # 工具函数 (formatDate, validators 等)</span><br><span class="line">│   ├── App.jsx                # 根组件</span><br><span class="line">│   └── index.js               # 入口文件</span><br></pre></td></tr></table></figure><p><strong>核心说明</strong>：</p><ul><li><strong>Feature-first</strong>: <code>features/</code> 目录是核心。将一个功能的所有相关代码（Slice, 组件, API）放在同一个文件夹下，保持高内聚。</li><li><strong>Layered Structure</strong>: <code>components/</code> 存放纯 UI 组件，<code>pages/</code> 存放页面容器，<code>features/</code> 存放业务逻辑，层次分明。</li></ul><br><h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><ol><li><strong>始终使用 Redux Toolkit</strong>：不要再手写传统的 Redux 样板代码。</li><li><strong>State 范式化</strong>：尽量保持 State 扁平化，避免深层嵌套。</li><li><strong>不要把所有数据都放进 Redux</strong>：<ul><li>Form state -&gt; Local state (<code>useState</code>)</li><li>Server cache -&gt; RTK Query</li><li>Global UI state &#x2F; Shared data -&gt; Redux Slice</li></ul></li><li><strong>TypeScript</strong>：RTK 对 TypeScript 支持极佳，利用它可以获得强大的类型提示。</li></ol><hr><p><em>Happy Coding with React &amp; Redux!</em></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;React-Redux-全面指南-Redux-Toolkit&quot;&gt;&lt;a href=&quot;#React-Redux-全面指南-Redux-Toolkit&quot; class=&quot;headerlink&quot; title=&quot;React Redux 全面指南 (Redux Toolkit)</summary>
      
    
    
    
    <category term="前端开发" scheme="http://example.com/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="React" scheme="http://example.com/tags/React/"/>
    
    <category term="Redux" scheme="http://example.com/tags/Redux/"/>
    
    <category term="RTK" scheme="http://example.com/tags/RTK/"/>
    
  </entry>
  
  <entry>
    <title>React Router 全面指南 (v6.4+ &amp; v7)</title>
    <link href="http://example.com/posts/e2d3b4a5wq.html"/>
    <id>http://example.com/posts/e2d3b4a5wq.html</id>
    <published>2026-02-11T11:00:00.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React-Router-全面指南-v6-4-v7"><a href="#React-Router-全面指南-v6-4-v7" class="headerlink" title="React Router 全面指南 (v6.4+ &amp; v7)"></a>React Router 全面指南 (v6.4+ &amp; v7)</h1><blockquote><p>📚 本指南旨在帮助开发者掌握 React Router 的最新特性 (v6.4+ Data APIs) 及企业级封装写法。</p></blockquote><hr><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol><li><a href="#%E4%B8%80%E5%BC%95%E8%A8%80">引言</a></li><li><a href="#%E4%BA%8C%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-data-router">快速上手 (Data Router)</a></li><li><a href="#%E4%B8%89%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E5%9F%BA%E7%A1%80-routing">路由核心基础 (Routing)</a></li><li><a href="#%E5%9B%9Bdata-api-%E8%BF%9B%E9%98%B6">Data API (进阶)</a></li><li><a href="#%E4%BA%94%E5%B0%81%E8%A3%85%E5%BC%8F%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE-best-practice">封装式路由配置</a></li><li><a href="#%E5%85%AD%E8%BF%9B%E9%98%B6%E4%B8%8E%E4%BC%98%E5%8C%96">进阶与优化</a></li><li><a href="#%E4%B8%83%E5%B8%B8%E8%A7%81%E8%AF%AF%E5%8C%BA-common-pitfalls">常见误区 (Common Pitfalls)</a></li><li><a href="#%E5%85%AB%E6%80%BB%E7%BB%93">总结</a></li></ol><br><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a><strong>一、引言</strong></h2><h3 id="1-1-为什么需要路由？-SPA-vs-MPA"><a href="#1-1-为什么需要路由？-SPA-vs-MPA" class="headerlink" title="1.1 为什么需要路由？ (SPA vs MPA)"></a><strong><font color='red'>1.1 为什么需要路由？ (SPA vs MPA)</font></strong></h3><p>在传统的多页应用 (MPA) 中，每次点击链接，浏览器都会向服务器请求一个新的 HTML 页面，导致页面刷新（白屏闪烁）。</p><p><strong>React Router</strong> 帮助我们构建 <strong>单页应用 (SPA)</strong>：</p><ol><li><strong>无刷新跳转</strong>：点击链接时，只通过 JavaScript 更新页面内容，无需重新加载整个页面。</li><li><strong>体验如原生应用</strong>：丝滑的页面切换效果。</li><li><strong>URL 与 UI 同步</strong>：通过 URL (<code>/about</code>) 直接定位到特定组件 (<code>&lt;About /&gt;</code>)。</li></ol><br><h3 id="1-2-React-Router-v6-4-Data-APIs"><a href="#1-2-React-Router-v6-4-Data-APIs" class="headerlink" title="1.2 React Router v6.4+ (Data APIs)"></a><strong><font color='red'>1.2 React Router v6.4+ (Data APIs)</font></strong></h3><p>这是 React Router 的一次革命性更新，引入了 <strong>Data APIs</strong>。这不仅是定义路由的新方式，更解决了 React 应用中常见的“加载瀑布流”问题。</p><p><strong>核心优势：</strong></p><ul><li><strong>并行加载</strong>：路由与数据获取并行进行，极大提升首屏速度。</li><li><strong>配置化路由</strong>：使用对象数组 (<code>createBrowserRouter</code>) 管理路由，比 JSX 写法更清晰、更易维护。</li><li><strong>自动状态管理</strong>：内置 <code>loading</code>、<code>error</code> 状态处理，减少大量样板代码。</li></ul><br><h3 id="1-3-React-Router-v7-三种使用模式"><a href="#1-3-React-Router-v7-三种使用模式" class="headerlink" title="1.3 React Router v7+三种使用模式"></a><strong><font color='red'>1.3 React Router v7+三种使用模式</font></strong></h3><p>React Router 的这三种模式反映了它从一个简单的组件库演变为功能完备的数据框架的历程。</p><h3 id="1-三种模式的区别"><a href="#1-三种模式的区别" class="headerlink" title="1. 三种模式的区别"></a>1. 三种模式的区别</h3><table><thead><tr><th align="left">模式</th><th align="left">核心理念</th><th align="left">使用场景</th></tr></thead><tbody><tr><td align="left"><strong>Declarative (声明式)</strong></td><td align="left">传统的组件化路由，使用 <code>&lt;Routes&gt;</code> 和 <code>&lt;Route&gt;</code> 直接写在 JSX 中。</td><td align="left">简单的 CSR 应用，不需要路由驱动的数据预加载。</td></tr><tr><td align="left"><strong>Data (数据驱动)</strong></td><td align="left"><strong>React Router v6.4+ 推荐方式</strong>。使用 <code>createBrowserRouter</code> 定义路由对象。支持 <code>loader</code>（预加载数据）、<code>action</code>（数据修改）和 <code>errorElement</code>。</td><td align="left">中大型应用，希望通过路由并行加载数据、处理表单提交和错误边界。</td></tr><tr><td align="left"><strong>Framework (框架模式)</strong></td><td align="left"><strong>React Router v7 (原 Remix)</strong>。将 React Router 作为全栈框架使用，处理 SSR（服务端渲染）、静态生成等。</td><td align="left">需要 SSR、SEO 优化或复杂全栈逻辑的项目。</td></tr></tbody></table><hr><br><h2 id="二、快速上手-Data-Router"><a href="#二、快速上手-Data-Router" class="headerlink" title="二、快速上手 (Data Router)"></a><strong>二、快速上手 (Data Router)</strong></h2><h3 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1 安装"></a><strong><font color='red'>2.1 安装</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装最新版 React Router DOM (包含了核心 React Router)</span></span><br><span class="line">npm install react-router-dom</span><br></pre></td></tr></table></figure><blockquote><p><strong>提示</strong>：安装完成后，检查 <code>package.json</code> 中的 <code>dependencies</code>，确认版本号 <code>&gt;= 6.4</code>。</p></blockquote><br><h3 id="2-2-基本使用"><a href="#2-2-基本使用" class="headerlink" title="2.2 基本使用"></a><strong><font color='red'>2.2 基本使用</font></strong></h3><p>与传统的组件式 (<code>&lt;BrowserRouter&gt;</code>) 不同，新版推荐使用对象配置。</p><p><strong><code>src\router\index.js</code></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建路由器实例 (Router Instance)</span></span><br><span class="line"><span class="comment">// 这里定义了 URL 路径与 React 组件的映射关系</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="comment">// 访问根路径 http://localhost:5173/ 时</span></span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="comment">// 渲染这个 JSX</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/about&quot;</span>, <span class="comment">// 访问 http://localhost:5173/about 时</span></span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>About<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="comment">// 渲染 About 组件</span></span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure><p><strong><code>src\App.jsx</code></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">&#123;<span class="comment">/* RouterProvider 组件用于包裹整个应用或路由部分，能直接生成路由界面 */</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><br><h2 id="三、路由核心基础-Routing"><a href="#三、路由核心基础-Routing" class="headerlink" title="三、路由核心基础 (Routing)"></a><strong>三、路由核心基础 (Routing)</strong></h2><h3 id="3-1-数据加载-Loader"><a href="#3-1-数据加载-Loader" class="headerlink" title="3.1 数据加载 (Loader)"></a><strong><font color='red'>3.1 数据加载 (Loader)</font></strong></h3><blockquote><p><strong>注意</strong>: 这里展示的是基础概念，更深入的 Data API 用法请参考 <a href="#%E5%9B%9B-data-api-%E8%BF%9B%E9%98%B6">第四章 Data API</a>。</p></blockquote><p>这是 Data APIs 的基础功能。它允许路由在渲染组件<strong>之前</strong>并行加载数据，彻底解决了 React 应用中常见的“瀑布流加载”问题。</p><p><strong><font color='#00A6ED'>为什么使用 loader 而不是 verifyEffect？</font></strong></p><ul><li><strong>传统方式 (useEffect)</strong>: <code>加载组件 JS</code> -&gt; <code>渲染组件(Loading)</code> -&gt; <code>发起 Fetch</code> -&gt; <code>等待数据</code> -&gt; <code>渲染真实内容</code>。</li><li><strong>Loader 方式</strong>: <code>点击链接</code> -&gt; <code>并行加载组件 JS 和数据</code> -&gt; <code>渲染真实内容</code>。</li></ul><p><strong>代码实现：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 定义数据加载函数 (Loader)</span></span><br><span class="line"><span class="comment">// 该函数会在路由跳转时自动执行，支持异步操作</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">homeLoader</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;/api/user&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!res.<span class="property">ok</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Failed to load&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">json</span>(); <span class="comment">// 返回的数据可以在组件中通过 useLoaderData 获取</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 在路由配置中绑定</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>,</span><br><span class="line">    <span class="attr">loader</span>: homeLoader, <span class="comment">// &lt;--- 绑定 loader</span></span><br><span class="line">    <span class="attr">errorElement</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorPage</span> /&gt;</span></span>, <span class="comment">// 自动捕获 loader 抛出的错误</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/user/:id&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">User</span> /&gt;</span></span>,</span><br><span class="line">    <span class="comment">// loader 函数接收一个 params 对象</span></span><br><span class="line">    <span class="attr">loader</span>: <span class="title function_">async</span> (&#123; params &#125;) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="title function_">fetch</span>(<span class="string">`/api/user/<span class="subst">$&#123;params.id&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span> response.<span class="title function_">json</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/detail/:id&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Detail</span> /&gt;</span></span>,</span><br><span class="line">    <span class="attr">loader</span>: <span class="title function_">async</span> (&#123; params &#125;) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="title function_">fetch</span>(<span class="string">`/api/user/<span class="subst">$&#123;params.id&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">const</span> res = response.<span class="title function_">json</span>()</span><br><span class="line">      <span class="keyword">if</span>(!res.<span class="property">token</span>) &#123; <span class="comment">// 重定向</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> res</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p><strong>在组件中获取数据：</strong></p><p>组件内部无需处理 <code>loading</code> 状态，因为 loader 执行完才会渲染组件（除非使用了 <code>defer</code>）。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useLoaderData &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">useLoaderData</span>(); <span class="comment">//直接获取 loader 返回的数据</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome, &#123;user.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="3-2-路由跳转-Navigation"><a href="#3-2-路由跳转-Navigation" class="headerlink" title="3.2 路由跳转 (Navigation)"></a><strong><font color='red'>3.2 路由跳转 (Navigation)</font></strong></h3><p>React Router 提供了两种主要的跳转方式：声明式和编程式。</p><h4 id="1）声明式跳转"><a href="#1）声明式跳转" class="headerlink" title="1）声明式跳转"></a><strong><font color='#10c300'>1）声明式跳转</font></strong></h4><p>用于构建用户界面中的导航链接，类似于 HTML 的 <code>&lt;a&gt;</code> 标签，但不会刷新页面。</p><ul><li><strong><code>&lt;Link&gt;</code></strong>: 基础链接组件。</li><li><strong><code>&lt;NavLink&gt;</code></strong>: 特殊的 Link，自动感知是否处于激活状态（常用于菜单）。</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span>, <span class="title class_">NavLink</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Menu</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 基础跳转 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>关于我们<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* 带有激活样式的跳转 (Active Style) */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">NavLink</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&#123;(&#123;</span> <span class="attr">isActive</span> &#125;) =&gt;</span> (isActive ? &quot;active&quot; : &quot;&quot;)&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        首页</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* replace: 替换当前历史记录，不留痕迹 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">replace</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        登录 (Replace)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2）编程式跳转"><a href="#2）编程式跳转" class="headerlink" title="2）编程式跳转"></a><strong><font color='#10c300'>2）编程式跳转</font></strong></h4><p><code>useNavigate</code>在事件处理函数 (Event Handler) 或副作用 (Effect) 中执行跳转。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useNavigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LoginPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> navigate = <span class="title function_">useNavigate</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleLogin</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 基础跳转</span></span><br><span class="line">    <span class="title function_">navigate</span>(<span class="string">&quot;/dashboard&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 替换模式 (Replace)</span></span><br><span class="line">    <span class="title function_">navigate</span>(<span class="string">&quot;/home&quot;</span>, &#123; <span class="attr">replace</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后退/前进</span></span><br><span class="line">    <span class="title function_">navigate</span>(-<span class="number">1</span>); <span class="comment">// 后退一步</span></span><br><span class="line">    <span class="title function_">navigate</span>(<span class="number">1</span>); <span class="comment">// 前进一步</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleLogin&#125;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="3-3-参数传递-Params"><a href="#3-3-参数传递-Params" class="headerlink" title="3.3 参数传递 (Params)"></a><strong><font color='red'>3.3 参数传递 (Params)</font></strong></h3><p>这是开发中最常见的需求，React Router 支持三种主要的传参方式。</p><h4 id="1）路径参数-Path-Params"><a href="#1）路径参数-Path-Params" class="headerlink" title="1）路径参数 (Path Params)"></a><strong><font color='#10c300'>1）路径参数 (Path Params)</font></strong></h4><p>参数直接拼接在 URL 中，如 <code>/user/123</code>。</p><ul><li><strong>优点</strong>：刷新页面参数不丢失，语义清晰。</li><li><strong>定义</strong>：需要在路由配置中定义占位符 <code>:id</code>。</li></ul><p><strong>1️⃣路由定义：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/index.jsx</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;/user/:id&quot;</span>, <span class="comment">// :id 是参数占位符</span></span><br><span class="line">  <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">UserPage</span> /&gt;</span></span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2️⃣跳转传参：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> to=<span class="string">&quot;/user/123&quot;</span>&gt;查看用户 <span class="number">123</span>&lt;/<span class="title class_">Link</span>&gt;;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="title function_">navigate</span>(<span class="string">&quot;/user/123&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>3️⃣获取参数：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useParams &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = <span class="title function_">useParams</span>(); <span class="comment">// 获取到的 id 为 string 类型 &quot;123&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>User ID: &#123;id&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2）查询参数-Query-Params"><a href="#2）查询参数-Query-Params" class="headerlink" title="2）查询参数 (Query Params)"></a><strong><font color='#10c300'>2）查询参数 (Query Params)</font></strong></h4><p>参数以 key&#x3D;value 形式拼接在 ? 后，如 <code>/list?page=1&amp;sort=desc</code>。</p><ul><li><strong>优点</strong>：无需修改路由定义，灵活多变。</li></ul><p><strong>1️⃣跳转传参：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> to=<span class="string">&quot;/list?page=1&amp;sort=desc&quot;</span>&gt;商品列表&lt;/<span class="title class_">Link</span>&gt;;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="title function_">navigate</span>(<span class="string">&quot;/list?page=1&amp;sort=desc&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>2️⃣获取参数：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSearchParams &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ListPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [searchParams, setSearchParams] = <span class="title function_">useSearchParams</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取</span></span><br><span class="line">  <span class="keyword">const</span> page = searchParams.<span class="title function_">get</span>(<span class="string">&quot;page&quot;</span>); <span class="comment">// &quot;1&quot;</span></span><br><span class="line">  <span class="keyword">const</span> sort = searchParams.<span class="title function_">get</span>(<span class="string">&quot;sort&quot;</span>); <span class="comment">// &quot;desc&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改 (这会更新 URL 并重新渲染组件)</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">changeSort</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setSearchParams</span>(&#123; <span class="attr">page</span>: <span class="number">1</span>, <span class="attr">sort</span>: <span class="string">&quot;asc&quot;</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Page: &#123;page&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3）隐式状态-State"><a href="#3）隐式状态-State" class="headerlink" title="3）隐式状态 (State)"></a><strong><font color='#10c300'>3）隐式状态 (State)</font></strong></h4><p>参数不显示在 URL 中，存储在 history state 对象里。</p><ul><li><strong>优点</strong>：可传递对象、数组等复杂数据，URL 干净。</li><li><strong>缺点</strong>：<strong>刷新页面不丢失</strong>（很多误区认为会丢失，实际上 History State 刷新后依然存在），但<strong>复制链接给别人会丢失数据</strong>。</li></ul><p><strong>1️⃣跳转传参：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> to=<span class="string">&quot;/profile&quot;</span> state=&#123;&#123; <span class="attr">role</span>: <span class="string">&quot;admin&quot;</span>, <span class="attr">code</span>: <span class="number">9527</span> &#125;&#125;&gt;</span><br><span class="line">  个人中心</span><br><span class="line">&lt;/<span class="title class_">Link</span>&gt;;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="title function_">navigate</span>(<span class="string">&quot;/profile&quot;</span>, &#123; <span class="attr">state</span>: &#123; <span class="attr">role</span>: <span class="string">&quot;admin&quot;</span>, <span class="attr">code</span>: <span class="number">9527</span> &#125; &#125;);</span><br></pre></td></tr></table></figure><p><strong>2️⃣获取参数：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useLocation &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ProfilePage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> location = <span class="title function_">useLocation</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; role, code &#125; = location.<span class="property">state</span> || &#123;&#125;; <span class="comment">// 记得处理空值，防止直接访问报错</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Role: &#123;role&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="3-4-嵌套路由与-Outlet"><a href="#3-4-嵌套路由与-Outlet" class="headerlink" title="3.4 嵌套路由与 Outlet"></a><strong><font color='red'>3.4 嵌套路由与 Outlet</font></strong></h3><p>嵌套路由是 React Router 最核心、最强大的功能。它让我们能够将 UI 的嵌套结构与 URL 的路径结构完美对应。</p><h4 id="1）什么是嵌套路由？"><a href="#1）什么是嵌套路由？" class="headerlink" title="1）什么是嵌套路由？"></a><strong><font color='#10c300'>1）什么是嵌套路由？</font></strong></h4><p>在大多数应用中，界面通常是由多层嵌套的组件组成的。例如：</p><ul><li><strong>URL</strong>: <code>/dashboard/settings</code></li><li><strong>UI</strong>: 页面整体 -&gt; 侧边栏布局 (<code>Parent</code>) -&gt; 设置面板 (<code>Child</code>)</li></ul><p>React Router 通过 <strong>嵌套路由</strong> 自动帮我们将这种 URL 映射为组件层级：<br><code>/dashboard</code> -&gt; 渲染 <code>&lt;DashboardLayout /&gt;</code><br><code>/dashboard/settings</code> -&gt; 在 <code>&lt;DashboardLayout&gt;</code> 内部渲染 <code>&lt;Settings /&gt;</code></p><h4 id="2）嵌套配置"><a href="#2）嵌套配置" class="headerlink" title="2）嵌套配置"></a><strong><font color='#10c300'>2）嵌套配置</font></strong></h4><p>我们在路由配置中使用 <code>children</code> 数组来定义子路由。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/router/index.jsx</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/dashboard&quot;</span>, <span class="comment">// 1. 父路由路径</span></span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">DashboardLayout</span> /&gt;</span></span>, <span class="comment">// 2. 父组件（通常是布局文件）</span></span><br><span class="line">    <span class="comment">// 3. 定义子路由数组</span></span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="literal">true</span>, <span class="comment">// 默认子路由 (访问 /dashboard 时显示，默认子路由里面不能再嵌套子路由)</span></span><br><span class="line">        <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Stats</span> /&gt;</span></span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;settings&quot;</span>, <span class="comment">// 子路由路径 (注意：不要加 / )</span></span><br><span class="line">        <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Settings</span> /&gt;</span></span>, <span class="comment">// 访问 /dashboard/settings 时显示</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h4 id="3）父组件如何渲染子路由？"><a href="#3）父组件如何渲染子路由？" class="headerlink" title="3）父组件如何渲染子路由？"></a><strong><font color='#10c300'>3）父组件如何渲染子路由？</font></strong></h4><p>光配置了路由还不够，<strong>父组件必须明确指定“子组件显示在哪里”</strong>。如果不写 <code>&lt;Outlet /&gt;</code>，子路由的内容将不会渲染。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/layouts/DashboardLayout.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Outlet</span>, <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">DashboardLayout</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;layout&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 侧边栏导航 (始终显示) */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span>&gt;</span>概览<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard/settings&quot;</span>&gt;</span>设置<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">main</span> <span class="attr">className</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* 🔥 关键点：子路由匹配到的组件 (Stats 或 Settings) 将会填入这个位置 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4）总结：路由匹配流程"><a href="#4）总结：路由匹配流程" class="headerlink" title="4）总结：路由匹配流程"></a><strong><font color='#10c300'>4）总结：路由匹配流程</font></strong></h4><p>当用户访问 <code>/dashboard/settings</code> 时：</p><ol><li>React Router 匹配到 <code>/dashboard</code> -&gt; 渲染 <code>&lt;DashboardLayout&gt;</code>。</li><li>React Router 继续匹配 <code>settings</code> -&gt; 找到 <code>&lt;Settings&gt;</code> 组件。</li><li>它将 <code>&lt;Settings&gt;</code> 组件作为 children 传递给 <code>&lt;Outlet /&gt;</code>，最终页面结构如下：</li></ol><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">DashboardLayout</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">nav</span>&gt;</span>...<span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Settings</span> /&gt;</span> &#123;/* &lt;-- 这里就是 Outlet 渲染的内容 */&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">DashboardLayout</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br><h3 id="3-5-路由懒加载"><a href="#3-5-路由懒加载" class="headerlink" title="3.5 路由懒加载"></a><strong><font color='red'>3.5 路由懒加载</font></strong></h3><p>随着应用规模的增长，打包后的 JavaScript 文件（Chunk）会变得越来越大，导致首屏加载缓慢。 <strong>路由懒加载</strong> 是优化 React 应用性能的关键手段。</p><h4 id="1）为什么要懒加载？"><a href="#1）为什么要懒加载？" class="headerlink" title="1）为什么要懒加载？"></a><strong><font color='#10c300'>1）为什么要懒加载？</font></strong></h4><ul><li><strong>默认行为</strong>：构建工具（如 Viper&#x2F;Webpack）会将所有页面组件打包进一个巨大的 JS 文件中。即使有些页面用户可能永远不会访问，浏览器也必须先下载这些代码。</li><li><strong>懒加载行为</strong>：将代码分割成多个小块（Chunks）。<strong>只有当用户点击跳转到特定路由时</strong>，浏览器才去下载该页面对应的 JS 代码。</li></ul><h4 id="2）核心-API：React-lazy-Suspense"><a href="#2）核心-API：React-lazy-Suspense" class="headerlink" title="2）核心 API：React.lazy &amp; Suspense"></a><strong><font color='#10c300'>2）核心 API：React.lazy &amp; Suspense</font></strong></h4><p>React 原生提供了 <code>lazy</code> 函数来实现动态导入，配合 <code>Suspense</code> 组件处理加载状态。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; lazy, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 使用 lazy 动态导入组件 (注意：不要在组件内部声明)</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">About</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./pages/About&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//  2. 使用 Suspense 包裹懒加载组件，fallback 用于显示加载中状态</span></span><br><span class="line"><span class="comment">// 方式1：</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">About</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">    ),</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2：封装 Suspens(HOC高阶函数)</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">withSuspense</span> = (<span class="params">Component</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Component</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="title function_">withSuspense</span>(<span class="title class_">About</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式3：可在整个路由入口使用Suspense 包裹所有路由组件(前提全部路由懒加载)</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：如果不使用 <code>Suspense</code> 包裹，React 在等待组件加载时会抛出错误，导致应用崩溃。</p></blockquote><br><h3 id="3-6-路由模式"><a href="#3-6-路由模式" class="headerlink" title="3.6 路由模式"></a><strong><font color='red'>3.6 路由模式</font></strong></h3><p>React Router 主要支持两种路由模式：<strong>History 模式</strong> 和 <strong>Hash 模式</strong>。在 Data API (v6.4+) 中，它们分别对应 <code>createBrowserRouter</code> 和 <code>createHashRouter</code>。</p><h4 id="1）History-模式-推荐"><a href="#1）History-模式-推荐" class="headerlink" title="1）History 模式 (推荐)"></a><strong><font color='#10c300'>1）History 模式 (推荐)</font></strong></h4><p>这是现代 Web 应用的标准模式，使用 HTML5 History API (<code>pushState</code>, <code>replaceState</code>) 来管理 URL。</p><ul><li><strong>表现</strong>：URL 看起来像标准的路径，例如 <code>example.com/user/123</code>。</li><li><strong>优点</strong>：URL 美观，符合用户习惯；SEO 友好。</li><li><strong>缺点</strong>：<strong>需要服务器配置支持</strong>。因为是单页应用，当用户直接访问深层路径（如 <code>/user/123</code>）或刷新页面时，服务器必须返回 <code>index.html</code>，否则会出现 404 错误。</li></ul><p><strong>代码示例：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter, <span class="title class_">RouterProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  <span class="comment">// ...路由配置</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure><p><strong>服务器配置示例 (Nginx)：</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2）Hash-模式"><a href="#2）Hash-模式" class="headerlink" title="2）Hash 模式"></a><strong><font color='#10c300'>2）Hash 模式</font></strong></h4><p>使用 URL 的 Hash 部分 (<code>#</code>) 来模拟一个完整的 URL。</p><ul><li><strong>表现</strong>：URL 带有 <code>#</code> 号，例如 <code>example.com/#/user/123</code>。</li><li><strong>优点</strong>：兼容性极好（支持老旧浏览器）；<strong>不需要服务器额外配置</strong>（因为 <code>#</code> 后面的内容不会发送给服务器）。</li><li><strong>缺点</strong>：URL 不够美观；SEO 较差；某些第三方登录回调可能不支持 Hash 路径。</li></ul><p><strong>代码示例：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createHashRouter, <span class="title class_">RouterProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createHashRouter</span>([</span><br><span class="line">  <span class="comment">// ...路由配置</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure><h4 id="3）如何选择？"><a href="#3）如何选择？" class="headerlink" title="3）如何选择？"></a><strong><font color='#10c300'>3）如何选择？</font></strong></h4><table><thead><tr><th align="left">特性</th><th align="left">History 模式 (<code>createBrowserRouter</code>)</th><th align="left">Hash 模式 (<code>createHashRouter</code>)</th></tr></thead><tbody><tr><td align="left"><strong>URL 外观</strong></td><td align="left">美观 (<code>/path</code>)</td><td align="left">带井号 (<code>/#/path</code>)</td></tr><tr><td align="left"><strong>服务器配置</strong></td><td align="left"><strong>需要</strong> (Nginx&#x2F;Apache rewrite)</td><td align="left"><strong>不需要</strong></td></tr><tr><td align="left"><strong>SEO</strong></td><td align="left">友好</td><td align="left">较差</td></tr><tr><td align="left"><strong>部署难度</strong></td><td align="left">中</td><td align="left">低</td></tr><tr><td align="left"><strong>推荐场景</strong></td><td align="left">公网项目、企业级应用</td><td align="left">内部工具、演示 Demo、无法控制服务器配置时</td></tr></tbody></table><h4 id="4）拓展"><a href="#4）拓展" class="headerlink" title="4）拓展"></a><strong><font color='#10c300'>4）拓展</font></strong></h4><p>1️⃣History 模式下为什么需要服务器配置支持，为什么当用户直接访问深层路径（如 <code>/user/123</code>）或刷新页面时，服务器必须返回 <code>index.html</code>，否则会出现 404 错误。</p><p>答：当你直接在浏览器地址栏输入 <a href="http://example.com/user/123">http://example.com/user/123</a> 并回车（或按刷新键）：</p><ol><li>浏览器：这被视为一次全新的访问。浏览器会老老实实向服务器发送一个 HTTP GET 请求：”请给我 &#x2F;user&#x2F;123 这个文件”。</li><li><strong>服务器</strong>：去它的硬盘文件系统里找<ul><li>它找有没有 user 文件夹？没有。</li><li>它找有没有 user&#x2F;123 文件？没有。</li><li>它找有没有 user&#x2F;123.html？也没有。</li><li>因为 SPA 项目打包后，服务器上通常只有一个 index.html 和一堆 .js&#x2F;.css 文件，根本不存在物理上的 &#x2F;user&#x2F;123 目录。</li></ul></li><li><strong>结果</strong>：服务器诚实地返回了 <strong>404 Not Found</strong>。</li></ol><br><h3 id="3-7-404-页面配置"><a href="#3-7-404-页面配置" class="headerlink" title="3.7 404 页面配置"></a><strong><font color='red'>3.7 404 页面配置</font></strong></h3><p>在 SPA 应用中，当用户访问了未定义的路径时，如果不做处理，页面可能会显示一片空白。我们需要配置一个 <strong>Catch-All 路由</strong> 来展示友好的 404 页面。</p><p>在 React Router v6 中，使用 <code>path: &quot;*&quot;</code> 即可匹配任意路径。由于 v6 内部有智能的路由排名算法（Ranking Algorithm），你不需要在这个路由上加 <code>exact</code>，也不强求将它放在路由数组的最后（但在 v5 中必须放在最后）。</p><h4 id="1）基础配置"><a href="#1）基础配置" class="headerlink" title="1）基础配置"></a><strong><font color='#10c300'>1）基础配置</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/router/index.jsx</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">About</span> /&gt;</span></span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 🔥 404 路由配置（通常建议放在最后，便于阅读）</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">NotFound</span> /&gt;</span></span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h4 id="2）创建优雅的-404-组件"><a href="#2）创建优雅的-404-组件" class="headerlink" title="2）创建优雅的 404 组件"></a><strong><font color='#10c300'>2）创建优雅的 404 组件</font></strong></h4><p>简单的 404 页面应该包含错误提示和返回首页的按钮。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/pages/NotFound.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span>, useNavigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">NotFound</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> navigate = <span class="title function_">useNavigate</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">textAlign:</span> &quot;<span class="attr">center</span>&quot;, <span class="attr">padding:</span> &quot;<span class="attr">50px</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">fontSize:</span> &quot;<span class="attr">72px</span>&quot; &#125;&#125;&gt;</span>404<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">fontSize:</span> &quot;<span class="attr">24px</span>&quot; &#125;&#125;&gt;</span>抱歉，您访问的页面不存在。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginTop:</span> &quot;<span class="attr">20px</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> navigate(-1)&#125; style=&#123;&#123; marginRight: &quot;10px&quot; &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">          返回上一页</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span>&gt;</span>回到首页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3）重定向到首页"><a href="#3）重定向到首页" class="headerlink" title="3）重定向到首页"></a><strong><font color='#10c300'>3）重定向到首页</font></strong></h4><p>有时候我们不希望显示 404 页面，而是直接将用户重定向回首页（例如在后台管理系统中）。可以使用 <code>&lt;Navigate&gt;</code> 组件。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">  <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> <span class="attr">replace</span> /&gt;</span></span>, <span class="comment">// replace: true 防止用户点击后退时陷入死循环</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><hr><br><h2 id="四、Data-API-进阶"><a href="#四、Data-API-进阶" class="headerlink" title="四、Data API (进阶)"></a><strong>四、Data API (进阶)</strong></h2><p>React Router 6.4+ 引入的 Data API 不仅仅是关于路由跳转，它提供了一套完整的<strong>数据生命周期管理</strong>方案。这使得我们可以在路由层面处理数据获取、提交和错误处理，大大减少组件内部的副作用代码。</p><h3 id="4-1-数据加载-Loader"><a href="#4-1-数据加载-Loader" class="headerlink" title="4.1 数据加载 (Loader)"></a><strong><font color='red'>4.1 数据加载 (Loader)</font></strong></h3><blockquote><p><strong>注意</strong>：Loader 的基础用法已在 <a href="#31-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD-loader">3.1 节</a> 中介绍。</p></blockquote><p>Loader 是 Data API 的读取端。它在路由渲染前运行，为组件提供数据。</p><p><strong>核心优势</strong>：</p><ol><li><strong>并行加载</strong>：路由组件和数据并行请求，消除瀑布流。</li><li><strong>数据&#x2F;UI 分离</strong>：组件只负责接收数据渲染，不负责 Fetch。</li></ol><br><h3 id="4-2-数据提交-Action"><a href="#4-2-数据提交-Action" class="headerlink" title="4.2 数据提交 (Action)"></a><strong><font color='red'>4.2 数据提交 (Action)</font></strong></h3><p>Action 是 Data API 的写入端，用于处理非 GET 请求（如 POST, PUT, DELETE）。它与 <code>&lt;Form&gt;</code> 组件配合，能在不手动编写 <code>onSubmit</code> 和 <code>fetch</code> 的情况下完成数据提交。</p><h4 id="1）定义-Action"><a href="#1）定义-Action" class="headerlink" title="1）定义 Action"></a><strong><font color='#10c300'>1）定义 Action</font></strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/pages/Login.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; redirect &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loginAction</span>(<span class="params">&#123; request &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 获取表单数据</span></span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">await</span> request.<span class="title function_">formData</span>();</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(formData);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发起请求</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;/api/login&quot;</span>, &#123; <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>, <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data) &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 成功后重定向</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">redirect</span>(<span class="string">&quot;/dashboard&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2）绑定-Config"><a href="#2）绑定-Config" class="headerlink" title="2）绑定 Config"></a><strong><font color='#10c300'>2）绑定 Config</font></strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/index.jsx</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>,</span><br><span class="line">  <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Login</span> /&gt;</span></span>,</span><br><span class="line">  <span class="attr">action</span>: loginAction, <span class="comment">// 👈 绑定 action</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3）使用-Form-组件"><a href="#3）使用-Form-组件" class="headerlink" title="3）使用 Form 组件"></a><strong><font color='#10c300'>3）使用 Form 组件</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Form</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Login</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="4-3-无导航交互-useFetcher"><a href="#4-3-无导航交互-useFetcher" class="headerlink" title="4.3 无导航交互 (useFetcher)"></a><strong><font color='red'>4.3 无导航交互 (useFetcher)</font></strong></h3><p>通常点击链接或提交表单会导致页面跳转。但有些操作我们<strong>不希望跳转页面</strong>，比如：<strong>点赞</strong>、<strong>加入购物车</strong>、<strong>Newsletter 订阅</strong>。这时使用 <code>useFetcher</code>。</p><p>提供了 <code>fetcher.Form</code>、<code>fetcher.submit</code>、<code>fetcher.load</code> 等方法，可以在不导航的情况下触发 loader 或 action。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useFetcher &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ProductItem</span>(<span class="params">&#123; product &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> fetcher = <span class="title function_">useFetcher</span>();</span><br><span class="line">  <span class="keyword">const</span> isSubmitting = fetcher.<span class="property">state</span> === <span class="string">&quot;submitting&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;product-card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;product.name&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 这里的提交不会导致页面跳转，但会触发 action 并自动重新验证页面数据 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">fetcher.Form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/add-to-cart&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;productId&quot;</span> <span class="attr">value</span>=<span class="string">&#123;product.id&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">disabled</span>=<span class="string">&#123;isSubmitting&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;isSubmitting ? &quot;添加中...&quot; : &quot;加入购物车&quot;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">fetcher.Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="4-4-错误边界-ErrorElement"><a href="#4-4-错误边界-ErrorElement" class="headerlink" title="4.4 错误边界 (ErrorElement)"></a><strong><font color='red'>4.4 错误边界 (ErrorElement)</font></strong></h3><p>每个路由都可以定义一个 <code>errorElement</code>。当 <code>loader</code>、<code>action</code> 或组件渲染过程中抛出错误时，React Router 会捕获它并渲染 <code>errorElement</code>，而不是让整个页面白屏。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  <span class="attr">loader</span>: <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Oh no!&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>,</span><br><span class="line">  <span class="attr">errorElement</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorPage</span> /&gt;</span></span>, <span class="comment">// 👈 用户将看到这个组件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><br><h2 id="五、封装式路由配置-Best-Practice"><a href="#五、封装式路由配置-Best-Practice" class="headerlink" title="五、封装式路由配置 (Best Practice)"></a><strong>五、封装式路由配置 (Best Practice)</strong></h2><p>在真实项目中，我们将路由配置抽离到独立文件中管理，使其结构更清晰。</p><h3 id="5-1-目录结构"><a href="#5-1-目录结构" class="headerlink" title="5.1 目录结构"></a><strong><font color='red'>5.1 目录结构</font></strong></h3><p>推荐在 <code>src/router</code> 目录下管理路由：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">├── main.jsx         &lt;-- 入口文件</span><br><span class="line">├── pages/</span><br><span class="line">│   ├── Home.jsx</span><br><span class="line">│   ├── Login.jsx</span><br><span class="line">│   └── Dashboard.jsx</span><br><span class="line">├── router/</span><br><span class="line">│   └── index.jsx    &lt;-- 路由配置文件</span><br></pre></td></tr></table></figure><br><h3 id="5-2-路由配置文件"><a href="#5-2-路由配置文件" class="headerlink" title="5.2 路由配置文件"></a><strong><font color='red'>5.2 路由配置文件</font></strong></h3><p>利用 <code>createBrowserRouter</code> 和 <code>lazy</code> 实现配置化与懒加载的完美结合。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/router/index.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; lazy &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter, <span class="title class_">Navigate</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载页面组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../pages/Home&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">About</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../pages/About&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Dashboard</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../pages/Dashboard&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Login</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../pages/Login&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载中组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Loading</span> = (<span class="params"></span>) =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;p-4&quot;</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由表定义</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="title class_">Home</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="title class_">Login</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/dashboard&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="title class_">Dashboard</span>,</span><br><span class="line">    <span class="comment">// 嵌套路由配置</span></span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;stats&quot;</span>, <span class="comment">// 路径为 /dashboard/stats   子路由不要加&#x27;/&#x27;</span></span><br><span class="line">        <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Stats View<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;settings&quot;</span>, <span class="comment">// 路径为 /dashboard/settings</span></span><br><span class="line">        <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Settings View<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 404 路由处理</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> <span class="attr">replace</span> /&gt;</span></span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建并导出路由实例</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(routes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure><br><h3 id="5-3-接入"><a href="#5-3-接入" class="headerlink" title="5.3 接入"></a><strong><font color='red'>5.3 接入</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><hr><br><h2 id="六、进阶与优化"><a href="#六、进阶与优化" class="headerlink" title="六、进阶与优化"></a><strong>六、进阶与优化</strong></h2><p>在封装式写法中，我们可以创建一个包装组件来保护路由。</p><h3 id="6-1-路由守卫-Protected-Routes"><a href="#6-1-路由守卫-Protected-Routes" class="headerlink" title="6.1 路由守卫 (Protected Routes)"></a><strong><font color='red'>6.1 路由守卫 (Protected Routes)</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/AuthGuard.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Navigate</span>, useLocation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">AuthGuard</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> isLogged = <span class="literal">false</span>; <span class="comment">// 替换为真实的鉴权逻辑</span></span><br><span class="line">  <span class="keyword">const</span> location = <span class="title function_">useLocation</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!isLogged) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">state</span>=<span class="string">&#123;&#123;</span> <span class="attr">from:</span> <span class="attr">location</span> &#125;&#125; <span class="attr">replace</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> children;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/router/index.js 使用</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/admin&#x27;</span>,</span><br><span class="line">  <span class="attr">element</span>: (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">AuthGuard</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">AdminPage</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">AuthGuard</span>&gt;</span></span></span><br><span class="line">  ),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="6-2-全局-Loading-状态"><a href="#6-2-全局-Loading-状态" class="headerlink" title="6.2 全局 Loading 状态"></a><strong><font color='red'>6.2 全局 Loading 状态</font></strong></h3><p>使用 <code>useNavigation</code> 监听全局路由跳转状态。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useNavigation, <span class="title class_">Outlet</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">RootLayout</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> navigation = <span class="title function_">useNavigation</span>();</span><br><span class="line">  <span class="keyword">const</span> isLoading = navigation.<span class="property">state</span> === <span class="string">&quot;loading&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isLoading &amp;&amp; <span class="tag">&lt;<span class="name">GlobalSpinner</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><br><h2 id="七、常见误区-Common-Pitfalls"><a href="#七、常见误区-Common-Pitfalls" class="headerlink" title="七、常见误区 (Common Pitfalls)"></a><strong>七、常见误区 (Common Pitfalls)</strong></h2><h3 id="7-1-错误使用-Layout-组件-Context-丢失"><a href="#7-1-错误使用-Layout-组件-Context-丢失" class="headerlink" title="7.1 错误使用 Layout 组件 (Context 丢失)"></a><strong><font color='red'>7.1 错误使用 Layout 组件 (Context 丢失)</font></strong></h3><p>很多初学者容易犯的一个错误是：<strong>将布局组件 (<code>Layout</code> &#x2F; <code>Menu</code>) 防止在 <code>RouterProvider</code> 之外</strong>。</p><p><strong>错误写法：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.jsx</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Layout</span> /&gt;</span> &#123;/* ❌ 错误：Layout 在 RouterContext 之外 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>问题后果：</strong></p><ol><li><strong>无法使用 <code>&lt;Link&gt;</code> &#x2F; <code>&lt;NavLink&gt;</code></strong>：点击菜单会报错 <code>useHref() may be used only in the context of a &lt;Router&gt; component.</code></li><li><strong>无法使用 hooks</strong>：<code>useLocation</code>、<code>useNavigate</code> 等 Hook 均无法工作。</li><li><strong>路由状态无法共享</strong>：布局组件无法感知当前的路由变化。</li><li>如果Layout中是固定的内容，不涉及路由跳转等，布局组件则可以写在 <code>RouterProvider</code> 之外</li></ol><p><strong>最佳实践</strong>：是利用 <strong>嵌套路由 (Nested Routes)</strong> 和 <code>&lt;Outlet /&gt;</code>。</p><p><strong>第一步：创建布局组件 (src&#x2F;components&#x2F;Layout.jsx)</strong></p><p>利用 <code>&lt;Outlet /&gt;</code> 渲染子路由内容：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Outlet</span>, <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Layout</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;layout&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span> | <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 子路由的内容将渲染在这里 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Layout</span>;</span><br></pre></td></tr></table></figure><p><strong>第二步：配置嵌套路由 (src&#x2F;router&#x2F;index.jsx)</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&quot;../components/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&quot;../pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&quot;../pages/About&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> /&gt;</span></span>, <span class="comment">// 1. 根路径渲染布局</span></span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      <span class="comment">// 2. 子路由渲染在 Layout 的 Outlet 中</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="literal">true</span>, <span class="comment">// 默认子路由 (对应 path: &quot;/&quot;)</span></span><br><span class="line">        <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;about&quot;</span>,</span><br><span class="line">        <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">About</span> /&gt;</span></span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure><p><strong>第三步：入口文件 (src&#x2F;main.jsx)</strong></p><p>入口文件保持简洁，只需注入 <code>router</code>：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom/client&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>)).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/*  默认这里是APP组件，也可以将<span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> /&gt;</span>写到APP组件中去 */&#125;</span></span><br><span class="line"><span class="language-xml">    &#123;/*  <span class="tag">&lt;<span class="name">App</span> /&gt;</span> */&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><hr><br><h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a><strong>八、总结</strong></h2><p>React Router v6.4+ 定义了现代 React 应用的路由标准：</p><ol><li><strong>使用 <code>createBrowserRouter</code></strong> 进行集中式路由管理。</li><li><strong>利用 <code>loader</code></strong> 提前加载数据，提升首屏体验。</li><li><strong>结合 <code>Suspense</code> 和 <code>lazy</code></strong> 实现代码分割。</li><li><strong>目录结构规范化</strong>，将路由逻辑与 UI 组件分离。</li></ol><p>掌握这套模式，你将能构建出性能更优、架构更清晰的 React 应用。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;React-Router-全面指南-v6-4-v7&quot;&gt;&lt;a href=&quot;#React-Router-全面指南-v6-4-v7&quot; class=&quot;headerlink&quot; title=&quot;React Router 全面指南 (v6.4+ &amp;amp; v7)&quot;&gt;&lt;/a&gt;Re</summary>
      
    
    
    
    <category term="前端开发" scheme="http://example.com/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="React" scheme="http://example.com/tags/React/"/>
    
    <category term="React Router" scheme="http://example.com/tags/React-Router/"/>
    
  </entry>
  
  <entry>
    <title>React 完全指南 (React 18 &amp; 19)</title>
    <link href="http://example.com/posts/4179c0b9.html"/>
    <id>http://example.com/posts/4179c0b9.html</id>
    <published>2025-12-02T10:28:38.000Z</published>
    <updated>2026-03-01T16:07:38.353Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React-初学者完全指南-React-18-19"><a href="#React-初学者完全指南-React-18-19" class="headerlink" title="React 初学者完全指南 (React 18 &amp; 19)"></a>React 初学者完全指南 (React 18 &amp; 19)</h1><blockquote><p>📚 本指南旨在帮助初学者快速掌握 React 的核心概念和最新特性</p></blockquote><hr><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol><li><a href="#%E4%B8%80-react-%E7%AE%80%E4%BB%8B">React 简介</a></li><li><a href="#%E4%BA%8C-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">环境搭建</a></li><li><a href="#%E4%B8%89-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">核心概念</a></li><li><a href="#%E5%9B%9B-react-hooks-%E8%AF%A6%E8%A7%A3">React Hooks 详解</a></li><li><a href="#%E4%BA%94-hoc-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6">HOC 高阶组件</a></li><li><a href="#5-react-18-%E6%96%B0%E7%89%B9%E6%80%A7">React 18 新特性</a></li><li><a href="#6-react-19-%E6%96%B0%E7%89%B9%E6%80%A7">React 19 新特性</a></li><li><a href="#7-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li><li><a href="#8-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">常见问题与解决方案</a></li></ol><br><h2 id="一、React-简介"><a href="#一、React-简介" class="headerlink" title="一、React 简介"></a><strong>一、React 简介</strong></h2><h3 id="1-1-什么是-React？"><a href="#1-1-什么是-React？" class="headerlink" title="1.1 什么是 React？"></a><strong><font color='red'>1.1 什么是 React？</font></strong></h3><p>React 是由 Facebook（现 Meta）开发的一个用于构建用户界面的 JavaScript 库。它的核心思想是：</p><ul><li><strong>组件化</strong>：将 UI 拆分成独立、可复用的组件</li><li><strong>声明式</strong>：描述 UI 应该是什么样子，而不是如何改变它</li><li><strong>单向数据流</strong>：数据从父组件流向子组件，使应用更可预测</li></ul><h3 id="1-2-为什么选择-React？"><a href="#1-2-为什么选择-React？" class="headerlink" title="1.2 为什么选择 React？"></a><strong><font color='red'>1.2 为什么选择 React？</font></strong></h3><table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td>🚀 高性能</td><td>虚拟 DOM 最小化真实 DOM 操作</td></tr><tr><td>🧩 组件复用</td><td>一次编写，多处使用</td></tr><tr><td>🌐 生态丰富</td><td>大量第三方库和工具支持</td></tr><tr><td>📱 跨平台</td><td>React Native 可开发移动应用</td></tr><tr><td>👥 社区活跃</td><td>丰富的学习资源和解决方案</td></tr></tbody></table><hr><br><h2 id="二、-环境搭建"><a href="#二、-环境搭建" class="headerlink" title="二、 环境搭建"></a><strong>二、 环境搭建</strong></h2><h3 id="2-1-使用-Vite-创建项目（推荐）"><a href="#2-1-使用-Vite-创建项目（推荐）" class="headerlink" title="2.1 使用 Vite 创建项目（推荐）"></a><strong><font color='red'>2.1 使用 Vite 创建项目（推荐）</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 npm</span></span><br><span class="line">npm create vite@latest vite-react-app -- --template react</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 pnpm</span></span><br><span class="line">pnpm create vite vite-react-app --template react</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 yarn</span></span><br><span class="line">yarn create vite vite-react-app --template react</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入项目目录并启动</span></span><br><span class="line"><span class="built_in">cd</span> vite-react-app</span><br><span class="line">npm/pnpm/yarn install</span><br><span class="line">npm/pnpm/yarn run dev</span><br></pre></td></tr></table></figure><h3 id="2-2-使用-Create-React-App"><a href="#2-2-使用-Create-React-App" class="headerlink" title="2.2 使用 Create React App"></a><strong><font color='red'>2.2 使用 Create React App</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app webpack-react-app</span><br><span class="line"><span class="built_in">cd</span> webpack-react-app</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure><h3 id="2-3-项目结构"><a href="#2-3-项目结构" class="headerlink" title="2.3 项目结构"></a><strong><font color='red'>2.3 项目结构</font></strong></h3><p><strong>vite</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vite-react-app/</span><br><span class="line">├── 📁 public/                 # 公共资源目录</span><br><span class="line">│   └── vite.svg               # Vite 项目默认 SVG 图标</span><br><span class="line">├── 📁 src/                    # 源代码目录</span><br><span class="line">│   ├── 📁 assets/             # 静态资源目录</span><br><span class="line">│   ├── App.jsx                # 根组件</span><br><span class="line">│   ├── App.css                # App 组件样式文件</span><br><span class="line">│   ├── main.jsx               # 应用入口文件</span><br><span class="line">│   └── index.css              # 全局样式文件</span><br><span class="line">├── .gitignore                 # Git 忽略配置文件</span><br><span class="line">├── README.md                  # 项目说明文档</span><br><span class="line">├── eslint.config.js           # ESLint 配置文件</span><br><span class="line">├── index.html                 # HTML 入口文件</span><br><span class="line">├── package.json               # 项目配置文件</span><br><span class="line">├── pnpm-lock.yaml             # pnpm 依赖锁定文件</span><br><span class="line">└── vite.config.js             # Vite 配置文件</span><br></pre></td></tr></table></figure><p><strong>webpack</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">webpack-react-app/</span><br><span class="line">├── 📁 public/                 # 公共资源目录</span><br><span class="line">│   ├── favicon.ico            # 网站图标</span><br><span class="line">│   ├── index.html             # HTML 入口文件</span><br><span class="line">│   ├── manifest.json          # Web App 清单文件</span><br><span class="line">│   └── robots.txt             # 搜索引擎爬虫规则</span><br><span class="line">├── 📁 src/                    # 源代码目录</span><br><span class="line">│   ├── App.css                # App 组件样式文件</span><br><span class="line">│   ├── App.js                 # 根组件</span><br><span class="line">│   ├── App.test.js            # App 组件测试文件</span><br><span class="line">│   ├── index.css              # 全局样式文件</span><br><span class="line">│   ├── index.js               # 应用入口文件</span><br><span class="line">│   ├── reportWebVitals.js     # 性能检测文件</span><br><span class="line">│   └── setupTests.js          # 测试设置文件</span><br><span class="line">├── .gitignore                 # Git 忽略配置文件</span><br><span class="line">├── README.md                  # 项目说明文档</span><br><span class="line">├── package-lock.json          # npm 依赖锁定文件</span><br><span class="line">└── package.json               # 项目配置文件</span><br></pre></td></tr></table></figure><h3 id="2-4-跨域请求代理配置"><a href="#2-4-跨域请求代理配置" class="headerlink" title="2.4 跨域请求代理配置"></a><strong><font color='red'>2.4 跨域请求代理配置</font></strong></h3><p>在前后端分离跨域开发时，通常需要在本地开发服务器中配置代理解决跨域问题。</p><h4 id="1）Vite-配置跨域代理"><a href="#1）Vite-配置跨域代理" class="headerlink" title="1）Vite 配置跨域代理"></a><strong><font color='#10c300'>1）Vite 配置跨域代理</font></strong></h4><p>修改根目录下的 <code>vite.config.js</code> 文件，在 <code>server</code> 选项中添加用户指定的 <code>proxy</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">react</span>()],</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;https://jsonplaceholder.typicode.com&quot;</span>, <span class="comment">// 实际后端地址</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/api/</span>, <span class="string">&quot;&quot;</span>), <span class="comment">// 如果后端接口本身不带 /api 前缀</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="2）Create-React-App-配置跨域代理"><a href="#2）Create-React-App-配置跨域代理" class="headerlink" title="2）Create React App 配置跨域代理"></a><strong><font color='#10c300'>2）Create React App 配置跨域代理</font></strong></h4><p>CRA 官方推荐通过在 src 目录下创建 <code>setupProxy.js</code> 来配置代理底层中间件。</p><ol><li>安装代理插件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install http-proxy-middleware --save</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>src/</code> 目录中新建 <code>setupProxy.js</code>（注意：由于它是 Node 环境直接读取配置，只能使用 CommonJS 规范），写入以下配置：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">&quot;http-proxy-middleware&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">app</span>) &#123;</span><br><span class="line">  app.<span class="title function_">use</span>(</span><br><span class="line">    <span class="string">&quot;/api&quot;</span>,</span><br><span class="line">    <span class="title function_">createProxyMiddleware</span>(&#123;</span><br><span class="line">      <span class="attr">target</span>: <span class="string">&quot;https://jsonplaceholder.typicode.com&quot;</span>, <span class="comment">// 实际后端地址</span></span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">        <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// 路径重写，去掉 /api 前缀</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><br><h2 id="三、-核心概念"><a href="#三、-核心概念" class="headerlink" title="三、 核心概念"></a><strong>三、 核心概念</strong></h2><h3 id="3-1-JSX-语法"><a href="#3-1-JSX-语法" class="headerlink" title="3.1 JSX 语法"></a><strong><font color='red'>3.1 JSX 语法</font></strong></h3><p>JSX 是 JavaScript 的语法扩展，让你可以在 JS 中编写类似 HTML 的代码：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JSX 基础语法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">&quot;React&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;welcome&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 使用花括号嵌入表达式 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;name&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* 条件渲染 */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;isLoggedIn ? <span class="tag">&lt;<span class="name">p</span>&gt;</span>欢迎回来<span class="tag">&lt;/<span class="name">p</span>&gt;</span> : <span class="tag">&lt;<span class="name">p</span>&gt;</span>请登录<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* 注意：class 要写成 className */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>点击我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1）JSX-规则速记"><a href="#1）JSX-规则速记" class="headerlink" title="1）JSX 规则速记"></a><strong><font color='#10c300'>1）JSX 规则速记</font></strong></h4><table><thead><tr><th>HTML</th><th>JSX</th></tr></thead><tbody><tr><td><code>class</code></td><td><code>className</code></td></tr><tr><td><code>for</code></td><td><code>htmlFor</code></td></tr><tr><td><code>onclick</code></td><td><code>onClick</code></td></tr><tr><td><code>tabindex</code></td><td><code>tabIndex</code></td></tr></tbody></table><br><h3 id="3-2-组件"><a href="#3-2-组件" class="headerlink" title="3.2 组件"></a><strong><font color='red'>3.2 组件</font></strong></h3><h4 id="1）函数组件（推荐）"><a href="#1）函数组件（推荐）" class="headerlink" title="1）函数组件（推荐）"></a><strong><font color='#10c300'>1）函数组件（推荐）</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数组件是 React 推荐的编写方式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Greeting</span>(<span class="params">&#123; name &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>你好, &#123;name&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数写法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Greeting</span> = (<span class="params">&#123; name &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>你好, &#123;name&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="2）类组件（了解即可）"><a href="#2）类组件（了解即可）" class="headerlink" title="2）类组件（了解即可）"></a><strong><font color='#10c300'>2）类组件（了解即可）</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Greeting</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>你好, &#123;this.props.name&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="3-3-Props（属性）"><a href="#3-3-Props（属性）" class="headerlink" title="3.3 Props（属性）"></a><strong><font color='red'>3.3 Props（属性）</font></strong></h3><p>Props 是父组件传递给子组件的数据：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">UserCard</span> <span class="attr">name</span>=<span class="string">&quot;张三&quot;</span> <span class="attr">age</span>=<span class="string">&#123;25&#125;</span> <span class="attr">isAdmin</span>=<span class="string">&#123;true&#125;</span> <span class="attr">hobbies</span>=<span class="string">&#123;[</span>&quot;<span class="attr">读书</span>&quot;, &quot;<span class="attr">游戏</span>&quot;]&#125; /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserCard</span>(<span class="params">&#123; name, age, isAdmin, hobbies &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄: &#123;age&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>身份: &#123;isAdmin ? &quot;管理员&quot; : &quot;普通用户&quot;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;hobbies.map((hobby, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;hobby&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1）Props-默认值"><a href="#1）Props-默认值" class="headerlink" title="1）Props 默认值"></a><strong><font color='#10c300'>1）Props 默认值</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; text = <span class="string">&quot;点击&quot;</span>, type = <span class="string">&quot;primary&quot;</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;</span>`<span class="attr">btn-</span>$&#123;<span class="attr">type</span>&#125;`&#125;&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="3-4-State（状态）"><a href="#3-4-State（状态）" class="headerlink" title="3.4 State（状态）"></a><strong><font color='red'>3.4 State（状态）</font></strong></h3><p>State 是组件内部的可变数据：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 声明状态：[当前值, 更新函数] = useState(初始值)</span></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前计数: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count - 1)&#125;&gt;-1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(0)&#125;&gt;重置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1）State-更新注意事项"><a href="#1）State-更新注意事项" class="headerlink" title="1）State 更新注意事项"></a><strong><font color='#10c300'>1）State 更新注意事项</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ❌ 错误：直接修改状态</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">wrongUpdate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    user.<span class="property">age</span> = <span class="number">26</span>; <span class="comment">// 不会触发重新渲染</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 正确：创建新对象</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">correctUpdate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setUser</span>(&#123; ...user, <span class="attr">age</span>: <span class="number">26</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 使用函数式更新（基于前一个状态）</span></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function">(<span class="params">prevCount</span>) =&gt;</span> prevCount + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="3-5-事件处理"><a href="#3-5-事件处理" class="headerlink" title="3.5 事件处理"></a><strong><font color='red'>3.5 事件处理</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">EventExample</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 点击事件</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;按钮被点击&quot;</span>, e);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 带参数的事件处理</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleDelete</span> = (<span class="params">id</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;删除项目:&quot;</span>, id);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 表单输入</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleChange</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setValue</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>点击我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleDelete(123)&#125;&gt;删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="3-6-条件渲染"><a href="#3-6-条件渲染" class="headerlink" title="3.6 条件渲染"></a><strong><font color='red'>3.6 条件渲染</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ConditionalExample</span>(<span class="params">&#123; isLoggedIn, messages &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 方式1: 三元运算符 */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;isLoggedIn ? <span class="tag">&lt;<span class="name">LogoutButton</span> /&gt;</span> : <span class="tag">&lt;<span class="name">LoginButton</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* 方式2: &amp;&amp; 短路运算 */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;messages.length &gt; 0 &amp;&amp; <span class="tag">&lt;<span class="name">Badge</span> <span class="attr">count</span>=<span class="string">&#123;messages.length&#125;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* 方式3: if-else 提前返回 */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;(() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        if (messages.length === 0) return <span class="tag">&lt;<span class="name">p</span>&gt;</span>暂无消息<span class="tag">&lt;/<span class="name">p</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">        if (messages.length &lt; 5) return <span class="tag">&lt;<span class="name">p</span>&gt;</span>少量消息<span class="tag">&lt;/<span class="name">p</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">p</span>&gt;</span>大量消息<span class="tag">&lt;/<span class="name">p</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)()&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="3-7-列表渲染"><a href="#3-7-列表渲染" class="headerlink" title="3.7 列表渲染"></a><strong><font color='red'>3.7 列表渲染</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> todos = [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">&quot;学习 React&quot;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">&quot;写代码&quot;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">&quot;看文档&quot;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;todos.map((todo) =&gt; (</span></span><br><span class="line"><span class="language-xml">        // key 必须是唯一且稳定的标识符</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span> <span class="attr">className</span>=<span class="string">&#123;todo.done</span> ? &quot;<span class="attr">completed</span>&quot; <span class="attr">:</span> &quot;&quot;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;todo.text&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>⚠️ <strong>key 的重要性</strong>：key 帮助 React 识别哪些元素改变了，避免使用数组索引作为 key（除非列表是静态的）</p></blockquote><br><h3 id="3-8-CSS-Modules-样式管理"><a href="#3-8-CSS-Modules-样式管理" class="headerlink" title="3.8 CSS Modules - 样式管理"></a><strong><font color='red'>3.8 CSS Modules - 样式管理</font></strong></h3><p>CSS Modules 是一种 CSS 文件的模块化和作用域化方案，它可以让 CSS 类名自动生成唯一的名称，避免全局样式冲突。</p><h4 id="1）什么是-CSS-Modules？"><a href="#1）什么是-CSS-Modules？" class="headerlink" title="1）什么是 CSS Modules？"></a><strong><font color='#10c300'>1）什么是 CSS Modules？</font></strong></h4><p>CSS Modules 的核心思想：</p><ul><li><strong>局部作用域</strong>：默认情况下，CSS 类名只在当前模块内生效</li><li><strong>自动命名</strong>：构建工具会将类名转换为唯一的哈希值（如 <code>.button</code> → <code>.Button_button__2Rx3L</code>）</li><li><strong>显式依赖</strong>：通过 <code>import</code> 引入样式，明确组件与样式的关系</li><li><strong>可组合性</strong>：支持 <code>composes</code> 关键字实现样式继承</li></ul><h4 id="2）基本使用"><a href="#2）基本使用" class="headerlink" title="2）基本使用"></a><strong><font color='#10c300'>2）基本使用</font></strong></h4><p><strong>Step 1️⃣：创建 CSS Module 文件</strong></p><p>文件命名规范：<code>*.module.css</code>（Vite 和 CRA 都默认支持）</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Button.module.css */</span></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#007bff</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0056b3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.primary</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#28a745</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.danger</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#dc3545</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Step 2️⃣：在组件中导入并使用</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Button.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; type = <span class="string">&quot;default&quot;</span>, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;styles.button&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Button</span>;</span><br></pre></td></tr></table></figure><p><strong>Step 3️⃣：查看编译后的类名</strong></p><p>在浏览器中查看，类名会被转换为类似这样的唯一标识：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;Button_button__2Rx3L&quot;</span>&gt;</span>点击我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3）动态类名组合"><a href="#3）动态类名组合" class="headerlink" title="3）动态类名组合"></a><strong><font color='#10c300'>3）动态类名组合</font></strong></h4><p><strong>1️⃣使用模板字符串</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Card.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Card</span>(<span class="params">&#123; isActive, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">styles.card</span>&#125; $&#123;<span class="attr">isActive</span> ? <span class="attr">styles.active</span> <span class="attr">:</span> &quot;&quot;&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2️⃣使用 classnames 库（推荐）</strong></p><p>先安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install classnames</span><br></pre></td></tr></table></figure><p>使用方式：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Card.module.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&quot;classnames&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Card</span>(<span class="params">&#123; isActive, isDisabled, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&#123;classNames(styles.card,</span> &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        [<span class="attr">styles.active</span>]<span class="attr">:</span> <span class="attr">isActive</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        [<span class="attr">styles.disabled</span>]<span class="attr">:</span> <span class="attr">isDisabled</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Card</span>;</span><br></pre></td></tr></table></figure><p><strong>3️⃣使用 clsx 库（轻量替代）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install clsx</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Button.module.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> clsx <span class="keyword">from</span> <span class="string">&quot;clsx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; variant, size, disabled, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&#123;clsx(</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">styles.button</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">styles</span>[<span class="attr">variant</span>], // <span class="attr">动态访问样式</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">styles</span>[<span class="attr">size</span>],</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">disabled</span> &amp;&amp; <span class="attr">styles.disabled</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      )&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4）composes-样式组合"><a href="#4）composes-样式组合" class="headerlink" title="4）composes 样式组合"></a><strong><font color='#10c300'>4）composes 样式组合</font></strong></h4><p>CSS Modules 支持 <code>composes</code> 关键字来实现样式继承和组合：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Button.module.css */</span></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.primary</span> &#123;</span><br><span class="line">  composes: button;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#007bff</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.danger</span> &#123;</span><br><span class="line">  composes: button;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#dc3545</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用时只需应用一个类名：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Button.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; type &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;styles[type]&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">&lt;<span class="title class_">Button</span> type=<span class="string">&quot;primary&quot;</span> /&gt;  <span class="comment">// 自动继承 button 的样式</span></span><br></pre></td></tr></table></figure><h4 id="5）从其他文件组合样式"><a href="#5）从其他文件组合样式" class="headerlink" title="5）从其他文件组合样式"></a><strong><font color='#10c300'>5）从其他文件组合样式</font></strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* base.module.css */</span></span><br><span class="line"><span class="selector-class">.baseButton</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Button.module.css */</span></span><br><span class="line"><span class="selector-class">.submitButton</span> &#123;</span><br><span class="line">  composes: baseButton from <span class="string">&quot;./base.module.css&quot;</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6）全局样式与局部样式混合"><a href="#6）全局样式与局部样式混合" class="headerlink" title="6）全局样式与局部样式混合"></a><strong><font color='#10c300'>6）全局样式与局部样式混合</font></strong></h4><p><strong>1️⃣使用 <code>:global</code> 声明全局样式</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* App.module.css */</span></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 全局样式 */</span></span><br><span class="line">:<span class="built_in">global</span>(.highlight) &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 也可以嵌套 */</span></span><br><span class="line"><span class="selector-class">.wrapper</span> :<span class="built_in">global</span>(.external-class) &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2️⃣混合使用全局类名和模块类名</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./App.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">styles.container</span>&#125; <span class="attr">global-theme</span>`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;highlight&quot;</span>&gt;</span>全局高亮<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7）CSS-变量与主题切换"><a href="#7）CSS-变量与主题切换" class="headerlink" title="7）CSS 变量与主题切换"></a><strong><font color='#10c300'>7）CSS 变量与主题切换</font></strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* theme.module.css */</span></span><br><span class="line"><span class="selector-class">.light</span> &#123;</span><br><span class="line">  <span class="attr">--bg-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attr">--text-color</span>: <span class="number">#000000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dark</span> &#123;</span><br><span class="line">  <span class="attr">--bg-color</span>: <span class="number">#1a1a1a</span>;</span><br><span class="line">  <span class="attr">--text-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./theme.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = <span class="title function_">useState</span>(<span class="string">&quot;light&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">styles.container</span>&#125; $&#123;<span class="attr">styles</span>[<span class="attr">theme</span>]&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>当前主题：&#123;theme&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setTheme(theme === &quot;light&quot; ? &quot;dark&quot; : &quot;light&quot;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        切换主题</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><h4 id="8）配合-Sass-Less-使用"><a href="#8）配合-Sass-Less-使用" class="headerlink" title="8）配合 Sass&#x2F;Less 使用"></a><strong><font color='#10c300'>8）配合 Sass&#x2F;Less 使用</font></strong></h4><p>CSS Modules 完全支持 CSS 预处理器。</p><p><strong>1️⃣安装 Sass</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install sass</span><br></pre></td></tr></table></figure><p><strong>2️⃣创建 SCSS Module 文件</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Button.module.scss */</span></span><br><span class="line"><span class="variable">$primary-color</span>: <span class="number">#007bff</span>;</span><br><span class="line"><span class="variable">$hover-darken</span>: <span class="number">10%</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.primary</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="variable">$primary-color</span>;</span><br><span class="line">    </span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">darken</span>(<span class="variable">$primary-color</span>, <span class="variable">$hover-darken</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.large</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3️⃣在组件中使用</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Button.module.scss&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; variant = <span class="string">&quot;primary&quot;</span>, size = <span class="string">&quot;medium&quot;</span>, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">styles.button</span>&#125; $&#123;<span class="attr">styles</span>[<span class="attr">variant</span>]&#125; $&#123;<span class="attr">styles</span>[<span class="attr">size</span>]&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9）TypeScript-支持"><a href="#9）TypeScript-支持" class="headerlink" title="9）TypeScript 支持"></a><strong><font color='#10c300'>9）TypeScript 支持</font></strong></h4><p><strong>1️⃣自动生成类型定义</strong></p><p>安装类型生成工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D typescript-plugin-css-modules</span><br></pre></td></tr></table></figure><p>配置 <code>tsconfig.json</code>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;typescript-plugin-css-modules&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>2️⃣手动创建类型定义</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Button.module.css.d.ts</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">styles</span>: &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">button</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">primary</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">danger</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">large</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">small</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> styles;</span><br></pre></td></tr></table></figure><p><strong>3️⃣在 TypeScript 组件中使用</strong></p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Button.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line">  <span class="attr">variant</span>?: <span class="string">&quot;primary&quot;</span> | <span class="string">&quot;danger&quot;</span> | <span class="string">&quot;success&quot;</span>;</span><br><span class="line">  <span class="attr">size</span>?: <span class="string">&quot;small&quot;</span> | <span class="string">&quot;medium&quot;</span> | <span class="string">&quot;large&quot;</span>;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Button</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">ButtonProps</span>&gt; = <span class="function">(<span class="params">&#123; </span></span></span><br><span class="line"><span class="params"><span class="function">  variant = <span class="string">&quot;primary&quot;</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">  size = <span class="string">&quot;medium&quot;</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">  children </span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">styles.button</span>&#125; $&#123;<span class="attr">styles</span>[<span class="attr">variant</span>]&#125; $&#123;<span class="attr">styles</span>[<span class="attr">size</span>]&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Button</span>;</span><br></pre></td></tr></table></figure><h4 id="10）实战案例：卡片组件"><a href="#10）实战案例：卡片组件" class="headerlink" title="10）实战案例：卡片组件"></a><strong><font color='#10c300'>10）实战案例：卡片组件</font></strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Card.module.css */</span></span><br><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#e0e0e0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.3s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.15</span>);</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">2px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cardHeader</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#f0f0f0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cardTitle</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cardContent</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cardFooter</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">gap</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.highlighted</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#007bff</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f8f9ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Card.module.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&quot;classnames&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Card</span>(<span class="params">&#123; title, children, actions, highlighted = <span class="literal">false</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classNames(styles.card,</span> &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      [<span class="attr">styles.highlighted</span>]<span class="attr">:</span> <span class="attr">highlighted</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;)&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;title &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.cardHeader&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&#123;styles.cardTitle&#125;</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.cardContent&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">      &#123;actions &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.cardFooter&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;actions&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Card</span>;</span><br></pre></td></tr></table></figure><h4 id="11）配置自定义哈希命名"><a href="#11）配置自定义哈希命名" class="headerlink" title="11）配置自定义哈希命名"></a><strong><font color='#10c300'>11）配置自定义哈希命名</font></strong></h4><p><strong>Vite 配置</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">react</span>()],</span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">      <span class="comment">// 自定义生成的类名格式</span></span><br><span class="line">      <span class="attr">generateScopedName</span>: <span class="string">&quot;[name]__[local]___[hash:base64:5]&quot;</span>,</span><br><span class="line">      <span class="comment">// [name]: 文件名</span></span><br><span class="line">      <span class="comment">// [local]: 原始类名</span></span><br><span class="line">      <span class="comment">// [hash:base64:5]: 5位哈希值</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>Create React App 配置</strong></p><p>CRA 需要 eject 或使用 <code>craco</code> &#x2F; <code>react-app-rewired</code> 来修改配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// craco.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">style</span>: &#123;</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">      <span class="attr">localIdentName</span>: <span class="string">&quot;[name]__[local]--[hash:base64:5]&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="12）最佳实践"><a href="#12）最佳实践" class="headerlink" title="12）最佳实践"></a><strong><font color='#10c300'>12）最佳实践</font></strong></h4><p><strong>1️⃣文件命名约定</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">components/</span><br><span class="line">├── Button/</span><br><span class="line">│   ├── Button.jsx</span><br><span class="line">│   ├── Button.module.css</span><br><span class="line">│   └── index.js</span><br></pre></td></tr></table></figure><p><strong>2️⃣避免过度嵌套</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ❌ 不推荐：选择器嵌套过深 */</span></span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.wrapper</span> <span class="selector-class">.content</span> <span class="selector-class">.item</span> <span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ✅ 推荐：扁平化类名 */</span></span><br><span class="line"><span class="selector-class">.container</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.itemTitle</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p><strong>3️⃣使用语义化命名</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ❌ 不清晰 */</span></span><br><span class="line"><span class="selector-class">.btn1</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.box2</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.red</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ✅ 语义化 */</span></span><br><span class="line"><span class="selector-class">.submitButton</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.userCard</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.errorMessage</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p><strong>4️⃣组合全局样式和模块样式</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./App.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// 全局重置样式 + 模块样式</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>`<span class="attr">global-reset</span> $&#123;<span class="attr">styles.container</span>&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">header</span> <span class="attr">className</span>=<span class="string">&#123;styles.header&#125;</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5️⃣共享常量（CSS 变量）</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* variables.module.css */</span></span><br><span class="line">:export &#123;</span><br><span class="line">  primaryColor: <span class="number">#007bff</span>;</span><br><span class="line">  successColor: <span class="number">#28a745</span>;</span><br><span class="line">  spacing: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> variables <span class="keyword">from</span> <span class="string">&quot;./variables.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">color:</span> <span class="attr">variables.primaryColor</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">padding:</span> <span class="attr">variables.spacing</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      内容</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="13）常见问题与解决方案"><a href="#13）常见问题与解决方案" class="headerlink" title="13）常见问题与解决方案"></a><strong><font color='#10c300'>13）常见问题与解决方案</font></strong></h4><p><strong>Q1: 如何应用多个类名？</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法1：模板字符串</span></span><br><span class="line">&lt;div className=&#123;<span class="string">`<span class="subst">$&#123;styles.card&#125;</span> <span class="subst">$&#123;styles.active&#125;</span>`</span>&#125; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：数组 join</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;[styles.card,</span> <span class="attr">styles.active</span>]<span class="attr">.join</span>(&#x27; &#x27;)&#125; /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法3：classnames 库（推荐）</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classNames(styles.card,</span> <span class="attr">styles.active</span>)&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>Q2: 如何访问带连字符的类名？</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Button.module.css */</span></span><br><span class="line"><span class="selector-class">.submit-button</span> &#123; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法1：中括号语法</span></span><br><span class="line">&lt;button className=&#123;styles[<span class="string">&#x27;submit-button&#x27;</span>]&#125; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：驼峰命名（推荐）</span></span><br><span class="line"><span class="comment">/* 改为 .submitButton */</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;styles.submitButton&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>Q3: 如何在 CSS Modules 中使用伪类和伪元素？</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Button.module.css */</span></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 伪类 */</span></span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">:disabled</span> &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 伪元素 */</span></span><br><span class="line"><span class="selector-class">.button</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Q4: 如何覆盖第三方组件库样式？</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* App.module.css */</span></span><br><span class="line"><span class="comment">/* 使用 :global 包裹第三方类名 */</span></span><br><span class="line"><span class="selector-class">.customModal</span> :<span class="built_in">global</span>(.ant-modal-content) &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper</span> :global &#123;</span><br><span class="line">  <span class="selector-class">.mui-button</span> &#123;</span><br><span class="line">    <span class="attribute">text-transform</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./App.module.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Modal</span> &#125; <span class="keyword">from</span> <span class="string">&quot;antd&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.customModal&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Modal</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="14）CSS-Modules-vs-其他方案对比"><a href="#14）CSS-Modules-vs-其他方案对比" class="headerlink" title="14）CSS Modules vs 其他方案对比"></a><strong><font color='#10c300'>14）CSS Modules vs 其他方案对比</font></strong></h4><table><thead><tr><th align="left">方案</th><th align="left">优势</th><th align="left">劣势</th><th align="left">适用场景</th></tr></thead><tbody><tr><td align="left"><strong>CSS Modules</strong></td><td align="left">自动作用域、零运行时、学习成本低</td><td align="left">动态样式支持弱、需要构建工具</td><td align="left">中小型项目、组件库</td></tr><tr><td align="left"><strong>CSS-in-JS</strong> (styled-components)</td><td align="left">动态样式强大、主题支持好</td><td align="left">运行时开销、调试困难</td><td align="left">需要大量动态样式的应用</td></tr><tr><td align="left"><strong>Tailwind CSS</strong></td><td align="left">快速开发、设计系统一致性</td><td align="left">HTML 类名冗长、需要学习类名</td><td align="left">追求开发效率的项目</td></tr><tr><td align="left"><strong>普通 CSS</strong></td><td align="left">简单直接</td><td align="left">全局污染、命名冲突</td><td align="left">简单页面、原型开发</td></tr><tr><td align="left"><strong>Sass&#x2F;Less Modules</strong></td><td align="left">变量、嵌套、函数</td><td align="left">需要编译、学习成本</td><td align="left">复杂样式逻辑</td></tr></tbody></table><h4 id="15）高级技巧"><a href="#15）高级技巧" class="headerlink" title="15）高级技巧"></a><strong><font color='#10c300'>15）高级技巧</font></strong></h4><p><strong>1️⃣条件渲染复杂样式</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Status.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">StatusBadge</span>(<span class="params">&#123; status &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> statusClass = &#123;</span><br><span class="line">    <span class="attr">pending</span>: styles.<span class="property">pending</span>,</span><br><span class="line">    <span class="attr">success</span>: styles.<span class="property">success</span>,</span><br><span class="line">    <span class="attr">error</span>: styles.<span class="property">error</span>,</span><br><span class="line">    <span class="attr">warning</span>: styles.<span class="property">warning</span>,</span><br><span class="line">  &#125;[status];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">styles.badge</span>&#125; $&#123;<span class="attr">statusClass</span>&#125;`&#125;&gt;</span>&#123;status&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2️⃣动画与过渡</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Animation.module.css */</span></span><br><span class="line"><span class="keyword">@keyframes</span> fadeIn &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">10px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fadeInElement</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: fadeIn <span class="number">0.3s</span> ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.transition</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.3s</span> <span class="built_in">cubic-bezier</span>(<span class="number">0.4</span>, <span class="number">0</span>, <span class="number">0.2</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3️⃣响应式设计</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Card.module.css */</span></span><br><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.card</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">1024px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.card</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">33.333%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4️⃣条件样式的性能优化</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./List.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ListItem</span>(<span class="params">&#123; item, isActive, isSelected &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 缓存类名计算结果</span></span><br><span class="line">  <span class="keyword">const</span> className = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      <span class="title function_">classNames</span>(styles.<span class="property">item</span>, &#123;</span><br><span class="line">        [styles.<span class="property">active</span>]: isActive,</span><br><span class="line">        [styles.<span class="property">selected</span>]: isSelected,</span><br><span class="line">      &#125;),</span><br><span class="line">    [isActive, isSelected]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="16）常见陷阱-⚠️"><a href="#16）常见陷阱-⚠️" class="headerlink" title="16）常见陷阱 ⚠️"></a><strong><font color='#10c300'>16）常见陷阱 ⚠️</font></strong></h4><p><strong>1️⃣忘记使用 .module.css 后缀</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：没有 .module 后缀，会被当作普通 CSS</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Button.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Button.module.css&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>2️⃣直接修改 styles 对象</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：styles 是只读的</span></span><br><span class="line">styles.<span class="property">button</span> = <span class="string">&quot;new-class&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：通过字符串拼接</span></span><br><span class="line"><span class="keyword">const</span> className = <span class="string">`<span class="subst">$&#123;styles.button&#125;</span> <span class="subst">$&#123;styles.active&#125;</span>`</span>;</span><br></pre></td></tr></table></figure><p><strong>3️⃣在全局样式中使用模块类名</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ❌ 错误：global.css（全局样式文件） */</span></span><br><span class="line"><span class="selector-class">.Button_button__2Rx3L</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red; <span class="comment">/* 哈希值会变，无法定位 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ✅ 正确：使用语义化的全局类或 data 属性 */</span></span><br><span class="line"><span class="selector-attr">[data-component=<span class="string">&quot;button&quot;</span>]</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件中添加 data 属性</span></span><br><span class="line">&lt;button className=&#123;styles.<span class="property">button</span>&#125; data-component=<span class="string">&quot;button&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p><strong>4️⃣在 CSS Modules 中引用图片路径问题</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ❌ 可能失效 */</span></span><br><span class="line"><span class="selector-class">.background</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">./images/bg.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ✅ 使用别名或绝对路径 */</span></span><br><span class="line"><span class="selector-class">.background</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">@/assets/images/bg.png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或在组件中使用：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Hero.module.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> bgImage <span class="keyword">from</span> <span class="string">&quot;./images/bg.png&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Hero</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&#123;styles.hero&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundImage:</span> `<span class="attr">url</span>($&#123;<span class="attr">bgImage</span>&#125;)` &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      内容</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="17）调试技巧"><a href="#17）调试技巧" class="headerlink" title="17）调试技巧"></a><strong><font color='#10c300'>17）调试技巧</font></strong></h4><p><strong>1️⃣查看编译后的类名</strong></p><p>在浏览器开发者工具中检查元素，可以看到实际的类名：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;Button_button__2Rx3L Button_primary__3kM9x&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2️⃣在开发环境使用可读的类名</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">      <span class="attr">generateScopedName</span>: </span><br><span class="line">        process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span></span><br><span class="line">          ? <span class="string">&quot;[hash:base64:8]&quot;</span>  <span class="comment">// 生产：短哈希</span></span><br><span class="line">          : <span class="string">&quot;[name]__[local]___[hash:base64:5]&quot;</span>, <span class="comment">// 开发：可读</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>3️⃣使用 console.log 查看 styles 对象</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./Button.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(styles);</span><br><span class="line"><span class="comment">// 输出: &#123; button: &quot;Button_button__2Rx3L&quot;, primary: &quot;Button_primary__3kM9x&quot; &#125;</span></span><br></pre></td></tr></table></figure><h4 id="18）性能优化建议"><a href="#18）性能优化建议" class="headerlink" title="18）性能优化建议"></a><strong><font color='#10c300'>18）性能优化建议</font></strong></h4><ol><li><p><strong>按需导入</strong>：如果只需要少数几个类名，可以使用解构</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; button, primary &#125; <span class="keyword">from</span> <span class="string">&quot;./Button.module.css&quot;</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>避免在循环中动态计算类名</strong>：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 每次渲染都计算</span></span><br><span class="line">&#123;items.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;item.active</span> ? <span class="attr">styles.active</span> <span class="attr">:</span> <span class="attr">styles.inactive</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">))&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// ✅ 预先计算或使用 useMemo</span></span><br><span class="line"><span class="language-xml">const getItemClass = useCallback((active) =&gt; </span></span><br><span class="line"><span class="language-xml">  active ? styles.active : styles.inactive, </span></span><br><span class="line"><span class="language-xml">[]);</span></span><br></pre></td></tr></table></figure></li><li><p><strong>生产环境压缩类名</strong>：确保构建工具生成短哈希以减小 HTML 体积</p></li></ol><hr><br><h2 id="四、-React-Hooks-详解"><a href="#四、-React-Hooks-详解" class="headerlink" title="四、 React Hooks 详解"></a><strong>四、 React Hooks 详解</strong></h2><p>Hooks 是 React 16.8 引入的特性，让你在函数组件中使用状态和其他 React 特性。</p><h3 id="4-1-useState-状态管理"><a href="#4-1-useState-状态管理" class="headerlink" title="4.1 useState - 状态管理"></a><strong><font color='red'>4.1 useState - 状态管理</font></strong></h3><p><code>useState</code> 是一个 React Hook，用于在函数组件中声明和管理<strong>状态（state）</strong>（ 一定要在**<code>组件顶层</code>**调用）</p><hr><h4 id="1）基本语法"><a href="#1）基本语法" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initialValue);</span><br></pre></td></tr></table></figure><ul><li>initialArg：定义的初始值，可以是任意数据，像数字，字符串或者数组和对象。</li><li>useState ()方法的返回值为由两个值组成的数组<ol><li><code>state</code>：当前状态值：在首次渲染时，它将与你传递的 <code>initialArg</code> 相匹配。</li><li><code>setState</code>：更新状态的函数：它可以让你将 state 更新为不同的值并触发重新渲染。</li></ol></li></ul><h4 id="2）基本用法"><a href="#2）基本用法" class="headerlink" title="2）基本用法"></a><strong><font color='#10c300'>2）基本用法</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;点击了 &#123;count&#125; 次<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br></pre></td></tr></table></figure><h4 id="3）核心特性详解"><a href="#3）核心特性详解" class="headerlink" title="3）核心特性详解"></a><strong><font color='#10c300'>3）核心特性详解</font></strong></h4><p><strong>1️⃣ 状态是隔离的</strong></p><p>每个组件实例拥有独立的状态，互不影响。</p><hr><p><strong>2️⃣ 状态更新是替换而非合并</strong></p><p>与 class 组件的 <code>setState</code> 不同，<code>useState</code> 不会自动合并对象：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 错误：这会丢失 age 字段</span></span><br><span class="line"><span class="title function_">setUser</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：需要手动展开</span></span><br><span class="line"><span class="title function_">setUser</span>(&#123; ...user, <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span> &#125;);</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣ 函数式更新（解决闭包问题）</strong></p><p>当新状态依赖旧状态时，使用函数形式避免闭包陷阱：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">incrementTwice</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ❌ 问题：两次都基于 count=0，结果还是 1</span></span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ✅ 正确：基于最新状态更新</span></span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function">(<span class="params">prev</span>) =&gt;</span> prev + <span class="number">1</span>);</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function">(<span class="params">prev</span>) =&gt;</span> prev + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;incrementTwice&#125;</span>&gt;</span>+2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>4️⃣惰性初始化</strong></p><p>如果初始状态需要复杂计算，使用函数避免每次渲染都执行：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 每次渲染都会执行 heavyComputation()</span></span><br><span class="line"><span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="title function_">heavyComputation</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 只在初始渲染执行一次，因为初始化的时候函数都会创建新的引用地址</span></span><br><span class="line"><span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> <span class="title function_">heavyComputation</span>());</span><br></pre></td></tr></table></figure><hr><p><strong>5️⃣数组&#x2F;对象更新技巧</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [list, setList] = <span class="title function_">useState</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="keyword">const</span> [map, setMap] = <span class="title function_">useState</span>(<span class="keyword">new</span> <span class="title class_">Map</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组操作</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">addItem</span> = (<span class="params">item</span>) =&gt; <span class="title function_">setList</span>([...list, item]);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">removeItem</span> = (<span class="params">index</span>) =&gt; <span class="title function_">setList</span>(list.<span class="title function_">filter</span>(<span class="function">(<span class="params">_, i</span>) =&gt;</span> i !== index));</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">updateItem</span> = (<span class="params">index, value</span>) =&gt;</span><br><span class="line">  <span class="title function_">setList</span>(list.<span class="title function_">map</span>(<span class="function">(<span class="params">item, i</span>) =&gt;</span> (i === index ? value : item)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Map/Set 操作（需要新引用才会触发更新）</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">addToMap</span> = (<span class="params">k, v</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> newMap = <span class="keyword">new</span> <span class="title class_">Map</span>(map);</span><br><span class="line">  newMap.<span class="title function_">set</span>(k, v);</span><br><span class="line">  <span class="title function_">setMap</span>(newMap);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="4）TypeScript-支持"><a href="#4）TypeScript-支持" class="headerlink" title="4）TypeScript 支持"></a><strong><font color='#10c300'>4）TypeScript 支持</font></strong></h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础类型推断</span></span><br><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>); <span class="comment">// number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 联合类型</span></span><br><span class="line"><span class="keyword">const</span> [status, setStatus] = useState&lt;<span class="string">&quot;idle&quot;</span> | <span class="string">&quot;loading&quot;</span> | <span class="string">&quot;success&quot;</span>&gt;(<span class="string">&quot;idle&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [user, setUser] = useState&lt;<span class="title class_">User</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果初始值为 undefined，需要显式指定类型</span></span><br><span class="line"><span class="keyword">const</span> [value, setValue] = useState&lt;<span class="built_in">string</span>&gt;();</span><br></pre></td></tr></table></figure><h4 id="5）常见陷阱与解决方案⚠️"><a href="#5）常见陷阱与解决方案⚠️" class="headerlink" title="5）常见陷阱与解决方案⚠️"></a><strong><font color='#10c300'>5）常见陷阱与解决方案⚠️</font></strong></h4><p><strong>陷阱 1️⃣：闭包过期</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// 永远是旧值</span></span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>); <span class="comment">// 永远基于初始值</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;, []); <span class="comment">// 空依赖导致闭包陷阱</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决：使用函数式更新或正确设置依赖</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c + <span class="number">1</span>); <span class="comment">// 总是获取最新值</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><hr><p><strong>陷阱 2️⃣：异步更新特性</strong></p><p>状态更新是异步且批处理的，不能立即获取新值：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// 还是旧值！</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如需基于新值操作，使用 useEffect 或函数式更新</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><p><strong>陷阱 3️⃣：对象引用不变不触发更新</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [items, setItems] = <span class="title function_">useState</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">wrongUpdate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  items.<span class="title function_">push</span>(<span class="number">4</span>); <span class="comment">// 修改原数组</span></span><br><span class="line">  <span class="title function_">setItems</span>(items); <span class="comment">// 引用相同，React 不重新渲染</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">correctUpdate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">setItems</span>([...items, <span class="number">4</span>]); <span class="comment">// 新数组引用</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="6）最佳实践"><a href="#6）最佳实践" class="headerlink" title="6）最佳实践"></a><strong><font color='#10c300'>6）最佳实践</font></strong></h4><p><strong>1️⃣ 合理拆分状态：</strong> 不要把所有状态塞在一个对象里，独立变化的状态应该独立声明</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 过度聚合</span></span><br><span class="line"><span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(&#123; <span class="attr">user</span>: <span class="literal">null</span>, <span class="attr">posts</span>: [], <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 独立声明</span></span><br><span class="line"><span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> [posts, setPosts] = <span class="title function_">useState</span>([]);</span><br><span class="line"><span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣ 使用自定义 Hook 封装状态逻辑</strong>：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useCounter</span>(<span class="params">initial = <span class="number">0</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(initial);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">inc</span> = (<span class="params"></span>) =&gt; <span class="title function_">setCount</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">dec</span> = (<span class="params"></span>) =&gt; <span class="title function_">setCount</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c - <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; <span class="title function_">setCount</span>(initial);</span><br><span class="line">  <span class="keyword">return</span> &#123; count, inc, dec, reset &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣ 避免深层嵌套状态</strong>：复杂状态考虑使用 <code>useReducer</code></p><p><code>useState</code> 适用于简单状态管理，当状态逻辑复杂或多个状态相互关联时，考虑升级到 <code>useReducer</code>。</p><br><h3 id="4-2-useEffect-副作用处理"><a href="#4-2-useEffect-副作用处理" class="headerlink" title="4.2 useEffect-副作用处理"></a><strong><font color='red'>4.2 useEffect-副作用处理</font></strong></h3><p>它让函数组件能够在<strong>渲染后执行副作用操作（side effects）</strong>，比如：网络请求、DOM 操作、事件监听、定时器、数据订阅等。</p><p>函数组件里没有生命周期方法（像类组件的 <code>componentDidMount</code>、<code>componentWillUnmount</code>）；React 提供 <code>useEffect</code> 来替代它们。</p><hr><h4 id="1）基本语法-1"><a href="#1）基本语法-1" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行副作用逻辑</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 清理副作用逻辑（可选）</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, [dependencies]);</span><br></pre></td></tr></table></figure><ul><li>**参数1 (函数)：**定义的初始值，可以是任意数据，像数字，字符串或者数组和对象。</li><li><strong>参数2 (依赖项)：</strong><ol><li><code>无参数</code>：每次渲染后都执行。</li><li><code>空数组</code>：仅在挂载时执行一次。</li><li><code>依赖参数</code>：依赖参数变化时执行（首次渲染也会执行一次）。</li></ol></li></ul><h4 id="2）三种执行时机"><a href="#2）三种执行时机" class="headerlink" title="2）三种执行时机"></a><strong><font color='#10c300'>2）三种执行时机</font></strong></h4><p><strong>1️⃣ 不带依赖 → 每次渲染都执行</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;每次渲染都执行&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>不写依赖数组时，意味着：</p><ul><li>每次组件<strong>挂载和更新</strong>都会运行。<br>⚠️ 如无必要，不建议省略依赖数组，会影响性能。</li></ul><hr><p><strong>2️⃣ 组件挂载时执行（只执行一次）</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;组件挂载&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;组件卸载&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []); <span class="comment">// 空依赖数组 → 只执行一次</span></span><br></pre></td></tr></table></figure><p>可类比于：</p><ul><li>挂载时执行：<code>componentDidMount</code></li><li>卸载时清理：<code>componentWillUnmount</code></li></ul><hr><p><strong>3️⃣ 特定依赖变化时执行</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`count 更新了：<span class="subst">$&#123;count&#125;</span>`</span>);</span><br><span class="line">&#125;, [count]); <span class="comment">// 👈 当 count 改变重新运行副作用逻辑</span></span><br></pre></td></tr></table></figure><h4 id="3）清理函数（Cleanup）"><a href="#3）清理函数（Cleanup）" class="headerlink" title="3）清理函数（Cleanup）"></a><strong><font color='#10c300'>3）清理函数（Cleanup）</font></strong></h4><p>当**<code>取消订阅</code><strong>、</strong><code>清除定时器</code>**等，应该在组件卸载时清理，以防止内存泄漏。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;tick&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清理函数：组件卸载或依赖变化前执行</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;定时器已清理&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><strong>🔍执行时机</strong>：</p><ul><li>组件卸载时</li><li>依赖变化导致重新执行 effect 之前</li></ul><h4 id="4）实际应用场景"><a href="#4）实际应用场景" class="headerlink" title="4）实际应用场景"></a><strong><font color='#10c300'>4）实际应用场景</font></strong></h4><p><strong>1️⃣ 数据获取（需处理竞态）</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> cancelled = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> api.<span class="title function_">getUser</span>(userId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 防止竞态条件：如果组件已卸载或 userId 已变，忽略结果</span></span><br><span class="line">    <span class="keyword">if</span> (!cancelled) &#123;</span><br><span class="line">      <span class="title function_">setUser</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">fetchData</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cancelled = <span class="literal">true</span>; <span class="comment">// 取消标志</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, [userId]);</span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣事件监听</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleScroll</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setScrollY</span>(<span class="variable language_">window</span>.<span class="property">scrollY</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;scroll&quot;</span>, handleScroll);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 必须清理，否则重复挂载会添加多个监听器</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;scroll&quot;</span>, handleScroll);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣DOM 操作</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 直接操作 DOM（应尽量避免，但在与第三方库集成时有用）</span></span><br><span class="line">  <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;modal&quot;</span>);</span><br><span class="line">  element?.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;active&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    element?.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;active&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><h4 id="5）常见陷阱⚠️"><a href="#5）常见陷阱⚠️" class="headerlink" title="5）常见陷阱⚠️"></a><strong><font color='#10c300'>5）常见陷阱⚠️</font></strong></h4><p><strong>1️⃣无限循环</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：setState 导致渲染，渲染触发 effect，effect 又 setState</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">&#125;, [count]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：使用函数式更新或条件判断</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">setCount</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c + <span class="number">1</span>), <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">&#125;, []); <span class="comment">// 或 [count] 如果需要响应外部 count 变化</span></span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣依赖缺失（ ESLint 会警告）</strong></p><p><code>eslint-plugin-react-hooks</code> 自动检查依赖。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 遗漏依赖：callback 变化时 effect 不会更新</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fetchData</span>(query, callback);</span><br><span class="line">&#125;, [query]); <span class="comment">// 缺少 callback</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案 1：添加所有依赖</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fetchData</span>(query, callback);</span><br><span class="line">&#125;, [query, callback]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案 2：如果 callback 不稳定，使用 ref</span></span><br><span class="line"><span class="keyword">const</span> callbackRef = <span class="title function_">useRef</span>(callback);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  callbackRef.<span class="property">current</span> = callback;</span><br><span class="line">&#125;, [callback]);</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fetchData</span>(query, <span class="function">(<span class="params">data</span>) =&gt;</span> callbackRef.<span class="title function_">current</span>(data));</span><br><span class="line">&#125;, [query]);</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣闭包陷阱（stale closure）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// 永远是旧值！</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;, []); <span class="comment">// 空依赖导致闭包捕获初始 count</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案 1：添加依赖</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(count);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;, [count]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决方案 2：使用 ref 获取最新值</span></span><br><span class="line"><span class="keyword">const</span> countRef = <span class="title function_">useRef</span>(count);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  countRef.<span class="property">current</span> = count;</span><br><span class="line">&#125;, [count]);</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(countRef.<span class="property">current</span>); <span class="comment">// 总是最新值</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><hr><p><strong>4️⃣async&#x2F;await 直接使用</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：useEffect 不能返回 Promise（async 函数隐式返回 Promise）</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetchData</span>();</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：内部定义 async 函数</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetchData</span>();</span><br><span class="line">    <span class="title function_">setData</span>(data);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">loadData</span>();</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><h4 id="6）useEffect-vs-useLayoutEffect"><a href="#6）useEffect-vs-useLayoutEffect" class="headerlink" title="6）useEffect vs useLayoutEffect"></a><strong><font color='#10c300'>6）useEffect vs useLayoutEffect</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useLayoutEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// useEffect：浏览器绘制完成后执行（不阻塞渲染）</span></span><br><span class="line"><span class="comment">// useLayoutEffect：浏览器绘制之前执行（阻塞渲染，避免闪烁）</span></span><br><span class="line"><span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 用于需要同步执行且影响视觉的 DOM 操作</span></span><br><span class="line">  <span class="keyword">const</span> width = element.<span class="title function_">getBoundingClientRect</span>().<span class="property">width</span>;</span><br><span class="line">  <span class="title function_">setWidth</span>(width);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><strong>使用建议</strong>：</p><ul><li>优先使用 <code>useEffect</code></li><li>仅在出现视觉闪烁（如从服务端渲染恢复时需要同步计算布局）时使用 <code>useLayoutEffect</code></li></ul><h4 id="7）TypeScript-支持"><a href="#7）TypeScript-支持" class="headerlink" title="7）TypeScript 支持"></a><strong><font color='#10c300'>7）TypeScript 支持</font></strong></h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清理函数类型会自动推断</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> subscription = api.<span class="title function_">subscribe</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    subscription.<span class="title function_">unsubscribe</span>(); <span class="comment">// 类型安全</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 依赖数组严格类型检查</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">&#125;, [name]); <span class="comment">// name 必须是依赖项</span></span><br></pre></td></tr></table></figure><h4 id="8）最佳实践"><a href="#8）最佳实践" class="headerlink" title="8）最佳实践"></a><strong><font color='#10c300'>8）最佳实践</font></strong></h4><p>1️⃣<strong>单一职责</strong>：一个 <code>useEffect</code> 只做一件事，便于管理和清理</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 混合多个不相关逻辑</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fetchUser</span>();</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(poll, <span class="number">5000</span>);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">&quot;New Page&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 分离成多个 effect</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fetchUser</span>();</span><br><span class="line">&#125;, []);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(poll, <span class="number">5000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">&#125;, []);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">&quot;New Page&quot;</span>;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><hr><p>2️⃣<strong>自定义 Hook 封装副作用</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useWindowSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [size, setSize] = <span class="title function_">useState</span>(&#123; <span class="attr">width</span>: <span class="number">0</span>, <span class="attr">height</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">update</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">      <span class="title function_">setSize</span>(&#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="variable language_">window</span>.<span class="property">innerHeight</span>,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, update);</span><br><span class="line">    <span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;resize&quot;</span>, update);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>3️⃣<strong>对象&#x2F;数组依赖使用 useMemo</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// ❌ 每次渲染都是新对象，导致 effect 每次都执行</span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData(options);</span><br><span class="line">&#125;, [&#123; page: 1, size: 10 &#125;]);</span><br><span class="line"></span><br><span class="line">// ✅ 使用 useMemo 稳定引用</span><br><span class="line">const options = useMemo(() =&gt; (&#123; page: 1, size: 10 &#125;), []);</span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData(options);</span><br><span class="line">&#125;, [options]);</span><br></pre></td></tr></table></figure><br><h3 id="4-3-useContext-跨组件共享状态"><a href="#4-3-useContext-跨组件共享状态" class="headerlink" title="4.3 useContext - 跨组件共享状态"></a><strong><font color='red'>4.3 useContext - 跨组件共享状态</font></strong></h3><p>它主要用于在组件树中<strong>共享数据</strong>，<strong>避免层层传递 props（“props drilling”）的问题</strong>。</p><p>在 React 应用中，如果很多层组件之间都需要共享某个数据（比如主题、语言、用户信息），直接通过 props 一层层往下传会非常麻烦：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">App</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">theme</span>=<span class="string">&#123;theme&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Content</span> <span class="attr">theme</span>=<span class="string">&#123;theme&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">theme</span>=<span class="string">&#123;theme&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">App</span>&gt;</span><br></pre></td></tr></table></figure><p>👆 每层都要传 <code>theme</code>，这就是 <strong>props drilling</strong>。</p><p>React 提供 <strong>Context</strong>，可以让你在组件树间<strong>直接共享数据，不必层层传递</strong>。</p><h4 id="1）基础用法-使用步骤"><a href="#1）基础用法-使用步骤" class="headerlink" title="1）基础用法(使用步骤)"></a><strong><font color='#10c300'>1）基础用法(使用步骤)</font></strong></h4><p><strong>Step 1️⃣：创建 Context</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\context\index.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyContext</span> = <span class="title function_">createContext</span>();</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">MyContext</span> &#125;;</span><br></pre></td></tr></table></figure><p><strong>Step 2️⃣：上层组件提供数据</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;./components/Child&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GrandChild</span> <span class="keyword">from</span> <span class="string">&quot;./components/GrandChild&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./context/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [data] = <span class="title function_">useState</span>(<span class="string">&quot;大鱼海棠&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;data&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是父组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Child</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">GrandChild</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Child</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p><strong>Step 3️⃣：子组件</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是子组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Child</span>;</span><br></pre></td></tr></table></figure><p><strong>Step 4️⃣：孙组件使用 <code>useContext</code> 获取值</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useContext&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../context/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">GrandChild</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 这是app.jsx中传来的数据</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="title function_">useContext</span>(<span class="title class_">MyContext</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是孙组件，红色部分是顶级组件数据：<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> &#x27;<span class="attr">red</span>&#x27;&#125;&#125;&gt;</span>&#123;data&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> defau lt <span class="title class_">GrandChild</span></span><br></pre></td></tr></table></figure><h4 id="2）自定义-Hook-封装（推荐）"><a href="#2）自定义-Hook-封装（推荐）" class="headerlink" title="2）自定义 Hook 封装（推荐）"></a><strong><font color='#10c300'>2）自定义 Hook 封装（推荐）</font></strong></h4><p>直接 <code>useContext</code> 需要在每个组件处理 <code>null</code>，封装更安全：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// contexts/ThemeContext.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createContext, useState, useContext, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 Hook，内置错误处理</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useTheme</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">if</span> (!context) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;useTheme 必须在 ThemeProvider 内部使用&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ThemeProvider</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = <span class="title function_">useState</span>(<span class="string">&quot;light&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 useMemo 防止不必要的重渲染</span></span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      theme,</span><br><span class="line">      setTheme,</span><br><span class="line">      <span class="attr">toggle</span>: <span class="function">() =&gt;</span> <span class="title function_">setTheme</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> (t === <span class="string">&quot;light&quot;</span> ? <span class="string">&quot;dark&quot;</span> : <span class="string">&quot;light&quot;</span>)),</span><br><span class="line">    &#125;),</span><br><span class="line">    [theme],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.vue 使用：</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ThemeProvider</span>, useTheme &#125; <span class="keyword">from</span> <span class="string">&quot;./contexts/ThemeContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; theme, toggle &#125; = <span class="title function_">useTheme</span>(); <span class="comment">// 直接使用，类型安全</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;toggle&#125;</span>&gt;</span>&#123;theme&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3）性能优化（关键）"><a href="#3）性能优化（关键）" class="headerlink" title="3）性能优化（关键）"></a><strong><font color='#10c300'>3）性能优化（关键）</font></strong></h4><p><strong>Context 的问题</strong>：一旦 <code>value</code> 变化，<strong>所有</strong>消费组件都会重渲染，即使只使用了部分数据。</p><p><strong>方案1️⃣：拆分 Context（推荐）</strong></p><p>将高频变化和低频变化分离：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 避免单一 Context 包含所有状态</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppContext</span> = <span class="title function_">createContext</span>(&#123;</span><br><span class="line">  <span class="attr">user</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">theme</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">notifications</span>: [],</span><br><span class="line">  <span class="comment">// ... 所有状态</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 拆分为多个 Context</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NotificationContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件只订阅需要的 Context</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserAvatar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">useContext</span>(<span class="title class_">UserContext</span>); <span class="comment">// 只有 user 变化时重渲染</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;user.avatar&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>方案2️⃣：使用 React.memo</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ExpensiveComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; theme &#125; = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;theme&#125;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 虽然 context 变化，但 props 没变时跳过渲染</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">ExpensiveComponent</span>);</span><br></pre></td></tr></table></figure><hr><p><strong>方案3️⃣：使用第三方状态管理</strong></p><p>如果频繁更新（如滚动位置、动画状态），使用 Zustand、Jotai 或 Redux，它们支持细粒度订阅。</p><p><strong>useContext + useReducer（简易 Redux）</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// contexts/StoreContext.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createContext, useReducer, useContext, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">StoreContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span>, <span class="attr">user</span>: <span class="literal">null</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;setUser&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">user</span>: action.<span class="property">payload</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 Hooks</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useStore</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useContext</span>(<span class="title class_">StoreContext</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123; state, dispatch &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">StoreProvider</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将 state 和 dispatch 都放入 context</span></span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> [state, dispatch], [state]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">StoreContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">StoreContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StoreProvider</span>, useStore &#125; <span class="keyword">from</span> <span class="string">&quot;./contexts/ThemeContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; state, dispatch &#125; = <span class="title function_">useStore</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;increment&quot; &#125;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">StoreProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">StoreProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4）TypeScript-支持-1"><a href="#4）TypeScript-支持-1" class="headerlink" title="4）TypeScript 支持"></a><strong><font color='#10c300'>4）TypeScript 支持</font></strong></h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AuthContextType</span> &#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="title class_">User</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">login</span>: <span class="function">(<span class="params"><span class="attr">user</span>: <span class="title class_">User</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">logout</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">isLoading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AuthContext</span> = createContext&lt;<span class="title class_">AuthContextType</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型安全的自定义 Hook</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useAuth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">AuthContext</span>);</span><br><span class="line">  <span class="keyword">if</span> (!context) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;useAuth must be used within AuthProvider&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Provider 组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">AuthProvider</span>(<span class="params">&#123; children &#125;: &#123; children: React.ReactNode &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = useState&lt;<span class="title class_">User</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [isLoading, setIsLoading] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      user,</span><br><span class="line">      isLoading,</span><br><span class="line">      <span class="attr">login</span>: <span class="function">(<span class="params"><span class="attr">u</span>: <span class="title class_">User</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setUser</span>(u);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">logout</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setUser</span>(<span class="literal">null</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    [user, isLoading],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">AuthContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">AuthContext.Provider</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5）常见陷阱⚠️-1"><a href="#5）常见陷阱⚠️-1" class="headerlink" title="5）常见陷阱⚠️"></a><strong><font color='#10c300'>5）常见陷阱⚠️</font></strong></h4><p><strong>1️⃣Context 默认值陷阱</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果不提供 Provider，会使用默认值</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyContext</span> = <span class="title function_">createContext</span>(&#123; <span class="attr">value</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = <span class="title function_">useContext</span>(<span class="title class_">MyContext</span>);</span><br><span class="line">  <span class="comment">// 如果忘记包裹 Provider，ctx 是 &#123; value: 0 &#125;</span></span><br><span class="line">  <span class="comment">// 这可能隐藏错误，建议默认值设为 null 并检查</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣不必要的重渲染</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ❌ 每次渲染都是新对象，导致所有消费者重渲染</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">theme:</span> &quot;<span class="attr">dark</span>&quot;, <span class="attr">count</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 使用 useMemo 缓存</span></span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> (&#123; <span class="attr">theme</span>: <span class="string">&quot;dark&quot;</span>, count &#125;), [count]);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣在条件语句中使用</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="title function_">useContext</span>(<span class="title class_">MyContext</span>); <span class="comment">// ❌ Hook 必须在顶层调用</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ✅ 始终在组件顶层调用</span></span><br><span class="line">  <span class="keyword">const</span> ctx = <span class="title function_">useContext</span>(<span class="title class_">MyContext</span>);</span><br><span class="line">  <span class="keyword">if</span> (!ctx) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6）何时使用-vs-不用"><a href="#6）何时使用-vs-不用" class="headerlink" title="6）何时使用 vs 不用"></a><strong><font color='#10c300'>6）何时使用 vs 不用</font></strong></h4><p><strong>1️⃣适合使用：</strong></p><ul><li>主题、语言等全局配置</li><li>认证状态（用户登录信息）</li><li>路由状态</li><li>需要在深层组件访问的共享状态</li></ul><p><strong>2️⃣避免使用：</strong></p><ul><li>仅父子组件通信（直接用 props）</li><li>频繁更新的状态（如滚动、输入、动画，考虑使用订阅模式或外部状态管理）</li><li>简单表单状态（用本地 useState）</li></ul><p><strong>替代方案👇</strong></p><ul><li>简单共享：props drilling、组合组件（composition）</li><li>高频更新：Zustand、Jotai、Recoil、Redux</li><li>服务端状态：React Query、SWR</li></ul><h4 id="7）高级模式：Render-Props-转-Context"><a href="#7）高级模式：Render-Props-转-Context" class="headerlink" title="7）高级模式：Render Props 转 Context"></a><strong><font color='#10c300'>7）高级模式：Render Props 转 Context</font></strong></h4><p>将旧版 Render Props 组件转为 Hook：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 旧方式</span></span><br><span class="line">&lt;<span class="title class_">MouseTracker</span>&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">&#123; x, y &#125;</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;x&#125;, &#123;y&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/<span class="title class_">MouseTracker</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新方式：结合 Context 和 Hook</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MouseContext</span> = <span class="title function_">createContext</span>(&#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useMouse</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useContext</span>(<span class="title class_">MouseContext</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; x, y &#125; = <span class="title function_">useMouse</span>(); <span class="comment">// 更简洁的 API</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;x&#125;, &#123;y&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="4-4-useMemo-缓存计算结果"><a href="#4-4-useMemo-缓存计算结果" class="headerlink" title="4.4 useMemo- 缓存计算结果"></a><strong><font color='red'>4.4 useMemo- 缓存计算结果</font></strong></h3><p><code>useMemo</code> 用于缓存昂贵的计算结果，避免每次渲染都重新计算，同时保持<strong>对象&#x2F;数组的引用</strong>稳定。</p><p>换句话说：</p><ul><li>如果依赖没变 → 直接用上次计算的结果；</li><li>如果依赖变了 → 重新计算并返回新结果。</li></ul><p>它可以帮你显著减少不必要的计算或对象重建。</p><p><code>useMemo</code>的理念是同步的，<strong>useMemo不能进行一些额外的副操作，比如网络请求等</strong>。</p><hr><h4 id="1）基本语法-2"><a href="#1）基本语法-2" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> 值;</span><br><span class="line">&#125;, [依赖项]);</span><br></pre></td></tr></table></figure><ul><li>参数1 (工厂函数)：一个返回值的函数（执行计算）</li><li>参数2 (依赖数组)：依赖数组，当其中某项改变时才重新计算</li></ul><p>返回值：<strong>缓存的计算结果</strong>。</p><h4 id="2）使用场景示例"><a href="#2）使用场景示例" class="headerlink" title="2）使用场景示例"></a><strong><font color='#10c300'>2）使用场景示例</font></strong></h4><p><strong>1️⃣ 复杂计算缓存</strong></p><p>未使用<code>useMemo</code>的时候改变颜色，也会执行ComputeTotal价格的计算。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ComputeTotal</span>(<span class="params">price, count</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;函数运行了&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> price * count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [price, setPrice] = <span class="title function_">useState</span>(<span class="number">100</span>);</span><br><span class="line">  <span class="keyword">const</span> [count] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> [color, setColor] = <span class="title function_">useState</span>(<span class="string">&quot;red&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 👉 只有 price 变化时，才重新计算</span></span><br><span class="line">  <span class="keyword">const</span> totalPrice = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title class_">ComputeTotal</span>(price, count), [price]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>总价：&#123;totalPrice&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;color&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setColor(&quot;blue&quot;)&#125;&gt;修改颜色<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setPrice(price + 100)&#125;&gt;修改价格<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p>✅ 当你改变颜色的时候，不会重新执行ComputeTotal。只有price变化时才会重新计算。</p><hr><p><strong>2️⃣ 保持引用稳定，避免重渲染（关键用途）</strong></p><p><strong>示例一：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ChartComponent</span>(<span class="params">&#123; data, options &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ❌ 每次渲染都是新对象，导致 useEffect 无限循环或 Chart 组件重渲染</span></span><br><span class="line">  <span class="keyword">const</span> config = &#123; <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>, data, ...options &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 依赖不变时保持同一引用</span></span><br><span class="line">  <span class="keyword">const</span> config = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">responsive</span>: <span class="literal">true</span>,</span><br><span class="line">        ...options,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    [data, options],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 现在只在 config 真正变化时执行</span></span><br><span class="line">    chartRef.<span class="property">current</span>.<span class="title function_">update</span>(config);</span><br><span class="line">  &#125;, [config]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">ref</span>=<span class="string">&#123;canvasRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>示例二：</strong></p><p>例如子组件使用 <code>React.memo</code>：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">&#123; options &#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child render&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;options.join(&quot;, &quot;)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MemoChild</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">Child</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 如果不缓存，数组每次渲染都新建，导致 Child 重新渲染</span></span><br><span class="line">  <span class="keyword">const</span> options = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>], []); <span class="comment">// 👈 缓存数组引用</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">MemoChild</span> <span class="attr">options</span>=<span class="string">&#123;options&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Parent</span>;</span><br></pre></td></tr></table></figure><p><code>useMemo</code> 保证每次渲染中 <code>options</code> 的引用稳定，<code>React.memo</code> 会认为 props 没变，从而跳过重新渲染。</p><hr><p><strong>3️⃣ 缓存组件(极少用)</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [price, setPrice] = <span class="title function_">useState</span>(<span class="number">100</span>);</span><br><span class="line">  <span class="keyword">const</span> [count] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> [color, setColor] = <span class="title function_">useState</span>(<span class="string">&quot;red&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> memoizedChild = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">count</span>=<span class="string">&#123;count&#125;</span> <span class="attr">price</span>=<span class="string">&#123;price&#125;</span> /&gt;</span></span>,</span><br><span class="line">    [count, price],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;color&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setColor(&quot;blue&quot;)&#125;&gt;修改颜色<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setPrice(price + 100)&#125;&gt;修改价格<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 使用组件 */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;memoizedChild&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><h4 id="3）与-useCallback-的关系"><a href="#3）与-useCallback-的关系" class="headerlink" title="3）与 useCallback 的关系"></a><strong><font color='#10c300'>3）与 useCallback 的关系</font></strong></h4><p><code>useCallback</code> 本质上是 <code>useMemo</code> 的语法糖：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这两者是等价的</span></span><br><span class="line"><span class="title function_">useCallback</span>(fn, deps);</span><br><span class="line"><span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> fn, deps);</span><br></pre></td></tr></table></figure><p><strong>选择原则</strong>：</p><ul><li>缓存<strong>函数</strong> → <code>useCallback</code></li><li>缓存<strong>值</strong>（对象、数组、计算结果）→ <code>useMemo</code></li></ul><h4 id="4）实际示例：搜索过滤"><a href="#4）实际示例：搜索过滤" class="headerlink" title="4）实际示例：搜索过滤"></a><strong><font color='#10c300'>4）实际示例：搜索过滤</font></strong></h4><p>**完整案例：**<a href="https://www.yuque.com/zhbiao/qr34us/qk5da4gmpqzhat4s?singleDoc#wkQxl">https://www.yuque.com/zhbiao/qr34us/qk5da4gmpqzhat4s?singleDoc#wkQxl</a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SearchResults</span>(<span class="params">&#123; query, items &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [highlightIndex, setHighlightIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 搜索结果缓存</span></span><br><span class="line">  <span class="keyword">const</span> results = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!query) <span class="keyword">return</span> [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> startTime = performance.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">const</span> filtered = items.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span></span><br><span class="line">      item.<span class="property">text</span>.<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(query.<span class="title function_">toLowerCase</span>()),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`搜索耗时: <span class="subst">$&#123;performance.now() - startTime&#125;</span>ms`</span>);</span><br><span class="line">    <span class="keyword">return</span> filtered;</span><br><span class="line">  &#125;, [query, items]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 高亮项缓存（基于 results，形成计算链）</span></span><br><span class="line">  <span class="keyword">const</span> highlightedItem = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> results[highlightIndex] || <span class="literal">null</span>;</span><br><span class="line">  &#125;, [results, highlightIndex]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;results.map((item, idx) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">className</span>=<span class="string">&#123;idx</span> === <span class="string">highlightIndex</span> ? &quot;<span class="attr">highlight</span>&quot; <span class="attr">:</span> &quot;&quot;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;item.text&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Preview</span> <span class="attr">data</span>=<span class="string">&#123;highlightedItem&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4）TypeScript-支持-2"><a href="#4）TypeScript-支持-2" class="headerlink" title="4）TypeScript 支持"></a><strong><font color='#10c300'>4）TypeScript 支持</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="attr">id</span>: number;</span><br><span class="line">    <span class="attr">name</span>: string;</span><br><span class="line">    <span class="attr">score</span>: number;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 自动推断返回类型为 number</span></span><br><span class="line">  <span class="keyword">const</span> averageScore = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (users.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> users.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, u</span>) =&gt;</span> sum + u.<span class="property">score</span>, <span class="number">0</span>) / users.<span class="property">length</span>;</span><br><span class="line">  &#125;, [users]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 复杂对象类型</span></span><br><span class="line">  <span class="keyword">const</span> processedData = useMemo&lt;&#123; <span class="attr">labels</span>: string[]; <span class="attr">values</span>: number[] &#125;&gt;(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">labels</span>: data.<span class="title function_">map</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">date</span>),</span><br><span class="line">      <span class="attr">values</span>: data.<span class="title function_">map</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">value</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [data]);</span><br></pre></td></tr></table></figure><h4 id="5）常见陷阱⚠️-2"><a href="#5）常见陷阱⚠️-2" class="headerlink" title="5）常见陷阱⚠️"></a><strong><font color='#10c300'>5）常见陷阱⚠️</font></strong></h4><p><strong>1️⃣过度使用（负优化）</strong></p><p><code>useMemo</code> 本身也有开销（依赖比较、缓存存储），简单计算无需缓存：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 没必要：加法计算比 useMemo 开销更小</span></span><br><span class="line"><span class="keyword">const</span> sum = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> a + b, [a, b]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 直接使用</span></span><br><span class="line"><span class="keyword">const</span> sum = a + b;</span><br></pre></td></tr></table></figure><p><strong>使用时机</strong>：</p><ul><li>计算复杂度 &gt; O(n) 且 n 较大</li><li>需要保持对象引用稳定（用于 props 或依赖数组）</li><li>明确测量到性能瓶颈（React DevTools Profiler）</li></ul><hr><p><strong>2️⃣依赖数组遗漏</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 遗漏 user，导致使用旧的 user 数据</span></span><br><span class="line"><span class="keyword">const</span> fullName = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;user.firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>; <span class="comment">// user 来自外层作用域</span></span><br><span class="line">&#125;, [lastName]); <span class="comment">// 缺少 user</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 完整依赖</span></span><br><span class="line"><span class="keyword">const</span> fullName = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;user.firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>;</span><br><span class="line">&#125;, [user, lastName]);</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣在 useMemo 里执行副作用</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：useMemo 应该纯函数，不执行副作用</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;key&quot;</span>, value); <span class="comment">// 副作用！</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">process</span>(value);</span><br><span class="line">&#125;, [value]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 副作用放在 useEffect</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;key&quot;</span>, value);</span><br><span class="line">&#125;, [value]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">process</span>(value), [value]);</span><br></pre></td></tr></table></figure><hr><p><strong>4️⃣ 返回函数时的混淆</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 这样缓存的是函数的返回值，不是函数本身</span></span><br><span class="line"><span class="keyword">const</span> handler = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;clicked&quot;</span>); <span class="comment">// 返回一个函数</span></span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 如果真要缓存函数，直接用 useCallback</span></span><br><span class="line"><span class="keyword">const</span> handler = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;clicked&quot;</span>);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><h4 id="6）高级模式"><a href="#6）高级模式" class="headerlink" title="6）高级模式"></a><strong><font color='#10c300'>6）高级模式</font></strong></h4><p><strong>1️⃣计算链</strong></p><p><code>useMemo</code> 可以依赖其他 <code>useMemo</code> 的结果，形成计算链：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rawData = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">fetchData</span>(), []);</span><br><span class="line"><span class="keyword">const</span> processedData = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">cleanData</span>(rawData), [rawData]);</span><br><span class="line"><span class="keyword">const</span> statistics = <span class="title function_">useMemo</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">calculateStats</span>(processedData),</span><br><span class="line">  [processedData],</span><br><span class="line">);</span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣条件性缓存</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!enabled) <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 提前返回</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">heavyComputation</span>(data);</span><br><span class="line">&#125;, [enabled, data]);</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣与 useEffect 配合防止无限循环</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userIds = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> users.<span class="title function_">map</span>(<span class="function">(<span class="params">u</span>) =&gt;</span> u.<span class="property">id</span>), [users]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在 userIds 引用稳定，不会导致 effect 每次都执行</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fetchDetails</span>(userIds);</span><br><span class="line">&#125;, [userIds]);</span><br></pre></td></tr></table></figure><br><p>🌟 <strong>一句话总结：</strong></p><p><code>useMemo</code> 用来解决”因为对象引用变化导致的无效重渲染”比解决”重复计算”更常见</p><br><h3 id="4-5-useCallback-缓存函数引用"><a href="#4-5-useCallback-缓存函数引用" class="headerlink" title="4.5 useCallback- 缓存函数引用"></a><strong><font color='red'>4.5 useCallback- 缓存函数引用</font></strong></h3><p>在 React 中，每次组件渲染都会重新执行组件函数体，<strong>里面定义的函数也会被“重新创建”</strong>。<br>如果这些函数作为 props 传给子组件，即使函数逻辑没有变，根据 <strong>引用地址比较</strong>，子组件会认为 props 变了而重新渲染。</p><p><code>useCallback</code> 解决了这个问题：</p><p>✅ **让函数引用在依赖不变时保持稳定（不变）**语义上，<code>useCallback</code> 明确表示”缓存函数”，而 <code>useMemo</code> 用于缓存任意计算值。</p><hr><h4 id="1）基本语法-3"><a href="#1）基本语法-3" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedCallback = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 函数逻辑</span></span><br><span class="line">&#125;, [dependencies]);</span><br></pre></td></tr></table></figure><ul><li><strong>第一个参数</strong>：要缓存的回调函数</li><li><strong>第二个参数</strong>：依赖数组，当依赖中有值变化时，返回的新函数引用会更新</li></ul><h4 id="2）核心使用场景"><a href="#2）核心使用场景" class="headerlink" title="2）核心使用场景"></a><strong><font color='#10c300'>2）核心使用场景</font></strong></h4><p><strong>1️⃣传递给优化后的子组件（最常见）</strong></p><p>配合 <code>React.memo</code> 防止子组件因父组件渲染而重渲染：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useCallback &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">&#123; onClick &#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;子组件渲染了&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>子组件按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MemoChild</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">Child</span>); <span class="comment">// 👈 只有 props 变了才渲染</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 只有 count 变化时才会更新函数引用(子组件渲染)</span></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Clicked:&quot;</span>, count);</span><br><span class="line">  &#125;, [count]); <span class="comment">// 👈 缓存函数引用</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;count +1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;text&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setText(e.target.value)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MemoChild</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p><strong>🔍 分析：</strong></p><ul><li>如果不用 <code>useCallback</code>，每次 App 渲染都会“新建”一个 <code>handleClick</code> 函数引用；</li><li><code>MemoChild</code> 会认为 props (<code>onClick</code>) 改了 → 重新渲染；</li><li>用了 <code>useCallback</code> 后，在依赖不变化时，函数引用保持稳定 → 组件不重渲染。</li></ul><hr><p><strong>2️⃣作为 useEffect 的依赖</strong></p><p>当 <code>useEffect</code> 依赖某个函数时，必须用 <code>useCallback</code> 保持引用稳定</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Search</span>(<span class="params">&#123; query &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [results, setResults] = <span class="title function_">useState</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ❌ 每次渲染都是新函数，导致 effect 每次都要执行</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> api.<span class="title function_">search</span>(query);</span><br><span class="line">    <span class="title function_">setResults</span>(res);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ fetchData 引用稳定，只有 query 变化时才重新触发 effect</span></span><br><span class="line">  <span class="keyword">const</span> fetchData = <span class="title function_">useCallback</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> api.<span class="title function_">search</span>(query);</span><br><span class="line">    <span class="title function_">setResults</span>(res);</span><br><span class="line">  &#125;, [query]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;, [fetchData]); <span class="comment">// 现在可以安全地将函数放入依赖数组</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Results</span> <span class="attr">data</span>=<span class="string">&#123;results&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣自定义 Hook 中返回的回调</strong></p><p>确保 Hook 使用者可以获得稳定的函数引用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useDebounce</span>(<span class="params">callback, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [debouncedCallback] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> <span class="title function_">debounce</span>(callback, delay));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回稳定的函数引用</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useCallback</span>(</span><br><span class="line">    <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">debouncedCallback</span>(...args);</span><br><span class="line">    &#125;,</span><br><span class="line">    [debouncedCallback],</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3）什么时候用-useCallback"><a href="#3）什么时候用-useCallback" class="headerlink" title="3）什么时候用 useCallback"></a><strong><font color='#10c300'>3）什么时候用 useCallback</font></strong></h4><ol><li>函数作为 props 传递给 <code>React.memo</code> 包裹的子组件</li><li>函数作为其他 Hook（<code>useEffect</code>、<code>useMemo</code>）的依赖</li><li>函数是自定义 Hook 的返回值，供外部使用</li></ol><h4 id="4）TypeScript-支持-3"><a href="#4）TypeScript-支持-3" class="headerlink" title="4）TypeScript 支持"></a><strong><font color='#10c300'>4）TypeScript 支持</font></strong></h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础类型推断</span></span><br><span class="line"><span class="keyword">const</span> handleChange = <span class="title function_">useCallback</span>(<span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">React</span>.<span class="title class_">ChangeEvent</span>&lt;<span class="title class_">HTMLInputElement</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setValue</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型约束</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FetchFn</span> = <span class="function">(<span class="params"><span class="attr">id</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="title class_">User</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetchUser = useCallback&lt;<span class="title class_">FetchFn</span>&gt;(<span class="title function_">async</span> (id) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> api.<span class="title function_">getUser</span>(id);</span><br><span class="line">  <span class="keyword">return</span> res.<span class="property">data</span>;</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回元组（常见于自定义 Hook）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useToggle</span>(<span class="params">initial = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initial);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> toggle = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setState</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> !s);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setTrue = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> <span class="title function_">setState</span>(<span class="literal">true</span>), []);</span><br><span class="line">  <span class="keyword">const</span> setFalse = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> <span class="title function_">setState</span>(<span class="literal">false</span>), []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 类型自动推断为 [boolean, () =&gt; void, () =&gt; void, () =&gt; void]</span></span><br><span class="line">  <span class="keyword">return</span> [state, toggle, setTrue, setFalse] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5）高级模式"><a href="#5）高级模式" class="headerlink" title="5）高级模式"></a><strong><font color='#10c300'>5）高级模式</font></strong></h4><p><strong>1️⃣结合 useRef 解决过期闭包（稳定引用 + 最新值）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useStableCallback</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title function_">useRef</span>(fn);</span><br><span class="line">  ref.<span class="property">current</span> = fn; <span class="comment">// 每次渲染更新 ref</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回稳定引用，但始终调用最新函数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useCallback</span>(<span class="function">(<span class="params">...args</span>) =&gt;</span> ref.<span class="title function_">current</span>(...args), []);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用：可以放入 useEffect 依赖而不触发重新执行，且能访问最新 props/state</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; onUpdate &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> stableCallback = <span class="title function_">useStableCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;最新状态&quot;</span>); <span class="comment">// 永远能访问最新值，无需依赖数组</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(stableCallback, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">  &#125;, [stableCallback]); <span class="comment">// 永远不会变，effect 只执行一次</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣ 记忆化事件处理器工厂</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ❌ 每次渲染都创建 N 个新函数</span></span><br><span class="line">  <span class="keyword">return</span> items.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleItemClick(item.id)&#125;&gt;&#123;item.name&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  ));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ✅ 使用 useCallback 缓存每个处理器（配合 memo）</span></span><br><span class="line">  <span class="keyword">return</span> items.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MemoItem</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">item</span>=<span class="string">&#123;item&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClick</span>=<span class="string">&#123;useCallback(</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        () =&gt;</span> handleItemClick(item.id),</span></span><br><span class="line"><span class="language-xml">        [item.id], // 只有当 item.id 变化时才更新</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣依赖注入模式</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useApi</span>(<span class="params">api</span>) &#123;</span><br><span class="line">  <span class="comment">// 即使 api 对象变化，只要 endpoint 不变，fetchData 引用稳定</span></span><br><span class="line">  <span class="keyword">const</span> fetchData = <span class="title function_">useCallback</span>(</span><br><span class="line">    <span class="function">(<span class="params">endpoint</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> api.<span class="title function_">request</span>(endpoint);</span><br><span class="line">    &#125;,</span><br><span class="line">    [api],</span><br><span class="line">  ); <span class="comment">// api 通常是稳定的单例</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> fetchData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6）常见误区⚠️"><a href="#6）常见误区⚠️" class="headerlink" title="6）常见误区⚠️"></a><strong><font color='#10c300'>6）常见误区⚠️</font></strong></h4><ol><li><p><strong>不要滥用</strong><br>如果子组件没有 <code>React.memo</code> 或不是性能瓶颈，没必要加 <code>useCallback</code>（增加复杂度）</p></li><li><p><strong>缓存不是减少渲染次数的万能钥匙</strong><br><code>useCallback</code> 只防止不必要的重渲染，但状态更新触发的渲染仍会发生</p></li><li><p><strong>依赖不正确会导致逻辑错误</strong><br>缺少依赖可能让函数内部拿到旧的状态</p></li><li><p>在写代码时，<strong>默认不要加 <code>useCallback</code></strong>。只有当你遇到下面这两个信号时，再补上：</p><ul><li>👋 “我要把这个函数传给一个很重的、加了 memo 的列表子组件”。</li><li>“ESLint 警告我说，这个函数被用这了 useEffect 的依赖里”。</li></ul><p>除此之外，放心大胆地写普通函数，代码更干净，性能反而更好。</p></li></ol><br><h3 id="4-6-useReducer-复杂状态管理"><a href="#4-6-useReducer-复杂状态管理" class="headerlink" title="4.6 useReducer-复杂状态管理"></a><strong><font color='red'>4.6 useReducer-复杂状态管理</font></strong></h3><blockquote><p>✅ <code>useReducer</code> 是 <code>useState</code> 的高级替代方案。<br>当状态变化逻辑比较复杂，或者新状态依赖旧状态时，用 <code>useReducer</code> 会更晰。</p></blockquote><p>它和 Redux 的核心思想一样：<br><strong>通过 “动作（action）” 和 “状态更新函数（reducer）” 来控制状态变化。</strong></p><hr><h4 id="1）基本语法-4"><a href="#1）基本语法-4" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialArg, init?)</span><br></pre></td></tr></table></figure><ul><li><strong><code>state</code></strong>：当前状态</li><li><strong><code>dispatch</code></strong>：触发状态更新的函数</li><li><strong><code>reducer</code></strong>：一个函数，负责“接收旧状态 + 动作（action）”，返回新状态</li><li><strong><code>initialArg</code></strong>：初始状态</li><li><strong><code>init（可选）</code></strong>：<em>惰性初始化函数</em>，用于在初始渲染时对 <code>initialArg</code> 进行加工或计算，返回真正的初始状态，只会在初始化执行一次</li></ul><h4 id="2）使用场景示例-1"><a href="#2）使用场景示例-1" class="headerlink" title="2）使用场景示例"></a><strong><font color='#10c300'>2）使用场景示例</font></strong></h4><p><strong><font color='#00A6ED'>1️⃣ 计数器</font></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 reducer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;decrement&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state; <span class="comment">// 返回原状态（防止报错）</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>计数：&#123;state.count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;increment&quot; &#125;)&#125;&gt;+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;decrement&quot; &#125;)&#125;&gt;-1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br></pre></td></tr></table></figure><p>✅ <code>dispatch</code> 类似于调用 <code>setState</code>，但语义更清晰、逻辑集中。</p><hr><p><strong><font color='#00A6ED'>2️⃣ 复杂状态示例：表单管理</font></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialForm = &#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formReducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;CHANGE_FIELD&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, [action.<span class="property">field</span>]: action.<span class="property">value</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;RESET&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> initialForm;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [form, dispatch] = <span class="title function_">useReducer</span>(formReducer, initialForm);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;form.username&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span></span></span><br><span class="line"><span class="language-xml">          dispatch(&#123;</span></span><br><span class="line"><span class="language-xml">            type: &quot;CHANGE_FIELD&quot;,</span></span><br><span class="line"><span class="language-xml">            field: &quot;username&quot;,</span></span><br><span class="line"><span class="language-xml">            value: e.target.value,</span></span><br><span class="line"><span class="language-xml">          &#125;)</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">        placeholder=&quot;用户名&quot;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;form.age&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span></span></span><br><span class="line"><span class="language-xml">          dispatch(&#123;</span></span><br><span class="line"><span class="language-xml">            type: &quot;CHANGE_FIELD&quot;,</span></span><br><span class="line"><span class="language-xml">            field: &quot;age&quot;,</span></span><br><span class="line"><span class="language-xml">            value: e.target.value,</span></span><br><span class="line"><span class="language-xml">          &#125;)</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">        placeholder=&quot;年龄&quot;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;RESET&quot; &#125;)&#125;&gt;重置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;JSON.stringify(form)&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Form</span>;</span><br></pre></td></tr></table></figure><p>✅ 优势：</p><ul><li>所有状态更新逻辑集中在 <code>reducer</code>；</li><li>更容易维护、测试、调试。</li></ul><h4 id="3）useReducer-的执行流程图"><a href="#3）useReducer-的执行流程图" class="headerlink" title="3）useReducer 的执行流程图"></a><strong><font color='#10c300'>3）useReducer 的执行流程图</font></strong></h4><p>1️⃣ 组件渲染时：</p><ul><li>React 按 <code>initialArg</code> 初始化状态。</li></ul><p>2️⃣ 调用 <code>dispatch(action)</code>：</p><ul><li>React 会执行 <code>reducer(state, action)</code>；</li><li>得到新的 state；</li><li>重新渲染组件。</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">dispatch</span>(action)</span><br><span class="line">   ↓</span><br><span class="line"><span class="title function_">reducer</span>(state, action)</span><br><span class="line">   ↓</span><br><span class="line">newState → 触发重新渲染</span><br></pre></td></tr></table></figure><h4 id="4）useState-vs-useReducer-选择指南"><a href="#4）useState-vs-useReducer-选择指南" class="headerlink" title="4）useState vs useReducer 选择指南"></a><strong><font color='#10c300'>4）useState vs useReducer 选择指南</font></strong></h4><table><thead><tr><th align="left">场景</th><th align="left">useState</th><th align="left">useReducer</th></tr></thead><tbody><tr><td align="left">状态类型</td><td align="left">简单值（string, number, boolean）</td><td align="left">复杂对象（含多个字段）</td></tr><tr><td align="left">更新逻辑</td><td align="left">直接设置新值</td><td align="left">基于动作（action）计算新状态</td></tr><tr><td align="left">状态关联</td><td align="left">独立状态</td><td align="left">多状态相互依赖（如表单校验影响提交按钮）</td></tr><tr><td align="left">状态转换</td><td align="left">少（&lt; 3 种变化）</td><td align="left">多（增删改查、加载、错误处理）</td></tr><tr><td align="left">可测试性</td><td align="left">一般</td><td align="left">高（reducer 是纯函数）</td></tr><tr><td align="left">团队协作</td><td align="left">快速开发</td><td align="left">大型项目易维护</td></tr></tbody></table><p><strong>转换信号</strong>：当 <code>useState</code> 出现多个 <code>setXxx</code> 连续调用，或状态逻辑超过 5 行时，考虑改用 <code>useReducer</code>。</p><h4 id="5）使用惰性初始化（第三个参数）"><a href="#5）使用惰性初始化（第三个参数）" class="headerlink" title="5）使用惰性初始化（第三个参数）"></a><strong><font color='#10c300'>5）使用惰性初始化（第三个参数）</font></strong></h4><p><code>useReducer</code> 还支持传入一个函数，延迟计算初始状态（避免初始化开销）👇</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">initialCount</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">count</span>: initialCount &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;reset&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">init</span>(action.<span class="property">payload</span>);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, <span class="number">0</span>, init);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>计数: &#123;state.count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;increment&quot; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;reset&quot;, payload: 5 &#125;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        重置为 5</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br></pre></td></tr></table></figure><p>这种方式适用于初始状态计算非常复杂的情况。</p><h4 id="6）useReducer-useContext"><a href="#6）useReducer-useContext" class="headerlink" title="6）useReducer + useContext"></a><strong><font color='#10c300'>6）useReducer + useContext</font></strong></h4><p><strong>1️⃣全局状态（Redux 思想）</strong></p><p><code>useReducer</code> 常配合 <code>useContext</code> 使用，构建轻量“全局状态管理”：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext, useReducer, useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CounterContext</span> = <span class="title function_">createContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;add&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CounterProvider</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, dispatch] = <span class="title function_">useReducer</span>(reducer, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">CounterContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">count</span>, <span class="attr">dispatch</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">CounterContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; count, dispatch &#125; = <span class="title function_">useContext</span>(<span class="title class_">CounterContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;add&quot; &#125;)&#125;&gt;+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">CounterProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">CounterProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>✅ 相当于一个小型 Redux。</p><hr><p><strong>2️⃣主题切换</strong></p><p>用 <strong><code>useReducer</code> + <code>useContext</code></strong> 实现一个<strong>全局状态管理系统</strong>，就像一个轻量版 Redux。</p><p>我们以“主题切换（深色 &#x2F; 浅色）”为例 👇</p><p><strong><font color='cornflowerblue'>🎯 功能目标</font></strong></p><ul><li>页面上有多个组件；</li><li>这些组件都能感知当前主题；</li><li>点击按钮可以在浅色&#x2F;深色模式之间切换；</li><li>所有组件自动更新，<strong>不用手动传 props</strong>。</li></ul><p><strong><font color='cornflowerblue'>🧱项目结构</font></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── 📁 components/                   # 组件</span><br><span class="line">│   ├── 📄 Header.jsx               # 子组件，读取主题并展示</span><br><span class="line">│   ├── 📄 Content.jsx              # 子组件，读取主题并展示</span><br><span class="line">├── 📁 context/                      # Context</span><br><span class="line">│   ├── 📄 index.js                 # 创建 Context + Reducer</span><br><span class="line">└── 📄 App.jsx</span><br></pre></td></tr></table></figure><p>完整案例：<a href="https://www.yuque.com/zhbiao/qr34us/qk5da4gmpqzhat4s/edit#S3pEZ">https://www.yuque.com/zhbiao/qr34us/qk5da4gmpqzhat4s/edit#S3pEZ</a></p><ul><li>页面加载时默认“浅色”；</li><li>点击“切换主题”按钮；</li><li><code>dispatch</code> 触发 <code>TOGGLE_THEME</code>；</li><li><code>reducer</code> 更新 theme → 所有使用该状态的组件自动重新渲染；</li><li>所有组件同步变成“深色模式”。</li></ul><h4 id="7）TypeScript-最佳实践"><a href="#7）TypeScript-最佳实践" class="headerlink" title="7）TypeScript 最佳实践"></a><strong><font color='#10c300'>7）TypeScript 最佳实践</font></strong></h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 定义 State 和 Action 类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span> | <span class="string">&quot;loading&quot;</span> | <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Action</span> =</span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&quot;increment&quot;</span> &#125;</span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&quot;decrement&quot;</span> &#125;</span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&quot;reset&quot;</span>; <span class="attr">payload</span>: <span class="built_in">number</span> &#125;</span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&quot;setError&quot;</span>; <span class="attr">error</span>: <span class="built_in">string</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Reducer 类型推断</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params"><span class="attr">state</span>: <span class="title class_">State</span>, <span class="attr">action</span>: <span class="title class_">Action</span></span>): <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;reset&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">count</span>: action.<span class="property">payload</span>, <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span> &#125;;</span><br><span class="line">    <span class="comment">// TypeScript 会检查是否处理了所有 action type</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 在组件中使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// dispatch 类型安全，错误的 action 会报错</span></span><br><span class="line">  <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;increment&quot;</span> &#125;); <span class="comment">// ✅</span></span><br><span class="line">  <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;reset&quot;</span>, <span class="attr">payload</span>: <span class="number">10</span> &#125;); <span class="comment">// ✅</span></span><br><span class="line">  <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;unknown&quot;</span> &#125;); <span class="comment">// ❌ TypeScript 错误</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><p>🌟 <strong>一句话总结：</strong></p><p><code>useReducer</code> &#x3D; “复杂版 useState”<br>当状态逻辑复杂或多步骤更新时，用 reducer 管理更干净、更可靠。</p><br><h3 id="4-7-useRef-引用-DOM-和保存可变值"><a href="#4-7-useRef-引用-DOM-和保存可变值" class="headerlink" title="4.7 useRef - 引用 DOM 和保存可变值"></a><strong><font color='red'>4.7 useRef - 引用 DOM 和保存可变值</font></strong></h3><p>✅ <code>useRef</code> 返回一个 <strong>可变的 ref 对象</strong> <code>&#123; current: ... &#125;</code><br>这个对象的 <code>.current</code> 属性可以存储任何值（DOM 元素、定时器 ID、普通变量等），<strong>改变 <code>.current</code> 不会触发组件重渲染</strong>。</p><p>它的两个主要用途：</p><ol><li><strong>访问 DOM 元素</strong>（函数组件中替代 <code>document.querySelector</code>）</li><li><strong>保存任意变量值</strong>（这个值在组件的整个生命周期内保持不变，不会因重新渲染而丢失）</li></ol><hr><h4 id="1）基本语法-5"><a href="#1）基本语法-5" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> refContainer = <span class="title function_">useRef</span>(initialValue);</span><br></pre></td></tr></table></figure><ul><li><code>initialValue</code> 是初始值</li><li><code>refContainer.current</code> 是存放值的地方</li><li>改变 <code>refContainer.current</code> <strong>不会触发组件重新渲染</strong></li></ul><h4 id="2）使用场景示例-2"><a href="#2）使用场景示例-2" class="headerlink" title="2）使用场景示例"></a><strong><font color='#10c300'>2）使用场景示例</font></strong></h4><p><strong><font color='#00A6ED'>1️⃣ 操作 DOM 元素</font></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">InputFocus</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>); <span class="comment">// 初始 current = null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">focusInput</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>(); <span class="comment">// 获取 DOM 节点并聚焦</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;点击按钮聚焦我&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;focusInput&#125;</span>&gt;</span>聚焦输入框<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">InputFocus</span>;</span><br></pre></td></tr></table></figure><ul><li><code>ref=&#123;inputRef&#125;</code> 将 DOM 节点绑定到 <code>inputRef.current</code></li><li>点击按钮时执行 <code>inputRef.current.focus()</code> 来让输入框获得焦点</li></ul><hr><p><strong><font color='#00A6ED'>2️⃣ 用来存储可变值</font></strong></p><p><code>useRef</code> 可以用来存储任意可变值，而且即使组件重新渲染，这个值仍然保留。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">RenderCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> renderTimes = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    renderTimes.<span class="property">current</span> += <span class="number">1</span>; <span class="comment">// 每次渲染 +1</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;组件渲染&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>按钮点击次数：&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>组件渲染次数：&#123;renderTimes.current&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 这里点击调用了useState，导致页面重新渲染，但是useRef一直处于叠加状态，没有初始到0 说明具有持久性 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RenderCount</span>;</span><br></pre></td></tr></table></figure><ul><li><code>renderTimes.current</code> 是一个持久化引用，组件每次渲染都会累加，但不会引起额外的渲染</li><li>对 <code>useRef</code> 变量的修改不会触发 UI 更新</li></ul><h4 id="3）注意事项⚠️"><a href="#3）注意事项⚠️" class="headerlink" title="3）注意事项⚠️"></a><strong><font color='#10c300'>3）注意事项⚠️</font></strong></h4><ol><li><p><strong>不要用它来代替 state</strong>，除非你不需要触发渲染。</p></li><li><p><code>.current</code> 修改不会更新 UI，只有 <code>state</code> 更新会触发渲染。</p></li><li><p>访问 DOM 节点要确保该节点已经渲染到页面上（通常在 <code>useEffect</code> 中使用）。</p></li><li><p>函数组件不能使用ref，因为函数组件没有实例（和 forwardRef 搭配可使用ref）</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;./child&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> domRef = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 错误写法，函数组件不能使用ref，因为函数组件没有实例 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;domRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>父组件的按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure></li></ol><h4 id="4）和-forwardRef-搭配"><a href="#4）和-forwardRef-搭配" class="headerlink" title="4）和 forwardRef 搭配"></a><strong><font color='#10c300'>4）和 forwardRef 搭配</font></strong></h4><p><a name="forwardRef"><strong><code>useRef</code></strong> 配合 <strong><code>forwardRef</code></strong> 可以将 ref 传给子组件中的 DOM 元素：</a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef, forwardRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CustomInput</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> myInputRef = <span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CustomInput</span> <span class="attr">ref</span>=<span class="string">&#123;myInputRef&#125;</span> <span class="attr">placeholder</span>=<span class="string">&quot;自定义组件中的输入框&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> myInputRef.current.focus()&#125;&gt;聚焦<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p>✅ 这样可以让父组件直接操作子组件内部的 DOM 元素。</p><p><strong><font color='red'>🚫在react19中已废弃forwardRef </font></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ React 19 写法：直接从 props 中获取 ref</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CustomInput</span>(<span class="params">&#123; placeholder, ref, ...props &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">placeholder</span>=<span class="string">&#123;placeholder&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> myInputRef = <span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CustomInput</span> <span class="attr">ref</span>=<span class="string">&#123;myInputRef&#125;</span> <span class="attr">placeholder</span>=<span class="string">&quot;自定义组件中的输入框&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> myInputRef.current.focus()&#125;&gt;聚焦<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><h4 id="5）TypeScript-支持"><a href="#5）TypeScript-支持" class="headerlink" title="5）TypeScript 支持"></a><strong><font color='#10c300'>5）TypeScript 支持</font></strong></h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DOM 元素引用（自动推断类型）</span></span><br><span class="line"><span class="keyword">const</span> inputRef = useRef&lt;<span class="title class_">HTMLInputElement</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">inputRef.<span class="property">current</span>?.<span class="title function_">focus</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非 DOM 引用需要显式类型</span></span><br><span class="line"><span class="keyword">const</span> timerRef = useRef&lt;<span class="built_in">number</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">timerRef.<span class="property">current</span> = <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确保有初始值（非 null）</span></span><br><span class="line"><span class="keyword">const</span> countRef = useRef&lt;<span class="built_in">number</span>&gt;(<span class="number">0</span>);</span><br><span class="line">countRef.<span class="property">current</span> += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MutableRefObject vs RefObjectD</span></span><br><span class="line"><span class="comment">// useRef&lt;T&gt;(null) -&gt; RefObject&lt;T&gt;（current 只读，用于 DOM）</span></span><br><span class="line"><span class="comment">// useRef&lt;T&gt;(undefined) 或 useRef&lt;T&gt;(initial) -&gt; MutableRefObject&lt;T&gt;（current 可写）</span></span><br></pre></td></tr></table></figure><br><h3 id="4-8-useId-生成唯一-ID"><a href="#4-8-useId-生成唯一-ID" class="headerlink" title="4.8 useId - 生成唯一 ID"></a><strong><font color='red'>4.8 useId - 生成唯一 ID</font></strong></h3><p><code>useId</code> 是一个 React 内置 Hook，用来生成一个稳定且唯一的 ID 字符串，通常用于：</p><ul><li><strong>无障碍（a11y）场景</strong>：让 <code>label</code> 和表单控件配对使用；</li><li><strong>服务端渲染（SSR）</strong>：防止客户端与服务器渲染的 ID 不一致；</li><li><strong>生成稳定唯一 key&#x2F;id</strong>（每次渲染保持不变）。</li></ul><hr><h4 id="1）基本语法-6"><a href="#1）基本语法-6" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = <span class="title function_">useId</span>();</span><br></pre></td></tr></table></figure><ul><li>返回一个在当前组件作用域内 <strong>唯一且稳定</strong> 的字符串，例如：<code>&quot;r1:0&quot;</code>。</li><li>每次渲染都保证相同组件中的 id 一致。</li><li>不会在不同组件之间重复。</li></ul><h4 id="2）使用场景示例-3"><a href="#2）使用场景示例-3" class="headerlink" title="2）使用场景示例"></a><strong><font color='#10c300'>2）使用场景示例</font></strong></h4><p><strong><font color='#00A6ED'>1️⃣ 关联 <code>&lt;label&gt;</code> 与 <code>&lt;input&gt;</code></font></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">jsximport <span class="title class_">React</span>, &#123; useId &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">NameField</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="title function_">useId</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&#123;id&#125;</span>&gt;</span>姓名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&#123;id&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入姓名&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">NameField</span>;</span><br></pre></td></tr></table></figure><p>✅ 在这里：</p><ul><li><code>useId</code> 生成一个唯一 id；</li><li><code>label</code> 的 <code>htmlFor</code> 与 <code>input</code> 的 <code>id</code> 一致；</li><li>当多个 <code>NameField</code> 组件同时存在时，每个组件生成的 id 不会冲突。</li></ul><hr><p><strong><font color='#00A6ED'>2️⃣ 组合前缀使用（推荐）</font></strong></p><p>为了更明确区分不同控件，可以加上自定义前缀：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jsxconst id = <span class="title function_">useId</span>();</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&#123;</span>`<span class="attr">email-</span>$&#123;<span class="attr">id</span>&#125;`&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&#123;</span>`<span class="attr">email-</span>$&#123;<span class="attr">id</span>&#125;`&#125;&gt;</span>邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>结果类比：<code>id=&quot;email-r1:0&quot;</code>, <code>email-r1:1</code> 等。</p><h4 id="3）与-SSR-配合"><a href="#3）与-SSR-配合" class="headerlink" title="3）与 SSR 配合"></a><strong><font color='#10c300'>3）与 SSR 配合</font></strong></h4><p>React 18 引入了 <code>useId</code>，是为了解决 <strong>服务端渲染（Server Side Rendering）</strong> 时生成的 ID 不一致问题：</p><ul><li>SSR 阶段会生成稳定的 ID。</li><li>Hydration（客户端激活）时，React 会保证客户端生成的 id 与服务端的一致。</li></ul><p>✅ 所以 <code>useId</code> 是 <strong>SSR 安全的唯一 ID</strong>。</p><h4 id="4）注意事项⚠️"><a href="#4）注意事项⚠️" class="headerlink" title="4）注意事项⚠️"></a><strong><font color='#10c300'>4）注意事项⚠️</font></strong></h4><ol><li><code>useId</code> <strong>不适合当作列表 key 的唯一标识</strong>，因为它只在组件作用域独立唯一，不是数据层唯一。</li><li>每次调用 <code>useId</code> 都会生成一个不同的子 ID，React 内部有机制确保组合时不冲突。</li><li>只可在 <strong>组件初始化阶段调用一次</strong>，即让 <code>id</code> 在整个组件生命周期内稳定。</li></ol><br><h3 id="4-9-useDeferredValue-延迟更新值"><a href="#4-9-useDeferredValue-延迟更新值" class="headerlink" title="4.9 useDeferredValue - 延迟更新值"></a><strong><font color='red'>4.9 useDeferredValue - 延迟更新值</font></strong></h3><p>当你更新某个状态时，React 不一定立刻同步渲染使用这个值的部分，而是会<strong>优先渲染更紧急的更新（交互、输入）</strong>，稍后再更新那些耗时的渲染部分。</p><p>✅ 简单理解：让页面中不太重要的部分“晚一点更新”，以保证用户操作更流畅。</p><hr><h4 id="1）基本语法-7"><a href="#1）基本语法-7" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deferredValue = <span class="title function_">useDeferredValue</span>(value);</span><br></pre></td></tr></table></figure><ul><li><code>value</code>：原始的值（可能变化频繁）</li><li><code>deferredValue</code>：React 返回的延迟更新的值</li></ul><p>当 <code>value</code> 改变时，React <strong>不会立即</strong>让 <code>deferredValue</code> 同步，而是“稍后”更新它（基于调度优先级），如果更新非常快，比如频繁输入，<code>deferredValue</code> 会滞后一点跟上。</p><h4 id="2）使用场景示例-4"><a href="#2）使用场景示例-4" class="headerlink" title="2）使用场景示例"></a><strong><font color='#10c300'>2）使用场景示例</font></strong></h4><p><strong><font color='#00A6ED'>1️⃣ 搜索过滤（大列表）</font></strong></p><p>假设我们有一个输入框用于搜索大量数据，输入过程中你不希望每个字母都立即导致昂贵的渲染：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useDeferredValue, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SlowList</span>(<span class="params">&#123; input &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 模拟大数据过滤（耗时） 要配合useMemo使用，要不然子组件每次渲染，也会导致输入卡顿</span></span><br><span class="line">  <span class="keyword">const</span> list = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> items = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">      items.<span class="title function_">push</span>(</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;input&#125; - 项 &#123;i&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> items;</span><br><span class="line">  &#125;, [input]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;list&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> deferredQuery = <span class="title function_">useDeferredValue</span>(query); <span class="comment">// 👈 延迟使用 query</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;query&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setQuery(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">        placeholder=&quot;输入搜索关键词...&quot;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;/* 使用延迟的状态值渲染大列表 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">SlowList</span> <span class="attr">input</span>=<span class="string">&#123;deferredQuery&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">SearchPage</span>;</span><br></pre></td></tr></table></figure><p><strong>🔍 效果：</strong></p><ul><li>输入框响应非常顺畅；</li><li>列表渲染稍微滞后一点更新（不会阻塞输入）；</li><li>React 自动安排较低优先级的渲染任务。</li></ul><h4 id="3）useDeferredValue的本质"><a href="#3）useDeferredValue的本质" class="headerlink" title="3）useDeferredValue的本质"></a><strong><font color='#10c300'>3）useDeferredValue的本质</font></strong></h4><p>它利用了 <strong>React 的并发特性（Concurrent Rendering）</strong><br>让某些更新以较低优先级进行：</p><ul><li>用户输入 → 高优先级；</li><li>列表更新 → 低优先级；</li><li>React 内部可在合适时机处理低优先级更新。</li></ul><p>所以它非常适合：</p><ul><li>输入搜索时展示结果；</li><li>大量数据过滤；</li><li>复杂渲染场景中保持 UI 互动流畅。</li></ul><h4 id="4）注意事项⚠️-1"><a href="#4）注意事项⚠️-1" class="headerlink" title="4）注意事项⚠️"></a><strong><font color='#10c300'>4）注意事项⚠️</font></strong></h4><table><thead><tr><th>注意点</th><th>说明</th></tr></thead><tbody><tr><td>不会跳过更新</td><td>只是延迟执行，最终仍会同步到最新值</td></tr><tr><td>不建议用于关键 UI 状态</td><td>因为它可能暂时落后于真实值</td></tr><tr><td>需要 React 18+</td><td>属于并发系统的功能</td></tr><tr><td>可搭配 <code>useTransition</code> 一起使用</td><td>共同控制更新优先级更加灵活</td></tr></tbody></table><br><h3 id="4-10-useTransition-非阻塞状态更新"><a href="#4-10-useTransition-非阻塞状态更新" class="headerlink" title="4.10 useTransition - 非阻塞状态更新"></a><strong><font color='red'>4.10 useTransition - 非阻塞状态更新</font></strong></h3><p>用来将某些状态更新标记为“过渡更新（transition update）”。</p><p>简单来说，它告诉 React：</p><blockquote><p>“这类更新不用立刻执行，可以稍后完成，让用户交互不要被卡顿。”</p></blockquote><p>在 React 18 的 <strong>并发渲染模式</strong> 下，更新有优先级区分：</p><ul><li><strong>紧急更新（Urgent）</strong>：立刻执行，比如输入框、点击。</li><li><strong>过渡更新（Transition）</strong>：可以延后，比如筛选、分页、排序、大列表渲染。</li></ul><h4 id="1）基本语法搜索过滤"><a href="#1）基本语法搜索过滤" class="headerlink" title="1）基本语法搜索过滤"></a><strong><font color='#10c300'>1）基本语法搜索过滤</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [isPending, startTransition] = <span class="title function_">useTransition</span>();</span><br></pre></td></tr></table></figure><ul><li><p><code>isPending</code> ：布尔值：表示过渡更新是否正在进行中，可用于显示“加载中…”</p></li><li><p><code>startTransition()</code>：函数：用于包裹属于过渡更新的代码（例如 setState）</p></li></ul><h4 id="2）使用场景示例-5"><a href="#2）使用场景示例-5" class="headerlink" title="2）使用场景示例"></a><strong><font color='#10c300'>2）使用场景示例</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useTransition &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> allItems = <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="number">20000</span> &#125;, <span class="function">(<span class="params">_, i</span>) =&gt;</span> <span class="string">`Item <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params">&#123; list &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;list.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;item&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = <span class="title function_">useState</span>(allItems);</span><br><span class="line">  <span class="keyword">const</span> [isPending, startTransition] = <span class="title function_">useTransition</span>(); <span class="comment">// 👈 使用 useTransition</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newQuery = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="title function_">setQuery</span>(newQuery); <span class="comment">// 紧急更新（立即响应输入）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 过滤操作标记为“过渡更新”，不会阻塞输入</span></span><br><span class="line">    <span class="title function_">startTransition</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> filtered = allItems.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span></span><br><span class="line">        item.<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(newQuery.<span class="title function_">toLowerCase</span>()),</span><br><span class="line">      );</span><br><span class="line">      <span class="title function_">setList</span>(filtered);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">padding:</span> <span class="attr">20</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>useTransition 优化的搜索示例<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;query&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">placeholder</span>=<span class="string">&quot;输入关键字过滤列表…&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isPending &amp;&amp; <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> &quot;<span class="attr">orange</span>&quot; &#125;&#125;&gt;</span>正在过滤数据…<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>匹配到 &#123;list.length&#125; 条结果<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">List</span> <span class="attr">list</span>=<span class="string">&#123;list&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p>✅ 体验：<br>输入框输入即时响应；<br>列表过滤是延后执行的，界面不会卡顿。</p><h4 id="3）工作原理"><a href="#3）工作原理" class="headerlink" title="3）工作原理"></a><strong><font color='#10c300'>3）工作原理</font></strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用户输入 → 立即更新输入框（紧急更新）</span><br><span class="line">        ↓</span><br><span class="line">React 空闲时 → 执行过滤逻辑（过渡更新）</span><br><span class="line">        ↓</span><br><span class="line">过渡完成 → isPending = false，列表更新</span><br></pre></td></tr></table></figure><p>当 <code>startTransition</code> 内的更新在进行时：</p><ul><li>React 会优先处理交互事件（比如输入框），</li><li>暂缓其他较慢的渲染任务，</li><li>确保界面流畅。</li></ul><h4 id="4）与useDeferredValue的对比"><a href="#4）与useDeferredValue的对比" class="headerlink" title="4）与useDeferredValue的对比"></a><strong><font color='#10c300'>4）与useDeferredValue的对比</font></strong></h4><ul><li><strong><code>useDeferredValue</code></strong> 主要用于延迟单个值的更新，适用于值的变化直接影响到 UI 渲染但又不是立即必要的更新。</li><li><strong><code>useTransition</code></strong> 用于告诉 React 哪些更新是低优先级的，并可使用 <code>isPending</code> 状态反馈更新是否处于等待状态，适用于控制大块区域或复杂状态的更新行为，允许你在触发更新时提供更自然的用户体验。</li></ul><table><thead><tr><th>对比项</th><th><code>useTransition</code></th><th><code>useDeferredValue</code></th></tr></thead><tbody><tr><td>控制对象</td><td>一整段状态更新（<code>setState</code>）</td><td>一个状态值</td></tr><tr><td>延迟方式</td><td>手动包裹更新</td><td>自动使值延迟生效</td></tr><tr><td>返回值</td><td><code>[isPending, startTransition]</code></td><td><code>deferredValue</code></td></tr><tr><td>是否有加载状态</td><td>✅ 有 <code>isPending</code></td><td>❌ 需手动比较</td></tr><tr><td>使用场景</td><td>你要延迟执行某个更新逻辑</td><td>你要延迟某个值传递下去</td></tr></tbody></table><h4 id="5）注意事项⚠️"><a href="#5）注意事项⚠️" class="headerlink" title="5）注意事项⚠️"></a><strong><font color='#10c300'>5）注意事项⚠️</font></strong></h4><ul><li><code>useTransition</code> 只在 React 18+ 有效果；</li><li>它不会跳过渲染，只是调度顺序不同；</li><li>不适用于动画或时间延迟，只改变更新优先级；</li><li>不要滥用——仅在性能瓶颈或卡顿时使用。</li></ul><br><h3 id="4-11-useImperativeHandle-暴露自定义ref"><a href="#4-11-useImperativeHandle-暴露自定义ref" class="headerlink" title="4.11 useImperativeHandle - 暴露自定义ref"></a><strong><font color='red'>4.11 useImperativeHandle - 暴露自定义ref</font></strong></h3><p><code>useImperativeHandle</code> 用于自定义通过 ref 暴露给父组件的实例值。它通常与 <code>forwardRef</code> 配合使用（React 19 后 ref 可作为 prop 直接传递）。<a href="#forwardRef">forwardRef用法</a></p><hr><h4 id="1）基本语法-8"><a href="#1）基本语法-8" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useImperativeHandle</span>(ref, createHandle, deps?)</span><br></pre></td></tr></table></figure><ul><li><strong>ref</strong>：从 <code>forwardRef</code> 或 props 传入的 ref</li><li><strong>createHandle</strong>：返回暴露给父组件的对象</li><li><strong>deps</strong>：依赖数组，类似 <code>useEffect</code></li></ul><h4 id="2）React-19-之前的写法（forwardRef）"><a href="#2）React-19-之前的写法（forwardRef）" class="headerlink" title="2）React 19 之前的写法（forwardRef）"></a><strong><font color='#10c300'>2）React 19 之前的写法（forwardRef）</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef, useImperativeHandle, forwardRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(</span><br><span class="line">    ref,</span><br><span class="line">    <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">focus</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">getValue</span>: <span class="function">() =&gt;</span> inputRef.<span class="property">current</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    [],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入内容&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> childRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 调用子组件暴露的方法</span></span><br><span class="line">    childRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(childRef.<span class="property">current</span>.<span class="title function_">getValue</span>());</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;childRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>操作子组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Parent</span>;</span><br></pre></td></tr></table></figure><h4 id="3）React-19-的简化写法"><a href="#3）React-19-的简化写法" class="headerlink" title="3）React 19 的简化写法"></a><strong><font color='#10c300'>3）React 19 的简化写法</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef, useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">&#123; ref &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(</span><br><span class="line">    ref,</span><br><span class="line">    <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="comment">// 返回一个对象</span></span><br><span class="line">      <span class="attr">focus</span>: <span class="function">() =&gt;</span> inputRef.<span class="property">current</span>?.<span class="title function_">focus</span>(),</span><br><span class="line">      <span class="attr">clear</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputRef.<span class="property">current</span>) inputRef.<span class="property">current</span>.<span class="property">value</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    [],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> childRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 调用子组件暴露的方法</span></span><br><span class="line">    childRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    childRef.<span class="property">current</span>.<span class="title function_">clear</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;childRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>操作子组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Parent</span>;</span><br></pre></td></tr></table></figure><h4 id="4）使用场景"><a href="#4）使用场景" class="headerlink" title="4）使用场景"></a><strong><font color='#10c300'>4）使用场景</font></strong></h4><p><strong>1️⃣ 封装第三方组件</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">FancyInput</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 只暴露特定的 API，隐藏内部实现</span></span><br><span class="line">    <span class="attr">focus</span>: <span class="function">() =&gt;</span> inputRef.<span class="property">current</span>.<span class="title function_">focus</span>(),</span><br><span class="line">    <span class="attr">scrollIntoView</span>: <span class="function">() =&gt;</span></span><br><span class="line">      inputRef.<span class="property">current</span>.<span class="title function_">scrollIntoView</span>(&#123; <span class="attr">behavior</span>: <span class="string">&quot;smooth&quot;</span> &#125;),</span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣动画控制</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AnimatedBox</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> elementRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">shake</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      elementRef.<span class="property">current</span>?.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;shake-animation&quot;</span>);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        elementRef.<span class="property">current</span>?.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;shake-animation&quot;</span>);</span><br><span class="line">      &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">highlight</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      elementRef.<span class="property">current</span>?.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;highlight&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;elementRef&#125;</span>&gt;</span>&#123;props.children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="5）注意事项⚠️-1"><a href="#5）注意事项⚠️-1" class="headerlink" title="5）注意事项⚠️"></a><strong><font color='#10c300'>5）注意事项⚠️</font></strong></h4><ol><li><p><strong>避免过度使用</strong>：优先通过 props 和 state 进行数据流通信，refs 是”逃生舱”</p></li><li><p><strong>返回值限制</strong>：<code>createHandle</code> 返回的对象中不能包含原始类型的 ref 值（如 <code>&#123; current: ... &#125;</code>），只能是普通函数或值</p></li><li><p><strong>TypeScript 支持</strong>：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">ChildRef</span> &#123;</span><br><span class="line">    <span class="attr">focus</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">    <span class="attr">clear</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = forwardRef&lt;<span class="title class_">ChildRef</span>, <span class="title class_">Props</span>&gt;(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">focus</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">        <span class="attr">clear</span>: <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p><strong>与 <code>useRef</code> 配合</strong>：通常在子组件内部维护实际 DOM ref，再通过 <code>useImperativeHandle</code> 选择性暴露方法</p></li><li><p><strong>清理逻辑</strong>：如果暴露的方法涉及副作用（如定时器），记得在组件卸载时清理</p></li></ol><p>这个模式适用于需要<strong>命令式操作</strong>（如聚焦、播放、滚动、触发动画）但不想暴露整个 DOM 节点的场景。</p><br><h3 id="4-12-useLayoutEffect-同步执行的副作用"><a href="#4-12-useLayoutEffect-同步执行的副作用" class="headerlink" title="4.12 useLayoutEffect - 同步执行的副作用"></a><strong><font color='red'>4.12 useLayoutEffect - 同步执行的副作用</font></strong></h3><blockquote><p><code>useLayoutEffect</code> 可能会影响性能。尽可能使用 <a href="https://zh-hans.react.dev/reference/react/useEffect"><code>useEffect</code></a></p></blockquote><p><code>useLayoutEffect</code> 与 <code>useEffect</code> 签名完全相同，但执行时机不同：<strong>在浏览器绘制（paint）之前同步执行</strong>，用于避免视觉闪烁。</p><hr><h4 id="1）执行时机对比"><a href="#1）执行时机对比" class="headerlink" title="1）执行时机对比"></a><strong><font color='#10c300'>1）执行时机对比</font></strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">组件渲染完成</span><br><span class="line">    ↓</span><br><span class="line">useLayoutEffect（同步执行，阻塞绘制）← 在这里修改 DOM，用户看不到中间态</span><br><span class="line">    ↓</span><br><span class="line">浏览器绘制（Paint）到屏幕</span><br><span class="line">    ↓</span><br><span class="line">useEffect（异步执行，不阻塞绘制）</span><br></pre></td></tr></table></figure><h4 id="2）核心使用场景-1"><a href="#2）核心使用场景-1" class="headerlink" title="2）核心使用场景"></a><strong><font color='#10c300'>2）核心使用场景</font></strong></h4><p><strong>1️⃣测量 DOM 并同步修改（防止闪烁）</strong></p><p>**完整案例：**<a href="https://www.yuque.com/zhbiao/qr34us/qk5da4gmpqzhat4s/edit#fdd2408c">https://www.yuque.com/zhbiao/qr34us/qk5da4gmpqzhat4s/edit#fdd2408c</a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useLayoutEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Tooltip</span>(<span class="params">&#123; children, content &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [position, setPosition] = <span class="title function_">useState</span>(&#123; <span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> triggerRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> tooltipRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> triggerRect = triggerRef.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">    <span class="keyword">const</span> tooltipRect = tooltipRef.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算 tooltip 位置（例如显示在 trigger 上方）</span></span><br><span class="line">    <span class="keyword">const</span> top = triggerRect.<span class="property">top</span> - tooltipRect.<span class="property">height</span> - <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">const</span> left = triggerRect.<span class="property">left</span> + (triggerRect.<span class="property">width</span> - tooltipRect.<span class="property">width</span>) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同步设置位置，用户不会看到 tooltip 先出现在错误位置</span></span><br><span class="line">    <span class="title function_">setPosition</span>(&#123; top, left &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&#123;triggerRef&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;tooltipRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">position:</span> &quot;<span class="attr">fixed</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">top:</span> <span class="attr">position.top</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">left:</span> <span class="attr">position.left</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;content&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>如果用 <code>useEffect</code> 会怎样？</strong></p><ul><li>浏览器先绘制 tooltip 在默认位置（例如 0,0）</li><li>用户看到一闪而过的错位</li><li>然后 <code>useEffect</code> 执行，跳转到正确位置</li></ul><hr><p><strong>2️⃣从服务端渲染恢复（SSR Hydration）</strong></p><p>当服务端渲染的 HTML 与客户端首次渲染不一致时，用 <code>useLayoutEffect</code> 在绘制前修正，避免 hydration 不匹配警告：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ClientOnlyComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 服务端没有 window，默认渲染为 0</span></span><br><span class="line">  <span class="comment">// 客户端在绘制前同步计算实际宽度，防止闪烁</span></span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setWidth</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>窗口宽度: &#123;width&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3）与-useEffect-的选择指南"><a href="#3）与-useEffect-的选择指南" class="headerlink" title="3）与 useEffect 的选择指南"></a><strong><font color='#10c300'>3）与 useEffect 的选择指南</font></strong></h4><table><thead><tr><th align="left">场景</th><th align="left">推荐</th><th align="left">原因</th></tr></thead><tbody><tr><td align="left">数据获取</td><td align="left"><code>useEffect</code></td><td align="left">不阻塞绘制，用户更快看到内容</td></tr><tr><td align="left">事件监听</td><td align="left"><code>useEffect</code></td><td align="left">不阻塞绘制</td></tr><tr><td align="left">基于 DOM 测量调整布局</td><td align="left"><code>useLayoutEffect</code></td><td align="left">防止闪烁</td></tr><tr><td align="left">动画初始状态</td><td align="left"><code>useLayoutEffect</code></td><td align="left">防止闪烁</td></tr><tr><td align="left">DOM 修改（如聚焦）</td><td align="left"><code>useEffect</code></td><td align="left">通常不需要同步，除非有视觉问题</td></tr></tbody></table><p><strong>黄金法则</strong>：先使用 <code>useEffect</code>，如果出现<strong>视觉闪烁</strong>（flicker）再改为 <code>useLayoutEffect</code></p><h4 id="4）性能警告-⚠️"><a href="#4）性能警告-⚠️" class="headerlink" title="4）性能警告 ⚠️"></a><strong><font color='#10c300'>4）性能警告 ⚠️</font></strong></h4><p><code>useLayoutEffect</code> <strong>会阻塞浏览器绘制</strong>，执行时间过长会导致：</p><ol><li><p><strong>掉帧&#x2F;卡顿</strong>：用户感觉到界面卡住</p></li><li><p><strong>延迟交互</strong>：无法响应用户输入</p></li><li><p><strong>影响用户体验</strong>：比轻微的视觉闪烁更糟糕</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：在 useLayoutEffect 中执行耗时操作</span></span><br><span class="line"><span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 大数据处理会阻塞绘制</span></span><br><span class="line">  <span class="keyword">const</span> processed = <span class="title function_">heavyDataProcessing</span>(data);</span><br><span class="line">  <span class="title function_">setData</span>(processed);</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：耗时操作应在 useEffect 中</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> processed = <span class="title function_">heavyDataProcessing</span>(data);</span><br><span class="line">  <span class="title function_">setData</span>(processed);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure></li></ol><br><h3 id="4-13-自定义-Hooks"><a href="#4-13-自定义-Hooks" class="headerlink" title="4.13 自定义 Hooks"></a><strong><font color='red'>4.13 自定义 Hooks</font></strong></h3><p>自定义 Hook 是<strong>提取组件逻辑到可复用函数</strong>的机制，解决 React 中状态逻辑复用问题（替代高阶组件 HOC 和 Render Props）。</p><h4 id="1）核心规则"><a href="#1）核心规则" class="headerlink" title="1）核心规则"></a><strong><font color='#10c300'>1）核心规则</font></strong></h4><p><strong>1️⃣ 命名必须以 <code>use</code> 开头</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 正确：React 识别为 Hook，会检查规则</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useWindowSize</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 错误：普通函数，React 不会应用 Hook 规则</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getWindowSize</span>(<span class="params"></span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣遵循 Hooks 规则</strong></p><ul><li>只在顶层调用（不在循环、条件、嵌套函数中）</li><li>只在 React 函数或自定义 Hook 中调用</li></ul><h4 id="2）基础模板"><a href="#2）基础模板" class="headerlink" title="2）基础模板"></a><strong><font color='#10c300'>2）基础模板</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useCustomHook</span>(<span class="params">arg</span>) &#123;</span><br><span class="line">  <span class="comment">// 可以使用其他 Hooks</span></span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initialValue);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 副作用逻辑</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 清理逻辑</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [arg]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回状态、方法或计算值</span></span><br><span class="line">  <span class="keyword">return</span> [state, setState]; <span class="comment">// 或返回对象 &#123; state, action &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3）实战示例"><a href="#3）实战示例" class="headerlink" title="3）实战示例"></a><strong><font color='#10c300'>3）实战示例</font></strong></h4><p><strong>1️⃣useLocalStorage（持久化状态）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.jsx</span></span><br><span class="line"><span class="keyword">import</span> useLocalStorage <span class="keyword">from</span> <span class="string">&quot;./Hooks/useLocalStorage&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [name, setName] = <span class="title function_">useLocalStorage</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Guest&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;name&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setName(e.target.value)&#125; /&gt;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// src\Hooks\useLocalStorage.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useLocalStorage</span>(<span class="params">key, initialValue</span>) &#123;</span><br><span class="line">    <span class="comment">// 惰性初始化：从 localStorage 读取</span></span><br><span class="line">    <span class="keyword">const</span> [storedValue, setStoredValue] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> item = <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line">            <span class="keyword">return</span> item ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(item) : initialValue;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">            <span class="keyword">return</span> initialValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新 localStorage 当状态变化</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setValue</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> valueToStore = value <span class="keyword">instanceof</span> <span class="title class_">Function</span> ? <span class="title function_">value</span>(storedValue) : value;</span><br><span class="line">            <span class="title function_">setStoredValue</span>(valueToStore);</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(valueToStore));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [storedValue, setValue];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useLocalStorage</span><br></pre></td></tr></table></figure><hr><p><strong>2️⃣useDebounce（防抖）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.jsx</span></span><br><span class="line"><span class="keyword">import</span> useDebounce <span class="keyword">from</span> <span class="string">&quot;./Hooks/useDebounce&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> debouncedText = <span class="title function_">useDebounce</span>(text, <span class="number">500</span>); <span class="comment">// 500ms 防抖</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (debouncedText) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(debouncedText); <span class="comment">// 只在停止输入 500ms 后搜索</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [debouncedText]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;text&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125; /&gt;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">SearchInput</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// src\Hooks\useDebounce.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useDebounce</span>(<span class="params">value, delay</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [debouncedValue, setDebouncedValue] = <span class="title function_">useState</span>(value);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> handler = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">setDebouncedValue</span>(value);</span><br><span class="line">        &#125;, delay);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(handler); <span class="comment">// 清除上一次的定时器</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;, [value, delay]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> debouncedValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useDebounce</span><br></pre></td></tr></table></figure><hr><p><strong>3️⃣useFetch（数据获取）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useFetch</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">isLoading</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cancelled = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setState</span>(<span class="function">(<span class="params">prev</span>) =&gt;</span> (&#123; ...prev, <span class="attr">isLoading</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="title function_">fetch</span>(url)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!cancelled) &#123;</span><br><span class="line">          <span class="title function_">setState</span>(&#123; data, <span class="attr">isLoading</span>: <span class="literal">false</span>, <span class="attr">error</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!cancelled) &#123;</span><br><span class="line">          <span class="title function_">setState</span>(&#123; <span class="attr">data</span>: <span class="literal">null</span>, <span class="attr">isLoading</span>: <span class="literal">false</span>, error &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      cancelled = <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [url]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserProfile</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: user, isLoading, error &#125; = <span class="title function_">useFetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isLoading) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Spinner</span> /&gt;</span></span>;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Error</span> <span class="attr">message</span>=<span class="string">&#123;error.message&#125;</span> /&gt;</span></span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>4️⃣useMediaQuery（响应式）</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useMediaQuery</span>(<span class="params">query</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [matches, setMatches] = <span class="title function_">useState</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(query).<span class="property">matches</span>,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> media = <span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(query);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">listener</span> = (<span class="params"></span>) =&gt; <span class="title function_">setMatches</span>(media.<span class="property">matches</span>);</span><br><span class="line">    media.<span class="title function_">addEventListener</span>(<span class="string">&quot;change&quot;</span>, listener);</span><br><span class="line">    <span class="title function_">setMatches</span>(media.<span class="property">matches</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> media.<span class="title function_">removeEventListener</span>(<span class="string">&quot;change&quot;</span>, listener);</span><br><span class="line">  &#125;, [query]); <span class="comment">// 不必依赖 matches</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> matches;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ResponsiveComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> isMobile = <span class="title function_">useMediaQuery</span>(<span class="string">&quot;(max-width: 768px)&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> isTablet = <span class="title function_">useMediaQuery</span>(<span class="string">&quot;(min-width: 769px) and (max-width: 1024px)&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;isMobile ? &quot;手机视图&quot; : isTablet ? &quot;平板视图&quot; : &quot;桌面视图&quot;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ResponsiveComponent</span>;</span><br></pre></td></tr></table></figure><h4 id="4）高级模式"><a href="#4）高级模式" class="headerlink" title="4）高级模式"></a><strong><font color='#10c300'>4）高级模式</font></strong></h4><p><strong>1️⃣组合多个 Hooks（自定义 Hook 使用其他自定义 Hook）</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useWindowSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [size, setSize] = <span class="title function_">useState</span>(&#123; <span class="attr">width</span>: <span class="number">0</span>, <span class="attr">height</span>: <span class="number">0</span> &#125;);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">update</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">      <span class="title function_">setSize</span>(&#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="variable language_">window</span>.<span class="property">innerHeight</span>,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, update);</span><br><span class="line">    <span class="title function_">update</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;resize&quot;</span>, update);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useBreakpoint</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; width &#125; = <span class="title function_">useWindowSize</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">isMobile</span>: width &lt; <span class="number">768</span>,</span><br><span class="line">      <span class="attr">isTablet</span>: width &gt;= <span class="number">768</span> &amp;&amp; width &lt; <span class="number">1024</span>,</span><br><span class="line">      <span class="attr">isDesktop</span>: width &gt;= <span class="number">1024</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [width]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> breakpoints = <span class="title function_">useBreakpoint</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Current Breakpoints<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">pre</span>&gt;</span>&#123;JSON.stringify(breakpoints, null, 4)&#125;<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p><strong>2️⃣返回稳定引用（防止无限重渲染）</strong></p><p>**完整案例：**<a href="https://www.yuque.com/zhbiao/qr34us/qk5da4gmpqzhat4s/edit#Xexzy">https://www.yuque.com/zhbiao/qr34us/qk5da4gmpqzhat4s/edit#Xexzy</a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useAuth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 useCallback 保持方法引用稳定</span></span><br><span class="line">  <span class="keyword">const</span> login = <span class="title function_">useCallback</span>(<span class="title function_">async</span> (credentials) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> api.<span class="title function_">login</span>(credentials);</span><br><span class="line">    <span class="title function_">setUser</span>(user);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> logout = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    api.<span class="title function_">logout</span>();</span><br><span class="line">    <span class="title function_">setUser</span>(<span class="literal">null</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 useMemo 保持对象引用稳定</span></span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">useMemo</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      user,</span><br><span class="line">      <span class="attr">isAuthenticated</span>: !!user,</span><br><span class="line">      login,</span><br><span class="line">      logout,</span><br><span class="line">    &#125;),</span><br><span class="line">    [user, login, logout],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在可以安全地用于 useEffect 依赖</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (auth.<span class="property">isAuthenticated</span>) &#123;</span><br><span class="line">    <span class="comment">// 不会导致无限循环，因为 auth 引用稳定</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, [auth]);</span><br></pre></td></tr></table></figure><br><h4 id="5）常见陷阱"><a href="#5）常见陷阱" class="headerlink" title="5）常见陷阱"></a><strong><font color='#10c300'>5）常见陷阱</font></strong></h4><p><strong>1️⃣依赖数组遗漏</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：handler 变化时不会更新</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useEventListener</span>(<span class="params">eventName, handler</span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(eventName, handler);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(eventName, handler);</span><br><span class="line">  &#125;, []); <span class="comment">// 缺少 handler</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：但要求使用者使用 useCallback 包裹 handler</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(eventName, handler);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(eventName, handler);</span><br><span class="line">&#125;, [eventName, handler]);</span><br></pre></td></tr></table></figure><p><strong>2️⃣返回不稳定引用导致重渲染</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：每次返回新数组</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">fetchData</span>();</span><br><span class="line">  <span class="keyword">return</span> [data, data.<span class="property">length</span>]; <span class="comment">// 新数组引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：保持引用稳定</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">fetchData</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> [data, data.<span class="property">length</span>], [data]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3️⃣在条件语句中使用 Hook</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useConditionalHook</span>(<span class="params">condition</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">    <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="number">0</span>); <span class="comment">// Hook 在条件中！</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useConditionalHook</span>(<span class="params">condition</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// 根据 condition 决定是否使用 state</span></span><br><span class="line">  <span class="keyword">return</span> condition ? state : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h2 id="五、-HOC-高阶组件"><a href="#五、-HOC-高阶组件" class="headerlink" title="五、 HOC 高阶组件"></a><strong>五、 HOC 高阶组件</strong></h2><p>高阶组件是一个<strong>函数</strong>，它接收一个组件并返回一个新的组件，例如：</p><h3 id="5-1-React-memo"><a href="#5-1-React-memo" class="headerlink" title="5.1 React.memo"></a><strong><font color='red'>5.1 React.memo</font></strong></h3><p><code>memo</code> 是一个 <strong>高阶组件</strong>，用于<strong>优化函数组件的重新渲染</strong>。只有当它的 <strong>props 发生变化</strong> 时，React 才会重新渲染这个组件。否则，它会直接复用上一次的渲染结果，提高性能。</p><hr><h4 id="1）基本语法-9"><a href="#1）基本语法-9" class="headerlink" title="1）基本语法"></a><strong><font color='#10c300'>1）基本语法</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接在父组件将引入的子组件MyComponent使用memo缓存</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MemoizedComponent</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">MyComponent</span>);</span><br></pre></td></tr></table></figure><p>或者定义时直接使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接在子组件导出的时候就对当前组件MyComponent使用memo缓存</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">MyComponent</span>);</span><br></pre></td></tr></table></figure><h4 id="2）基本示例"><a href="#2）基本示例" class="headerlink" title="2）基本示例"></a><strong><font color='#10c300'>2）基本示例</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;./components/Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="string">&quot;父组件数据&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> [b] = <span class="title function_">useState</span>(<span class="number">100</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;父组件渲染了&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setData(`新数据$&#123;new Date().getTime()&#125;`)&#125;&gt;我是App：&#123;data&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Child</span> <span class="attr">b</span>=<span class="string">&#123;b&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br><span class="line">============================================分割线==============================================</span><br><span class="line"></span><br><span class="line"><span class="comment">// Child.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; memo &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;子组件渲染了&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是子组件: &#123;props.b&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 React.memo 包装组件，只有当 props 发生变化时才重新渲染</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">memo</span>(<span class="title class_">Child</span>);</span><br></pre></td></tr></table></figure><p><strong>🔍 输出结果：</strong></p><ul><li>初始化的时候父组件和子组件都渲染</li><li>触发父组件的点击事件，data状态发生变化，b状态未变，子组件未触发渲染</li></ul><p>如果用的是普通组件，哪怕 props 一样，也会重新渲染。</p><h4 id="3）工作原理-1"><a href="#3）工作原理-1" class="headerlink" title="3）工作原理"></a><strong><font color='#10c300'>3）工作原理</font></strong></h4><p><code>React.memo</code> 在渲染后，会 <strong>保存上一次的 props</strong>。<br>下一次组件渲染时，它会做一个 <strong>浅比较（shallow compare）</strong>：</p><ul><li>如果旧的 props 与新的 props 内容一致 → 跳过渲染；</li><li>如果不同 → 重新渲染。</li></ul><blockquote><p>默认比较是浅层（只比较基础类型或引用是否相同），<br>对象&#x2F;数组类型的 props 如果新建了对象，就会认为不同。</p></blockquote><h4 id="4）自定义比较函数"><a href="#4）自定义比较函数" class="headerlink" title="4）自定义比较函数"></a><strong><font color='#10c300'>4）自定义比较函数</font></strong></h4><p>有时候你希望控制“什么算变”，可以在第二个参数传入自定义比较函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Memoized</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">MyComponent</span>, <span class="function">(<span class="params">prevProps, nextProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 返回 true 表示不需要重新渲染（props 相等）</span></span><br><span class="line">  <span class="comment">// 返回 false 表示需要重渲染</span></span><br><span class="line">  <span class="keyword">return</span> prevProps.<span class="property">id</span> === nextProps.<span class="property">id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="5）常见优化场景"><a href="#5）常见优化场景" class="headerlink" title="5）常见优化场景"></a><strong><font color='#10c300'>5）常见优化场景</font></strong></h4><table><thead><tr><th>场景</th><th>说明</th></tr></thead><tbody><tr><td>列表项组件</td><td>列表中有大量子组件，父组件频繁更新</td></tr><tr><td>表单组件</td><td>输入变化导致整个页面重渲染</td></tr><tr><td>复杂组件</td><td>内部渲染代价高但 props 很稳定</td></tr><tr><td>与 useCallback 搭配</td><td>保持传入函数引用一致，避免误触更新</td></tr></tbody></table><h4 id="6）与-useCallback-和-useMemo-的配合"><a href="#6）与-useCallback-和-useMemo-的配合" class="headerlink" title="6）与 useCallback 和 useMemo 的配合"></a><strong><font color='#10c300'>6）与 useCallback 和 useMemo 的配合</font></strong></h4><p><code>React.memo</code> 只关心 props 是否变化。但是如果传入的是一个函数，每次渲染函数都是新引用，就会导致重新渲染。函数作为 <code>props</code> 的“引用不稳定”问题</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child render&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;props.count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;clicked&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">count</span>=<span class="string">&#123;count&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Parent</span>;</span><br></pre></td></tr></table></figure><p>你期望的是：只要 <code>count</code> 没变，<code>Child</code> 不应该重新渲染。但实际上，<strong>每次父组件重渲染，<code>Child</code> 都会重新渲染</strong>。</p><p><strong><font color='#00A6ED'>🌈原因：函数的引用每次都变</font></strong></p><p>在 React 中，函数也是一种对象，而对象&#x2F;函数的「引用地址」每次都会变。当父组件重新运行时 都会创建一个 <strong>新函数对象</strong>，和之前的不是同一个引用。</p><p>React.memo 的默认比较方式是浅比较（shallow compare）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oldProps.<span class="property">onClick</span> === newProps.<span class="property">onClick</span>;</span><br></pre></td></tr></table></figure><p>而因为每次重新渲染时，这个函数都是新建的，所以结果是 <code>false</code>，导致 <code>Child</code> 无论 props 内容是否逻辑相同，都会被认为变动了。</p><p>🤏**解决方案：**通过 <code>useCallback</code> 来让函数在依赖不变的情况下，保持同一个引用</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useCallback, useState&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line">unction <span class="title class_">Parent</span>() &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked&#x27;</span>);</span><br><span class="line">  &#125;, []) <span class="comment">// 👈 引用稳定</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">count</span>=<span class="string">&#123;count&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Parent</span>;</span><br></pre></td></tr></table></figure><h4 id="7）注意事项"><a href="#7）注意事项" class="headerlink" title="7）注意事项"></a><strong><font color='#10c300'>7）注意事项</font></strong></h4><table><thead><tr><th>项目</th><th>说明</th></tr></thead><tbody><tr><td>比较方式</td><td>浅比较（对象或函数需注意引用变化）</td></tr><tr><td>不适合滥用</td><td>若组件很轻量，比较成本可能高于渲染收益</td></tr><tr><td>useContext 更新仍会触发</td><td>Context 更新时会重新渲染子节点</td></tr><tr><td>不缓存 state</td><td>仅缓存渲染结果，与内部状态无关</td></tr></tbody></table><h4 id="8）总结"><a href="#8）总结" class="headerlink" title="8）总结"></a><strong><font color='#10c300'>8）总结</font></strong></h4><table><thead><tr><th>项目</th><th>内容</th></tr></thead><tbody><tr><td>作用</td><td>缓存组件渲染结果，避免不必要渲染</td></tr><tr><td>类型</td><td>高阶组件（HOC）</td></tr><tr><td>比较机制</td><td>浅层比较 props（可自定义）</td></tr><tr><td>推荐搭配</td><td><code>useCallback</code>, <code>useMemo</code> 保持 props 引用稳定</td></tr><tr><td>适用场景</td><td>子组件稳定、父组件频繁渲染、性能优化</td></tr></tbody></table><hr><p>🌟 <strong>一句话总结：</strong></p><blockquote><p><code>React.memo</code> 就像是函数组件的“PureComponent”。<br>当 props 没变时，跳过渲染，提高性能。</p></blockquote><hr><br><h2 id="七、-React-19-新特性"><a href="#七、-React-19-新特性" class="headerlink" title="七、 React 19 新特性"></a><strong>七、 React 19 新特性</strong></h2><p>React 19 带来了许多令人兴奋的新特性，特别是针对 <strong>性能优化</strong> 和 <strong>服务端组件（RSC）</strong> 的深度集成。最引人注目的是 React Compiler（React 编译器）的引入，它旨在自动处理 memoization，减少手动优化的负担。</p><h3 id="7-1-React-Compiler-React-编译器"><a href="#7-1-React-Compiler-React-编译器" class="headerlink" title="7.1 React Compiler (React 编译器)"></a><strong><font color='red'>7.1 React Compiler (React 编译器)</font></strong></h3><p>这是 React 19 最具革命性的变化。</p><ul><li><strong>过去</strong>：为了避免不必要的重新渲染，我们需要手动使用 <code>useMemo</code>、<code>useCallback</code> 和 <code>React.memo</code>。</li><li><strong>现在</strong>：React Compiler 可以在构建时自动分析代码，并自动应用优化。这意味着你可能不再需要手动写 <code>useMemo</code> 和 <code>useCallback</code> 了！</li></ul><blockquote><p>⚠️ 注意：这是一个构建工具层面的优化，而不是运行时 API。</p></blockquote><h3 id="7-2-Actions-Server-Actions"><a href="#7-2-Actions-Server-Actions" class="headerlink" title="7.2 Actions (Server Actions)"></a><strong><font color='red'>7.2 Actions (Server Actions)</font></strong></h3><p>React 19 更加拥抱服务端能力，引入了 <strong>Actions</strong> 概念，简化数据提交和变更。</p><h4 id="1）useActionState-原-useFormState"><a href="#1）useActionState-原-useFormState" class="headerlink" title="1）useActionState (原 useFormState)"></a><strong><font color='#10c300'>1）useActionState (原 useFormState)</font></strong></h4><p>用于管理表单提交的状态（如加载中、成功、失败、错误信息）。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useActionState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateName</span>(<span class="params">error, formData</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = formData.<span class="title function_">get</span>(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="string">&quot;Name required&quot;</span>;</span><br><span class="line">  <span class="keyword">await</span> api.<span class="title function_">updateUser</span>(name);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ChangeName</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [error, submitAction, isPending] = <span class="title function_">useActionState</span>(updateName, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;submitAction&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">disabled</span>=<span class="string">&#123;isPending&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;isPending ? &quot;Updating...&quot; : &quot;Update&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;error &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;error&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2）useFormStatus"><a href="#2）useFormStatus" class="headerlink" title="2）useFormStatus"></a><strong><font color='#10c300'>2）useFormStatus</font></strong></h4><p>让我们在子组件中直接获取父级 <code>&lt;form&gt;</code> 的状态，而不需要通过 props 传递 <code>loading</code> 状态。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useFormStatus &#125; <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubmitButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; pending &#125; = <span class="title function_">useFormStatus</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span>=<span class="string">&#123;pending&#125;</span>&gt;</span>&#123;pending ? &quot;提交中...&quot; : &quot;提交&quot;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;submitAction&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">SubmitButton</span> /&gt;</span> &#123;/* 自动感知 form 状态 */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-3-新的-use-API"><a href="#7-3-新的-use-API" class="headerlink" title="7.3 新的 use API"></a><strong><font color='red'>7.3 新的 <code>use</code> API</font></strong></h3><p><code>use</code> 是一个新的 API，用于在 render 中读取资源（Promise 或 Context）。</p><h4 id="1）读取-Context"><a href="#1）读取-Context" class="headerlink" title="1）读取 Context"></a><strong><font color='#10c300'>1）读取 Context</font></strong></h4><p>不再受限于只能在顶层使用 <code>useContext</code>，<code>use</code> 可以在条件语句和循环中使用（尽管仍建议在顶层）。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; use &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ThemeContext</span> <span class="keyword">from</span> <span class="string">&quot;./ThemeContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Heading</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (children == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ✅ 可以在条件判断中使用</span></span><br><span class="line">  <span class="keyword">const</span> theme = <span class="title function_">use</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> <span class="attr">theme.color</span> &#125;&#125;&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2）读取-Promise"><a href="#2）读取-Promise" class="headerlink" title="2）读取 Promise"></a><strong><font color='#10c300'>2）读取 Promise</font></strong></h4><p>可以直接在组件中等待 Promise 解析（配合 Suspense）。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; use, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Comments</span>(<span class="params">&#123; commentsPromise &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ❌ 以前：需要 useEffect + useState</span></span><br><span class="line">  <span class="comment">// ✅ 现在：直接 use(promise)</span></span><br><span class="line">  <span class="keyword">const</span> comments = <span class="title function_">use</span>(commentsPromise);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> comments.<span class="title function_">map</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;c.id&#125;</span>&gt;</span>&#123;c.text&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params">&#123; post &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&quot;加载评论中...&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Comments</span> <span class="attr">commentsPromise</span>=<span class="string">&#123;fetchComments(post.id)&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-4-Ref-作为-Prop"><a href="#7-4-Ref-作为-Prop" class="headerlink" title="7.4 Ref 作为 Prop"></a><strong><font color='red'>7.4 Ref 作为 Prop</font></strong></h3><p>终于！在 React 19 中，你不再需要 <code>forwardRef</code> 了。<code>ref</code> 现在只是一个普通的 prop。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React 19 写法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyInput</span>(<span class="params">&#123; placeholder, ref &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&#123;placeholder&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line">&lt;<span class="title class_">MyInput</span> ref=&#123;inputRef&#125; /&gt;;</span><br></pre></td></tr></table></figure><h3 id="7-5-文档元数据支持"><a href="#7-5-文档元数据支持" class="headerlink" title="7.5 文档元数据支持"></a><strong><font color='red'>7.5 文档元数据支持</font></strong></h3><p>直接在组件中渲染 <code>&lt;title&gt;</code>、<code>&lt;meta&gt;</code> 和 <code>&lt;link&gt;</code> 标签，React 会自动将它们提升到 <code>&lt;head&gt;</code> 中。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">HomePage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页 - 我的应用<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;这是首页&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><br><h2 id="八、-最佳实践"><a href="#八、-最佳实践" class="headerlink" title="八、 最佳实践"></a><strong>八、 最佳实践</strong></h2><h3 id="8-1-组件拆分与结构"><a href="#8-1-组件拆分与结构" class="headerlink" title="8.1 组件拆分与结构"></a><strong><font color='red'>8.1 组件拆分与结构</font></strong></h3><ol><li><strong>单一职责原则</strong>：每个组件只做一件事。如果一个组件超过 200 行，或者包含多个 <code>useEffect</code> 处理不同逻辑，考虑拆分。</li><li><strong>容器与展示组件分离</strong>：<ul><li><strong>展示组件 (Presentational)</strong>：只负责渲染 UI，通过 props 接收数据和回调（如 <code>Button</code>, <code>Card</code>）。</li><li><strong>容器组件 (Container)</strong>：负责获取数据、处理逻辑，将数据传给展示组件。</li></ul></li></ol><h3 id="8-2-性能优化指南"><a href="#8-2-性能优化指南" class="headerlink" title="8.2 性能优化指南"></a><strong><font color='red'>8.2 性能优化指南</font></strong></h3><ol><li><p><strong>变动分离</strong>：将变动频繁的部分（如输入框文字）抽离成独立组件，避免带动父组件重渲染。</p></li><li><p><strong>列表虚拟化</strong>：对于长列表（超过 50 条），使用 <code>react-window</code> 或 <code>react-virtuoso</code> 仅渲染可视区域的元素。</p></li><li><p><strong>懒加载 (Lazy Loading)</strong>：<br>对于非首屏路由或大型组件，使用 <code>lazy</code> 和 <code>Suspense</code>。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AdminPanel</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./AdminPanel&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Spinner</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">AdminPanel</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>避免滥用 Context</strong>：Context 适合全局配置（主题、用户、语言），不适合高频变动的数据。高频数据应考虑 <code>Zustand</code> 或 <code>Redux</code> 等专门的状态管理库。</p></li></ol><h3 id="8-3-自定义-Hooks-封装逻辑"><a href="#8-3-自定义-Hooks-封装逻辑" class="headerlink" title="8.3 自定义 Hooks 封装逻辑"></a><strong><font color='red'>8.3 自定义 Hooks 封装逻辑</font></strong></h3><p>不要在组件里堆砌 <code>useEffect</code>。将相关的逻辑（如 data fetching, event listeners）封装到自定义 Hook 中。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 不推荐</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = <span class="title function_">useState</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handle</span> = (<span class="params"></span>) =&gt; <span class="title function_">setWidth</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, handle);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;resize&quot;</span>, handle);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 推荐</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> width = <span class="title function_">useWindowSize</span>(); <span class="comment">// 逻辑复用且清晰</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-4-错误边界-Error-Boundaries"><a href="#8-4-错误边界-Error-Boundaries" class="headerlink" title="8.4 错误边界 (Error Boundaries)"></a><strong><font color='red'>8.4 错误边界 (Error Boundaries)</font></strong></h3><p>使用错误边界捕获组件树中的 JS 错误，防止整个应用崩溃（白屏）。推荐使用 <code>react-error-boundary</code> 库。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErrorBoundary</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-error-boundary&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ErrorBoundary</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>出错了！<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">MyWidget</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><hr><br><h2 id="九、-常见问题与解决方案"><a href="#九、-常见问题与解决方案" class="headerlink" title="九、 常见问题与解决方案"></a><strong>九、 常见问题与解决方案</strong></h2><h3 id="Q1-为什么我的组件渲染了两次？"><a href="#Q1-为什么我的组件渲染了两次？" class="headerlink" title="Q1: 为什么我的组件渲染了两次？"></a><strong><font color='red'>Q1: 为什么我的组件渲染了两次？</font></strong></h3><p><strong>A:</strong> 这是 React 18+ 在 <strong>开发模式 (Strict Mode)</strong> 下的预期行为。<br>React 会故意卸载并重新挂载组件（mount -&gt; unmount -&gt; mount），主要为了检测：</p><ul><li><code>useEffect</code> 清理函数是否正确。</li><li>是否有不纯的副作用。</li></ul><p><strong>生产环境只会渲染一次</strong>，无需担心性能。</p><h3 id="Q2-“Too-many-re-renders”-报错"><a href="#Q2-“Too-many-re-renders”-报错" class="headerlink" title="Q2: “Too many re-renders” 报错"></a><strong><font color='red'>Q2: “Too many re-renders” 报错</font></strong></h3><p><strong>A:</strong> 通常是因为你在<strong>渲染阶段</strong>直接调用了 <code>setState</code>。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="title function_">setCount</span>(<span class="number">1</span>); <span class="comment">// 🔴 每次渲染又触发更新 -&gt; 死循环</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setCount</span>(<span class="number">1</span>);</span><br><span class="line">&#125;, []); <span class="comment">// 仅在挂载时执行</span></span><br></pre></td></tr></table></figure><h3 id="Q3-useEffect-依赖警告-exhaustive-deps"><a href="#Q3-useEffect-依赖警告-exhaustive-deps" class="headerlink" title="Q3: useEffect 依赖警告 (exhaustive-deps)"></a><strong><font color='red'>Q3: useEffect 依赖警告 (exhaustive-deps)</font></strong></h3><p><strong>A:</strong> ESLint 警告你遗漏了依赖项。</p><ul><li><strong>不要忽略它</strong>：忽略通常会导致闭包陷阱（读到旧值）。</li><li><strong>解决方案</strong>：<ol><li>将函数移到 <code>useEffect</code> 内部。</li><li>使用 <code>useCallback</code> 包裹函数。</li><li>如果真的只需要执行一次，检查逻辑是否正确，或者用 <code>useRef</code> 保存不需要触发更新的值。</li></ol></li></ul><h3 id="Q4-为什么-console-log-打印-State-总是旧值？"><a href="#Q4-为什么-console-log-打印-State-总是旧值？" class="headerlink" title="Q4: 为什么 console.log 打印 State 总是旧值？"></a><strong><font color='red'>Q4: 为什么 console.log 打印 State 总是旧值？</font></strong></h3><p><strong>A:</strong> <code>setState</code> 是<strong>异步</strong>（批处理）的。调用后状态不会立刻改变，而是等到下一次渲染。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">setCount</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// 仍然是 0 (旧值)</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方法：使用 useEffect 监听变化</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// 10 (新值)</span></span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><h3 id="Q5-A-component-is-changing-an-uncontrolled-input-to-be-controlled"><a href="#Q5-A-component-is-changing-an-uncontrolled-input-to-be-controlled" class="headerlink" title="Q5: A component is changing an uncontrolled input to be controlled"></a><strong><font color='red'>Q5: A component is changing an uncontrolled input to be controlled</font></strong></h3><p><strong>A:</strong> 这通常是因为你给 input 的 <code>value</code> 传了 <code>undefined</code> 或 <code>null</code>。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：初始是 undefined (非受控)，后来变成 &#x27;hello&#x27; (受控)</span></span><br><span class="line"><span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>();</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;text&#125;</span> /&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：给初始值</span></span><br><span class="line"><span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="Q6-如何处理组件卸载后的异步状态更新？"><a href="#Q6-如何处理组件卸载后的异步状态更新？" class="headerlink" title="Q6: 如何处理组件卸载后的异步状态更新？"></a><strong><font color='red'>Q6: 如何处理组件卸载后的异步状态更新？</font></strong></h3><p><strong>A:</strong> 在 <code>useEffect</code> 中发起异步请求时，如果组件在请求完成前被卸载，尝试更新状态可能会导致警告（React 18 前）或潜在的竞态条件。</p><p><strong>🤔 为什么说“组件可能已卸载”？</strong></p><p>由于 <code>fetch</code> 是异步的（网络请求需要时间），在请求发出后到响应返回前的这段时间内，用户可能已经点击了路由跳转、关闭了弹窗或条件渲染导致该组件被销毁。<br>此时代码执行到 <code>.then(setUser)</code> 时，实际上是在试图更新一个“已经不存在的组件”的状态。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 问题：组件卸载后更新状态</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserData</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title function_">setUser</span>(data)); <span class="comment">// 如果此时用户已经离开当前页面，组件已卸载，这里就会报错</span></span><br><span class="line">  &#125;, [userId]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决：使用 AbortController (推荐)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserData</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>(); <span class="comment">// 1. 创建控制器</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123; <span class="attr">signal</span>: controller.<span class="property">signal</span> &#125;) <span class="comment">// 2. 绑定 signal</span></span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title function_">setUser</span>(data))</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 3. 忽略因取消导致的错误</span></span><br><span class="line">        <span class="keyword">if</span> (err.<span class="property">name</span> !== <span class="string">&quot;AbortError&quot;</span>) <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 组件卸载或 userId 变化时取消请求</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> controller.<span class="title function_">abort</span>();</span><br><span class="line">  &#125;, [userId]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ⚠️ 传统解法：使用 cleanup function + 标记变量 (isMounted)</span></span><br><span class="line"><span class="comment">// 这种方法不终止网络请求，只是不执行 setState，浪费流量但能避免报错</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserDataFallback</span>(<span class="params">&#123; userId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> isMounted = <span class="literal">true</span>; <span class="comment">// 1. 设置标记</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 2. 只有组件还在挂载中时才更新状态</span></span><br><span class="line">        <span class="keyword">if</span> (isMounted) <span class="title function_">setUser</span>(data);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 清理函数：组件卸载时将标记设为 false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      isMounted = <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [userId]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;React-初学者完全指南-React-18-19&quot;&gt;&lt;a href=&quot;#React-初学者完全指南-React-18-19&quot; class=&quot;headerlink&quot; title=&quot;React 初学者完全指南 (React 18 &amp;amp; 19)&quot;&gt;&lt;/a&gt;Rea</summary>
      
    
    
    
    <category term="框架与生态" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6%E4%B8%8E%E7%94%9F%E6%80%81/"/>
    
    
    <category term="react18" scheme="http://example.com/tags/react18/"/>
    
    <category term="react19" scheme="http://example.com/tags/react19/"/>
    
  </entry>
  
  <entry>
    <title>React 类组件开发全攻略</title>
    <link href="http://example.com/posts/4179c0b9543543.html"/>
    <id>http://example.com/posts/4179c0b9543543.html</id>
    <published>2025-12-02T09:28:38.000Z</published>
    <updated>2026-03-01T16:07:38.352Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、组件与类组件"><a href="#一、组件与类组件" class="headerlink" title="一、组件与类组件"></a><strong><font color='red'>一、组件与类组件</font></strong></h2><p>组件其实就是一段封装了 HTML、CSS、JS 的代码，最终表现为一个自定义标签。</p><p>组件都有自己独立的作用域：</p><blockquote><p>React 中的组件分为两大类：</p><ol><li>类组件（本手册重点）</li><li>函数组件</li></ol></blockquote><h3 id="2-1、类组件"><a href="#2-1、类组件" class="headerlink" title="2.1、类组件"></a><strong><font color='#10c300'>2.1、类组件</font></strong></h3><p>要将 React 组件定义为类，请继承内置的 Component 类并定义 render 方法：</p><p><strong>基本结构</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>自定义类组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return后面不写html标签直接换行 则需要用括号包裹</span></span><br><span class="line">    <span class="comment">// return (</span></span><br><span class="line">    <span class="comment">//     &lt;div&gt;自定义类组件&lt;/div&gt;</span></span><br><span class="line">    <span class="comment">// )</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用组件</span></span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h4 id="1）关于Fragment"><a href="#1）关于Fragment" class="headerlink" title="1）关于Fragment "></a><strong><font color='cornflowerblue'>1）关于Fragment </font></strong></h4><p>这个空标签被称作 Fragment。React Fragment 允许你将子元素分组，而不会在 HTML 结构中添加额外节点。</p><p>类似vue中的<code>&lt;templete&gt;&lt;/templete&gt;</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span>&gt;</span>111<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>, <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>222<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>];</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br><h4 id="2）props"><a href="#2）props" class="headerlink" title="2）props"></a><strong><font color='cornflowerblue'>2）props</font></strong></h4><p>组件的属性类似于函数的参数，可以让组件接收外面的数据，展现出不同的结果。</p><blockquote><p>props是类组件⾃带的属性，代表所有属性的集合</p></blockquote><p>**注意：**属性不能更改，因为属性是从外部传⼊的并不是组件自己的数据，所有没权利更改。如果想更改只能去修改数据源，让他重新传⼀个新属性。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; name &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello，&#123;name&#125; <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">name</span>=<span class="string">&quot;张三&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">name</span>=<span class="string">&quot;李四&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">name</span>=<span class="string">&quot;王五&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">name</span>=<span class="string">&quot;赵六&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br><h5 id="a、props-children"><a href="#a、props-children" class="headerlink" title="a、props.children "></a><strong><font color='orange'>a、props.children </font></strong></h5><p>类似vue中的插槽</p><blockquote><p>如果在组件标签内写内容，通过props.children读取<br>如果传⼊单个内容，返回的就是⼀个对象，如果传⼊多个内容的话，返回的就是数组</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; children &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>一级标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>二级主题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Welcome</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/&gt;</span></span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果想把组件标签内的多个内容渲染到不同位置,通过数组索引访问即可</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">props</span>);</span><br><span class="line">    <span class="keyword">let</span> &#123; children &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children[1]&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>一级标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children[0]&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>二级主题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Welcome</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br><h4 id="3）state"><a href="#3）state" class="headerlink" title="3）state "></a><strong><font color='cornflowerblue'>3）state </font></strong></h4><ul><li>state是属于组件内部私有的，外部无法访问</li><li>state 用于存储组件的动态数据，当组件的 state 更新时，就会执行render函数，组件会重新渲染以更新页面</li></ul><p>使用state必须先定义初始值：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义初始状态的两种⽅式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.在构造器⾥定义</span></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">        <span class="attr">num</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.在类中直接定义</span></span><br><span class="line">state = &#123;</span><br><span class="line">    <span class="attr">num</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h5 id="a、何时使用状态？"><a href="#a、何时使用状态？" class="headerlink" title="a、何时使用状态？"></a><strong><font color='orange'>a、何时使用状态？</font></strong></h5><ul><li>组件中什么东西将来会变化，就把什么东西定义成状态</li><li>只要修改了状态，组件就会重新渲染</li></ul><h5 id="b、state-的使用"><a href="#b、state-的使用" class="headerlink" title="b、state 的使用"></a><strong><font color='orange'>b、state 的使用</font></strong></h5><p><strong>1、不能直接修改state，必须采取setState方法去更改</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">num</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 方式一：</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">// 方式二：推荐 传入函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">prevState</span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">num</span>: prevState.<span class="property">num</span> + <span class="number">1</span>,</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; num &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;num&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.add&#125;</span>&gt;</span>点击增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br><p><strong>2、数组和对象的更改</strong></p><p>对于数组和对象，必须整体替换，即</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">数组名: 新数组</span><br><span class="line">对象: 新对象</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">num</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">score</span>: [<span class="string">&quot;语文90&quot;</span>, <span class="string">&quot;数学99&quot;</span>],</span><br><span class="line">    <span class="attr">information</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;JACK&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">num</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span> + <span class="number">1</span>,</span><br><span class="line">      <span class="attr">score</span>: [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">score</span>, <span class="string">&quot;英语59&quot;</span>],</span><br><span class="line">      <span class="attr">information</span>: &#123; ...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">information</span>, <span class="attr">links</span>: <span class="string">&quot;唱歌&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; num, score, information &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;num&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>成绩：&#123;score&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>信息：&#123;JSON.stringify(information)&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.change&#125;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><p><strong>3、state的更新可能是异步的（出于性能考虑）</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">num</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">num</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span> + <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span>); <span class="comment">// 第一次点击修改时为：1 因此证明更新是异步的</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; num &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;num&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.change&#125;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><p>如果想同步获取数据，那么可以使用setState的第⼆个参数</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">num</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">num</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span> + <span class="number">1</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; num &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;num&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.change&#125;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><p><strong>4、state的更新可能会被合并</strong></p><p>连续多次修改state，出于性能考虑，会只执行⼀次。</p><p>因为state中的值发生变化render函数就会执行一次，即页面渲染一次。如果这里遍历十次页面渲染十次就会影响性能。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">num</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">10</span>; index++) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span>); <span class="comment">// 打印10个1</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">num</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span> + <span class="number">1</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; num &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;num&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> // 页面展示的确是2</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.change&#125;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><p>如果不想合并多次更改state的操作，可以通过给setState传入函数的形式，返回新的状态</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">num</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">prev</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 代表的是上⼀次更新的状态</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(prev.<span class="property">num</span>); <span class="comment">// 1,2,3,4,5,6,7,8,9,10</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="comment">// 返回值就是你想把什么状态改成什么</span></span><br><span class="line">          <span class="attr">num</span>: prev.<span class="property">num</span> + <span class="number">1</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; num &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;num&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.change&#125;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h4 id="4）类组件完整结构"><a href="#4）类组件完整结构" class="headerlink" title="4）类组件完整结构"></a><strong><font color='cornflowerblue'>4）类组件完整结构</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Qq</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="comment">// 定义数据</span></span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">nickname</span>: <span class="string">&quot;爷傲奈我何&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// js逻辑</span></span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">nickname</span>: <span class="string">&quot;更换数据了&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// html</span></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; nickname &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;nickname&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h2 id="三、事件处理"><a href="#三、事件处理" class="headerlink" title="三、事件处理"></a><strong><font color='red'>三、事件处理</font></strong></h2><h3 id="3-1、基本语法"><a href="#3-1、基本语法" class="headerlink" title="3.1、基本语法"></a><strong><font color='#10c300'>3.1、基本语法</font></strong></h3><ul><li>React 事件绑定属性的命名采用驼峰式写法，而不是小写</li><li>等号后面跟的不是字符串，而是函数名</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="3-2、关于this指向问题"><a href="#3-2、关于this指向问题" class="headerlink" title="3.2、关于this指向问题"></a><strong><font color='#10c300'>3.2、关于this指向问题</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;我是一个状态&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// undefined</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">msg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><p><strong><code>这里的this是undefined</code></strong><br>react中的onClick是⼀个自定义的事件名，中间经历过⼀次赋值（onClick&#x3D;{this.fn}），就是把等号后面的函数名赋给了前面的onClick，所以导致this丢失。</p><p>以下代码可以演示为什么经历过⼀次赋值，this会丢失：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正常调用能取到this</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">display</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">display</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将函数当做一个实参传给fn函数的形参，这里相当于一次赋值，丢失this</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">display</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// undefined</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="title function_">cb</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>(obj.<span class="property">display</span>);</span><br></pre></td></tr></table></figure><br><h3 id="3-3、如何解决this丢失的问题？"><a href="#3-3、如何解决this丢失的问题？" class="headerlink" title="3.3、如何解决this丢失的问题？"></a><strong><font color='#10c300'>3.3、如何解决this丢失的问题？</font></strong></h3><h4 id="1）在构造器中绑定this"><a href="#1）在构造器中绑定this" class="headerlink" title="1）在构造器中绑定this"></a><strong><font color='cornflowerblue'>1）在构造器中绑定this</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fn</span> = <span class="variable language_">this</span>.<span class="property">fn</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>); <span class="comment">// 在构造器⾥完成this绑定</span></span><br><span class="line">  &#125;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;我是一个状态&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">msg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h4 id="2）调用的时候绑定"><a href="#2）调用的时候绑定" class="headerlink" title="2）调用的时候绑定 "></a><strong><font color='cornflowerblue'>2）调用的时候绑定 </font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="variable language_">this</span>.<span class="property">fn</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)&#125;&gt;按钮&lt;/button&gt;</span><br></pre></td></tr></table></figure><br><h4 id="3）使用箭头函数-最推荐"><a href="#3）使用箭头函数-最推荐" class="headerlink" title="3）使用箭头函数(最推荐) "></a><strong><font color='cornflowerblue'>3）使用箭头函数(最推荐) </font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;我是一个状态&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使⽤箭头函数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">msg</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="3-4、函数参数的传递"><a href="#3-4、函数参数的传递" class="headerlink" title="3.4、函数参数的传递"></a><strong><font color='#10c300'>3.4、函数参数的传递</font></strong></h3><blockquote><p>注意一定不能直接写 <code>函数名()</code>，这种是函数调用语句。<br>React 中的事件后面跟的是函数名或者函数体（匿名函数）。</p></blockquote><h4 id="1）传入匿名函数的形式"><a href="#1）传入匿名函数的形式" class="headerlink" title="1）传入匿名函数的形式"></a><strong><font color='cornflowerblue'>1）传入匿名函数的形式</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;我是一个状态&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  fn = <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          this.fn(66);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        按钮</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h4 id="2）bind的方式"><a href="#2）bind的方式" class="headerlink" title="2）bind的方式"></a><strong><font color='cornflowerblue'>2）bind的方式</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="variable language_">this</span>.<span class="property">fn</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>, <span class="number">5</span>)&#125;&gt;按钮&lt;/button&gt;</span><br></pre></td></tr></table></figure><br><h4 id="3）案例"><a href="#3）案例" class="headerlink" title="3）案例"></a><strong><font color='cornflowerblue'>3）案例</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">bgColor</span>: <span class="string">&quot;rgb(255,255,255)&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>);</span><br><span class="line">    <span class="keyword">const</span> g = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>);</span><br><span class="line">    <span class="keyword">const</span> b = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">bgColor</span>: <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> box = &#123;</span><br><span class="line">      <span class="attr">width</span>: <span class="string">&quot;100px&quot;</span>,</span><br><span class="line">      <span class="attr">height</span>: <span class="string">&quot;100px&quot;</span>,</span><br><span class="line">      <span class="attr">border</span>: <span class="string">&quot;1px solid #ccc&quot;</span>,</span><br><span class="line">      <span class="attr">background</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">bgColor</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;box&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>切换<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h2 id="四、组件之间的传值"><a href="#四、组件之间的传值" class="headerlink" title="四、组件之间的传值"></a><strong><font color='red'>四、组件之间的传值</font></strong></h2><h3 id="4-1、父传子-props"><a href="#4-1、父传子-props" class="headerlink" title="4.1、父传子(props)"></a><strong><font color='#10c300'>4.1、父传子(props)</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;我是父组件的数据&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; msg &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是父组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Child</span> <span class="attr">a</span>=<span class="string">&#123;msg&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; a &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>我是子组件，&#123;a&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">GrandChild</span> <span class="attr">b</span>=<span class="string">&#123;a&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">GrandChild</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h5</span>&gt;</span>我是孙子组件，&#123;props.b&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Parent</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="4-2、子传父-回调函数"><a href="#4-2、子传父-回调函数" class="headerlink" title="4.2、子传父(回调函数)"></a><strong><font color='#10c300'>4.2、子传父(回调函数)</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  fn = <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">msg</span>: val,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是父组件, 这是子组件传来的数据：&#123;this.state.msg || &quot;______&quot;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Child</span> <span class="attr">fn</span>=<span class="string">&#123;this.fn&#125;</span> /&gt;</span> // 1、将fn方法 通过方法传给子组件</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;我是子组件的数据&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  fn1 = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 2、子组件通过props接收fn方法 并且调用传参</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">msg</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn1&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          我是子组件，点击可将子组件数据传给父组件</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Parent</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="4-3、案例"><a href="#4-3、案例" class="headerlink" title="4.3、案例"></a><strong><font color='#10c300'>4.3、案例</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Qq</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">nickname</span>: <span class="string">&quot;爷傲奈我何&quot;</span>,</span><br><span class="line">    <span class="attr">show</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  edit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">show</span>: <span class="string">&quot;block&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  nclose = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">show</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  changeName = <span class="function">(<span class="params">nickname</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      nickname,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; nickname, show &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;nickname&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.edit&#125;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">nkname</span>=<span class="string">&#123;nickname&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">show</span>=<span class="string">&#123;show&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">nclose</span>=<span class="string">&#123;this.nclose&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">changeName</span>=<span class="string">&#123;this.changeName&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Modal</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; nkname, show, nclose, changeName &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;sbox&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">display:</span> <span class="attr">show</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;nkname&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;nclose&#125;</span>&gt;</span>关闭弹窗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> changeName(&quot;不吃香菜&quot;)&#125;&gt;改名称<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Qq</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h2 id="五、条件渲染"><a href="#五、条件渲染" class="headerlink" title="五、条件渲染"></a><strong><font color='red'>五、条件渲染</font></strong></h2><p>通常你的组件会需要根据不同的情况显示不同的内容。在 React 中，你可以通过使用 JavaScript 的 <code>if</code> 语句、<code>&amp;&amp;</code> 和 <code>? :</code> 运算符来选择性地渲染 JSX。</p><h3 id="5-1、基本写法"><a href="#5-1、基本写法" class="headerlink" title="5.1、基本写法"></a><strong><font color='#10c300'>5.1、基本写法</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里也可以用解构 &#123;flag&#125;</span></span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">flag</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎您尊贵的会员<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>下午好，普通用户<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">flag</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">flag</span>=<span class="string">&#123;false&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br><h3 id="5-2、可以返回null"><a href="#5-2、可以返回null" class="headerlink" title="5.2、可以返回null"></a><strong><font color='#10c300'>5.2、可以返回null</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">flag</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Vip</span> /&gt;</span></span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Vip</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是尊贵的vip<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">flag</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">flag</span>=<span class="string">&#123;false&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br><h3 id="5-3、-运算符"><a href="#5-3、-运算符" class="headerlink" title="5.3、&amp;&amp;运算符"></a><strong><font color='#10c300'>5.3、&amp;&amp;运算符</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Email</span>(<span class="params">&#123; msg &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> msg.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>你有&#123;msg.length&#125;条消息待处理<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">&quot;下午吃什么&quot;</span>, <span class="string">&quot;晚上吃什么&quot;</span>, <span class="string">&quot;明天吃什么&quot;</span>];</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Email</span> <span class="attr">msg</span>=<span class="string">&#123;arr&#125;</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="5-4、三元表达式"><a href="#5-4、三元表达式" class="headerlink" title="5.4、三元表达式"></a><strong><font color='#10c300'>5.4、三元表达式</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params">&#123; flag &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> flag ? <span class="language-xml"><span class="tag">&lt;<span class="name">Vip</span> /&gt;</span></span> : <span class="language-xml"><span class="tag">&lt;<span class="name">Normal</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Vip</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是尊贵的vip<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Normal</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是黄金普通用户<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">flag</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h2 id="六、列表渲染"><a href="#六、列表渲染" class="headerlink" title="六、列表渲染"></a><strong><font color='red'>六、列表渲染</font></strong></h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Week</span>(<span class="params">&#123; courseList &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;courseList.map((item, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.courseName&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> courseList = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">courseName</span>: <span class="string">&quot;第一节课&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    <span class="attr">courseName</span>: <span class="string">&quot;第二节课&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">    <span class="attr">courseName</span>: <span class="string">&quot;第三节课&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">    <span class="attr">courseName</span>: <span class="string">&quot;第四节课&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Week</span> <span class="attr">courseList</span>=<span class="string">&#123;courseList&#125;</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><p><strong><code>为什么需要key？</code></strong></p><p>key是用来给列表中的每一项做标记，后续更新只更新有差别的部分，不变的部分就不更新</p><p>不要用index当key，key要求是独一无二的字符串，一般由后端返回</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在原生js中，假如有一个渲染的列表如下：</span></span><br><span class="line">&lt;li&gt;<span class="number">1</span>&lt;/li&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="comment">// 当数据发生变化，变成：</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="comment">// 对于js来说不会因为只变了一个就只删除这一个然后创建一个新的，而是整个列表都删除，创建新的全部重新创建，这样列表数据多了就会造成性能问题</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在react和vue中这种列表如果变化了，不会立马去更新。因为react和vue有一个虚拟dom，每次列表数据更新，就会先去更新虚拟dom（更新很快），然后和真实dom做对比（这种对比就是diff算法）去更新改动的地方。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// key是用来给列表中的每一项做标记，后续更新只更新有差别的部分，不变的部分就不更新</span></span><br></pre></td></tr></table></figure><p><strong><code>不要用index当key，key要求是独一无二的字符串</code></strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202507160102927.png" alt="image-20250716010216779"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为什么不用index索引去当key呢？</span></span><br><span class="line">如果用索引当key，那么图一列表以此是<span class="number">012345</span>。如果某天将列表第二个删除了(图<span class="number">2</span>)，那么是不是列表第一个之后的key全部都发生变化了，原来列表内容<span class="number">3</span>的key是<span class="number">2</span>，现在列表内容3key是<span class="number">1</span>了，这时候需求demo和真实dom一对比，会去更新变化的地方即列表内容<span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span>的都要去做更新，如果又后端返回一个唯一id值，那么就不存在这种问题</span><br></pre></td></tr></table></figure><br><h2 id="七、表单处理"><a href="#七、表单处理" class="headerlink" title="七、表单处理"></a><strong><font color='red'>七、表单处理</font></strong></h2><p>在react中表单的处理通常和其他元素不一样， 正常情况下我们把html中会发上变化的地方都设置为state，然后通过更改state的更新视图</p><p>在 HTML 中，表单元素<code>（如&lt;input&gt;、 &lt;textarea&gt; 和 &lt;select&gt;）</code>通常自己维护 state，并根据用户输入进行更新。<br>而在 React 中，可变状态（mutable state）通常保存在组件的 state 属性中，并且只能通过使用 setState()来更新。</p><p>渲染表单的 React 组件还控制着用户输入过程中表单发生的操作。被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p><br><h3 id="7-1、基本使用"><a href="#7-1、基本使用" class="headerlink" title="7.1、基本使用"></a><strong><font color='#10c300'>7.1、基本使用</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Input</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  handleChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">value</span>: e.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span> <span class="attr">value</span>=<span class="string">&#123;this.state.value&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;this.state.value&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="7-2、多个表单元素"><a href="#7-2、多个表单元素" class="headerlink" title="7.2、多个表单元素"></a><strong><font color='#10c300'>7.2、多个表单元素</font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Input</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">userValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">emailValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  handleChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> name = e.<span class="property">target</span>.<span class="property">name</span> === <span class="string">&quot;user&quot;</span> ? <span class="string">&quot;userValue&quot;</span> : <span class="string">&quot;emailValue&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      [name]: e.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">userValue</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">emailValue</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;this.state.userValue&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;user&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;this.state.emailValue&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="7-3、select、checkbox、radio等特殊元素"><a href="#7-3、select、checkbox、radio等特殊元素" class="headerlink" title="7.3、select、checkbox、radio等特殊元素"></a><font color='red' size="">7.3、select、checkbox、radio等特殊元素</font></h3><h4 id="1）select用法"><a href="#1）select用法" class="headerlink" title="1）select用法"></a><strong><font color='cornflowerblue'>1）select用法</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Input</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;shanghai&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">value</span>: e.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">value</span>=<span class="string">&#123;this.state.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.change&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shanghai&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shenzhen&quot;</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h4 id="2）checkbox用法"><a href="#2）checkbox用法" class="headerlink" title="2）checkbox用法"></a><strong><font color='cornflowerblue'>2）checkbox用法</font></strong></h4><p><strong><code>操作他的checked属性</code></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Input</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">isChecked</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">isChecked</span>: e.<span class="property">target</span>.<span class="property">checked</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">checked</span>=<span class="string">&#123;this.state.isChecked&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;this.change&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h4 id="3）radio的用法"><a href="#3）radio的用法" class="headerlink" title="3）radio的用法"></a><strong><font color='cornflowerblue'>3）radio的用法</font></strong></h4><p><strong><code>通过更改value，间接操作checked属性</code></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Input</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">n</span>: <span class="string">&quot;option2&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">n</span>: e.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;city&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&quot;option1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">checked</span>=<span class="string">&#123;this.state.n</span> == <span class="string">&quot;option1&quot;</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;this.change&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;city&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&quot;option2&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">checked</span>=<span class="string">&#123;this.state.n</span> == <span class="string">&quot;option2&quot;</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;this.change&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h2 id="八、ref"><a href="#八、ref" class="headerlink" title="八、ref"></a><strong><font color='red'>八、ref</font></strong></h2><blockquote><p>什么是ref：ref是React提供的用来操纵React组件实例或者DOM元素的接口。</p><p>基本跟vue中的ref用法一样 <strong><code>ref拿到的是真实dom </code></strong></p></blockquote><p>简单来说，就是提供了一种方式能让你直接获取到dom元素对象或者组件实例。</p><p><strong><code>ref不能用于函数组件上（函数组件没有实例），ref只适用于实例对象上，例如class类</code></strong></p><h3 id="8-1、回调形式的ref-（老版本推荐）"><a href="#8-1、回调形式的ref-（老版本推荐）" class="headerlink" title="8.1、回调形式的ref （老版本推荐）"></a><strong><font color='#10c300'>8.1、回调形式的ref （老版本推荐）</font></strong></h3><h4 id="1）在元素中"><a href="#1）在元素中" class="headerlink" title="1）在元素中"></a><strong><font color='cornflowerblue'>1）在元素中</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  test = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ins</span>); <span class="comment">// 获取到p标签这个dom</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;(dom)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            this.ins = dom;</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          你好啊</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.test&#125;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Dome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h4 id="2）在组件中"><a href="#2）在组件中" class="headerlink" title="2）在组件中"></a><strong><font color='cornflowerblue'>2）在组件中</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  test = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ins</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ins1</span>.<span class="property">state</span>.<span class="property">msg</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ins1</span>.<span class="title function_">fn</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;(dom)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            this.ins = dom;</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          你好啊</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.test&#125;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;(dom)</span> =&gt;</span> (this.ins1 = dom)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;我是子组件的数据&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">666666666</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>我是子组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Dome</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="8-2、React-createRef-（适用于类组件）"><a href="#8-2、React-createRef-（适用于类组件）" class="headerlink" title="8.2、React.createRef （适用于类组件） "></a><strong><font color='#10c300'>8.2、React.createRef （适用于类组件） </font></strong></h3><blockquote><p>通过在class中使用React.createRef()方法创建一些变量，可以将这些变量绑定到标签的ref中</p><p>那么该变量的current则指向绑定的标签dom</p></blockquote><h4 id="1）在元素中-1"><a href="#1）在元素中-1" class="headerlink" title="1）在元素中"></a><strong><font color='cornflowerblue'>1）在元素中</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  myRef = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">myRef</span>.<span class="property">current</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;</span>&gt;</span>这是一个组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Demo</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h4 id="2）在组件中-1"><a href="#2）在组件中-1" class="headerlink" title="2）在组件中"></a><strong><font color='cornflowerblue'>2）在组件中</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  myRef = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">  myRef1 = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">myRef</span>.<span class="property">current</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">myRef1</span>.<span class="property">current</span>.<span class="property">state</span>.<span class="property">msg</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">myRef1</span>.<span class="property">current</span>.<span class="title function_">childFn</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;</span>&gt;</span>这是一个组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef1&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;我是一个子组件数据&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  childFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">6666666</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>我是子组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Demo</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h3 id="8-3、useRef-（适用于函数组件）"><a href="#8-3、useRef-（适用于函数组件）" class="headerlink" title="8.3、useRef （适用于函数组件） "></a><strong><font color='#10c300'>8.3、useRef （适用于函数组件） </font></strong></h3><p>是一个hooks，后面讲</p><br><h3 id="8-4、综合案例"><a href="#8-4、综合案例" class="headerlink" title="8.4、综合案例 "></a><strong><font color='#10c300'>8.4、综合案例 </font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(container);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  myRef = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line"></span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">value</span>: e.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">value</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">list</span>: [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">list</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">value</span>],</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">myRef</span>.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  del = <span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 注意：在 React 中不建议直接修改原状态（splice 会修改原数组）</span></span><br><span class="line">    <span class="comment">// 推荐做法：const newList = this.state.list.filter((_, i) =&gt; i !== index);</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">list</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">list</span>: [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">list</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; list &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;this.state.value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;this.change&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.add&#125;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;list.length &gt; 0 &amp;&amp;</span></span><br><span class="line"><span class="language-xml">            list.map((item, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">li</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.del(index)&#125; key=&#123;index&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                &#123;item&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Demo</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure><br><h2 id="九、脚手架搭建项目"><a href="#九、脚手架搭建项目" class="headerlink" title="九、脚手架搭建项目"></a><strong><font color='red'>九、脚手架搭建项目</font></strong></h2><h3 id="9-1、基于webpack创建项目"><a href="#9-1、基于webpack创建项目" class="headerlink" title="9.1、基于webpack创建项目 "></a><strong><font color='#10c300'>9.1、基于webpack创建项目 </font></strong></h3><p>基于webpack创建是使用create-react-app搭建项目，Create React App 是一个官方支持的创建 React 单页应用程序的方法。</p><h4 id="1）安装"><a href="#1）安装" class="headerlink" title="1）安装"></a><strong><font color='cornflowerblue'>1）安装</font></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式一</span></span><br><span class="line"><span class="comment">//全局安装脚手架</span></span><br><span class="line">npm install -g create-react-app</span><br><span class="line"><span class="comment">//利用脚手架创建项目</span></span><br><span class="line">create-react-app my-app</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二（推荐）</span></span><br><span class="line">npx create-react-app my-app</span><br><span class="line">cd my-app</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure><p>npx 是 npm5.2.0版本新增的一个工具包，定义为npm包的执行者，相比 npm，npx 会自动安装依赖包并执行某个命令。</p><p>使用npx创建项目，创建的时候会检查电脑是否有create-react-app，没有就安装create-react-app，有就跳过。</p><br><h4 id="2）生成的项目文件解读"><a href="#2）生成的项目文件解读" class="headerlink" title="2）生成的项目文件解读"></a><strong><font color='#10c300'>2）生成的项目文件解读</font></strong></h4><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202507201844527.png" alt="image-20250720184443319"></p><ul><li><p>node_modules:项目的核心模块，依赖包</p></li><li><p>public：存放静态资源文件</p><ul><li>.ico:页签的logo</li><li>index.html:唯一的页面文件，只提供根节点</li><li>manifest.json:移动端的配置一文件</li><li>robots.txt:告诉爬虫者，不可爬的页面，没有实质作用只是警告</li></ul></li><li><p>.gitignore:声明一些再在git上传的时候需要忽略的文件</p></li><li><p>package.json:项目的说明文件，有哪些依赖，依赖了哪个版本</p></li><li><p>package-lock.json：项目依赖的安装包的一些版本会做一些限制，进行版本锁定</p></li><li><p>Readme.md:作者的一些话</p></li><li><p>src</p><ul><li>App.css:App组件的样式文件</li><li>App.js 项目的根组件</li><li>App.test.js：自动化测试文件</li><li>index.css全局样式文件</li><li>index.js：项目的入口文件，html只会加载这个js文件(类似vue中main.js)</li><li>reportWebVitals.js:谷歌浏览器退出的一个浏览器性能优化的库</li><li>setupTests：针对index.js的单元测试原件</li></ul></li></ul><blockquote><p>React.StrictMode的作用</p><p>1.识别一些不安全的生命周期</p><p>2.检测意外的副作用</p><p>3.检测过时的context api</p></blockquote><br><h3 id="9-2、基于Vite创建项目"><a href="#9-2、基于Vite创建项目" class="headerlink" title="9.2、基于Vite创建项目 "></a><strong><font color='#10c300'>9.2、基于Vite创建项目 </font></strong></h3><p><strong><code>node 版本要大于 18 以上，建议用 20 版本，否则运行会报错</code></strong></p><p>使用 NPM:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest</span><br></pre></td></tr></table></figure><p>使用 Yarn:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create vite</span><br></pre></td></tr></table></figure><p>使用 PNPM:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm create vite</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202507201845867.png" alt="image-20250720184501683"></p><br><h3 id="9-3、项目的基本使用"><a href="#9-3、项目的基本使用" class="headerlink" title="9.3、项目的基本使用 "></a><strong><font color='#10c300'>9.3、项目的基本使用 </font></strong></h3><blockquote><p>组件的后缀名我们推荐用jsx，表示是一个组件</p><p>普通js后缀名就用.js</p></blockquote><p>默认引入：</p><blockquote><p>引入的时候可以不需要加文件后缀，编辑器会自动查找.jsx后缀的文件，如果找不到，会接着查找后缀为.js的文件</p><p>如果直接引入的是文件夹的名字，那么默认去查找该文件夹下的index.jsx文件。</p></blockquote><br><h2 id="十、模块化样式"><a href="#十、模块化样式" class="headerlink" title="十、模块化样式"></a><strong><font color='red'>十、模块化样式</font></strong></h2><h3 id="10-1、xxx-module-css"><a href="#10-1、xxx-module-css" class="headerlink" title="10.1、xxx.module.css "></a><strong><font color='#10c300'>10.1、xxx.module.css </font></strong></h3><p><strong>只需要将样式文件名字改 ：名字.module.css即可</strong></p><p>CSS Modules 允许通过自动创建 [filename]_[classname]__[hash] 格式的唯一 classname 来确定 CSS 的作用域,如下</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&quot;./App.module.css&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&#123;style.App&#125;</span>&gt;</span>你好<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&#123;style.title&#125;</span>&gt;</span>哈哈哈哈哈<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><br><h3 id="10-2、预处理器（Sass-Less-Stylus）"><a href="#10-2、预处理器（Sass-Less-Stylus）" class="headerlink" title="10.2、预处理器（Sass&#x2F;Less&#x2F;Stylus） "></a><strong><font color='#10c300'>10.2、预处理器（Sass&#x2F;Less&#x2F;Stylus） </font></strong></font></h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$text-color</span>: blue;</span><br><span class="line"><span class="selector-class">.component</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="variable">$text-color</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./Component.scss&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;component&quot;</span>&gt;</span>Styled Text<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="10-3、css-in-js库"><a href="#10-3、css-in-js库" class="headerlink" title="10.3、css-in-js库 "></a><strong><font color='#10c300'>10.3、css-in-js库 </font></strong></h3><p>使用JS编写CSS的库，如styled-components、emotion等</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用styled-components</span></span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">&quot;styled-components&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">StyledDiv</span> = styled.<span class="property">div</span><span class="string">`</span></span><br><span class="line"><span class="string">  color: blue;</span></span><br><span class="line"><span class="string">  font-size: 20px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">StyledDiv</span>&gt;</span>Styled Text<span class="tag">&lt;/<span class="name">StyledDiv</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h2 id="十一、组件的生命周期"><a href="#十一、组件的生命周期" class="headerlink" title="十一、组件的生命周期"></a><strong><font color='red'>十一、组件的生命周期</font></strong></h2><h3 id="11-1、生命周期图谱"><a href="#11-1、生命周期图谱" class="headerlink" title="11.1、生命周期图谱 "></a><strong><font color='#10c300'>11.1、生命周期图谱 </font></strong></h3><p>组件的生命周期函数就是在特定时间节点上会自动运行的函数</p><p><strong><code>重点：函数组件没有生命周期</code></strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202507202212214.png" alt="image-20240416135406354"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202507202212318.png" alt="image-20240416135418172"></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;constructor&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">    <span class="attr">info</span>: <span class="string">&quot;hahahaha&quot;</span>,</span><br><span class="line">    <span class="attr">flag</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//组件更新完毕的时候执行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidUpdate&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//组件挂载完毕的时候执行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidMount&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//组件即将卸载的时候执行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentWillUnmount&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">flag</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  change = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">info</span>: <span class="string">&quot;呵呵呵呵&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是App组件&#123;this.state.msg&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.change&#125;</span>&gt;</span>改info<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.state.flag &amp;&amp; <span class="tag">&lt;<span class="name">Child</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><br><h3 id="11-2、shouldComponentUpdate"><a href="#11-2、shouldComponentUpdate" class="headerlink" title="11.2、shouldComponentUpdate "></a><strong><font color='#10c300'>11.2、shouldComponentUpdate </font></strong></h3><p>shouldComponentUpdate 是一个可以在**<code>组件更新之前</code>**触发的生命周期方法，它允许你通过返回一个布尔值来决定一个组件的输出是否受当前状态或属性的改变影响而更新。如果 shouldComponentUpdate 返回 false，那么组件就不会进行更新。</p><p>简单来说就是用于更新数据时，如果更新的数据和上一次数据是一样的，理论上应该不需要再次更新组件了，但是实际上确实会更新，使用shouldComponentUpdate 则会避免这种情况，如果shouldComponentUpdate 返回false就说明数据一样，那么组件就不需要更新。</p><h4 id="1）基本用法"><a href="#1）基本用法" class="headerlink" title="1）基本用法"></a><strong><font color='cornflowerblue'>1）基本用法</font></strong></h4><p>shouldComponentUpdate 接收两个参数：nextProps 和 nextState，分别表示组件即将接收的新属性和新状态。你需要在这个方法中比较当前组件的属性和状态与新的属性和状态，然后返回一个布尔值来决定组件是否需要更新。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps,nextState</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(nextState.<span class="property">msg</span>===<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">msg</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h4 id="2）案例"><a href="#2）案例" class="headerlink" title="2）案例"></a><strong><font color='cornflowerblue'>2）案例</font></strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.jsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&quot;world&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextState.<span class="property">msg</span> === <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">msg</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;组件更新了&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是App组件&#123;this.state.msg&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span> // 第二次点击不会执行了</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p><code>自React 16.3版本起，推荐使用 PureComponent（对于类组件） 或 React.memo (对于函数组件) 来进行浅比较，这样可以减少手动编写 shouldComponentUpdate 的需求。</code></p><br><h3 id="11-3、PureComponent"><a href="#11-3、PureComponent" class="headerlink" title="11.3、PureComponent "></a><strong><font color='#10c300'>11.3、PureComponent </font></strong></h3><p>React.PureComponent 与 React.Component 很相似，两者的区别在于 React.Component 并未实现 shouldComponentUpdate()，而 React.PureComponent 中以浅层对比 prop 和 state 的方式来实现了该函数。</p><p><strong><font color='orange'>setState存在两个不合理之处:</font></strong></p><ol><li><p>setState无论是否更新了state，render函数都会重现调用，这是不合理的</p></li><li><p>如果父组件更新了，无论子组件用没用到父组件的数据也都会重新渲染子组件，这是不合理的</p></li></ol><br><p><strong><font color='orange'>传统的解决方案：</font></strong></p><p>通过生命周期函数shouldComponentUpdate(){}判断两次不一致再更新，否则不更新</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps,nextState</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">someprops</span>===nextProps.<span class="property">someprops</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 但是这仅仅是一个属性，如果有多个属性的话，一个一个对比会比较麻烦</span></span><br></pre></td></tr></table></figure><br><p><strong><font color='orange'>因此使用PureComponent：</font></strong></p><p>直接将React.Component替换成React.PureComponent</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">  <span class="comment">// 与之前写法相同，只不过不用写shouldComponentUpdate了，会自动帮我们判断</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.jsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&quot;world&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;组件更新了&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是App组件&#123;this.state.msg&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.fn&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><br><p><strong><font color='orange'>注意：</font></strong></p><p>React.PureComponent 中的 shouldComponentUpdate() 仅作对象的浅层比较。如果对象中包含复杂的数据结构，则有可能因为无法检查深层的差别，产生错误的比对结果。仅在你的 props 和 state 较为简单时，才使用React.PureComponent，或者在深层数据结构发生变化时调用 forceUpdate() 来确保组件被正确地更新。</p><br><h2 id="十二、context多层级传值"><a href="#十二、context多层级传值" class="headerlink" title="十二、context多层级传值"></a><strong><font color='red'>十二、context多层级传值</font></strong></h2><p>Context 提供了一个无需为每层组件手动添加 props，就能在组件树间进行数据传递的方法。</p><p><strong><font color='orange'>使用步骤</font></strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建需要传递的数据React.Context()实例：括号里存放默认初始数据</span></span><br><span class="line"><span class="comment">// src\utils\context.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyContext</span>=<span class="title class_">React</span>.<span class="title function_">createContext</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MyContext</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.父组件  提供Context数据：</span></span><br><span class="line"><span class="comment">// src\App.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;./components/Child&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyContext</span> <span class="keyword">from</span> <span class="string">&quot;./utils/context&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&quot;父组件数据&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.state.msg&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是父组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Child</span> <span class="attr">msg</span>=<span class="string">&#123;this.state.msg&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.后代组件获取Context数据</span></span><br><span class="line"><span class="comment">// src\components\GrandChild.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式一：通过consumer</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyContext</span> <span class="keyword">from</span> <span class="string">&#x27;../utils/context&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GrandChild</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">MyContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;</span></span><br><span class="line"><span class="language-xml">                    (value) =&gt; (</span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是孙子组件 <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &lt;/<span class="title class_">MyContext</span>.<span class="property">Consumer</span>&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">GrandChild</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二：通过Class.contextType (类组件使用)</span></span><br><span class="line">可以通过<span class="title class_">Class</span>.<span class="property">contextType</span>直接将<span class="title class_">Context</span>对象挂载到<span class="keyword">class</span>的contextType属性，然后就可以使用<span class="variable language_">this</span>.<span class="property">context</span>对context对象进行使用</span><br><span class="line">contextType属于类的属性，不属于某个实例，所以只能在外部添加或者使用<span class="keyword">static</span>将其添加给类属性</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GrandChild</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">    <span class="comment">// static contextType=MyContext; // 这里写在类里面并没有添加到实例上去，因为添加了static</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是孙子组件 <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;this.context&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">GrandChild</span>.<span class="property">contextType</span> = <span class="title class_">MyContext</span>; <span class="comment">// 添加在类属性上面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">GrandChild</span></span><br></pre></td></tr></table></figure><br><h2 id="十三、高阶组件-HOC"><a href="#十三、高阶组件-HOC" class="headerlink" title="十三、高阶组件 (HOC)"></a><strong><font color='red'>十三、高阶组件 (HOC)</font></strong></h2><p>高阶组件（Higher-Order Component，简称HOC）是React中用于复用组件逻辑的一种高级技术。本质上，高阶组件是一个函数，它接收一个组件并返回一个新的组件。它主要用于逻辑的共享和重用，而不是直接渲染UI。这种模式类似于JavaScript中的高阶函数，那些以函数为参数或返回一个函数的函数。</p><ul><li>HOC 应当是纯函数，无副作用。</li><li>不要在 HOC 内部修改原始组件，而是返回一个新组件</li><li>高阶组件的命名一般<strong>以 “with” 开头</strong>，表示它是为组件提供附加功能的。</li></ul><h3 id="13-1、基本使用"><a href="#13-1、基本使用" class="headerlink" title="13.1、基本使用 "></a><strong><font color='#10c300'>13.1、基本使用 </font></strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>我是demo1 &#123;this.props.a&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>我是demo2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">withLog</span>(<span class="params">WrapComponent</span>) &#123;</span><br><span class="line">  <span class="comment">// 高阶函数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;挂载了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrapComponent</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span>; <span class="comment">// 传值必须在这里解构props，要不然Demo1组件拿不到传的参数a和c</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用高阶函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyCom</span> = <span class="title function_">withLog</span>(<span class="title class_">Demo1</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyCom1</span> = <span class="title function_">withLog</span>(<span class="title class_">Demo2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;父组件数据&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">MyCom</span> <span class="attr">a</span>=<span class="string">&#123;this.state.msg&#125;</span> <span class="attr">c</span>=<span class="string">&quot;1231231&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">MyCom1</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><br><h3 id="13-2、高阶组件实战"><a href="#13-2、高阶组件实战" class="headerlink" title="13.2、高阶组件实战"></a><strong><font color='#10c300'>13.2、高阶组件实战</font></strong></h3><p>请求地址</p><p>dogApi：<a href="https://dog.ceo/api/breeds/image/random">https://dog.ceo/api/breeds/image/random</a></p><p>catApi：<a href="https://api.thecatapi.com/v1/images/search">https://api.thecatapi.com/v1/images/search</a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;this.props.url&#125;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>这是一只猫<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;this.props.url&#125;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>这是一只狗<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">withAnimal</span>(<span class="params">WrapComponent, url, type</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">      <span class="attr">imgUrl</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      axios.<span class="title function_">get</span>(url).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">          <span class="attr">imgUrl</span>: type ? res.<span class="property">data</span>.<span class="property">message</span> : res.<span class="property">data</span>[<span class="number">0</span>].<span class="property">url</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrapComponent</span> <span class="attr">url</span>=<span class="string">&#123;this.state.imgUrl&#125;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Cat</span> = <span class="title function_">withAnimal</span>(<span class="title class_">MyCat</span>, <span class="string">&quot;https://api.thecatapi.com/v1/images/search&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Dog</span> = <span class="title function_">withAnimal</span>(<span class="title class_">MyDog</span>, <span class="string">&quot;https://dog.ceo/api/breeds/image/random&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;渲染&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Cat</span>&gt;</span><span class="tag">&lt;/<span class="name">Cat</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Dog</span>&gt;</span><span class="tag">&lt;/<span class="name">Dog</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><br>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一、组件与类组件&quot;&gt;&lt;a href=&quot;#一、组件与类组件&quot; class=&quot;headerlink&quot; title=&quot;一、组件与类组件&quot;&gt;&lt;/a&gt;&lt;strong&gt;&lt;font color=&#39;red&#39;&gt;一、组件与类组件&lt;/font&gt;&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;组件其实</summary>
      
    
    
    
    <category term="框架与生态" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6%E4%B8%8E%E7%94%9F%E6%80%81/"/>
    
    
    <category term="React" scheme="http://example.com/tags/React/"/>
    
    <category term="React18" scheme="http://example.com/tags/React18/"/>
    
    <category term="类组件" scheme="http://example.com/tags/%E7%B1%BB%E7%BB%84%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>Cusros的使用</title>
    <link href="http://example.com/posts/aed47f69.html"/>
    <id>http://example.com/posts/aed47f69.html</id>
    <published>2025-12-02T00:38:45.000Z</published>
    <updated>2026-03-01T16:07:38.352Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、解决限制国内使用"><a href="#一、解决限制国内使用" class="headerlink" title="一、解决限制国内使用"></a><strong><font color='red'>一、解决限制国内使用</font></strong></h3><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251115161133203.png" alt="image-20251115161133203"></p><p>原因是美国那边制裁了 claude ，限制咱们国内地区的ip使用，因此我们就无法使用了。</p><p><strong>解决步骤</strong></p><ol><li><p>打开自己的魔法工具（大家懂得）</p></li><li><p>在Cursor编辑器设置代理，ip的端口号设置成魔法工具的端口号</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251115161504320.png" alt="image-20251115161504320"></p></li><li><p>将http&#x2F;2设置成http&#x2F;1.1即可</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251115161623548.png" alt="image-20251115161623548"></p></li><li><p>测试</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251115161703956.png" alt="image-20251115161703956"></p></li></ol><br><h3 id="二、Cusros对话模式模板"><a href="#二、Cusros对话模式模板" class="headerlink" title="二、Cusros对话模式模板"></a><strong><font color='red'>二、Cusros对话模式模板</font></strong></h3><p><strong>提示词技巧总结:</strong></p><ol><li>提供上下文:提及项目语言、框架、业务背景等信息</li><li>分点描述:将复杂需求拆解为具体步骤或要求</li><li>使用技术术语:准确的术语能帮助 AI 更精准理解需求</li><li>明确边界:说明必须保留的现有功能或禁止的实现方式</li><li>示例引导:附上期望输出示例或参考代码风格</li></ol><br><h4 id="2-1、代码生成类"><a href="#2-1、代码生成类" class="headerlink" title="2.1、代码生成类"></a><strong><font color='#10c300'>2.1、代码生成类</font></strong></h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">任务类型</span>]:<span class="link">请生成一个&#123;功能描述&#125;的&#123;编程语言/框架&#125;实现</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">具体要求</span>]:</span><br><span class="line"><span class="link">1.使用&#123;特定技术/库&#125;</span></span><br><span class="line">2.包含&#123;特定功能点&#125;</span><br><span class="line">3.符合&#123;编码规范/设计模式&#125;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">请生成一个学习计划页面的HTML+CSS+Javascript实现</span><br><span class="line"></span><br><span class="line">[具体要求]:</span><br><span class="line">1.使用Tailwind Css v3和Font Awesome</span><br><span class="line">2.包含任务添加、编辑、删除功能</span><br><span class="line">3.包含日历视图展示学习计划</span><br><span class="line">4.包含学习进度可视化图表</span><br><span class="line">5.符合现代UI设计原则和响应式设计</span><br><span class="line">6.具有平滑的动画和交互效果</span><br></pre></td></tr></table></figure><br><h4 id="2-2、代码修改类"><a href="#2-2、代码修改类" class="headerlink" title="2.2、代码修改类"></a><strong><font color='#10c300'>2.2、代码修改类</font></strong></h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">任务类型</span>]:<span class="link">请帮我修改&#123;上下文:具体文件/代码片段&#125;，实现&#123;预期功能&#125;</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">当前问题</span>]:<span class="link">&#123;现有的错误/不足描述&#125;</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">具体要求</span>]:</span><br><span class="line"><span class="link">1.保持&#123;现有功能/结构&#125;不变</span></span><br><span class="line">2.使用&#123;特定方法/技术&#125;&#125;改进</span><br><span class="line">3.修复&#123;具体错误/警告&#125;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请帮我修改当前的 React 组件，优化列表渲染性能</span><br><span class="line">当前问题:滚动时列表卡顿，存在明显性能问题。要求:</span><br><span class="line">1.保持现有 UI 不变</span><br><span class="line">2.使用 React.memo 和虚拟列表技术优化</span><br><span class="line">3.添加性能监控日志</span><br></pre></td></tr></table></figure><br><h4 id="2-3、代码解释类"><a href="#2-3、代码解释类" class="headerlink" title="2.3、代码解释类"></a><strong><font color='#10c300'>2.3、代码解释类</font></strong></h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">任务类型</span>]:<span class="link">请解释&#123;代码片段/功能模块&#125;的&#123;具体方面&#125;</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">上下文信息</span>]:<span class="link">&#123;相关业务背景/技术栈&#125;</span></span><br><span class="line"></span><br><span class="line">[具体问题]</span><br><span class="line">1.&#123;不理解的语法/逻辑&#125;</span><br><span class="line">2.&#123;特定设计选择的原因]</span><br><span class="line">3.&#123;潜在的问题/优化点&#125;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">请解释这段 Typescript 代码的泛型约束和类型推导逻辑。</span><br><span class="line">上下文:这是一个用于数据验证的工具函数。</span><br><span class="line">具体问题:</span><br><span class="line">1.&lt;T extends object&gt;这里为什么要加 extends object?</span><br><span class="line">2.类型推导是如何工作的?</span><br><span class="line">3.是否存在类型安全隐患?</span><br></pre></td></tr></table></figure><br><h4 id="2-4、流程自动化类"><a href="#2-4、流程自动化类" class="headerlink" title="2.4、流程自动化类"></a><strong><font color='#10c300'>2.4、流程自动化类</font></strong></h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">任务类型</span>]:<span class="link">请创建一个自动化流程，实现&#123;目标描述&#125;</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">操作步骤</span>]:</span><br><span class="line"><span class="link">1.从&#123;数据源&#125;获取&#123;数据类型&#125;</span></span><br><span class="line">2.执行&#123;数据处理/转换操作&#125;</span><br><span class="line">3.将结果保存到&#123;目标位置&#125;</span><br><span class="line">4.触发&#123;后续操作/通知&#125;</span><br><span class="line"></span><br><span class="line">[<span class="symbol">具体要求</span>]:</span><br><span class="line"><span class="link">1.使用&#123;特定工具/API&#125;</span></span><br><span class="line">2.添加&#123;错误处理/重试机制&#125;</span><br><span class="line">3.生成&#123;日志/报告&#125;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请创建一个自动化流程，每天凌晨从 GitHub API 获取仓库星标数，保存到 Goog1e sheets 并生成趋势图。</span><br><span class="line">要求:</span><br><span class="line">1.使用 GitHub REST API V3</span><br><span class="line">2.添加异常处理和邮件通知</span><br><span class="line">3.生成周/月增长趋势图表</span><br></pre></td></tr></table></figure><br><h4 id="2-5、命令行辅助类"><a href="#2-5、命令行辅助类" class="headerlink" title="2.5、命令行辅助类"></a><strong><font color='#10c300'>2.5、命令行辅助类</font></strong></h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">任务类型</span>]:<span class="link">请提供&#123;操作场景&#125;的&#123;操作系统&#125;命令</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">具体需求</span>]:</span><br><span class="line"><span class="link">1.&#123;执行的具体操作&#125;</span></span><br><span class="line">2.包含&#123;特定参数/选项&#125;</span><br><span class="line">3.处理&#123;特殊情况/错误&#125;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请提供在 macos 上批量压缩图片的命令行方案。需求:</span><br><span class="line">1.将当前目录下所有 PNG/JPG 图片压缩 50%</span><br><span class="line">2.保留原始文件并添加“-compressed”后缀</span><br><span class="line">3.显示每个文件的压缩前后大小对比</span><br></pre></td></tr></table></figure><br><h3 id="三、Cursor精准上下文指定"><a href="#三、Cursor精准上下文指定" class="headerlink" title="三、Cursor精准上下文指定"></a><strong><font color='red'>三、Cursor精准上下文指定</font></strong></h3><p>在 Cursor 工具里，“上下文（Context）” 可理解为 <strong>让 AI 准确理解需求、辅助编码的 “信息参考范围”</strong> ，是 AI 读懂代码、精准响应的关键!</p><h4 id="3-1-Codebase-Indexing-代码库索引"><a href="#3-1-Codebase-Indexing-代码库索引" class="headerlink" title="3.1 Codebase Indexing 代码库索引"></a><strong><font color='#10c300'>3.1 Codebase Indexing 代码库索引</font></strong></h4><h5 id="1）、概念和作用"><a href="#1）、概念和作用" class="headerlink" title="1）、概念和作用"></a><strong><font color='cornflowerblue'>1）、概念和作用</font></strong></h5><p>打开项目时，每个 Cursor 实例都将初始化该工作区的索引。初始索引设置完成后，Cursor 将自动为添加到工作区的任何新文件编制索引，以使您的代码库上下文保持最新：</p><ul><li>快速 “读懂” 你的项目结构（哪些是工具文件、哪些是业务逻辑）</li><li>定位相关代码（如搜索 <code>getUser</code> 时，知道优先查 <code>userService.js</code>）</li><li>理解代码关系（如 <code>Order</code> 类和 <code>Product</code> 类的关联）</li></ul><p><strong>Cursor 中的作用</strong>：AI 分析索引内容后，生成代码时会更贴合项目实际（如使用已有工具函数、遵循命名规范）。</p><br><h5 id="2）、代码库索引配置和示例"><a href="#2）、代码库索引配置和示例" class="headerlink" title="2）、代码库索引配置和示例"></a><strong><font color='cornflowerblue'>2）、代码库索引配置和示例</font></strong></h5><p>代码库索引的状态位于cursor settings &gt; Indexing &amp; Docs</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114004719325.png" alt="image-20251114004719325"></p><h5 id="3-、忽略文件配置"><a href="#3-、忽略文件配置" class="headerlink" title="3)、忽略文件配置"></a><strong><font color='cornflowerblue'>3)、忽略文件配置</font></strong></h5><p>Cursor 读取项目的代码库并为其编制索引以支持其功能。可以通过将.cursorignore 文件添加到根目录来控制<br>哪些文件被忽略和Cursor限制访问。</p><ul><li>提升索引速度：排除大型依赖、生成文件(如node_modu1es、dist)</li><li>避免干扰：某些配置文件可能包含敏感信息或与当前任务无关</li></ul><p>配置.cursorignore忽略文件的两种方法：</p><ol><li><p>自己创建 .cursorignore 文件添加到代码库目录的根目录下，并列出要忽略的目录和文件</p></li><li><p>使用cursor配置快捷创建忽略文件&#96;cursorsetting&gt;indexing&gt;Configure ignored files</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251113233732232.png" alt="image-20251113233732232"></p></li></ol><br><h4 id="3-2、Rules规则"><a href="#3-2、Rules规则" class="headerlink" title="3.2、Rules规则"></a><strong><font color='#10c300'>3.2、Rules规则</font></strong></h4><h5 id="1）规则介绍"><a href="#1）规则介绍" class="headerlink" title="1）规则介绍"></a><strong><font color='cornflowerblue'>1）规则介绍</font></strong></h5><p>Rules是给Cursor AI功能(规则适用于Chat和Cmd K)生成结果添加规则和限制，让 AI生成的代码贴合团队规范，减少人工二次修改成本，主要的作用如下:</p><ul><li>可约束代码风格(如强制用驼峰命名、要求函数必须写注释)</li><li>能限定技术选型(如禁止使用某老旧库、优先用项目指定工具类)</li><li>提前指定核心参数(如提前设置连接数据库的地址和账号密码等)</li></ul><table><thead><tr><th>维度</th><th>项目规则(Project Rules)</th><th>用户规则(User Rules)</th></tr></thead><tbody><tr><td>作用范围</td><td>仅对当前项目生效，团队成员共享相同规则</td><td>对所有项目生效，个人专属配置</td></tr><tr><td>存储位置</td><td>项目根目录下的.cursor&#x2F;rules&#x2F;随意.mdc 文件</td><td>用户配置目录(如~&#x2F;.cursor&#x2F;ru1es)</td></tr><tr><td>同步方式</td><td>随项目代码提交到版本库(如 Git)，团队共享</td><td>仅本地生效，不随项目同步</td></tr><tr><td>适用场景</td><td>统一团队编码规范(如函数注释格式、依赖版本)</td><td>个人习惯(如快捷键、AI 响应风格)</td></tr></tbody></table><p><font color='orange'>注意：项目规则和用户规则同时存在并且规则冲突，项目规则优先级更高–</font></p><br><h5 id="2）项目规则配置"><a href="#2）项目规则配置" class="headerlink" title="2）项目规则配置"></a><strong><font color='cornflowerblue'>2）项目规则配置</font></strong></h5><p><strong>a、项目下创建规则文件的两种方法</strong></p><ol><li>在项目根目录创建文件夹<code>.cursor/rules/随意命名.mdc</code></li><li>快捷命令方式创建 ctr1+ shift +P &gt; “New Cursor Rule”<img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114001431714.png" alt="image-20251114001431714"></li></ol><br><p><strong>b、编写项目规则文件</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">alwaysApply: true</span><br><span class="line">description: &quot;团队前端项目规范&quot;</span><br><span class="line"><span class="section">priority: 1000</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 代码风格</span></span><br><span class="line"><span class="bullet">1.</span> 函数必须包含 JSDoc 注释</span><br><span class="line"><span class="bullet">2.</span> 禁止使用<span class="code">`var`</span>,  统一使用 <span class="code">`const`</span>/<span class="code">`let`</span></span><br><span class="line"><span class="bullet">3.</span> 函数命名必须添加 zwf<span class="emphasis">_前缀，例如:zwf_</span>login</span><br><span class="line"></span><br><span class="line"><span class="section"># 技术选型</span></span><br><span class="line"><span class="bullet">-</span> 优先使用项目内已有的工具函数(如 <span class="code">`uti1s/request`</span>)</span><br><span class="line"><span class="bullet">-</span> 禁止引入低版本的 1odash(&lt;4.0.0)</span><br></pre></td></tr></table></figure><br><p><strong>c、项目规则文件生效测试</strong></p><p><code>ctrl+k</code>调出内联智能输入<img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114002810947.png" alt="image-20251114002810947"></p><br><h5 id="3）用户规则配置"><a href="#3）用户规则配置" class="headerlink" title="3）用户规则配置"></a><strong><font color='cornflowerblue'>3）用户规则配置</font></strong></h5><p><code>ctrl+shift+j</code>快捷打开Cursor Settings，用户规则不支持 MDC，它们只是纯文本。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114003925641.png" alt="image-20251114003925641"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114003947859.png" alt="image-20251114003947859"></p><p>实现每行代码都用中文注释了</p><br><h4 id="3-3、mdc语法了解"><a href="#3-3、mdc语法了解" class="headerlink" title="3.3、mdc语法了解"></a><strong><font color='#10c300'>3.3、mdc语法了解</font></strong></h4><p>Cursor 的 MDC（Markdown with Cursor）语法是专门为编写项目规则设计的轻量级格式，它结合了 Markdown 的可读性和元数据配置能力。接下来，我们来说明下mdc文件语法。</p><h5 id="1）-MDC-文件组成部分"><a href="#1）-MDC-文件组成部分" class="headerlink" title="1） MDC 文件组成部分"></a><strong><font color='cornflowerblue'>1） MDC 文件组成部分</font></strong></h5><ul><li>前置元数据（Frontmatter）<ul><li>用 <code>---</code> 包裹的 YAML 格式配置</li><li>定义规则的基本属性（如作用范围、优先级）</li></ul></li><li>规则内容（Markdown 正文）<ul><li>用 Markdown 语法写具体规则</li></ul></li></ul><br><h5 id="2）前置元数据"><a href="#2）前置元数据" class="headerlink" title="2）前置元数据"></a><strong><font color='cornflowerblue'>2）前置元数据</font></strong></h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 官方约定字段（推荐用，AI 更易理解）</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;前端项目规则&quot;</span></span><br><span class="line"><span class="attr">globs:</span> <span class="string">&quot;src/**/*.tsx&quot;</span></span><br><span class="line"><span class="attr">priority:</span> <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义字段（自己或团队约定含义）</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">&quot;技术团队&quot;</span></span><br><span class="line"><span class="attr">review_date:</span> <span class="string">&quot;2025-06-04&quot;</span></span><br><span class="line"><span class="attr">special_rule:</span> <span class="string">&quot;仅周一至周五生效&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>字段</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td><code>description</code></td><td>描述规则用途，指导 AI 如何应用规则</td><td><code>&quot;前端组件编码规范&quot;</code></td></tr><tr><td><code>globs</code></td><td>指定规则生效的文件范围（支持 glob 语法）</td><td><code>&quot;src/**/*.&#123;js,ts,jsx&#125;&quot;</code></td></tr><tr><td><code>priority</code></td><td>规则优先级（数值越大越优先），解决规则冲突</td><td><code>1000</code></td></tr><tr><td><code>version</code></td><td>规则版本号（可选）</td><td><code>&quot;1.0.0&quot;</code></td></tr></tbody></table><br><h5 id="3）规则内容（Markdown-正文）"><a href="#3）规则内容（Markdown-正文）" class="headerlink" title="3）规则内容（Markdown 正文）"></a><strong><font color='cornflowerblue'>3）规则内容（Markdown 正文）</font></strong></h5><p>用 Markdown 的标题、列表、代码块等语法写具体规则，常见结构：</p><p><strong>代码风格规则（最常用）</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 一、代码风格</span></span><br><span class="line"><span class="bullet">1.</span> 函数必须包含 JSDoc 注释  </span><br><span class="line"><span class="bullet">   -</span> 至少包含 <span class="code">`@param`</span> 和 <span class="code">`@return`</span> 描述  </span><br><span class="line"><span class="bullet">2.</span> 变量命名必须使用驼峰命名法（camelCase）  </span><br><span class="line"><span class="bullet">3.</span> 每行代码长度不超过 120 个字符  </span><br><span class="line"></span><br><span class="line"><span class="section"># 二、技术选型</span></span><br><span class="line"><span class="bullet">-</span> 禁止直接使用原生 fetch，必须通过项目封装的 request 工具  </span><br><span class="line"><span class="bullet">-</span> 优先使用 React Hooks 而非 Class 组件  </span><br></pre></td></tr></table></figure><p><strong>安全约束规则</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 安全规范</span></span><br><span class="line"><span class="bullet">1.</span> 禁止使用 eval() 函数  </span><br><span class="line"><span class="bullet">2.</span> SQL 查询必须使用参数化查询，防止注入攻击  </span><br><span class="line"><span class="bullet">3.</span> 敏感信息（如 API 密钥）必须从环境变量读取  </span><br></pre></td></tr></table></figure><p><strong>特殊语法：引用项目文件</strong></p><p>用 <code>@file</code> 引用项目内的配置文件，让 AI 参考：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 工具链配置</span></span><br><span class="line"><span class="bullet">1.</span> ESLint 规则必须符合 @file .eslintrc.js  </span><br><span class="line"><span class="bullet">2.</span> 测试用例必须遵循 Jest 框架规范  </span><br></pre></td></tr></table></figure><br><h5 id="4）完整示例（TypeScript-项目规则）"><a href="#4）完整示例（TypeScript-项目规则）" class="headerlink" title="4）完整示例（TypeScript 项目规则）"></a><strong><font color='cornflowerblue'>4）完整示例（TypeScript 项目规则）</font></strong></h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">description: &quot;TypeScript 项目编码规范&quot;</span><br><span class="line">globs: &quot;src/<span class="strong">**/<span class="emphasis">*.ts&quot;</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">priority: 1000</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">---</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"># 一、基础规范</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">1. 所有文件必须使用 UTF-8 编码  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">2. 统一使用 2 空格缩进  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"># 二、类型约束</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">1. 禁止使用隐式 any 类型  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">   - 示例：`const num: number = 123`（显式）  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">   - 禁止：`const num = 123`（隐式）  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">2. 接口命名必须以 `I` 开头（如 `interface IUser`）  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"># 三、项目约束</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">- 所有 HTTP 请求必须通过 @file src/utils/request.ts 封装的工具  </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">- 状态管理必须使用 Redux Toolkit，禁止直接修改 state  </span></span></span><br></pre></td></tr></table></figure><br><h4 id="3-4、-符号"><a href="#3-4、-符号" class="headerlink" title="3.4、@ 符号"></a><strong><font color='#10c300'>3.4、@ 符号</font></strong></h4><p>在 Cursor 中使用 @ 符号在聊天中引用代码、文件、文档和其他上下文的指南，直接更具体的指定上下文环境！</p><p>以下是所有可用 @ 符号的列表：</p><ul><li>@Files &amp; Folders - 引用项目中的特定文件或文件夹 ✅</li><li>@Docs- 访问文档和指南✅</li><li>@Git- 访问 git 历史记录和更改</li></ul><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114013559213.png" alt="image-20251114013559213"></p><h5 id="1）-Files-Folders-文件和文件夹"><a href="#1）-Files-Folders-文件和文件夹" class="headerlink" title="1）@Files &amp; Folders 文件和文件夹"></a><strong><font color='cornflowerblue'>1）@Files &amp; Folders 文件和文件夹</font></strong></h5><p>选择 <code>@Files &amp; Folders</code>，然后选择要搜索的文件名即可引用整个文件。你也可以将侧边栏中的文件直接拖拽到 Agent 中作为上下文。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114013919773.png" alt="image-20251114013919773"></p><p>选择文件夹后，输入 “&#x2F;” 以继续下钻并查看所有子文件夹。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114013934820.png" alt="image-20251114013934820"></p><br><h5 id="2）-Docs"><a href="#2）-Docs" class="headerlink" title="2）@Docs"></a><strong><font color='cornflowerblue'>2）@Docs</font></strong></h5><p><code>@Docs</code> 功能可让你用文档来辅助写代码</p><p><strong>添加文档</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114014157560.png" alt="image-20251114014157560"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114014346829.png" alt="image-20251114014346829"></p><br><p><strong>提问</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251114014547119.png" alt="image-20251114014547119"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一、解决限制国内使用&quot;&gt;&lt;a href=&quot;#一、解决限制国内使用&quot; class=&quot;headerlink&quot; title=&quot;一、解决限制国内使用&quot;&gt;&lt;/a&gt;&lt;strong&gt;&lt;font color=&#39;red&#39;&gt;一、解决限制国内使用&lt;/font&gt;&lt;/strong&gt;&lt;/h3</summary>
      
    
    
    
    <category term="工具" scheme="http://example.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="Cursor" scheme="http://example.com/tags/Cursor/"/>
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>UniApp多端开发</title>
    <link href="http://example.com/posts/57fa3c28.html"/>
    <id>http://example.com/posts/57fa3c28.html</id>
    <published>2025-12-02T00:29:04.000Z</published>
    <updated>2026-03-01T16:07:38.352Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、uniApp生命周期"><a href="#一、uniApp生命周期" class="headerlink" title="一、uniApp生命周期 "></a><strong><font color='red'>一、uniApp生命周期 </font></strong></h3><h4 id="1-1、应用生命周期"><a href="#1-1、应用生命周期" class="headerlink" title="1-1、应用生命周期"></a><strong><font color='#10c300'>1-1、应用生命周期</font></strong></h4><table><thead><tr><th align="left">函数名</th><th align="left">说明</th><th align="left">平台兼容</th></tr></thead><tbody><tr><td align="left">onLaunch</td><td align="left">当<code>uni-app</code> 初始化完成时触发（全局只触发一次），参数为应用启动参数，同 <a href="https://uniapp.dcloud.net.cn/api/getLaunchOptionsSync.html#getlaunchoptionssync">uni.getLaunchOptionsSync</a> 的返回值</td><td align="left"></td></tr><tr><td align="left">onShow</td><td align="left">当 <code>uni-app</code> 启动，或从后台进入前台显示，参数为应用启动参数，同 <a href="https://uniapp.dcloud.net.cn/api/getLaunchOptionsSync.html#getlaunchoptionssync">uni.getLaunchOptionsSync</a> 的返回值</td><td align="left"></td></tr><tr><td align="left">onHide</td><td align="left">当 <code>uni-app</code> 从前台进入后台</td><td align="left"></td></tr><tr><td align="left">onError</td><td align="left">当 <code>uni-app</code> 报错时触发</td><td align="left">app-uvue 不支持</td></tr><tr><td align="left">onUniNViewMessage</td><td align="left">对 <code>nvue</code> 页面发送的数据进行监听，可参考 <a href="https://uniapp.dcloud.io/tutorial/nvue-api?id=communication">nvue 向 vue 通讯</a></td><td align="left">app-uvue 不支持</td></tr><tr><td align="left">onUnhandledRejection</td><td align="left">对未处理的 Promise 拒绝事件监听函数（2.8.1+ app-uvue 暂不支持）</td><td align="left">app-uvue 不支持</td></tr><tr><td align="left">onPageNotFound</td><td align="left">页面不存在监听函数</td><td align="left">app-uvue 不支持</td></tr><tr><td align="left">onThemeChange</td><td align="left">监听系统主题变化</td><td align="left">app-uvue 不支持</td></tr><tr><td align="left">onLastPageBackPress</td><td align="left">最后一个页面按下Android back键，常用于自定义退出</td><td align="left">app-uvue-android 3.9+</td></tr><tr><td align="left">onExit</td><td align="left">监听应用退出</td><td align="left">app-uvue-android 3.9+</td></tr></tbody></table><p>应用生命周期仅可在<code>App.vue</code>中监听，在其它页面监听无效。</p><br><h4 id="1-2、面生命周期"><a href="#1-2、面生命周期" class="headerlink" title="1-2、面生命周期"></a><strong><font color='#10c300'>1-2、面生命周期</font></strong></h4><table><thead><tr><th align="left">函数名</th><th align="left">说明</th><th align="left">平台差异说明</th></tr></thead><tbody><tr><td align="left">onInit</td><td align="left">监听页面初始化，其参数同 onLoad 参数，为上个页面传递的数据，参数类型为 Object（用于页面传参），触发时机早于 onLoad</td><td align="left">百度小程序</td></tr><tr><td align="left">onLoad</td><td align="left">监听页面加载，该钩子被调用时，响应式数据、计算属性、方法、侦听器、props、slots 已设置完成，其参数为上个页面传递的数据，参数类型为 Object（用于页面传参）</td><td align="left"></td></tr><tr><td align="left">onShow</td><td align="left">监听页面显示，页面每次出现在屏幕上都触发，包括从下级页面点返回露出当前页面</td><td align="left"></td></tr><tr><td align="left">onReady</td><td align="left">监听页面初次渲染完成，此时组件已挂载完成，DOM 树($el)已可用，注意如果渲染速度快，会在页面进入动画完成前触发</td><td align="left"></td></tr><tr><td align="left">onHide</td><td align="left">监听页面隐藏</td><td align="left"></td></tr><tr><td align="left">onUnload</td><td align="left">监听页面卸载</td><td align="left"></td></tr><tr><td align="left">onResize</td><td align="left">监听窗口尺寸变化</td><td align="left">App、微信小程序、快手小程序</td></tr><tr><td align="left">onPullDownRefresh</td><td align="left">监听用户下拉动作，一般用于下拉刷新</td><td align="left"></td></tr><tr><td align="left">onReachBottom</td><td align="left">页面滚动到底部的事件（不是scroll-view滚到底），常用于下拉下一页数据。具体见下方注意事项</td><td align="left"></td></tr><tr><td align="left">onTabItemTap</td><td align="left">点击 tab 时触发，参数为Object，具体见下方注意事项</td><td align="left">微信小程序、QQ小程序、支付宝小程序、百度小程序、H5、App、快手小程序、京东小程序</td></tr><tr><td align="left">onShareAppMessage</td><td align="left">用户点击右上角分享</td><td align="left">微信小程序、QQ小程序、支付宝小程序、抖音小程序、飞书小程序、快手小程序、京东小程序</td></tr><tr><td align="left">onPageScroll</td><td align="left">监听页面滚动，参数为Object</td><td align="left">nvue不支持</td></tr><tr><td align="left">onNavigationBarButtonTap</td><td align="left">监听原生标题栏按钮点击事件，参数为Object</td><td align="left">App、H5</td></tr><tr><td align="left">onBackPress</td><td align="left">监听页面返回，返回 event &#x3D; {from:backbutton、 navigateBack} ，backbutton 表示来源是左上角返回按钮或 android 返回键；navigateBack表示来源是 uni.navigateBack；<a href="https://uniapp.dcloud.net.cn/tutorial/page.html#onbackpress">详见</a></td><td align="left">app、H5、支付宝小程序</td></tr><tr><td align="left">onNavigationBarSearchInputChanged</td><td align="left">监听原生标题栏搜索输入框输入内容变化事件</td><td align="left">App、H5</td></tr><tr><td align="left">onNavigationBarSearchInputConfirmed</td><td align="left">监听原生标题栏搜索输入框搜索事件，用户点击软键盘上的“搜索”按钮时触发。</td><td align="left">App、H5</td></tr><tr><td align="left">onNavigationBarSearchInputClicked</td><td align="left">监听原生标题栏搜索输入框点击事件（pages.json 中的 searchInput 配置 disabled 为 true 时才会触发）</td><td align="left">App、H5</td></tr><tr><td align="left">onShareTimeline</td><td align="left">监听用户点击右上角转发到朋友圈</td><td align="left">微信小程序</td></tr><tr><td align="left">onAddToFavorites</td><td align="left">监听用户点击右上角收藏</td><td align="left">微信小程序、QQ小程序</td></tr></tbody></table><h5 id="1）Vue2-页面及组件生命周期流程图"><a href="#1）Vue2-页面及组件生命周期流程图" class="headerlink" title="1）Vue2 页面及组件生命周期流程图"></a><strong><font color='cornflowerblue'>1）Vue2 页面及组件生命周期流程图</font></strong></h5><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/uni-app-lifecycle-vue2.jpg" alt="img"></p><br><h5 id="Vue3-页面及组件生命周期流程图"><a href="#Vue3-页面及组件生命周期流程图" class="headerlink" title="Vue3 页面及组件生命周期流程图"></a><strong><font color='cornflowerblue'>Vue3 页面及组件生命周期流程图</font></strong></h5><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/uni-app-lifecycle-vue3.jpg" alt="img"></p><br><h4 id="1-3、组件生命周期"><a href="#1-3、组件生命周期" class="headerlink" title="1-3、组件生命周期"></a><strong><font color='#10c300'>1-3、组件生命周期</font></strong></h4><table><thead><tr><th align="left">函数名</th><th align="left">说明</th><th align="left">平台差异说明</th></tr></thead><tbody><tr><td align="left">beforeCreate</td><td align="left">在实例初始化之前被调用。</td><td align="left"></td></tr><tr><td align="left">created</td><td align="left">在实例创建完成后被立即调用。</td><td align="left"></td></tr><tr><td align="left">beforeMount</td><td align="left">在挂载开始之前被调用。</td><td align="left"></td></tr><tr><td align="left">mounted</td><td align="left">挂载到实例上去之后调用。注意：此处并不能确定子组件被全部挂载，如果需要子组件完全挂载之后在执行操作可以使用<code>$nextTick</code></td><td align="left"></td></tr><tr><td align="left">beforeUpdate</td><td align="left">数据更新时调用，发生在虚拟 DOM 打补丁之前。</td><td align="left">仅H5平台支持</td></tr><tr><td align="left">updated</td><td align="left">由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。</td><td align="left">仅H5平台支持</td></tr><tr><td align="left">beforeDestroy</td><td align="left">实例销毁之前调用。在这一步，实例仍然完全可用。</td><td align="left"></td></tr><tr><td align="left">destroyed</td><td align="left">Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。</td><td align="left"></td></tr></tbody></table><br><h3 id="二、多端调试环境配置"><a href="#二、多端调试环境配置" class="headerlink" title="二、多端调试环境配置 "></a><strong><font color='red'>二、多端调试环境配置 </font></strong></h3><h4 id="2-1、安卓真机调试配置"><a href="#2-1、安卓真机调试配置" class="headerlink" title="2-1、安卓真机调试配置"></a><strong><font color='#10c300'>2-1、安卓真机调试配置</font></strong></h4><p><strong>以小米手机为例：</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250604101545567.png" alt="image-20250604101545567"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250604102525380.png" alt="image-20250604102525380"></p><br><h4 id="2-2、IOS真机调试配置"><a href="#2-2、IOS真机调试配置" class="headerlink" title="2-2、IOS真机调试配置"></a><strong><font color='#10c300'>2-2、IOS真机调试配置</font></strong></h4><p>2022年9月，因收到苹果公司警告，目前开发者已无法在iOS真机设备使用未签名的标准基座，所以现在要运行到 IOS ，也需要进行签名。Windows系统，开发者就可以使用三方工具（如爱思助手）对标准基座签名。</p><p><strong><code>注意：使用Apple ID签名的IPA文件有效期为7天，7天后需要重签。如果需要“自动续签”功能，IOS手机需要越狱</code></strong></p><h5 id="1）前期准备"><a href="#1）前期准备" class="headerlink" title="1）前期准备"></a><strong><font color='cornflowerblue'>1）前期准备</font></strong></h5><ul><li><p>HBuilder 3.6.9+(一般我会把软件更新到最新版，版本跟不上容易出现问题)</p></li><li><p>ios设备</p></li><li><p>原装数据线</p></li><li><p>爱思助手软件（还有iTunes工具，下载爱思助手后会自动安装该工具）</p></li><li><p>安装基座：在HBuildex安装目录下面的plugins\launcher\base 目录下找到安装的ios基座：iPhone_base.ipa</p><p>（如果没有需要安装），后面添加IPA文件的时候用到。</p></li></ul><br><h5 id="2）操作步骤"><a href="#2）操作步骤" class="headerlink" title="2）操作步骤"></a><strong><font color='cornflowerblue'>2）操作步骤</font></strong></h5><ul><li><p><strong>下载爱思助手</strong>，打开爱思助手并用数据线连接ios设备。</p></li><li><p><strong>进行签名：</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250604111911639.png" alt="image-20250604111911639"></p><p>使用Apple ID 签名，依次点击使用Apple ID签名—&gt;添加Apple ID—&gt; 输入Apple ID和密码（账号最好是邮箱， 如果 Apple ID 账号是手机号码，在签名输入 ID 账号时，手机号前面需要加 86。例如：8615012345678。 ）—&gt;确定。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250604113014783.png" alt="image-20250604113014783"></p><p>如果签名成功，打开已签名IPA的位置，找到签名后的ipa文件，<strong><code>并命名为iPhone_base_signed.ipa</code></strong>，然后将其拷贝到HBuilderX安装目录\plugins\launcher\base</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/2052514-20250121112902666-19879140.png" alt="img"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/2052514-20250121113924730-1273769980.png" alt="img"></p><p>打开HBuilderX，选择要运行的项目，点击工具栏运行图标，选择【运行到iOS App基座】</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/2052514-20250121113938712-386846139.png" alt="img"></p><p>如果没运行出来，可能是由于 iphone 没有开启 “开发者模式”，需要自己手动将开发者模式打开。</p></li><li><p><strong>打开开发者模式</strong></p><p>设置—&gt;隐私与安全—&gt;开发者模式 ，打开后会提示重启手机。</p><p><strong>如果你的ios系统。是 16 以上，可能在 设置—隐私与安全 里面没有 “开发者模式这一项” ，需要利用 爱思助手 来将选项打开</strong></p><p>打开爱思助手 工具箱—&gt;虚拟定位， 随便输入一个经纬度，点击修改 </p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250604113829151.png" alt="image-20250604113829151"></p><p>确定开发者模式已开启 ：在手机上，设置—隐私与安全性 里面，就能看到有”开发者选项“了，开启，然后提示重启手机。完成即可。</p></li><li><p><strong>运行ios基座遇到的问题</strong></p><p>下图运行到ios基座成功</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/2052514-20250121114101865-331084701.png" alt="img"></p><p>1.ios上面安装了HBuilder调试基座，但是移动端未出现运行app的界面，点击安装的HBuilder调试基座，弹出 需要互联网连接以验证是否信任开发者iphone…..，此时确保网络是否链接是否通畅，如果设备已经连接到互联网，仍然没解决，我选择了重启设备，解决了上述问题；</p><p>2.重启设备之后，再次点击HBuilder调试基座，提示不收信任的开发者，此时在设备上找到设置&gt;通用&gt;vpn与设备管理这个选项，可以看到我们的开发者APP当前是不受信任的 我们只需点开，信任当前开发APP就可以了</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250604114032005.png" alt="image-20250604114032005"></p><p>再重新打开这个APP，就可以发现已经可以进行iOS真机预览了。</p></li></ul><br><h4 id="2-3、微信小程序调试配置"><a href="#2-3、微信小程序调试配置" class="headerlink" title="2-3、微信小程序调试配置"></a><strong><font color='#10c300'>2-3、微信小程序调试配置</font></strong></h4><br><h4 id="2-4、支付宝小程序调试配置"><a href="#2-4、支付宝小程序调试配置" class="headerlink" title="2-4、支付宝小程序调试配置"></a><strong><font color='#10c300'>2-4、支付宝小程序调试配置</font></strong></h4><br><h3 id="三、多端调试环境配置"><a href="#三、多端调试环境配置" class="headerlink" title="三、多端调试环境配置 "></a><strong><font color='red'>三、多端调试环境配置 </font></strong></h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一、uniApp生命周期&quot;&gt;&lt;a href=&quot;#一、uniApp生命周期&quot; class=&quot;headerlink&quot; title=&quot;一、uniApp生命周期 &quot;&gt;&lt;/a&gt;&lt;strong&gt;&lt;font color=&#39;red&#39;&gt;一、uniApp生命周期 &lt;/font&gt;&lt;/s</summary>
      
    
    
    
    <category term="框架与生态" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6%E4%B8%8E%E7%94%9F%E6%80%81/"/>
    
    
    <category term="Uniapp" scheme="http://example.com/tags/Uniapp/"/>
    
    <category term="多端开发" scheme="http://example.com/tags/%E5%A4%9A%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>VMware17 Pro安装CentOS 8</title>
    <link href="http://example.com/posts/f6649ba0.html"/>
    <id>http://example.com/posts/f6649ba0.html</id>
    <published>2025-11-25T22:29:48.000Z</published>
    <updated>2026-03-01T16:07:38.352Z</updated>
    
    <content type="html"><![CDATA[<p><strong>软件版本</strong></p><blockquote><p>VMware 17 Pro  17.5.2 build-23775571</p><p>CentOS-8.1.1911-x86_64-dvd1.iso</p></blockquote><h3 id="一、-创建虚拟机"><a href="#一、-创建虚拟机" class="headerlink" title="一、 创建虚拟机"></a><strong><font color='red'>一、 创建虚拟机</font></strong></h3><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251021234224316.png" alt="image-20251021234224316"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251021234501665.png" alt="image-20251021234501665"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251021234533907.png" alt="image-20251021234533907"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251021234601087.png" alt="image-20251021234601087"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251021234734894.png" alt="image-20251021234734894"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251021234936363.png" alt="image-20251021234936363"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251021235013900.png" alt="image-20251021235013900"></p><br><h3 id="二、-配置虚拟机"><a href="#二、-配置虚拟机" class="headerlink" title="二、 配置虚拟机"></a><strong><font color='red'>二、 配置虚拟机</font></strong></h3><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251021235209438.png" alt="image-20251021235209438"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022000540363.png" alt="image-20251022000540363"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022000621830.png" alt="image-20251022000621830"></p><h4 id="虚拟化处于禁用状态"><a href="#虚拟化处于禁用状态" class="headerlink" title="虚拟化处于禁用状态"></a><strong><font color='#10c300'>虚拟化处于禁用状态</font></strong></h4><p>AMD处理器提示AMD-V处于禁用状态。</p><p>Intel处理器提示ntel VT-x处于禁用状态。</p><p>因为我是AMD的处理器以及ROG的主板，因为这里主要操作怎么在ROG主板的BIOS上开启虚拟化技术</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022232519026.png" alt="image-20251022232519026"></p><p><strong>开启步骤</strong></p><ol><li>电脑开启的时候一直按F2或Del进入BIOS界面</li><li>找到Advanced进入CPU Configguration中找到SVM Mode将其状态改成Enabled</li></ol><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022234218884.png" alt="image-20251022234218884"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022234544337.png" alt="image-20251022234544337"></p><br><h3 id="三、-系统安装引导界面"><a href="#三、-系统安装引导界面" class="headerlink" title="三、 系统安装引导界面"></a><strong><font color='red'>三、 系统安装引导界面</font></strong></h3><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/5e9856fd57ad3cd601de474ed0a9d59b.png" alt="img"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/da83ad02a5d26c3f865a68503efcbe2c.png" alt="img"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/71e0855efe957df4c85e67e7642a1538.png" alt="img"></p><br><h3 id="四、-定制化内容"><a href="#四、-定制化内容" class="headerlink" title="四、 定制化内容"></a><strong><font color='red'>四、 定制化内容</font></strong></h3><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022001114895.png" alt="image-20251022001114895"></p><br><h4 id="4-1、调整时间差"><a href="#4-1、调整时间差" class="headerlink" title="4.1、调整时间差"></a><strong><font color='#10c300'>4.1、调整时间差</font></strong></h4><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022003530905.png" alt="image-20251022003530905"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022003918721.png" alt="image-20251022003918721"></p><br><h4 id="4-2、配置磁盘分区"><a href="#4-2、配置磁盘分区" class="headerlink" title="4.2、配置磁盘分区"></a><strong><font color='#10c300'>4.2、配置磁盘分区</font></strong></h4><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023215033391.png" alt="image-20251023215033391"></p><br><h5 id="1）默认磁盘分区配置"><a href="#1）默认磁盘分区配置" class="headerlink" title="1）默认磁盘分区配置"></a><strong><font color='cornflowerblue'>1）默认磁盘分区配置</font></strong><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251022004121785.png" alt="image-20251022004121785"></h5><br><h5 id="2）自定义磁盘分区"><a href="#2）自定义磁盘分区" class="headerlink" title="2）自定义磁盘分区"></a><strong><font color='cornflowerblue'>2）自定义磁盘分区</font></strong></h5><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023215120757.png" alt="image-20251023215120757"></p><br><p><strong><font color='orange'>a、手动添加分区</font></strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023220443302.png" alt="image-20251023220443302"></p><br><p><strong><font color='orange'>b、添加 boot 区 给上 1G 容量后点击添加挂载点</font></strong></p><p>挂载点<code>/boot</code>是系统启动的引导分区</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023220707214.png" alt="image-20251023220707214"></p><p>文件系统默认选择ext4，即第四代文件扩展系统，其容量可以达到EB（GB→TB→EB）单个文件容量可以达到16TB。</p><p>我们选择xfs文件系统，这是一个高性能日志文件系统，特别擅长处理大文件，64位系统中最大能够支持8EB的文件系统，目前性能最强。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023224710364.png" alt="image-20251023224710364"></p><br><p><strong><font color='orange'>c、添加 swap 交换分区</font></strong></p><p>swap交换分区：</p><p>​在硬盘中单独创建一块分区来，单独去作为扩展内存。就是我们在配置虚拟机的时候设置的那个内存不足时，则可以将swap交换分区作为裸战内存来使用（我们当时是分了8G内存）。</p><p>执行的一个过程：</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023221045499.png" alt="image-20251023221045499"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023221112598.png" alt="image-20251023221112598"></p><br><p><strong><font color='orange'>d、配置根目录<code>/</code></font></strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023221245884.png" alt="image-20251023221245884"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023221339058.png" alt="image-20251023221339058"></p><br><p><strong><font color='orange'>e、分区配置完毕，点击完成，然后点击弹窗的接受更改</font></strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023221441203.png" alt="image-20251023221441203"></p><br><h4 id="4-3、配置kdump"><a href="#4-3、配置kdump" class="headerlink" title="4.3、配置kdump"></a><strong><font color='#10c300'>4.3、配置kdump</font></strong></h4><p>关闭 kdump 本身虚拟机内存就不够，他会吃掉一部分内存，我们尽量省一点</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023222056185.png" alt="image-20251023222056185"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023221802804.png" alt="image-20251023221802804"></p><br><h4 id="4-4、配置网络和主机名"><a href="#4-4、配置网络和主机名" class="headerlink" title="4.4、配置网络和主机名"></a><strong><font color='#10c300'>4.4、配置网络和主机名</font></strong></h4><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023222257482.png" alt="image-20251023222257482"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251023222457521.png" alt="image-20251023222457521"></p><br><h4 id="4-5、开始安装"><a href="#4-5、开始安装" class="headerlink" title="4.5、开始安装"></a><strong><font color='#10c300'>4.5、开始安装</font></strong></h4><h5 id="1）设置Root用户密码"><a href="#1）设置Root用户密码" class="headerlink" title="1）设置Root用户密码"></a><strong><font color='cornflowerblue'>1）设置Root用户密码</font></strong></h5><p>默认有个root用户，也就是超级管理员</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025162343490.png" alt="image-20251025162343490"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025162349989.png" alt="image-20251025162349989"></p><br><h5 id="2）创建用户"><a href="#2）创建用户" class="headerlink" title="2）创建用户"></a><strong><font color='cornflowerblue'>2）创建用户</font></strong></h5><p>新创建了一个zhb用户</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025162417872.png" alt="image-20251025162417872"></p><p>等待安装</p><br><h4 id="4-6、虚拟机的使用引导界面"><a href="#4-6、虚拟机的使用引导界面" class="headerlink" title="4.6、虚拟机的使用引导界面"></a><strong><font color='#10c300'>4.6、虚拟机的使用引导界面</font></strong></h4><p>重启进入引导界面</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025163325360.png" alt="image-20251025163325360"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025163408100.png" alt="image-20251025163408100"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025163426606.png" alt="image-20251025163426606"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025163508011.png" alt="image-20251025163508011"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025163545397.png" alt="image-20251025163545397"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025163555338.png" alt="image-20251025163555338"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025163609171.png" alt="image-20251025163609171"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025163627645.png" alt="image-20251025163627645"></p><p>安装完成</p><br><h3 id="五、-切换-root-用户"><a href="#五、-切换-root-用户" class="headerlink" title="五、 切换 root 用户"></a><strong><font color='red'>五、 切换 root 用户</font></strong></h3><p>当前登录的用户是刚刚创建的用户，权限会缺少，所以使用 root，修改一些内容更加方便</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025165233836.png" alt="image-20251025165233836"><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025165459175.png" alt="image-20251025165459175"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025165518127.png" alt="image-20251025165518127"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251025165706320.png" alt="image-20251025165706320"></p><br><h3 id="六、-网络配置"><a href="#六、-网络配置" class="headerlink" title="六、 网络配置"></a><strong><font color='red'>六、 网络配置</font></strong></h3><p>linux系统下，查看网络配置IP地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p>windows系统下，查看网络配置IP地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig</span><br></pre></td></tr></table></figure><p>测试你的计算机与目标主机（可以是域名或IP地址）之间的连通性</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping + ip地址</span><br></pre></td></tr></table></figure><br><p><strong><font color='orange'>VMware提供了三种网络连接模式：</font></strong></p><ol><li>桥接模式：虚拟机直接连接外部物理网络的模式，主机起到了网桥的作用。在这种模式下，虚拟机可以直接访问外部网络，并且对外部网络是可见的</li><li>NAT模式：虚拟机和主机构建一个专用网络，并通过虚拟网络地址转换（NAT）设备对IP进行转换。虚拟机通过共享主机IP可以访问外部网络，但外部网络无法访问虚拟机。</li><li>仅主机模式：虚拟机只与主机共享一个专用网络，与外部网络无法通信</li></ol><p><strong><font color='orange'>获取到虚拟机的ip</font></strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251201225649883.png" alt="image-20251201225649883"></p><br><h4 id="6-1、虚拟机修改静态ip"><a href="#6-1、虚拟机修改静态ip" class="headerlink" title="6.1、虚拟机修改静态ip"></a><strong><font color='#10c300'>6.1、虚拟机修改静态ip</font></strong></h4><h5 id="1）为什么要修改静态ip"><a href="#1）为什么要修改静态ip" class="headerlink" title="1）为什么要修改静态ip"></a><strong><font color='cornflowerblue'>1）为什么要修改静态ip</font></strong></h5><p>因为虚拟默认是动态ip的，每次重新都会更新ip的，因此需要修改成静态ip方便网络管理，比如你要通过SSH、远程桌面等方式连接虚拟机，固定IP更容易记忆和配置。</p><br><h5 id="2）修改静态ip"><a href="#2）修改静态ip" class="headerlink" title="2）修改静态ip"></a><strong><font color='cornflowerblue'>2）修改静态ip</font></strong></h5><p>Linux的所有配置文件放在 &#x2F;etc 目录下</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251201225950902.png" alt="image-20251201225950902"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251201230744458.png" alt="image-20251201230744458"></p><br><p>修改为BOOTPROTO&#x3D;”static”<br>在底部添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#IP地址</span><br><span class="line">IPADDR=192.168.244.100</span><br><span class="line">#网关</span><br><span class="line">GATEWAY=192.168.244.2</span><br><span class="line">#域名解析器</span><br><span class="line">DNS1=192.168.244.2</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251201232035172.png" alt="image-20251201232035172"></p><p><strong>最后需要重启网络</strong>，注意：conterOS7和8的命令不一样注意区分，我这里是直接重启虚拟机</p><br><p><strong>这里的ip地址要和虚拟网络的VMnet8的子网IP的网段保持一致（就是前三位保持一致，后一位可自行命名）</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251201231010889.png" alt="image-20251201231010889"></p><br><p><strong>网关和域名解析器则和VMnet8的NAT设置中的网关IP保持一致</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251201231230608.png" alt="image-20251201231230608"></p><br><h4 id="6-2、修改主机名"><a href="#6-2、修改主机名" class="headerlink" title="6.2、修改主机名"></a><strong><font color='#10c300'>6.2、修改主机名</font></strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname  # 查看主机名</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251201234837992.png" alt="image-20251201234837992"></p><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hostname  # 修改hostname的配置，此方式需要重启才会生效</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname hadop100  # 此方式不需要重启，就可以生效 修改主机名为hadop100</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251201235132862.png" alt="image-20251201235132862"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;软件版本&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;VMware 17 Pro  17.5.2 build-23775571&lt;/p&gt;
&lt;p&gt;CentOS-8.1.1911-x86_64-dvd1.iso&lt;/p&gt;
&lt;/blockquote&gt;
&lt;</summary>
      
    
    
    
    <category term="后端与运维" scheme="http://example.com/categories/%E5%90%8E%E7%AB%AF%E4%B8%8E%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="CentOS 8" scheme="http://example.com/tags/CentOS-8/"/>
    
    <category term="虚拟机" scheme="http://example.com/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
    <category term="VMware17" scheme="http://example.com/tags/VMware17/"/>
    
  </entry>
  
  <entry>
    <title>Hexo搭建个人博客</title>
    <link href="http://example.com/posts/ec7d7221.html"/>
    <id>http://example.com/posts/ec7d7221.html</id>
    <published>2025-11-25T21:57:23.000Z</published>
    <updated>2026-03-01T16:07:38.352Z</updated>
    
    <content type="html"><![CDATA[<div align="center">    <img src="https://img.shields.io/badge/hexo-8.1.0-d1a8.svg"/>    <img src="https://img.shields.io/badge/hexoCli-4.3.2-green.svg"/>    <img src="https://img.shields.io/badge/Node-=22.21.0-ffbc39.svg"/>    <br>    <br>    <img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202409131343278.png"/></div><br><h3 id="一、前置条件"><a href="#一、前置条件" class="headerlink" title="一、前置条件"></a><strong><font color='red'>一、前置条件</font></strong></h3><h4 id="1-1、要求✏️"><a href="#1-1、要求✏️" class="headerlink" title="1.1、要求✏️"></a><strong><font color='#10c300'>1.1、要求✏️</font></strong></h4><p>安装 Hexo 相当简单，只需要先安装下列应用程序即可：</p><ul><li><a href="http://nodejs.org/">Node.js</a> (Node.js 版本需不低于 10.13，建议使用 Node.js 12.0 及以上版本，本次使用的是18.18.0版本)</li><li><a href="http://git-scm.com/">Git</a></li></ul><p>如果您的电脑中已经安装上述必备程序，那么恭喜您！ 你可以直接前往 <a href="https://hexo.io/zh-cn/docs/#%E5%AE%89%E8%A3%85-Hexo">安装 Hexo</a> 步骤。</p><h4 id="1-2、安装-Hexo"><a href="#1-2、安装-Hexo" class="headerlink" title="1.2、安装 Hexo"></a><strong><font color='#10c300'>1.2、安装 Hexo</font></strong></h4><p>在电脑上全局安装Hexo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure><br><h3 id="二、创建博客"><a href="#二、创建博客" class="headerlink" title="二、创建博客"></a><strong><font color='red'>二、创建博客</font></strong></h3><p>安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建博客项目文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init &lt;folder&gt;</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251030145443715.png" alt="image-20251030145443715"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251027230420967.png" alt="image-20251027230420614"></p><h4 id="2-1、目录结构"><a href="#2-1、目录结构" class="headerlink" title="2.1、目录结构"></a><strong><font color='#10c300'>2.1、目录结构</font></strong></h4><p>初始化后，您的项目文件夹将如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">|   └── _posts</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure><h4 id="2-1、-config-yml"><a href="#2-1、-config-yml" class="headerlink" title="2.1、_config.yml"></a><strong><font color='#10c300'>2.1、_config.yml</font></strong></h4><p>网站的 <a href="https://hexo.io/zh-cn/docs/configuration">配置</a> 文件。 您可以在此配置大部分的参数。</p><br><h3 id="三、主题"><a href="#三、主题" class="headerlink" title="三、主题"></a><strong><font color='red'>三、主题</font></strong></h3><p><a href="https://github.com/shenliyang/hexo-theme-snippet">Hexo Themes列表</a></p><p>我们这次使用后是<a href="https://github.com/shenliyang/hexo-theme-snippet">Asnippet</a>主题</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251027230809516.png" alt="image-20251027230809516"></p><h4 id="3-1、下载主题"><a href="#3-1、下载主题" class="headerlink" title="3.1、下载主题"></a><strong><font color='#10c300'>3.1、下载主题</font></strong></h4><p>有两种方式获取本主题–下载 <code>*.zip</code> 文件和通过 <code>git</code>方式：</p><ol><li>下载 <a href="https://github.com/shenliyang/hexo-theme-snippet">Snippet 主题</a> 文件解压后放在 <code>themes</code> 目录下，和博客中的 landscape 为同级目录</li><li>Git 方式，在 Hexo 根目录执行：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git://github.com/shenliyang/hexo-theme-snippet.git themes/hexo-theme-snippet</span><br></pre></td></tr></table></figure><br><h4 id="3-2、切换主题"><a href="#3-2、切换主题" class="headerlink" title="3.2、切换主题"></a><strong><font color='#10c300'>3.2、切换主题</font></strong></h4><p>在根目录的<code>_config.yml</code>文件中，找到 <code>theme: landscape</code>，将landscape替换成新的主题名</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">hexo-theme-snippet</span></span><br></pre></td></tr></table></figure><br><h4 id="3-3、安装主题插件"><a href="#3-3、安装主题插件" class="headerlink" title="3.3、安装主题插件"></a><strong><font color='#10c300'>3.3、安装主题插件</font></strong></h4><p>1️⃣因为 <strong>hexo-theme-snippet</strong> 使用了 <code>ejs</code> 模版引擎 、 <code>Less</code> CSS 预编译语言以及在官方插件的基础上 进行功能的开发，以下为必装插件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pnpm i hexo-renderer-ejs hexo-renderer-less hexo-deployer-git -S</span><br></pre></td></tr></table></figure><p>2️⃣启用站内本地搜索功能</p><p>如果要使用本地站点搜索，必须安装插件 hexo-generator-json-content 来创建本地搜索 json 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pnpm i hexo-generator-json-content@2.2.0 -S</span><br></pre></td></tr></table></figure><p>然后修改主题配置_config.yml 文件下<code>jsonContent</code>相关参数。</p><br><h4 id="3-4、部署主题"><a href="#3-4、部署主题" class="headerlink" title="3.4、部署主题"></a><strong><font color='#10c300'>3.4、部署主题</font></strong></h4><h5 id="1）未修改过主题源文件"><a href="#1）未修改过主题源文件" class="headerlink" title="1）未修改过主题源文件"></a><strong><font color='cornflowerblue'>1）未修改过主题源文件</font></strong></h5><p>1️⃣  清空 hexo 静态文件和缓存，并重新生成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean &amp;&amp; hexo g  //清空缓存并生成静态文件</span><br></pre></td></tr></table></figure><p>2️⃣ 本地预览，确没有问题再进行发布</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s -p 4000 或者 hexo s  //启动本地服务默认</span><br></pre></td></tr></table></figure><p>3️⃣ 当 gulp 执行完成，并提示 <code>please execute： hexo d</code> 时，可以进行发布</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo d 或者 gulp deploy  //部署发布</span><br></pre></td></tr></table></figure><br><h5 id="2）修改过主题源文件"><a href="#2）修改过主题源文件" class="headerlink" title="2）修改过主题源文件"></a><strong><font color='cornflowerblue'>2）修改过主题源文件</font></strong></h5><p>1️⃣ 拷贝主题目录下<code>package.json</code>文件到 Hexo 根目录下，然后安装项目的开发依赖。</p><p>如下是拷贝过来的，并删除了多余的代码。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blog&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;deploy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hexo deploy&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hexo s&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gulp --gulpfile gulpfile.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hexo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.3.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ejs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.1.10&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-abbrlink&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.2.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-deployer-git&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-archive&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-feed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-json-content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.2.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-sitemap&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-renderer-ejs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-renderer-marked&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;gulp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-autoprefixer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^9.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-clean-css&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-htmlclean&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.7.22&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-htmlmin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-jshint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-less&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-notify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-plumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.2.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-rename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-rev-append&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.1.8&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-sequence&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-uglify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jshint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.13.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jshint-stylish&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.2.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;notify-send&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.1.2&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>2️⃣ 在 Hexo 根目录下创建一个名为 gulpfile.js 的文件并引入主题中的gulpfile.mjs：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> gulpTasks <span class="keyword">from</span> <span class="string">&#x27;./themes/hexo-theme-snippet/gulpfile.mjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> gulpTasks.<span class="property">default</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; build, dev, watchFiles, compileLess &#125; = gulpTasks;</span><br></pre></td></tr></table></figure><p>3️⃣ 编译less→css</p><p>在 Hexo 根目录下package.json添加并执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   &quot;compile-less&quot;: &quot;gulp --gulpfile themes/hexo-theme-snippet/gulpfile.mjs compileLess&quot;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pnpm run compile-less</span><br></pre></td></tr></table></figure><p>4️⃣  清空 hexo 静态文件和缓存，并重新生成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean &amp;&amp; hexo g  //清空缓存并生成静态文件</span><br></pre></td></tr></table></figure><p>5️⃣ 运行 gulp：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pnpm run gulp</span><br></pre></td></tr></table></figure><ul><li><p>pnpm run gulp 执行的是gulpfile.js中的默认任务，该任务引用自主题目录中的gulpfile.mjs</p></li><li><p>gulp默认执行的build任务主要功能是优化已存在的public目录中的文件，包括：</p><ul><li>压缩CSS并添加前缀</li><li>压缩JS</li><li>添加版本号到HTML文件</li><li>压缩HTML文件</li></ul></li><li><p>但是，gulp任务是在 .&#x2F;public 目录下工作的，它 不会 自动生成public目录</p></li><li><p>在Hexo博客框架中，public目录是由 hexo g (hexo generate)命令生成的，该命令会将source目录中的Markdown文件等转换为静态HTML文件</p></li></ul><p>**🔚结论 ：**要完成完整的打包流程，你需要先执行 hexo g 来生成public目录，然后再执行 pnpm run gulp 来优化public目录中的文件</p><p>6️⃣ 本地预览，确没有问题再进行发布</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s -p 4000 或者 hexo s  //启动本地服务默认</span><br></pre></td></tr></table></figure><p>7️⃣ 当 gulp 执行完成，并提示 <code>please execute： hexo d</code> 时，可以进行发布</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo d 或者 gulp deploy  //部署发布</span><br></pre></td></tr></table></figure><br><h5 id="3）拓展优化💡"><a href="#3）拓展优化💡" class="headerlink" title="3）拓展优化💡"></a><strong><font color='cornflowerblue'>3）拓展优化💡</font></strong></h5><p>1️⃣ 本地开发启动一个开发服务器，监听主题中的Less和JS文件变化，当文件发生变化时自动进行编译或校验，提高开发效率。</p><p>在 Hexo 根目录下package.json添加并执行</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;gulp:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gulp --gulpfile themes/hexo-theme-snippet/gulpfile.mjs watchFiles&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pnpm run <span class="string">&quot;gulp:dev&quot;</span></span><br></pre></td></tr></table></figure><p>开发者在修改样式或脚本文件后无需手动执行编译命令，系统会自动检测并处理文件变化</p><p>2️⃣优化指令</p><br><h4 id="3-5、更新主题"><a href="#3-5、更新主题" class="headerlink" title="3.5、更新主题"></a><strong><font color='#10c300'>3.5、更新主题</font></strong></h4><p>❌不建议更新，如果自己更改过主题源文件，更新主题会把自己改动的全部替换掉</p><p>主题可能会不定时优化和更新，更新主题代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> themes/hexo-theme-snippet</span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure><br><h4 id="3-6、主题配置"><a href="#3-6、主题配置" class="headerlink" title="3.6、主题配置"></a><strong><font color='#10c300'>3.6、主题配置</font></strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## menu -- 导航菜单显示&#123;[@page:名字,@url:地址,@icon:图标]&#125;</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">page:</span> <span class="string">home</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fa-home</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## favicon -- 网站图标位置&#123;@favicon&#125;</span></span><br><span class="line"><span class="attr">favicon:</span> <span class="string">/favicon.ico</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## rss --rss文件位置&#123;@rss&#125;</span></span><br><span class="line"><span class="attr">rss:</span> <span class="string">/atom.xml</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 各个小工具的设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## widgets -- 6个左边小工具&#123;@widgets:[notification,category,archive,tagcloud,friends]&#125;</span></span><br><span class="line"><span class="attr">widgets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">search</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">notification</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">social</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">category</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">archive</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tagcloud</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">friends</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 各个小工具的设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 搜索</span></span><br><span class="line"><span class="attr">jsonContent:</span></span><br><span class="line">  <span class="attr">searchLocal:</span> <span class="literal">true</span> <span class="string">//</span> <span class="string">是否启用本地搜索</span></span><br><span class="line">  <span class="attr">searchGoogle:</span> <span class="literal">true</span> <span class="string">//是否启用谷歌搜索</span></span><br><span class="line">  <span class="attr">posts:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">text:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">content:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## notification config --网站公告设置,支持 html 和 纯文本</span></span><br><span class="line"><span class="attr">notification:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">            &lt;p&gt;主题已经上线！欢迎下载或更新~ &lt;br/&gt;</span></span><br><span class="line"><span class="string">            主题下载：&lt;a href=&quot;https://github.com/shenliyang/hexo-theme-snippet&quot; title=&quot;fork me&quot; target=&quot;_blank&quot;&gt;Snippet主题&lt;/a&gt; &lt;br/&gt;</span></span><br><span class="line"><span class="string">            &lt;hr/&gt;接受贡献，包括不限于提交问题与需求，修复代码。欢迎Pull Request&lt;br/&gt;支持主题：&lt;a href=&quot;https://github.com/shenliyang/hexo-theme-snippet/stargazers&quot;&gt;Star一下&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="comment">## 社交设置&#123;@name:社交工具名字，@icon:社交工具图标，@href:设置工具链接&#125; [参考图标](http://fontawesome.io/icons/)</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Github</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">href:</span> <span class="string">//github.com/shenliyang</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章分类设置&#123;@cate_config:&#123;@show_count:是否显示数字，@show_current: 是否高亮当前category&#125;&#125;</span></span><br><span class="line"><span class="attr">cate_config:</span></span><br><span class="line">   <span class="attr">show_count:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">show_current:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章归档设置&#123;@arch_config:/*参数参考：https://hexo.io/zh-cn/docs/helpers.html#list-archives*/&#125;</span></span><br><span class="line"><span class="comment">## 推荐组合方式：[&#123;type: &#x27;monthly&#x27;,format: &#x27;YYYY年MM月&#x27;&#125;,&#123;type: &#x27;yearly&#x27;,format: &#x27;YYYY年&#x27;&#125;]</span></span><br><span class="line"><span class="attr">arch_config:</span></span><br><span class="line">   <span class="attr">type:</span> <span class="string">&#x27;monthly&#x27;</span></span><br><span class="line">   <span class="attr">format:</span> <span class="string">&#x27;YYYY年MM月&#x27;</span></span><br><span class="line">   <span class="attr">show_count:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">order:</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 标签云设置&#123;/*参数参考：http://www.goat1000.com/tagcanvas-options.php */&#125;</span></span><br><span class="line"><span class="attr">tagcloud:</span></span><br><span class="line">  <span class="attr">tag3d:</span> <span class="literal">false</span> <span class="string">//</span> <span class="string">是否启用3D标签云</span></span><br><span class="line">  <span class="attr">textColour:</span> <span class="string">&#x27;#444&#x27;</span> <span class="string">//</span> <span class="string">字体颜色</span></span><br><span class="line">  <span class="attr">outlineMethod:</span> <span class="string">&#x27;block&#x27;</span> <span class="string">//</span> <span class="string">选中模式(outline|classic|block|colour|size|none)</span></span><br><span class="line">  <span class="attr">outlineColour:</span> <span class="string">&#x27;#FFDAB9&#x27;</span> <span class="string">//</span> <span class="string">选中模式的颜色</span></span><br><span class="line">  <span class="attr">interval:</span> <span class="number">30</span> <span class="string">//</span> <span class="string">动画帧之间的时间间隔，值越大，转动幅度越大</span></span><br><span class="line">  <span class="attr">freezeActive:</span> <span class="literal">true</span> <span class="string">//</span> <span class="string">选中的标签是否继续滚动</span></span><br><span class="line">  <span class="attr">frontSelect:</span> <span class="literal">true</span> <span class="string">//</span> <span class="string">不选标签云后部的标签</span></span><br><span class="line">  <span class="attr">reverse:</span> <span class="literal">true</span> <span class="string">//</span> <span class="string">是否反向触发</span></span><br><span class="line">  <span class="attr">wheelZoom:</span> <span class="literal">false</span> <span class="string">//</span> <span class="string">是否启用鼠标滚轮</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 友链设置&#123;@链接名称：链接地址&#123;@links:[,,,]&#125;&#125;</span></span><br><span class="line"><span class="attr">links:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Hexo官网:</span> <span class="string">https://hexo.io/zh-cn/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主题自定义个性化配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 网站宣传语&#123;@branding：网站宣传语(不设置显示本地图片)&#125;</span></span><br><span class="line"><span class="attr">branding:</span> <span class="string">从未如此简单有趣</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置banner背景图片&#123;@img:自定义图片地址(支持绝对和相对路径),主题默认&#123;&quot;静态背景&quot;:&quot;banner.jpg&quot;&#125;,&#123;&quot;动态背景&quot;:&quot;banner2.jpg&quot;&#125;,&#123;&quot;动态星空背景&quot;:&quot;banner3.jpg&quot;&#125;&#125;</span></span><br><span class="line"><span class="comment">## 例如：https://hexo-theme-snippet-1251680922.cos.ap-beijing.myqcloud.com/img/banner|2|3.jpg, 或者 &#x27;./img/banner-img.jpg&#x27;(相对本地资源地址)</span></span><br><span class="line"><span class="attr">banner:</span></span><br><span class="line">  <span class="attr">img:</span> <span class="string">https://hexo-theme-snippet-1251680922.cos.ap-beijing.myqcloud.com/img/banner.jpg</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置carousel&#123;@img:图片地址,@url:点击跳转链接(默认值:&quot;javascript:&quot;)&#125;</span></span><br><span class="line"><span class="attr">carousel:</span></span><br><span class="line">  <span class="attr">img:</span> <span class="string">&#x27;img/head-img.jpg&#x27;</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">&#x27;javascript:&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 首页列表底部面板&#123;@homePanel: 是否开启&#125;</span></span><br><span class="line"><span class="attr">homePanel:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 首页文章列表缩略图</span></span><br><span class="line"><span class="comment">### 加载规则: 自定义文章缩略图(在Front-matter中添加的&#x27;img&#x27;字段) &gt; 文章内的图片 &gt; defaultImgs(随机获取) &gt; 无图模式列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 自定义随机图片</span></span><br><span class="line"><span class="attr">defaultImgs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">http://www.example.jpg</span> <span class="string">//远程图片链接示例</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/img/default-1.jpg</span> <span class="string">//本地图片链接示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 文章摘要&#123;@摘要显示优先级：自定义摘要 &gt; 自动截取摘要 &#125;</span></span><br><span class="line"><span class="comment">### 自定义摘要范围&#123;@&lt;!--more--&gt;:截取more之前的内容为摘要&#125;</span></span><br><span class="line"><span class="comment">### 自动截取摘要&#123;@excerptLength:自动截取文章前多少个字为摘要，不配置默认：120字&#125;</span></span><br><span class="line"><span class="attr">excerptLength:</span> <span class="number">120</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 是否开启文章目录</span></span><br><span class="line"><span class="attr">toc:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 代码高亮配置&#123;@highlightTheme: 主题名称,(配置暂时不可用，后续开发中…)&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">highlightTheme:</span> <span class="string">default</span> <span class="string">//TODO</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章过期提醒功能 &#123;@warning:&#123;days:临界天数(默认300天,设置0关闭功能),text:提醒文字/*%d为过期总天数占位符*/&#125;&#125;</span></span><br><span class="line"><span class="attr">warning:</span></span><br><span class="line">  <span class="attr">days:</span> <span class="number">300</span></span><br><span class="line">  <span class="attr">text:</span> <span class="string">&#x27;本文于%d天之前发表，文中内容可能已经过时。&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章内声明&#123;@declaration: &#123;enable:是否开启,title:声明标题,tip:提示内容&#125;&#125;</span></span><br><span class="line"><span class="attr">declaration:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&#x27;转载声明&#x27;</span></span><br><span class="line">  <span class="attr">tip:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">      商业转载请联系作者获得授权,非商业转载请注明出处 © &lt;a href=&quot;&quot; target=&quot;_blank&quot;&gt;Snippet&lt;/a&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="comment">## 文章打赏&#123;@reward: &#123;alipay:支付宝打赏,wepay:微信打赏,tip:打赏提示语; 链接都为空,关闭打赏功能&#125;&#125;</span></span><br><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">alipay:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">wepay:</span> <span class="string">&#x27;../img/reward-wepay.jpg&#x27;</span></span><br><span class="line">  <span class="attr">tip:</span> <span class="string">赞赏是不耍流氓的鼓励</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 主题评论</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## utterances评论: 一款基于 GitHub issues 的评论工具; 首先在 github 上进行安装 utterances，访问 [utterances应用程序](https://github.com/apps/utterances)；然后在主题内配置 [utterances更多配置](https://utteranc.es/)</span></span><br><span class="line"><span class="attr">utterances:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">shenliyang/snippet-comment</span> <span class="string">//</span> <span class="string">github仓库名字,</span> <span class="string">格式为</span> <span class="string">user-name/repo-name</span></span><br><span class="line">  <span class="attr">issueTerm:</span> <span class="string">pathname</span> <span class="string">//</span> <span class="string">标识issue类型</span> <span class="number">1</span><span class="string">.</span> <span class="string">pathname(推荐);</span> <span class="number">2</span><span class="string">.</span> <span class="string">url;</span> <span class="number">3.</span><span class="string">title;</span> <span class="number">3</span><span class="string">.</span> <span class="string">og:title;</span> <span class="number">4</span><span class="string">.</span> <span class="string">issue-number</span> <span class="number">5</span><span class="string">.</span> <span class="string">specific-term;</span></span><br><span class="line">  <span class="attr">issueNumber:</span> <span class="number">123</span> <span class="string">//</span> <span class="string">非必填，当配置</span> <span class="string">issueTerm</span> <span class="string">=</span> <span class="string">&quot;issue-number&quot;</span><span class="string">时，需要配置issue号</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">github-light</span> <span class="string">//</span> <span class="string">主题配置</span> <span class="number">1</span><span class="string">.</span> <span class="string">github-light(推荐);</span> <span class="number">2</span><span class="string">.</span> <span class="string">github-dark;</span> <span class="number">3</span><span class="string">.</span> <span class="string">preferred-color-scheme;</span> <span class="number">4</span><span class="string">.</span> <span class="string">github-dark-orange;</span> <span class="number">5</span><span class="string">.</span> <span class="string">icy-dark;</span> <span class="number">6</span><span class="string">.</span> <span class="string">dark-blue;</span> <span class="number">7</span><span class="string">.</span> <span class="string">photon-dark;</span> <span class="number">8</span><span class="string">.</span> <span class="string">boxy-light</span></span><br><span class="line">  <span class="attr">label:</span> <span class="string">//</span> <span class="string">非必填</span></span><br><span class="line">  <span class="attr">cdn:</span> <span class="string">//</span> <span class="string">使用自定义utteranc脚本加载。</span> <span class="string">非必填，默认：&quot;https://utteranc.es/client.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### gitment</span></span><br><span class="line"><span class="attr">gitment:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">owner:</span></span><br><span class="line">  <span class="attr">repo:</span></span><br><span class="line">  <span class="attr">client_id:</span></span><br><span class="line">  <span class="attr">client_secret:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">  <span class="attr">perPage:</span></span><br><span class="line">  <span class="attr">maxCommentHeight:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 来必力</span></span><br><span class="line"><span class="attr">livere:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">livere_uid:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 友言评论(服务不稳定，经常无法加载)</span></span><br><span class="line"><span class="attr">uyan:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">uyan_id:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Disqus评论(需要翻墙，或者搭建代理)</span></span><br><span class="line"><span class="attr">disqus:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">shortname:</span> <span class="string">snippet</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 畅言评论(需要ICP备案)</span></span><br><span class="line"><span class="attr">changyan:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">appid:</span></span><br><span class="line">  <span class="attr">conf:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Valine评论(leancloud需要实名认证) 参考网站: [valine评论](https://valine.js.org/)</span></span><br><span class="line"><span class="attr">valine:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">appId:</span></span><br><span class="line">  <span class="attr">appKey:</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">说点什么吧</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="literal">false</span> <span class="string">//</span> <span class="string">邮件通知</span></span><br><span class="line">  <span class="attr">verify:</span> <span class="literal">false</span> <span class="string">//</span> <span class="string">验证码</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">mm</span> <span class="string">//</span> <span class="string">avatar头像</span></span><br><span class="line">  <span class="attr">meta:</span> <span class="string">nick,mail</span> <span class="string">//</span> <span class="string">输入框内容，可选值nick,mail,link</span></span><br><span class="line">  <span class="attr">pageSize:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Gitalk评论 参考网站: [一个基于Github Issue和Preact开发的评论插件](https://gitalk.github.io/)</span></span><br><span class="line"><span class="attr">gitalk:</span></span><br><span class="line">   <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">clientID:</span> <span class="string">&quot;&quot;</span> <span class="string">//</span> <span class="string">Github</span> <span class="string">应用ID</span></span><br><span class="line">   <span class="attr">clientSecret:</span> <span class="string">&quot;&quot;</span> <span class="string">//</span> <span class="string">Github</span> <span class="string">应用密钥</span></span><br><span class="line">   <span class="attr">repo:</span> <span class="string">shenliyang.github.io</span> <span class="string">//</span> <span class="string">Github仓库地址</span></span><br><span class="line">   <span class="attr">owner:</span> <span class="string">shenliyang</span>  <span class="string">//</span> <span class="string">Github</span> <span class="string">用户名(Github仓库拥有者)</span></span><br><span class="line">   <span class="attr">admin:</span> <span class="string">shenliyang</span> <span class="string">//</span> <span class="string">GitHub</span> <span class="string">repository</span> <span class="string">的所有者和合作者</span> <span class="string">(对这个</span> <span class="string">repository</span> <span class="string">有写权限的用户)可以有一个或多个，如果有多名可使用，例如：admin:</span> <span class="string">admin1,admin2</span> <span class="string">配置</span></span><br><span class="line">   <span class="attr">perPage:</span> <span class="number">10</span> <span class="string">//</span> <span class="string">每次加载的数据大小，最多100</span></span><br><span class="line">   <span class="attr">distractionFreeMode:</span> <span class="literal">true</span> <span class="string">//</span> <span class="string">是否启用无干扰模式，类似Facebook评论框的全屏遮罩效果</span></span><br><span class="line"></span><br><span class="line">   <span class="string">//</span> <span class="string">以下参数主题会默认处理，不需要配置</span></span><br><span class="line">   <span class="string">language</span> <span class="string">//</span> <span class="string">语言类型，默认为站点配置中选项</span></span><br><span class="line">   <span class="string">id</span> <span class="string">//</span> <span class="string">页面的唯一标识,</span> <span class="string">已使用md5对pathname转换生成唯一id处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 网站访客统计 [不蒜子统计](http://busuanzi.ibruce.info/)</span></span><br><span class="line"><span class="attr">visit_counter:</span></span><br><span class="line">   <span class="attr">site:</span> <span class="literal">true</span> <span class="string">//</span> <span class="string">总访问量和访问人数统计</span></span><br><span class="line">   <span class="attr">page:</span> <span class="literal">true</span> <span class="string">//</span> <span class="string">文章阅读量统计</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 网站访问统计</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 网盟CNZZ统计 参考网站: [网盟CNZZ](http://www.umeng.com/)</span></span><br><span class="line"><span class="attr">cnzz_anaylytics:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 百度统计 参考网站: [百度统计](https://tongji.baidu.com/)</span></span><br><span class="line"><span class="attr">baidu_anaylytics:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 谷歌统计 参考网站：[谷歌统计](https://www.google-analytics.com/)</span></span><br><span class="line"><span class="attr">google_anaylytics:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 腾讯分析 参考网站：[腾讯分析](http://ta.qq.com/)</span></span><br><span class="line"><span class="attr">tencent_analytics:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 百度站点认证</span></span><br><span class="line"><span class="attr">baidu-site-verification:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 百度自动推送(@baidu_push: 是否启用百度自动推送)  参考网站: [百度站长资源](https://ziyuan.baidu.com/college/courseinfo?id=267&amp;page=2#h2_article_title18)</span></span><br><span class="line"><span class="attr">baidu_push:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ICON配置 (不配则启用本地Font Icon)</span></span><br><span class="line"><span class="attr">fontAwesome:</span> <span class="string">//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 网站主题配置</span></span><br><span class="line"><span class="attr">since:</span> <span class="number">2017</span>  <span class="string">//建站时间</span></span><br><span class="line"><span class="attr">beian:</span> <span class="string">&#x27;京ICP备04000001号&#x27;</span> <span class="string">//网站备案号</span></span><br><span class="line"><span class="attr">robot:</span> <span class="string">&#x27;all&#x27;</span>  <span class="string">//控制搜索引擎的抓取和索引编制行为，默认为all</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.3</span><span class="number">.0</span>  <span class="string">//当前主题版本号</span></span><br></pre></td></tr></table></figure><br><h4 id="3-7、主题使用技巧及功能扩展"><a href="#3-7、主题使用技巧及功能扩展" class="headerlink" title="3.7、主题使用技巧及功能扩展"></a><strong><font color='#10c300'>3.7、主题使用技巧及功能扩展</font></strong></h4><p>修改新增文章 Front-matter 模板,修改<code>scaffolds</code>目录下的<code>post.md</code>模板</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> &#123;&#123; <span class="string">title</span> &#125;&#125; <span class="string">//</span> <span class="string">标题</span></span><br><span class="line"><span class="attr">date:</span> &#123;&#123; <span class="string">date</span> &#125;&#125;   <span class="string">//</span> <span class="string">时间</span></span><br><span class="line"><span class="attr">categories:</span> [<span class="string">&#x27;分类1&#x27;</span>,<span class="string">&#x27;分类2&#x27;</span>] <span class="string">//</span> <span class="string">分类</span></span><br><span class="line"><span class="attr">tags:</span> [<span class="string">&#x27;标签1&#x27;</span>,<span class="string">&#x27;标签2&#x27;</span>]       <span class="string">//</span> <span class="string">标签</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span>    <span class="string">//</span> <span class="string">是否开启评论</span></span><br><span class="line"><span class="attr">img:</span>               <span class="string">//</span> <span class="string">自定义缩略图</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><br><h3 id="四、自定义路由-导航"><a href="#四、自定义路由-导航" class="headerlink" title="四、自定义路由(导航)"></a><strong><font color='red'>四、自定义路由(导航)</font></strong></h3><p>以我们这次<a href="https://github.com/shenliyang/hexo-theme-snippet">Asnippet</a>主题为例</p><p><a href="#aa">前置元数据详解</a>(前置知识，必先：ctrl+左键点击查看)</p><h4 id="4-1、配置文件中添加导航项"><a href="#4-1、配置文件中添加导航项" class="headerlink" title="4.1、配置文件中添加导航项"></a><strong><font color='#10c300'>4.1、配置文件中添加导航项</font></strong></h4><ul><li>主题配置文件中编辑 themes&#x2F;hexo-theme-snippet&#x2F;_config.yml</li><li>在 menu 部分添加新的菜单项（分类&#x2F;关于），格式如下：</li></ul><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251028185224676.png" alt="image-20251028185224676"></p><h4 id="4-2、创建页面内容"><a href="#4-2、创建页面内容" class="headerlink" title="4.2、创建页面内容"></a><strong><font color='#10c300'>4.2、创建页面内容</font></strong></h4><p><strong><font color='orange'>1）创建的页面就是以.md文件内容为展示的路由页面</font></strong></p><ul><li><p>在Hexo项目的根目录的source目录下创建对应的文件夹和文件</p><p>例如，要创建 <code>/about/</code>路由，需要在 source 目录下创建 <code>source\about\index.md</code>文件</p></li><li><p>在 index.md 中添加页面内容和前置元数据</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">关于我</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-10-28 16:03:32</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251029000623224.png" alt="image-20251029000623224"></p></li></ul><p><strong><font color='orange'>2）创建自定义页面模板</font></strong></p><ul><li><p>如果需要自定义页面模板，可以在<code>themes\hexo-theme-snippet\layout\</code>目录下创建新的<code>.ejs</code> 文件（<code>categories.ejs</code>）</p></li><li><p>在页面的前置元数据中指定布局文件。例如在layout文件夹中创建<code>categories.ejs</code>文件，那么在元数据中layout的属性值就得设置成<code>categories</code>和layout文件夹中创建的<code>.ejs</code> 文件名保持一致</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 分类</span><br><span class="line">date: 2025-10-28 16:15:28</span><br><span class="line">layout: categories</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251029001736475.png" alt="image-20251029001736475"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251029000804848.png" alt="image-20251029000804848"></p></li></ul><br><h3 id="五、前置元数据-Front-matter"><a href="#五、前置元数据-Front-matter" class="headerlink" title="五、前置元数据(Front-matter)"></a><strong><font color='red'>五、前置元数据(Front-matter)</font></strong></h3><p>在Hexo中，页面的前置元数据（Front-matter）和内容的组织是创建自定义页面的关键。</p><p>前置元数据是位于文件顶部、由 — 包围的YAML或JSON格式数据，它定义了页面的各种属性。</p><h4 id="5-1、基本结构"><a href="#5-1、基本结构" class="headerlink" title="5.1、基本结构"></a><strong><font color='#10c300'>5.1、基本结构</font></strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">页面标题</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-10-28 16:03:32</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">布局名称</span></span><br><span class="line"><span class="comment"># 其他属性...</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># 这里开始是页面内容</span></span><br></pre></td></tr></table></figure><h4 id="5-2、常用前置元数据属性"><a href="#5-2、常用前置元数据属性" class="headerlink" title="5.2、常用前置元数据属性"></a><strong><font color='#10c300'>5.2、常用前置元数据属性</font></strong></h4><p>根据您的项目中的示例，以下是常用的属性：</p><ol><li>title : 页面标题</li><li>date : 创建日期，格式为 YYYY-MM-DD HH:mm:ss</li><li>layout : 指定使用的布局模板（如 categories ）</li><li>comments : 是否开启评论（true&#x2F;false）</li><li>categories : 分类</li><li>tags : 标签</li><li>permalink : 自定义永久链接</li></ol><br><h3 id="六、博客部署到Github-Pages"><a href="#六、博客部署到Github-Pages" class="headerlink" title="六、博客部署到Github Pages"></a><strong><font color='red'>六、博客部署到Github Pages</font></strong></h3><h4 id="6-1、新建仓库"><a href="#6-1、新建仓库" class="headerlink" title="6.1、新建仓库"></a><strong><font color='#10c300'>6.1、新建仓库</font></strong></h4><p>创建一个和你用户名相同的仓库，后面加 <code>.github.io</code></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251031115006280.png" alt="image-20251031115006280"></p><h4 id="6-2、实现免密登录"><a href="#6-2、实现免密登录" class="headerlink" title="6.2、实现免密登录"></a><strong><font color='#10c300'>6.2、实现免密登录</font></strong></h4><p><strong>为了实现安全的免密访问 GitHub 仓库</strong>，也就是在你每次部署或推送内容到 GitHub Pages 时，不再需要输入账号密码，同时保证传输是安全加密的。</p><h5 id="1）配置-Git-用户信息"><a href="#1）配置-Git-用户信息" class="headerlink" title="1）配置 Git 用户信息"></a><strong><font color='cornflowerblue'>1）配置 Git 用户信息</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;yourname&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;youremail&quot;</span></span><br></pre></td></tr></table></figure><p>这两条命令不是用来登录的，而是：</p><ul><li><p>告诉 Git <strong>是谁在提交代码</strong>。</p></li><li><p>每一次 commit 都会写入这两个信息，形成类似：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Author: yourname &lt;youremail&gt;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p> <strong>🚨注意：</strong><br> 这个邮箱最好与你 GitHub 账号绑定的邮箱一致，否则 GitHub 无法正确识别为你的提交</p></blockquote><p>查看当前配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bashgit config user.name</span><br><span class="line">git config user.email</span><br></pre></td></tr></table></figure><h5 id="2）生成-SSH-密钥"><a href="#2）生成-SSH-密钥" class="headerlink" title="2）生成 SSH 密钥"></a><strong><font color='cornflowerblue'>2）生成 SSH 密钥</font></strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;yourEmail&quot;</span></span><br></pre></td></tr></table></figure><p>这条命令是<strong>创建一对 SSH 密钥</strong>（key pair）：</p><ul><li><strong>私钥 (<code>id_rsa</code>)</strong>：保存在你电脑上，不要泄露。</li><li><strong>公钥 (<code>id_rsa.pub</code>)</strong>：可以安全地上传到 GitHub（或其他服务器）。</li></ul><p>然后你会发现 <code>C:\Users\19584\</code> 下有一个 <code>.ssh</code> 目录，如果没有，打开隐藏文件夹，<code>.ssh</code> 文件夹下有 <code>id_rsa</code> 和 <code>id_rsa.pub</code>，前一个是私钥，后一个是公钥</p><h5 id="3）配置到-GitHub"><a href="#3）配置到-GitHub" class="headerlink" title="3）配置到 GitHub"></a><strong><font color='cornflowerblue'>3）配置到 GitHub</font></strong></h5><p>将 <code>id_rsa.pub</code> 内的内容复制下来，然后进入 GitHub，点击 <code>Settings</code>，进入 <code>SSH and GPG keys</code> 选项，点击 <code>New SSH key</code>，然后填写 <code>Title: Blog</code>，<code>Key:你刚刚复制的公钥</code></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20251031140039333.png" alt="image-20251031140039333"></p><h4 id="6-3、一键部署"><a href="#6-3、一键部署" class="headerlink" title="6.3、一键部署"></a><strong><font color='#10c300'>6.3、一键部署</font></strong></h4><ol><li><p>安装 <a href="https://github.com/hexojs/hexo-deployer-git">hexo-deployer-git</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add hexo-deployer-git</span><br></pre></td></tr></table></figure></li><li><p>在根目录 <code>_config.yml</code> 中添加以下配置（如果配置已经存在，请将其替换为如下）:</p></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/&lt;username&gt;/&lt;username&gt;.github.io</span></span><br><span class="line">  <span class="comment"># example, https://github.com/hexojs/hexojs.github.io</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span>  <span class="string">//</span> <span class="string">和你创建的&lt;username&gt;.github.io创库的主分支保持一致</span></span><br></pre></td></tr></table></figure><ul><li>执行 <code>hexo clean &amp;&amp; hexo deploy</code> 。</li><li>浏览 <em>username</em>.github.io，检查你的网站能否运作。</li></ul><p>添加组合命令</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;push&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run compile-less &amp;&amp; pnpm run del &amp;&amp; pnpm run clean &amp;&amp; pnpm run build &amp;&amp; pnpm run gulp &amp;&amp; pnpm run deploy&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;div align=&quot;center&quot;&gt;
    &lt;img src=&quot;https://img.shields.io/badge/hexo-8.1.0-d1a8.svg&quot;/&gt;
    &lt;img src=&quot;https://img.shields.io/badge/hexoCli-4.</summary>
      
    
    
    
    <category term="其他" scheme="http://example.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
    <category term="hexo" scheme="http://example.com/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>UnoCSS的使用</title>
    <link href="http://example.com/posts/74efe575.html"/>
    <id>http://example.com/posts/74efe575.html</id>
    <published>2025-08-23T15:51:08.000Z</published>
    <updated>2026-03-01T16:07:38.352Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502221552580.png" alt="image-20250222155200521"></p><p><a href="https://unocss.jiangruyi.com/">UnoCSS中文文档</a></p><h3 id="1、安装"><a href="#1、安装" class="headerlink" title="1、安装 "></a><strong><font color='red'>1、安装 </font></strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add -D unocss @iconify-json/ep @unocss/preset-rem-to-px</span><br></pre></td></tr></table></figure><blockquote><p>unocss：核心库</p><p>@iconify-jsonp&#x2F;ep：使用elementplus图标库<a href="https://iconify.design/">https://iconify.design/</a></p><p>@unocss&#x2F;preset-rem-to-px：默认是rem单位，将rem转成px</p></blockquote><p>**<code>UnoCSS</code>**图标预设：<a href="https://unocss.jiangruyi.com/presets/icons">https://unocss.jiangruyi.com/presets/icons</a></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UnoCSS</span> <span class="keyword">from</span> <span class="string">&#x27;unocss/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title class_">UnoCSS</span>(),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="2、配置"><a href="#2、配置" class="headerlink" title="2、配置"></a><strong><font color='red'>2、配置</font></strong></h3><p>**<code>UnoCSS</code>**的尺寸1（m-1）转换之后是4px，根目录默认字体大小16px即16px &#x3D; 1rem，4px &#x3D; 0.25rem，因此得知Uno中的1表示4px，也代表0.25rem。如果要想将UnoCSS中的1变成1px，则需要安装<code>@unocss/preset-rem-to-px</code>插件。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// uno.config.ts</span></span><br><span class="line"><span class="keyword">import</span> presetRemToPx <span class="keyword">from</span> <span class="string">&#x27;@unocss/preset-rem-to-px&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    defineConfig,</span><br><span class="line">    presetAttributify,</span><br><span class="line">    presetIcons,</span><br><span class="line">    presetWind3,</span><br><span class="line">    transformerDirectives,</span><br><span class="line">    transformerVariantGroup,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;unocss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">shortcuts</span>: &#123; <span class="comment">// 自定义属性  一个属性可以对应多个UnoCSS类值</span></span><br><span class="line">        <span class="string">&#x27;flex-center&#x27;</span>: <span class="string">&#x27;flex justify-center items-center&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;flex-x-center&#x27;</span>: <span class="string">&#x27;flex justify-center&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;flex-y-center&#x27;</span>: <span class="string">&#x27;flex items-center&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;grid-center&#x27;</span>: <span class="string">&#x27;grid place-items-center&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;wh-full&#x27;</span>: <span class="string">&#x27;w-full h-full&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;flex-x-between&#x27;</span>: <span class="string">&#x27;flex items-center justify-between&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;flex-x-end&#x27;</span>: <span class="string">&#x27;flex items-center justify-end&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;absolute-lt&#x27;</span>: <span class="string">&#x27;absolute left-0 top-0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;absolute-rt&#x27;</span>: <span class="string">&#x27;absolute right-0 top-0 &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;fixed-lt&#x27;</span>: <span class="string">&#x27;fixed left-0 top-0&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">theme</span>: &#123;</span><br><span class="line">        <span class="attr">colors</span>: &#123; <span class="comment">// 自定义颜色</span></span><br><span class="line">            <span class="attr">primary</span>: <span class="string">&#x27;var(--el-color-primary)&#x27;</span>,</span><br><span class="line">            <span class="attr">red</span>: <span class="string">&#x27;#f53e31&#x27;</span>,</span><br><span class="line">            <span class="attr">gray_888</span>: <span class="string">&#x27;#888&#x27;</span>,</span><br><span class="line">            <span class="attr">gray_999</span>: <span class="string">&#x27;#999&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">presets</span>: [</span><br><span class="line">        <span class="title function_">presetWind3</span>(&#123;</span><br><span class="line">            <span class="attr">important</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 允许你直接在HTML元素上使用属性来定义样式，而不需要使用class。例如，&lt;div flex m=&quot;5&quot;&gt;&lt;/div&gt;可以等价于&lt;div class=&quot;flex m-5&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">        <span class="title function_">presetAttributify</span>(),</span><br><span class="line">        <span class="title function_">presetIcons</span>(&#123;</span><br><span class="line">            <span class="attr">scale</span>: <span class="number">1.2</span>,</span><br><span class="line">            <span class="attr">warn</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title function_">presetRemToPx</span>(&#123; <span class="comment">// 根目录字体设置为4即可实现unocss的1为1px</span></span><br><span class="line">            <span class="attr">baseFontSize</span>: <span class="number">4</span>,</span><br><span class="line">        &#125;),</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// transformerDirectives() 可以使用@apply @screen theme函数</span></span><br><span class="line">    <span class="attr">transformers</span>: [</span><br><span class="line">        <span class="title function_">transformerDirectives</span>(),</span><br><span class="line">        <span class="title function_">transformerVariantGroup</span>(),</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        <span class="comment">// 以下官网规则可自定义转换</span></span><br><span class="line">        <span class="comment">// [/^m-([.\d]+)$/, ([_, num]) =&gt; (&#123; margin: `$&#123;num&#125;px` &#125;)],</span></span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;virtual:uno.css&#x27;</span></span><br></pre></td></tr></table></figure><br><p><strong><font color='red'>3、UnoCSS中使用图标 </font></strong></p><p><a href="https://icon-sets.iconify.design/" title=" iconify官网">iconify官网</a>中的@iconify-jsonp&#x2F;ep图标</p><p>@iconify-jsonp&#x2F;ep</p><blockquote><p>语法：i前缀-ep图标库:xx（图标名称）</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">i-ep:chrome-filled</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502232318083.png" alt="image-20250223231812025"></p><br><h3 id="4、UnoCSS预设语法"><a href="#4、UnoCSS预设语法" class="headerlink" title="4、UnoCSS预设语法 "></a><strong><font color='red'>4、UnoCSS预设语法 </font></strong></h3><p>默认的 <code>@unocss/preset-uno</code> 预设（实验阶段）是一系列流行的原子化框架的通用超集，包括了 <code>Tailwind CSS</code>，<code>Windi CSS</code>，<code>Bootstrap</code>，<code>Tachyons</code> 等。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">w-<span class="number">10</span> h-<span class="number">10</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line"></span><br><span class="line">max-w-<span class="number">96</span> min-w-<span class="number">96</span></span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">96px</span>;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">96px</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">text</span>-<span class="number">30</span></span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">30px</span></span><br><span class="line"></span><br><span class="line">rounded  rounded-<span class="number">2</span></span><br><span class="line">border-radius: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line"></span><br><span class="line">size-<span class="number">50</span></span><br><span class="line"><span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line"></span><br><span class="line">py-<span class="number">2</span></span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">2px</span>;</span><br><span class="line"></span><br><span class="line">px-<span class="number">4</span></span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">4px</span>;</span><br><span class="line"> <span class="attribute">padding-right</span>: <span class="number">4px</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">font</span>-bold</span><br><span class="line"><span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">border</span>-<span class="number">4</span> // 边框宽度</span><br><span class="line"><span class="attribute">border-width</span>: <span class="number">4px</span>;</span><br><span class="line"></span><br><span class="line">box-<span class="attribute">border</span></span><br><span class="line"><span class="attribute">box-sizing</span>: border-box;</span><br><span class="line"></span><br><span class="line">leading-<span class="number">3</span></span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">3px</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">text</span>-center</span><br><span class="line"><span class="attribute">text-align</span>: center;</span><br><span class="line"></span><br><span class="line">如果你的项目需要一次性自定义颜色，请考虑使用任意值符号来按需为该颜色生成一个类，而不是将其添加到你的主题中：</span><br><span class="line">class=&quot;c-<span class="selector-attr">[#f40]</span>&quot; //必须要用class</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">b</span>-<span class="selector-tag">b</span>-<span class="number">2</span> <span class="selector-tag">b</span>-solid <span class="selector-tag">b</span>-red</span><br><span class="line"><span class="attribute">border-bottom</span>: <span class="number">2px</span> solid red</span><br><span class="line"></span><br><span class="line">gap10</span><br><span class="line">gap: <span class="number">10px</span>;  <span class="attribute">flex</span>布局盒子之间距离</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502221552580.png&quot; alt=&quot;image-20250222155200521&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://</summary>
      
    
    
    
    <category term="工程化与质量" scheme="http://example.com/categories/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B8%8E%E8%B4%A8%E9%87%8F/"/>
    
    
    <category term="css" scheme="http://example.com/tags/css/"/>
    
    <category term="unocss" scheme="http://example.com/tags/unocss/"/>
    
  </entry>
  
  <entry>
    <title>element-Plus按需加载以及注意事项</title>
    <link href="http://example.com/posts/e3b10f75.html"/>
    <id>http://example.com/posts/e3b10f75.html</id>
    <published>2025-08-22T15:51:08.000Z</published>
    <updated>2026-03-01T16:07:38.352Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、依赖包安装"><a href="#一、依赖包安装" class="headerlink" title="一、依赖包安装"></a><strong><font color='red'>一、依赖包安装</font></strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pnpm install element-plus</span></span><br></pre></td></tr></table></figure><br><h3 id="二、Volar-支持"><a href="#二、Volar-支持" class="headerlink" title="二、Volar 支持"></a><strong><font color='red'>二、Volar 支持</font></strong></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/ tsconfig.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;element-plus/global&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br><h3 id="三、按需自动导入"><a href="#三、按需自动导入" class="headerlink" title="三、按需自动导入"></a><strong><font color='red'>三、按需自动导入</font></strong></h3><h4 id="3-1、安装"><a href="#3-1、安装" class="headerlink" title="3.1、安装 "></a><strong><font color='#10c300'>3.1、安装 </font></strong></h4><p>安装自动导入组件和函数的插件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pnpm add unplugin-vue-components unplugin-auto-import -D</span></span><br></pre></td></tr></table></figure><br><h4 id="3-2、配置"><a href="#3-2、配置" class="headerlink" title="3.2、配置 "></a><strong><font color='#10c300'>3.2、配置 </font></strong></h4><p>安装完成会默认在根目录生成<code>auto-imports.d.ts</code>和<code>components.d.ts</code>两个文件ts声明文件</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/ vite.<span class="property">config</span>.<span class="property">ts</span>配置</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AutoImport</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-auto-import/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Components</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElementPlusResolver</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="title class_">AutoImport</span>(&#123;</span><br><span class="line">         <span class="attr">resolvers</span>: [<span class="title class_">ElementPlusResolver</span>()],</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title class_">Components</span>(&#123;</span><br><span class="line">         <span class="attr">resolvers</span>: [<span class="title class_">ElementPlusResolver</span>()],</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>将生成的声明文件关联到ts的配置文件中去</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/ tsconfig.app.json</span><br><span class="line"><span class="comment">// 将auto-imports.d.ts和components.d.ts和env.d.ts三个文件统一放到根目录的types文件夹中，然后在include中直接引入types即可</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;types&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.vue&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// TypeScript编译器编译的文件</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p> 问题：只要新加组件和和函数就又会在根目录生成两个声明文件，但是我需要生成的文件在types文件中，怎么做呢？ 在<code>vite.config.ts</code>文件中配置声明文件存储的路径</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/ vite.<span class="property">config</span>.<span class="property">ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AutoImport</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-auto-import/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Components</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElementPlusResolver</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="title class_">AutoImport</span>(&#123;</span><br><span class="line">            <span class="comment">// 自动导入 Vue 相关函数，如：ref, reactive, toRef 等</span></span><br><span class="line">            <span class="attr">imports</span>: [<span class="string">&#x27;vue&#x27;</span>, <span class="string">&#x27;pinia&#x27;</span>, <span class="string">&#x27;vue-router&#x27;</span>],</span><br><span class="line">         <span class="attr">resolvers</span>: [<span class="title class_">ElementPlusResolver</span>()],</span><br><span class="line">            <span class="comment">// 指定自动导入 函数 TS类型声明文件路径，默认自动导入在根目录。</span></span><br><span class="line">            <span class="attr">dts</span>: <span class="string">&#x27;types/auto-imports.d.ts&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title class_">Components</span>(&#123;</span><br><span class="line">         <span class="attr">resolvers</span>: [<span class="title class_">ElementPlusResolver</span>()],</span><br><span class="line">            <span class="comment">// 指定自动导入 组件 TS类型声明文件路径，默认自动导入在根目录。</span></span><br><span class="line">            <span class="attr">dts</span>: <span class="string">&#x27;types/components.d.ts&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>怎么查看<code>components.d.ts</code>声明文件生效？鼠标放到使用的elementPlus组件上，会出现如图的ts。</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250217102004143.png" alt="image-20250217102004143"></p><p>忽略<code>auto-imports.d.ts</code>和<code>components.d.ts</code>上传至仓库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">types/*</span><br><span class="line">!types/env.d.ts</span><br></pre></td></tr></table></figure><br><h3 id="四、element-plus-样式问题"><a href="#四、element-plus-样式问题" class="headerlink" title="四、element-plus 样式问题"></a><strong><font color='red'>四、element-plus 样式问题</font></strong></h3><p>当你使用unplugin-vue-components来引入ui库的时候，message, notification，toast 等引入样式不生效（弹窗在底部）</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250217104623237.png" alt="image-20250217104623237"></p><h4 id="4-1、全量引入（不推荐）"><a href="#4-1、全量引入（不推荐）" class="headerlink" title="4.1、全量引入（不推荐） "></a><strong><font color='#10c300'>4.1、全量引入（不推荐） </font></strong></h4><p>在main.ts中引入</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br></pre></td></tr></table></figure><br><h4 id="4-1、按需自动引入"><a href="#4-1、按需自动引入" class="headerlink" title="4.1、按需自动引入"></a><strong><font color='#10c300'>4.1、按需自动引入</font></strong></h4><h5 id="1）安装"><a href="#1）安装" class="headerlink" title="1）安装 "></a><strong><font color='cornflowerblue'>1）安装 </font></strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pnpm add vite-plugin-style-import -D</span></span><br></pre></td></tr></table></figure><br><h5 id="2）配置文件"><a href="#2）配置文件" class="headerlink" title="2）配置文件 "></a><strong><font color='cornflowerblue'>2）配置文件 </font></strong></h5><p>在 <code>vite.config.ts</code> 配置</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStyleImportPlugin, <span class="title class_">ElementPlusResolve</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-style-import&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">createStyleImportPlugin</span>(&#123;</span><br><span class="line">            <span class="comment">// 预设的和自定义二选一</span></span><br><span class="line">            <span class="attr">resolves</span>: [<span class="title class_">ElementPlusResolve</span>()], <span class="comment">// 预设的样式解析器</span></span><br><span class="line">            <span class="comment">// libs: [&#123; // 自定义样式的加载方式</span></span><br><span class="line">            <span class="comment">//     libraryName: &#x27;element-plus&#x27;,</span></span><br><span class="line">            <span class="comment">//     esModule: true,</span></span><br><span class="line">            <span class="comment">//     resolveStyle: (name: string) =&gt; &#123;</span></span><br><span class="line">            <span class="comment">//         return `element-plus/theme-chalk/$&#123;name&#125;.css`</span></span><br><span class="line">            <span class="comment">//     &#125;,</span></span><br><span class="line">            <span class="comment">// &#125;],</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="五、icon图标自动导入"><a href="#五、icon图标自动导入" class="headerlink" title="五、icon图标自动导入"></a><strong><font color='red'>五、icon图标自动导入</font></strong></h3><p>如果使用unocss原子CSS引擎，也可使用unocss的icon图标引入，详细见<a href="https://shixna.github.io/post/74efe575.html">unocss使用教程</a></p><h4 id="5-1、安装"><a href="#5-1、安装" class="headerlink" title="5.1、安装 "></a><strong><font color='#10c300'>5.1、安装 </font></strong></h4><p>使用<code>unplugin-icons</code>和<code>unplugin-auto-import</code>从<a href="https://icon-sets.iconify.design/" title=" iconify官网">iconify</a>中自动导入任何图标集，若安装unplugin-auto-import则不需再次安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pnpm add -D unplugin-icons unplugin-auto-import</span></span><br></pre></td></tr></table></figure><br><h4 id="5-2、配置文件"><a href="#5-2、配置文件" class="headerlink" title="5.2、配置文件"></a><strong><font color='#10c300'>5.2、配置文件</font></strong></h4><h5 id="1）vite-config-ts配置"><a href="#1）vite-config-ts配置" class="headerlink" title="1）vite.config.ts配置 "></a><strong><font color='cornflowerblue'>1）vite.config.ts配置 </font></strong></h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Icons</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-icons/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">IconsResolver</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-icons/resolver&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title class_">Components</span>(&#123;</span><br><span class="line">            <span class="attr">resolvers</span>: [</span><br><span class="line">                <span class="title class_">IconsResolver</span>(), </span><br><span class="line">                <span class="comment">// IconsResolver(&#123;</span></span><br><span class="line">                <span class="comment">// prefix: &#x27;i&#x27;,</span></span><br><span class="line">                <span class="comment">// enabledCollections: [&#x27;ep&#x27;],</span></span><br><span class="line">                <span class="comment">// &#125;),</span></span><br><span class="line">            ],</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title class_">Icons</span>(&#123;</span><br><span class="line">            <span class="attr">autoInstall</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>网上很多教程有写在AutoImport中也需设置IconsResolver()，实际在AutoImport 下的 IconsResolver 中可以不添加 IconsResolver 配置，只在 Components 下的 IconsResolver 中进行相应配置就行</p><br><h5 id="2）自动导入icon-图标的格式"><a href="#2）自动导入icon-图标的格式" class="headerlink" title="2）自动导入icon 图标的格式"></a><strong><font color='cornflowerblue'>2）自动导入icon 图标的格式</font></strong></h5><p>{prefix}-{collection}-{icon}</p><p>即 ~ “前缀-使用的图标库名称-图标名” 格式形式来使用的，element-plus 的图标库名称是 “ep”，默认前缀是 “i”，需要改的话可以在 Components 配置项 的 IconsResolver 的<code>prefix</code>中进行相应配置</p><p>以elementPlus的<code>icon</code>为例（<a href="https://icon-sets.iconify.design/" title=" iconify官网">iconify</a>图标库中的也一样）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i-ep-Bowl</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 或者 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-icon</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i-ep-alarmClock</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果设置属性例如颜色、大写则必须使用<code>&lt;el-icon&gt;</code>包裹，然后在其上写属性</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-icon</span> <span class="attr">:size</span>=<span class="string">&quot;60&quot;</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i-ep-Plus</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br></pre></td></tr></table></figure><br><h5 id="3）IconsResolver配置解析"><a href="#3）IconsResolver配置解析" class="headerlink" title="3）IconsResolver配置解析"></a><strong><font color='cornflowerblue'>3）IconsResolver配置解析</font></strong></h5><p>当IconsResolver()不设置参数的时候，<a href="https://icon-sets.iconify.design/" title=" iconify官网">iconify</a>图标库中的图标都能使用（这里面也包含了elementPlus的图标）</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Icons</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-icons/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">IconsResolver</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-icons/resolver&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title class_">Components</span>(&#123;</span><br><span class="line">            <span class="attr">resolvers</span>: [</span><br><span class="line">                <span class="title class_">IconsResolver</span>(), </span><br><span class="line">            ],</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title class_">Icons</span>(&#123;</span><br><span class="line">            <span class="attr">autoInstall</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502172329868.png" alt="image-20250217232957812"></p><p>怎么使用<a href="https://icon-sets.iconify.design/" title=" iconify官网">iconify</a>图标库中的图标呢？举例子</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502172349404.png" alt="image-20250217234948316"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502172353815.png" alt="image-20250217235318764"></p><p>当IconsResolver()设置参数的时候，自定义图标格式前缀、限制使用图标库。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Icons</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-icons/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">IconsResolver</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-icons/resolver&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title class_">Components</span>(&#123;</span><br><span class="line">            <span class="attr">resolvers</span>: [</span><br><span class="line">                <span class="title class_">IconsResolver</span>(&#123;</span><br><span class="line">                <span class="attr">prefix</span>: <span class="string">&#x27;icon&#x27;</span>,</span><br><span class="line">                <span class="attr">enabledCollections</span>: [<span class="string">&#x27;ep&#x27;</span>, <span class="string">&#x27;mdi&#x27;</span>, <span class="string">&#x27;iconamoon&#x27;</span>],</span><br><span class="line">                &#125;),</span><br><span class="line">            ],</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title class_">Icons</span>(&#123;</span><br><span class="line">            <span class="attr">autoInstall</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// xxxx.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">icon-mdi-Bowl</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">icon-mdi-alarmClock</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">icon-iconamoon-arrow-bottom-right-1-fill</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502180003832.png" alt="image-20250218000329782"></p><p>怎么去看enabledCollections中定义的这个图标库名称呢？</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502180004288.png" alt="image-20250218000454202"></p><p><strong><code>注意</code></strong></p><p>当没做图标库限制的时候，使用了哪些图标库就会自动安装这个图标库的依赖，因此更建议使用IconsResolver({})自定义的去限制图标库</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250220170724230.png" alt="image-20250220170724230"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一、依赖包安装&quot;&gt;&lt;a href=&quot;#一、依赖包安装&quot; class=&quot;headerlink&quot; title=&quot;一、依赖包安装&quot;&gt;&lt;/a&gt;&lt;strong&gt;&lt;font color=&#39;red&#39;&gt;一、依赖包安装&lt;/font&gt;&lt;/strong&gt;&lt;/h3&gt;&lt;figure cla</summary>
      
    
    
    
    <category term="框架与生态" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6%E4%B8%8E%E7%94%9F%E6%80%81/"/>
    
    
    <category term="vue3" scheme="http://example.com/tags/vue3/"/>
    
    <category term="element-Plus" scheme="http://example.com/tags/element-Plus/"/>
    
  </entry>
  
  <entry>
    <title>0-1搭建vue3项目及配置</title>
    <link href="http://example.com/posts/eb0b56b0.html"/>
    <id>http://example.com/posts/eb0b56b0.html</id>
    <published>2025-08-20T15:51:08.000Z</published>
    <updated>2026-03-01T16:07:38.352Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>由于vite脚手架要禁止*.cjs 和 eslint版本升级废弃rc配置文件， 故重新搭建。</p><p>核心采用**<code>antfu</code>**大神预设配置 替代prettier和eslint设置，保留stylelint原因是暂时antfu不支持。</p></blockquote><h3 id="1、前置条件"><a href="#1、前置条件" class="headerlink" title="1、前置条件"></a><strong><font color='red'>1、前置条件</font></strong></h3><h4 id="1-1、node版本"><a href="#1-1、node版本" class="headerlink" title="1.1、node版本"></a><strong><font color='#10c300'>1.1、node版本</font></strong></h4><p>node 最好&gt;20 因为eslint9的需要 本次项目node为20.15.1</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240828103820848.png" alt="image-20240828103820848"></p><h4 id="1-2、包管理器"><a href="#1-2、包管理器" class="headerlink" title="1.2、包管理器"></a><strong><font color='#10c300'>1.2、包管理器</font></strong></h4><p>包管理器 采用pnpm</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20241207213915592.png" alt="image-20241207213915592"></p><h4 id="1-3、VsCode插件"><a href="#1-3、VsCode插件" class="headerlink" title="1.3、VsCode插件"></a><strong><font color='#10c300'>1.3、VsCode插件</font></strong></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.vscode/extensions.json</span><br><span class="line">它的作用是：当其他开发者用 VS Code 打开你的项目时，VS Code 会自动弹出提示，建议安装这些插件。</span><br><span class="line">recommendations：数组，列出推荐给团队成员的 VS Code 扩展插件 ID。</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;recommendations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;Vue.volar&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;dbaeumer.vscode-eslint&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;esbenp.prettier-vscode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;csstools.postcss&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;stylelint.vscode-stylelint&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;antfu.unocss&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;simonhe.to-unocss&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240828103527225.png" alt="image-20240828103527225"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240828103542672.png" alt="image-20240828103542672"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240828103556492.png" alt="image-20240828103556492"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240828103620621.png" alt="image-20240828103620621"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240828103706879.png" alt="image-20240828103706879"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240828140147090.png" alt="image-20240828140147090"></p><br><h3 id="2、创建项目"><a href="#2、创建项目" class="headerlink" title="2、创建项目"></a><strong><font color='red'>2、创建项目</font></strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建（二选一）</span></span><br><span class="line">pnpm create vite (vite官方)</span><br><span class="line">pnpm create vue@latest (vue官方)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命名</span></span><br><span class="line">? Project name: » vite-project</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择框架</span></span><br><span class="line">    Vanilla</span><br><span class="line">&gt;   Vue</span><br><span class="line">    React</span><br><span class="line">    Preact</span><br><span class="line">    Lit</span><br><span class="line">    Svelte</span><br><span class="line">    Solid</span><br><span class="line">    Qwik</span><br><span class="line">    Others</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择自己需要的语言</span></span><br><span class="line">? Select a variant: »</span><br><span class="line">    TypeScript</span><br><span class="line">    JavaScript</span><br><span class="line">&gt;   Customize with create-vue (现成的模板——推荐)</span><br><span class="line">    Nuxt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选配</span></span><br><span class="line">√ 是否使用 TypeScript 语法？ » 是</span><br><span class="line">√ 是否启用 JSX 支持？  » 是</span><br><span class="line">√ 是否引入 Vue Router 进行单页面应用开发？ » 是</span><br><span class="line">√ 是否引入 Pinia 用于状态管理？ » 是</span><br><span class="line">√ 是否引入 Vitest 用于单元测试？  » 是</span><br><span class="line">√ 是否要引入一款端到端（End to End）测试工具？ » 不需要</span><br><span class="line">√ 是否引入 ESLint 用于代码质量检测？ » 否</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化依赖</span></span><br><span class="line">dependencies:</span><br><span class="line">+ pinia 2.3.1</span><br><span class="line">+ vue 3.5.13</span><br><span class="line">+ vue-router 4.5.0</span><br><span class="line"></span><br><span class="line">devDependencies:</span><br><span class="line">+ @tsconfig/node22 22.0.0</span><br><span class="line">+ @types/node 22.10.10</span><br><span class="line">+ @vitejs/plugin-vue 5.2.1</span><br><span class="line">+ @vitejs/plugin-vue-jsx 4.1.1</span><br><span class="line">+ @vue/tsconfig 0.7.0</span><br><span class="line">+ npm-run-all2 7.0.2</span><br><span class="line">+ typescript 5.7.3</span><br><span class="line">+ vite 6.0.11</span><br><span class="line">+ vite-plugin-vue-devtools 7.7.1</span><br><span class="line">+ vue-tsc 2.2.0</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202504020017399.png" alt="image-20250402001720296"></p><p>如果pnpm版本是 v10.1.0 及以上，安装依赖包的时候pnpm i会有这个警告提示。因为pnpm 从 v10.1.0 开始引入安全机制，默认禁止依赖包运行构建脚本（如 <code>postinstall</code>），需要手动批准。若未明确允许 <code>esbuild</code> 的脚本执行，则会出现此警告。</p><p><strong>解决：修改配置文件（适合长期配置）</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;pnpm&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;onlyBuiltDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;esbuild&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br><h3 id="3、强制使用pnpm"><a href="#3、强制使用pnpm" class="headerlink" title="3、强制使用pnpm"></a><strong><font color='red'>3、强制使用pnpm</font></strong></h3><p><code>engines</code> 字段用于指定支持的 Node.js 版本以及其他依赖包的版本范围。它既不具有提示作用也不具有限制作用，它仅仅是一个标准，告诉使用者该软件包支持哪些版本的环境。</p><p><code>&quot;preinstall&quot;: &quot;npx only-allow pnpm&quot;</code>则具有强制作用，必须使用pnpm。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/ package.json</span><br><span class="line"><span class="attr">&quot;engines&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&gt;=20.15.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pnpm&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&gt;=9.0.6&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;preinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npx only-allow pnpm&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250124112043588.png" alt="image-20250124112043588"></p><br><h3 id="4、-vscode-配置文件"><a href="#4、-vscode-配置文件" class="headerlink" title="4、.vscode 配置文件"></a><strong><font color='red'>4、.vscode 配置文件</font></strong></h3><blockquote><p>用于保存带代码格式化功能</p></blockquote><p><strong>.vscode&#x2F;setting.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 这行配置开启了文件嵌套功能，使其在文件资源管理器中生效。</span></span><br><span class="line">    <span class="attr">&quot;explorer.fileNesting.enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 这是一个对象，其中定义了多个文件嵌套的模式。每个键值对定义了一个主文件和与之相关联的文件模式</span></span><br><span class="line">    <span class="attr">&quot;explorer.fileNesting.patterns&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;tsconfig.json&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tsconfig.*.json, env.d.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;vite.config.*&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jsconfig*, vitest.config.*, cypress.config.*, playwright.config.*&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;package.json&quot;</span><span class="punctuation">:</span> <span class="string">&quot;package-lock.json, pnpm*, .yarnrc*, yarn*, .eslint*, eslint*, .prettier*, prettier*, .editorconfig, commitlint.config.*, lint-staged.config.*, stylelint.config.*, uno.config.*,.gitignore,.stylelintignore&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typescript.tsdk&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./node_modules/typescript/lib&quot;</span><span class="punctuation">,</span> <span class="comment">// 配置 TypeScript 语言服务的 SDK 路径，指向本地的 TypeScript 库。</span></span><br><span class="line">    <span class="attr">&quot;npm.packageManager&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm&quot;</span><span class="punctuation">,</span> <span class="comment">// 配置使用的包管理器为 pnpm。 设置主要影响 VS Code 内置的一些自动化任务和脚本运行，但并不会影响你在终端中手动输入的命令。</span></span><br><span class="line">    <span class="attr">&quot;editor.tabSize&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="comment">// 设置编辑器中的制表符宽度为 4 个空格。</span></span><br><span class="line">    <span class="attr">&quot;editor.defaultFormatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;esbenp.prettier-vscode&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定默认的代码格式化工具为 esbenp.prettier-vscode</span></span><br><span class="line">    <span class="comment">// 保存文件缓慢时，可以考虑开启以下 3 行配置。</span></span><br><span class="line">    <span class="attr">&quot;vue.server.maxOldSpaceSize&quot;</span><span class="punctuation">:</span> <span class="number">4096</span><span class="punctuation">,</span> <span class="comment">// 设置 Vue 服务器端渲染的最大内存限制为 4GB。</span></span><br><span class="line">    <span class="attr">&quot;vue.server.hybridMode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 启用 Vue 服务器端渲染的混合模式。</span></span><br><span class="line">    <span class="attr">&quot;typescript.tsserver.maxTsServerMemory&quot;</span><span class="punctuation">:</span> <span class="number">4096</span><span class="punctuation">,</span> <span class="comment">// 设置 TypeScript 语言服务的最大内存限制为 4GB。</span></span><br><span class="line">    <span class="attr">&quot;files.eol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">,</span> <span class="comment">// 设置文件的行结束符为换行符（\n）。</span></span><br><span class="line">    <span class="attr">&quot;editor.guides.bracketPairs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 启用括号对高亮显示功能。</span></span><br><span class="line">    <span class="attr">&quot;editor.bracketPairColorization.enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 启用括号对颜色突出显示功能。</span></span><br><span class="line">    <span class="attr">&quot;vue.inlayHints.missingProps&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 启用 Vue 组件的属性提示功能。</span></span><br><span class="line">    <span class="attr">&quot;vue.autoInsert.dotValue&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 自动插入缺失的属性值。</span></span><br><span class="line">    <span class="attr">&quot;explorer.copyRelativePathSeparator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span> <span class="comment">// 设置复制相对路径时使用的分隔符为正斜杠。</span></span><br><span class="line">    <span class="attr">&quot;search.exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 配置要排除的文件和目录，以减少不必要的搜索。</span></span><br><span class="line">        <span class="attr">&quot;**/node_modules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/*.log&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/*.log*&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/bower_components&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/dist&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/elehukouben&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.git&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.gitignore&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.svn&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.DS_Store&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.idea&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.vscode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/pnpm i.lock&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/tmp&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;out&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dist&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;node_modules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;CHANGELOG.md&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;examples&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;res&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;screenshots&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pnpm i-error.log&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.pnpm i&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;files.exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 配置要排除的文件和目录，以减少不必要的文件搜索和处理。</span></span><br><span class="line">        <span class="attr">&quot;**/.cache&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.editorconfig&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.eslintcache&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/bower_components&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.idea&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/tmp&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.git&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.svn&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.hg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/CVS&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.DS_Store&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;files.watcherExclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 配置文件监视器中要排除的文件和目录，以减少不必要的文件监视。</span></span><br><span class="line">        <span class="attr">&quot;**/.git/objects/**&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.git/subtree-cache/**&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.vscode/**&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/node_modules/**&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/tmp/**&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/bower_components/**&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/dist/**&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/pnpm i.lock&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eslint.useFlatConfig&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 启用 ESLint 的扁平化配置。</span></span><br><span class="line">    <span class="attr">&quot;stylelint.enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 启用 stylelint 验证。</span></span><br><span class="line">    <span class="attr">&quot;stylelint.validate&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// 配置要验证的文件类型，包括 CSS、LESS、SCSS、Vue、Sass。</span></span><br><span class="line">        <span class="string">&quot;css&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;less&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;postcss&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;scss&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;sass&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;path-intellisense.mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 配置路径别名，用于提高代码可读性和开发效率。</span></span><br><span class="line">        <span class="attr">&quot;@/&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceRoot&#125;/src&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.localesPaths&quot;: [&quot;src/locales/lang&quot;], // 配置 i18n-ally 插件的语言文件路径。</span></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.keystyle&quot;: &quot;nested&quot;, // 配置 i18n-ally 插件的键风格为嵌套。</span></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.sortKeys&quot;: true, // 配置 i18n-ally 插件的键排序。</span></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.namespace&quot;: true, // 配置 i18n-ally 插件的命名空间。</span></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.pathMatcher&quot;: &quot;&#123;locale&#125;/&#123;namespaces&#125;.&#123;ext&#125;&quot;, // 配置 i18n-ally 插件的路径匹配器。</span></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.enabledParsers&quot;: [&quot;json&quot;], // 配置 i18n-ally 插件的启用解析器。</span></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.sourceLanguage&quot;: &quot;en&quot;, // 配置 i18n-ally 插件的源语言。</span></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.displayLanguage&quot;: &quot;zh-CN&quot;, // 配置 i18n-ally 插件的显示语言。</span></span><br><span class="line">    <span class="comment">// &quot;i18n-ally.enabledFrameworks&quot;: [&quot;vue&quot;, &quot;react&quot;], // 配置 i18n-ally 插件的启用框架。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 禁用默认格式化程序，改用eslint</span></span><br><span class="line">    <span class="attr">&quot;prettier.enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.formatOnSave&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 自动修复</span></span><br><span class="line">    <span class="attr">&quot;editor.codeActionsOnSave&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 保存时格式化</span></span><br><span class="line">        <span class="comment">// 保存时启用eslint格式化</span></span><br><span class="line">        <span class="attr">&quot;source.fixAll.eslint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;explicit&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// &quot;never&quot;表示在保存文件时，不会自动整理或排序import语句。性能消耗大，因此关闭。</span></span><br><span class="line">        <span class="attr">&quot;source.organizeImports&quot;</span><span class="punctuation">:</span> <span class="string">&quot;never&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 保存时启用stylelint格式化less或是sass</span></span><br><span class="line">        <span class="attr">&quot;source.fixAll.stylelint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;explicit&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义 ESLint 规则的行为，关闭某些风格规则的警告，但仍然允许自动修复。</span></span><br><span class="line">     <span class="attr">&quot;eslint.rules.customizations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;style/*&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;format/*&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*-indent&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*-spacing&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*-spaces&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*-order&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*-dangle&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*-newline&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*quotes&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*semi&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;fixable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 禁用 CSS、LESS 和 SCSS 的内置验证。</span></span><br><span class="line">    <span class="attr">&quot;css.validate&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;less.validate&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scss.validate&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 启用 ESLint 支持的所有语言类型</span></span><br><span class="line">    <span class="attr">&quot;eslint.validate&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;javascript&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;javascriptreact&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;typescript&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;typescriptreact&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;html&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;markdown&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;json&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;jsonc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;yaml&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;toml&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;xml&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;gql&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;graphql&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;astro&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;css&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;less&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;scss&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;pcss&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;postcss&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>这两行的作用就是文件嵌套作用</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;explorer.fileNesting.enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;explorer.fileNesting.patterns&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tsconfig.json&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tsconfig.*.json, env.d.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;vite.config.*&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jsconfig*, vitest.config.*, cypress.config.*, playwright.config.*&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;package.json&quot;</span><span class="punctuation">:</span> <span class="string">&quot;package-lock.json, pnpm*, .yarnrc*, yarn*, .eslint*, eslint*, .prettier*, prettier*, .editorconfig&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250124144015367.png" alt="image-20250124144015367"></p><br><h3 id="5、styleLint-【采用】"><a href="#5、styleLint-【采用】" class="headerlink" title="5、styleLint 【采用】"></a><strong><font color='red'>5、styleLint 【采用】</font></strong></h3><blockquote><p>less和sass 推荐只选一个</p></blockquote><p><strong><font color='#10c300'>5.1、依赖包 </font></strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">devDependencies<span class="punctuation">:</span></span><br><span class="line">+ less <span class="number">4.2</span><span class="number">.2</span></span><br><span class="line">+ postcss-less <span class="number">6.0</span><span class="number">.0</span></span><br><span class="line">+ sass <span class="number">1.83</span><span class="number">.4</span></span><br><span class="line">+ postcss-scss <span class="number">4.0</span><span class="number">.9</span></span><br><span class="line">+ postcss <span class="number">8.5</span><span class="number">.1</span></span><br><span class="line">+ postcss-html <span class="number">1.8</span><span class="number">.0</span></span><br><span class="line">+ stylelint <span class="number">16.13</span><span class="number">.2</span></span><br><span class="line">+ stylelint-config-recess-order <span class="number">6.0</span><span class="number">.0</span></span><br><span class="line">+ stylelint-config-standard <span class="number">37.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p><strong><font color='#10c300'>5.2、安装 </font></strong></p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 选择sass</span><br><span class="line">pnpm i sass postcss postcss-scss postcss-html stylelint stylelint-config-standard-scss stylelint-config-recess-order -D</span><br><span class="line"></span><br><span class="line"># 选择lees</span><br><span class="line">pnpm i less postcss postcss-less postcss-html stylelint stylelint-config-standard-less stylelint-config-recess-order -D</span><br></pre></td></tr></table></figure><table><thead><tr><th>依赖</th><th>说明</th><th>备注</th></tr></thead><tbody><tr><td>stylelint</td><td>stylelint核心库</td><td>stylelint</td></tr><tr><td>stylelint-config-standard</td><td>Stylelint 的标准配置，适用于普通的 CSS 文件</td><td>帮助开发者编写一致、规范的 CSS 代码。</td></tr><tr><td>stylelint-config-standard-scss</td><td>专门为 SCSS（Sass）文件设计的标准配置</td><td>在此stylelint-config-standard基础上扩展了对 SCSS 语法的支持</td></tr><tr><td>stylelint-config-standard-less</td><td>专门为 less文件设计的标准配置</td><td>在此stylelint-config-standard基础上扩展了对 less语法的支持</td></tr><tr><td>stylelint-config-recess-order</td><td>提供优化样式顺序配置</td><td>css样式书写顺序规范</td></tr><tr><td>postcss</td><td>处理 CSS 的工具</td><td>自动添加浏览器前缀、CSS 进行压缩、去除未使用的 CSS、合并相同的选择器等优化操作等等</td></tr><tr><td>postcss-scss</td><td>postcss的scss解析器</td><td>postcss-scss文档，支持css行类注释</td></tr><tr><td>postcss-html</td><td>解析html(类似html)的postcss语法</td><td>postcss-html文档</td></tr></tbody></table><p><strong>如果项目使用的是scss就使用stylelint-config-standard-scss，如果scss和less都没使用则安装stylelint-config-standard</strong></p><p><strong><font color='#10c300'>5.3、配置文件 </font></strong></p><p><strong>stylelint.config.mjs</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;stylelint&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// stylelint-config-standard 基础配置</span></span><br><span class="line">    <span class="comment">// stylelint-config-recess-order 样式顺序</span></span><br><span class="line">    <span class="attr">extends</span>: [<span class="string">&#x27;stylelint-config-standard-scss&#x27;</span>, <span class="string">&#x27;stylelint-config-recess-order&#x27;</span>],</span><br><span class="line">    <span class="comment">// 不同文件类型用不同解析器</span></span><br><span class="line">    <span class="attr">overrides</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">files</span>: [<span class="string">&#x27;**/*.(css|html|vue)&#x27;</span>],</span><br><span class="line">            <span class="attr">customSyntax</span>: <span class="string">&#x27;postcss-html&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 选less可以注释scss</span></span><br><span class="line">        <span class="comment">// &#123;</span></span><br><span class="line">        <span class="comment">//     files: [&#x27;*.less&#x27;, &#x27;**/*.less&#x27;],</span></span><br><span class="line">        <span class="comment">//     customSyntax: &#x27;postcss-less&#x27;,</span></span><br><span class="line">        <span class="comment">// &#125;,</span></span><br><span class="line">        <span class="comment">// 选sass可以注释上面的less</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">files</span>: [<span class="string">&#x27;*.scss&#x27;</span>, <span class="string">&#x27;**/*.scss&#x27;</span>],</span><br><span class="line">            <span class="attr">customSyntax</span>: <span class="string">&#x27;postcss-scss&#x27;</span>,</span><br><span class="line">            <span class="attr">rules</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;scss/percent-placeholder-pattern&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&#x27;scss/at-mixin-pattern&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">rules</span>: &#123;</span><br><span class="line">        <span class="comment">// &#x27;prettier/prettier&#x27;: true,</span></span><br><span class="line">        <span class="string">&#x27;media-feature-range-notation&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;scss/at-mixin-pattern&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;selector-not-notation&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;import-notation&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;function-no-unknown&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;selector-class-pattern&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;selector-pseudo-class-no-unknown&#x27;</span>: [</span><br><span class="line">            <span class="literal">true</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">ignorePseudoClasses</span>: [<span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;deep&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;selector-pseudo-element-no-unknown&#x27;</span>: [</span><br><span class="line">            <span class="literal">true</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">ignorePseudoElements</span>: [<span class="string">&#x27;v-deep&#x27;</span>, <span class="string">&#x27;:deep&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;at-rule-no-unknown&#x27;</span>: [</span><br><span class="line">            <span class="literal">true</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">ignoreAtRules</span>: [</span><br><span class="line">                    <span class="string">&#x27;tailwind&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;apply&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;variants&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;responsive&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;function&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;if&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;each&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;mixin&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;extend&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;use&#x27;</span>,</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;no-empty-source&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;named-grid-areas-no-invalid&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;no-descending-specificity&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;font-family-no-missing-generic-family-keyword&#x27;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&#x27;rule-empty-line-before&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;always&#x27;</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">ignore</span>: [<span class="string">&#x27;after-comment&#x27;</span>, <span class="string">&#x27;first-nested&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;unit-no-unknown&#x27;</span>: [<span class="literal">true</span>, &#123; <span class="attr">ignoreUnits</span>: [<span class="string">&#x27;rpx&#x27;</span>] &#125;],</span><br><span class="line">        <span class="string">&#x27;order/order&#x27;</span>: [</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&#x27;dollar-variables&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;custom-properties&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;at-rules&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;declarations&#x27;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;at-rule&#x27;</span>,</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;supports&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;at-rule&#x27;</span>,</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;media&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&#x27;rules&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">            &#123; <span class="attr">severity</span>: <span class="string">&#x27;error&#x27;</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">ignoreFiles</span>: [<span class="string">&#x27;**/*.js&#x27;</span>, <span class="string">&#x27;**/*.jsx&#x27;</span>, <span class="string">&#x27;**/*.tsx&#x27;</span>, <span class="string">&#x27;**/*.ts&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong><font color='#10c300'>5.4、新增脚本 </font></strong></p><p><strong>package.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 修复报错</span></span><br><span class="line">    <span class="attr">&quot;lint:stylelint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stylelint  \&quot;**/*.&#123;css,scss,less,vue,html&#125;\&quot; --fix&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong><font color='#10c300'>5.4、添加忽略文件 </font></strong></p><p><strong>.stylelintignore</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/dist<span class="comment">/*</span></span><br><span class="line"><span class="comment">/public/*</span></span><br></pre></td></tr></table></figure><br><h3 id="6、antfu-组合prettier-eslint-【采用】"><a href="#6、antfu-组合prettier-eslint-【采用】" class="headerlink" title="6、antfu 组合prettier&amp;eslint 【采用】"></a><strong><font color='red'>6、antfu 组合prettier&amp;eslint 【采用】</font></strong></h3><blockquote><p>配置网站 <a href="https://github.com/antfu/eslint-config/tree/feat/support-eslint-9?tab=readme-ov-file">https://github.com/antfu/eslint-config/tree/feat/support-eslint-9?tab=readme-ov-file</a></p><p>先选一个unocss 免得后续再去安装unocss的@unocss&#x2F;eslint-plugin</p></blockquote><p><strong><font color='#10c300'>6.1、命令行界面 (CLI) 安装 </font></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/ 空格选择 回车下一步</span><br><span class="line">npx @antfu/eslint-config@latest</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250124161525291.png" alt="image-20250124161525291"></p><p>最后一步选NO，配置setting.json中的内容，因为之前一次性配置了，因为这里选no。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">devDependencies<span class="punctuation">:</span></span><br><span class="line">+ @antfu/eslint-config <span class="number">3.16</span><span class="number">.0</span></span><br><span class="line">+ @unocss/eslint-plugin <span class="number">65.4</span><span class="number">.3</span></span><br><span class="line">+ eslint <span class="number">9.18</span><span class="number">.0</span></span><br><span class="line">+ eslint-plugin-format <span class="number">1.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><p>默认会添加这些依赖到包管理文件package.json（未安装），因此需要重新安装下依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i</span><br></pre></td></tr></table></figure><br><p><strong><font color='#10c300'>6.2、配置文件 </font></strong></p><blockquote><p>修改生成配置文件<code>eslint.config.js</code>为<code>eslint.config.mjs</code> 用于eslint规则校验</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">import antfu from &#x27;@antfu/eslint-config&#x27;</span><br><span class="line"></span><br><span class="line">export default antfu(</span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        stylistic<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            indent<span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="comment">// 缩进</span></span><br><span class="line">            quotes<span class="punctuation">:</span> &#x27;single&#x27;<span class="punctuation">,</span> <span class="comment">// 单引号</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        formatters<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">//</span></span><br><span class="line">        typescript<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 支持ts</span></span><br><span class="line">        unocss<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// 支持unocss</span></span><br><span class="line">        isInEditor<span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span> <span class="comment">// 保存删除未引入的代码</span></span><br><span class="line">        vue<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            overrides<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="comment">// vue文件顺序</span></span><br><span class="line">                &#x27;vue/block-order&#x27;<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;error&#x27;<span class="punctuation">,</span> <span class="punctuation">&#123;</span> order<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">[</span>&#x27;template&#x27;<span class="punctuation">,</span> &#x27;script&#x27;<span class="punctuation">]</span><span class="punctuation">,</span> &#x27;style&#x27;<span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">                &#x27;vue/singleline-html-element-content-newline&#x27;<span class="punctuation">:</span> &#x27;off&#x27;<span class="punctuation">,</span> <span class="comment">// 关闭单行元素内容换行</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        rules<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;no-console&#x27;<span class="punctuation">:</span> &#x27;off&#x27;<span class="punctuation">,</span> <span class="comment">// 关闭console检查</span></span><br><span class="line">            &#x27;no-debugger&#x27;<span class="punctuation">:</span> &#x27;off&#x27;<span class="punctuation">,</span> <span class="comment">// 关闭debugger检查</span></span><br><span class="line">            &#x27;antfu/top-level-function&#x27;<span class="punctuation">:</span> &#x27;off&#x27;<span class="punctuation">,</span> <span class="comment">// 顶级函数检测(开启时会将箭头函数转换为普通函数)</span></span><br><span class="line">            &#x27;antfu/if-newline&#x27;<span class="punctuation">:</span> &#x27;off&#x27;<span class="punctuation">,</span> <span class="comment">// 禁止换行 例如 if (a) return a使这种return a不会换行</span></span><br><span class="line">            &#x27;style/brace-style&#x27;<span class="punctuation">:</span> &#x27;off&#x27;<span class="punctuation">,</span> <span class="comment">// 关闭大括号风格检查(只要有大括号就会换行的情况)</span></span><br><span class="line">            &#x27;no-alert&#x27;<span class="punctuation">:</span> &#x27;off&#x27;<span class="punctuation">,</span> <span class="comment">// 关闭alert检查</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">// 9x版本 忽略文件这种配置方式 废弃掉eslintignore</span></span><br><span class="line">        ignores<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            &#x27;*.md&#x27;<span class="punctuation">,</span></span><br><span class="line">            &#x27;**<span class="comment">/*.md&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;*.sh&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;.husky&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;.local&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;node_modules&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;*.md&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;*.woff&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;*.ttf&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;.idea&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;docs/**&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;public/**&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;/bin/**&#x27;,</span></span><br><span class="line"><span class="comment">            &#x27;Dockerfile&#x27;,</span></span><br><span class="line"><span class="comment">        ],</span></span><br><span class="line"><span class="comment">    &#125;,</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure><br><p><strong><font color='#10c300'>6.3、新增脚本 </font></strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint .&quot;</span><span class="punctuation">,</span> <span class="comment">// 检测</span></span><br><span class="line">    <span class="attr">&quot;lint:fix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint . --fix&quot;</span> <span class="comment">// 修复</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br><h3 id="7、-gitignore文件"><a href="#7、-gitignore文件" class="headerlink" title="7、.gitignore文件"></a><strong><font color='red'>7、.gitignore文件</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"># <span class="title class_">Logs</span></span><br><span class="line">logs</span><br><span class="line">*.<span class="property">log</span></span><br><span class="line">npm-debug.<span class="property">log</span>*</span><br><span class="line">yarn-debug.<span class="property">log</span>*</span><br><span class="line">yarn-error.<span class="property">log</span>*</span><br><span class="line">lerna-debug.<span class="property">log</span>*</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Diagnostic</span> <span class="title function_">reports</span> (<span class="attr">https</span>:<span class="comment">//nodejs.org/api/report.html)</span></span><br><span class="line">report.[<span class="number">0</span>-<span class="number">9</span>]*.[<span class="number">0</span>-<span class="number">9</span>]*.[<span class="number">0</span>-<span class="number">9</span>]*.[<span class="number">0</span>-<span class="number">9</span>]*.<span class="property">json</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Runtime</span> data</span><br><span class="line">pids</span><br><span class="line">*.<span class="property">pid</span></span><br><span class="line">*.<span class="property">seed</span></span><br><span class="line">*.<span class="property">pid</span>.<span class="property">lock</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Directory</span> <span class="keyword">for</span> instrumented libs generated by jscoverage/<span class="title class_">JSCover</span></span><br><span class="line">lib-cov</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Coverage</span> directory used by tools like istanbul</span><br><span class="line">coverage</span><br><span class="line">*.<span class="property">lcov</span></span><br><span class="line"></span><br><span class="line"># nyc test coverage</span><br><span class="line">.<span class="property">nyc_output</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Grunt</span> intermediate <span class="title function_">storage</span> (<span class="attr">https</span>:<span class="comment">//gruntjs.com/creating-plugins#storing-task-files)</span></span><br><span class="line">.<span class="property">grunt</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Bower</span> dependency <span class="title function_">directory</span> (<span class="attr">https</span>:<span class="comment">//bower.io/)</span></span><br><span class="line">bower_components</span><br><span class="line"></span><br><span class="line"># node-waf configuration</span><br><span class="line">.<span class="property">lock</span>-wscript</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Compiled</span> binary <span class="title function_">addons</span> (<span class="attr">https</span>:<span class="comment">//nodejs.org/api/addons.html)</span></span><br><span class="line">build/<span class="title class_">Release</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Dependency</span> directories</span><br><span class="line">node_modules/</span><br><span class="line">jspm_packages/</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Snowpack</span> dependency <span class="title function_">directory</span> (<span class="attr">https</span>:<span class="comment">//snowpack.dev/)</span></span><br><span class="line">web_modules/</span><br><span class="line"></span><br><span class="line"># <span class="title class_">TypeScript</span> cache</span><br><span class="line">*.<span class="property">tsbuildinfo</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Optional</span> npm cache directory</span><br><span class="line">.<span class="property">npm</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Optional</span> eslint cache</span><br><span class="line">.<span class="property">eslintcache</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Microbundle</span> cache</span><br><span class="line">.<span class="property">rpt2_cache</span>/</span><br><span class="line">.<span class="property">rts2_cache_cjs</span>/</span><br><span class="line">.<span class="property">rts2_cache_es</span>/</span><br><span class="line">.<span class="property">rts2_cache_umd</span>/</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Optional</span> <span class="variable constant_">REPL</span> history</span><br><span class="line">.<span class="property">node_repl_history</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Output</span> <span class="keyword">of</span> <span class="string">&#x27;npm pack&#x27;</span></span><br><span class="line">*.<span class="property">tgz</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Yarn</span> <span class="title class_">Integrity</span> file</span><br><span class="line">.<span class="property">yarn</span>-integrity</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># parcel-bundler <span class="title function_">cache</span> (<span class="attr">https</span>:<span class="comment">//parceljs.org/)</span></span><br><span class="line">.<span class="property">cache</span></span><br><span class="line">.<span class="property">parcel</span>-cache</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Next</span>.<span class="property">js</span> build output</span><br><span class="line">.<span class="property">next</span></span><br><span class="line">out</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Nuxt</span>.<span class="property">js</span> build / generate output</span><br><span class="line">.<span class="property">nuxt</span></span><br><span class="line">dist</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Gatsby</span> files</span><br><span class="line">.<span class="property">cache</span>/</span><br><span class="line"># <span class="title class_">Comment</span> <span class="keyword">in</span> the public line <span class="keyword">in</span> <span class="keyword">if</span> your project uses <span class="title class_">Gatsby</span> and not <span class="title class_">Next</span>.<span class="property">js</span></span><br><span class="line"># <span class="attr">https</span>:<span class="comment">//nextjs.org/blog/next-9-1#public-directory-support</span></span><br><span class="line"># public</span><br><span class="line"></span><br><span class="line"># vuepress build output</span><br><span class="line">.<span class="property">vuepress</span>/dist</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Serverless</span> directories</span><br><span class="line">.<span class="property">serverless</span>/</span><br><span class="line"></span><br><span class="line"># <span class="title class_">FuseBox</span> cache</span><br><span class="line">.<span class="property">fusebox</span>/</span><br><span class="line"></span><br><span class="line"># <span class="title class_">DynamoDB</span> <span class="title class_">Local</span> files</span><br><span class="line">.<span class="property">dynamodb</span>/</span><br><span class="line"></span><br><span class="line"># <span class="title class_">TernJS</span> port file</span><br><span class="line">.<span class="property">tern</span>-port</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Stores</span> <span class="title class_">VSCode</span> versions used <span class="keyword">for</span> testing <span class="title class_">VSCode</span> extensions</span><br><span class="line">.<span class="property">vscode</span>-test</span><br><span class="line"></span><br><span class="line"># yarn v2</span><br><span class="line">.<span class="property">yarn</span>/cache</span><br><span class="line">.<span class="property">yarn</span>/unplugged</span><br><span class="line">.<span class="property">yarn</span>/build-state.<span class="property">yml</span></span><br><span class="line">.<span class="property">yarn</span>/install-state.<span class="property">gz</span></span><br><span class="line">.<span class="property">pnp</span>.*</span><br><span class="line"></span><br><span class="line">stats.<span class="property">html</span></span><br><span class="line"></span><br><span class="line">.<span class="property">stylelintcache</span></span><br></pre></td></tr></table></figure><br><h3 id="8、代码提交检查"><a href="#8、代码提交检查" class="headerlink" title="8、代码提交检查"></a><strong><font color='red'>8、代码提交检查</font></strong></h3><p>Husky + Lint-staged + Commitlint 来配置 Git 提交代码规范。</p><blockquote><p>核心内容是配置 <strong>Husky</strong> 的<code>pre-commit</code>和 <code>commit-msg</code> 两个钩子:</p><p>**<code>pre-commit</code>：**Husky + Lint-staged 整合实现 Git 提交前代码规范检测&#x2F;格式化 (前提：ESlint + Prettier + Stylelint 代码统一规范)；</p><p><strong><code>commit-msg</code>：</strong> Husky + Commitlint 整合实现生成规范化且高度自定义的 Git commit message。</p></blockquote><h4 id="8-1、husky-Git-钩子工具"><a href="#8-1、husky-Git-钩子工具" class="headerlink" title="8.1、husky Git 钩子工具 "></a><strong><font color='#10c300'>8.1、husky Git 钩子工具 </font></strong></h4><p>Husky 是 Git 钩子工具，可以设置在 git 各个阶段（<code>pre-commit</code>、<code>commit-msg</code> 等）触发。</p><p>官网<a href="https://typicode.github.io/husky">https://typicode.github.io/husky</a> 推荐安装指令</p><br><p><font color='orange'>命令行界面 (CLI) 安装</font></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky-init</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250124173230055.png" alt="image-20250124173230055"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240207141214268.png" alt="image-20240207141214268"></p><p>默认会添加这个依赖到包管理文件package.json（未安装），因此需要重新安装下依赖</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ pnpm i</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20250124173359482.png" alt="image-20250124173359482"></p><br><h4 id="8-2、Lint-staged-检测提交代码"><a href="#8-2、Lint-staged-检测提交代码" class="headerlink" title="8.2、Lint-staged 检测提交代码 "></a><strong><font color='#10c300'>8.2、Lint-staged 检测提交代码 </font></strong></h4><blockquote><p>lint-staged 是一个在 git add 到暂存区的文件运行 linters (ESLint&#x2F;Prettier&#x2F;StyleLint) 的工具进行检测，避免在 git commit 提交时在整个项目执行。</p></blockquote><h5 id="1）安装"><a href="#1）安装" class="headerlink" title="1）安装 "></a><strong><font color='cornflowerblue'>1）安装 </font></strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i lint-staged -D</span><br></pre></td></tr></table></figure><h5 id="2）配置文件"><a href="#2）配置文件" class="headerlink" title="2）配置文件 "></a><strong><font color='cornflowerblue'>2）配置文件 </font></strong></h5><p><strong>a、新建 lint-staged.config.mjs 配置文件</strong></p><p>cache缓存能使钩子检测速度更快</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;lint-staged&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="string">&#x27;*.&#123;js,ts,tsx,vue&#125;&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;eslint --fix --cache --cache-location .eslintcache&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;*.&#123;scss,html&#125;&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;stylelint --fix --cache --cache-location .stylelintcache --allow-empty-input&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;*.css&#x27;</span>: [<span class="string">&#x27;prettier --write&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>b、package.json 中添加指令</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">    <span class="attr">&quot;lint:lint-staged&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lint-staged&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p><strong>c、文件<code>.husky/pre-commit</code>修改提交前钩子命令</strong></p><p>提交的时候执行pre-commit文件中命令，然后触发package.json 中的lint:lint-staged，从而执行lint-staged.config.mjs配置文件去做检测。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env sh</span><br><span class="line">. <span class="string">&quot;$(dirname -- &quot;</span>$0<span class="string">&quot;)/_/husky.sh&quot;</span></span><br><span class="line"></span><br><span class="line"># 添加该命令</span><br><span class="line">npm run <span class="attr">lint</span>:lint-staged --allow-empty</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240207143016869.png" alt="image-20240207143016869"></p><br><h4 id="8-3、Commitlint-检测提交命名"><a href="#8-3、Commitlint-检测提交命名" class="headerlink" title="8.3、Commitlint 检测提交命名 "></a><strong><font color='#10c300'>8.3、Commitlint 检测提交命名 </font></strong></h4><blockquote><p>Commitlint 检查您的提交消息是否符合 Conventional comm it format 规范。– <a href="https://commitlint.js.org/">Commitlint 官网</a></p></blockquote><h5 id="1）安装-1"><a href="#1）安装-1" class="headerlink" title="1）安装 "></a><strong><font color='cornflowerblue'>1）安装 </font></strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i @commitlint/cli @commitlint/config-conventional -D</span><br></pre></td></tr></table></figure><br><h5 id="2）语法规范"><a href="#2）语法规范" class="headerlink" title="2）语法规范 "></a><strong><font color='cornflowerblue'>2）语法规范 </font></strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 语法规范</span><br><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;footer&gt;</span><br><span class="line">       </span><br><span class="line">// 示例</span><br><span class="line">feat(用户模块): 新增用户登录功能</span><br><span class="line"></span><br><span class="line">此提交引入了一个新的用户登录功能，允许用户通过邮箱和密码进行身份验证。</span><br><span class="line">同时，还包含了输入字段的验证和错误处理。</span><br><span class="line"></span><br><span class="line">Closes #123</span><br></pre></td></tr></table></figure><br><h5 id="3）语法拆解说明"><a href="#3）语法拆解说明" class="headerlink" title="3）语法拆解说明"></a><strong><font color='cornflowerblue'>3）语法拆解说明</font></strong></h5><ol><li>头部（Header）<ul><li><strong><code>&lt;type&gt;</code></strong>: 提交的类型，常见的类型包括：<ul><li><code>feat</code>: 新增功能</li><li><code>fix</code>: 修复缺陷</li><li><code>docs</code>: 文档变更</li><li><code>style</code>: 代码格式（不影响功能）</li><li><code>refactor</code>: 代码重构</li><li><code>perf</code>: 性能优化</li><li><code>test</code>: 添加测试或改动已有测试</li><li><code>build</code>: 构建过程或外部依赖的变更</li><li><code>ci</code>: 修改 CI 配置</li><li><code>chore</code>: 其他杂项更改</li><li><code>revert</code>: 回滚提交</li></ul></li><li><strong><code>&lt;scope&gt;</code></strong>: 可选，表示提交影响的范围（如模块名、文件名等），例如 <code>ui</code> 或 <code>api</code>。可以用括号括起来。</li><li><strong><code>&lt;subject&gt;</code></strong>: 提交的简要描述，建议不超过 50 个字符，使用祈使句（例如：<code>add login feature</code>）。</li></ul></li><li><strong>正文（Body）</strong><ul><li>可选，用于详细描述提交的内容和背景。可以包含多行，建议每行不超过 72 个字符。</li><li>说明为什么要做这些更改，以及如何解决了问题或实现了功能。</li></ul></li><li><strong>尾部（Footer）</strong><ul><li>可选，通常用于引用相关的任务、问题编号或其他重要的元信息。</li><li>例如：<code>Closes #123</code> 或 <code>Fixes #456</code>，表示这个提交关闭或修复了特定的问题。</li></ul></li></ol><br><h5 id="4）注意"><a href="#4）注意" class="headerlink" title="4）注意 "></a><strong><font color='cornflowerblue'>4）注意 </font></strong></h5><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202502252255451.png" alt="image-20250225005214324"></p><br><h5 id="5）配置文件"><a href="#5）配置文件" class="headerlink" title="5）配置文件 "></a><strong><font color='cornflowerblue'>5）配置文件 </font></strong></h5><p>根目录创建 <code>commitlint.config.mjs</code> 配置文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&quot;@commitlint/types&quot;).UserConfig</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">ignores</span>: [<span class="function">(<span class="params">commit</span>) =&gt;</span> commit.<span class="title function_">includes</span>(<span class="string">&quot;init&quot;</span>)],</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&quot;@commitlint/config-conventional&quot;</span>],</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&quot;body-leading-blank&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;always&quot;</span>],</span><br><span class="line">    <span class="string">&quot;footer-leading-blank&quot;</span>: [<span class="number">1</span>, <span class="string">&quot;always&quot;</span>],</span><br><span class="line">    <span class="string">&quot;header-max-length&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;always&quot;</span>, <span class="number">108</span>],</span><br><span class="line">    <span class="string">&quot;subject-empty&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>],</span><br><span class="line">    <span class="string">&quot;type-empty&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>],</span><br><span class="line">    <span class="string">&quot;subject-case&quot;</span>: [<span class="number">0</span>],</span><br><span class="line">    <span class="string">&quot;type-enum&quot;</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      <span class="string">&quot;always&quot;</span>,</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&quot;feat&quot;</span>, <span class="comment">// 新增功能</span></span><br><span class="line">        <span class="string">&quot;fix&quot;</span>, <span class="comment">// 修复缺陷</span></span><br><span class="line">        <span class="string">&quot;docs&quot;</span>, <span class="comment">// 文档变更</span></span><br><span class="line">        <span class="string">&quot;style&quot;</span>, <span class="comment">// 代码格式（不影响功能，例如空格、分号等格式修正）</span></span><br><span class="line">        <span class="string">&quot;refactor&quot;</span>, <span class="comment">// 代码重构（不包括 bug 修复、功能新增）</span></span><br><span class="line">        <span class="string">&quot;perf&quot;</span>, <span class="comment">// 性能优化</span></span><br><span class="line">        <span class="string">&quot;test&quot;</span>, <span class="comment">// 添加疏漏测试或已有测试改动</span></span><br><span class="line">        <span class="string">&quot;build&quot;</span>, <span class="comment">// 构建流程、外部依赖变更（如升级 npm 包、修改 webpack 配置等）</span></span><br><span class="line">        <span class="string">&quot;ci&quot;</span>, <span class="comment">// 修改 CI 配置、脚本</span></span><br><span class="line">        <span class="string">&quot;revert&quot;</span>, <span class="comment">// 回滚 commit</span></span><br><span class="line">        <span class="string">&quot;chore&quot;</span>, <span class="comment">// 对构建过程或辅助工具和库的更改（不影响源文件、测试用例）</span></span><br><span class="line">        <span class="string">&#x27;wip&#x27;</span>, <span class="comment">// 开发中临时提交</span></span><br><span class="line">      ],</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>执行下面命令生成 <code>commint-msg</code> 钩子用于 git 提交信息校验</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .<span class="property">husky</span>/commit-msg <span class="string">&quot;npx --no -- commitlint --edit $1&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20240207142542813.png" alt="image-20240207142542813"></p><br><h3 id="9、其他"><a href="#9、其他" class="headerlink" title="9、其他"></a><strong><font color='red'>9、其他</font></strong></h3><blockquote><p><strong>不使用antfu 直接使用prettier&amp;eslint &amp;styleLint</strong></p></blockquote><h4 id="9-1、prettier"><a href="#9-1、prettier" class="headerlink" title="9.1、prettier"></a><strong><font color='#10c300'>9.1、prettier</font></strong></h4><h5 id="1）安装-2"><a href="#1）安装-2" class="headerlink" title="1）安装 "></a><strong><font color='cornflowerblue'>1）安装 </font></strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i prettier -D</span><br></pre></td></tr></table></figure><h5 id="2）配置文件-1"><a href="#2）配置文件-1" class="headerlink" title="2）配置文件 "></a><strong><font color='cornflowerblue'>2）配置文件 </font></strong></h5><p>根目录创建 <code>prettier.config.mjs</code> 配置文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;prettier&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">$schema</span>: <span class="string">&quot;https://json.schemastore.org/prettierrc&quot;</span>,</span><br><span class="line">  <span class="attr">semi</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">tabWidth</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">singleQuote</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">printWidth</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">trailingComma</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="9-2、eslint"><a href="#9-2、eslint" class="headerlink" title="9.2、eslint"></a><strong><font color='#10c300'>9.2、eslint</font></strong></h4><blockquote><p><strong>使用9x版本 扁平化设计 导致很多插件版本滞后</strong></p></blockquote><h5 id="1）安装-3"><a href="#1）安装-3" class="headerlink" title="1）安装 "></a><strong><font color='cornflowerblue'>1）安装 </font></strong></h5><p>脚手架快速安装 然后pnpm i安装相关依赖包（如果创建项目的时候安装了，则不需要安装）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm create @eslint/config@latest</span><br></pre></td></tr></table></figure><p>额外安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i eslint-define-config eslint-plugin-import -D</span><br></pre></td></tr></table></figure><h5 id="2）配置文件-2"><a href="#2）配置文件-2" class="headerlink" title="2）配置文件 "></a><strong><font color='cornflowerblue'>2）配置文件 </font></strong></h5><p>修改<code>eslint.config.js</code>为<code>eslint.config.mjs</code>保持风格统一</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> globals <span class="keyword">from</span> <span class="string">&quot;globals&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> pluginJs <span class="keyword">from</span> <span class="string">&quot;@eslint/js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> tseslint <span class="keyword">from</span> <span class="string">&quot;typescript-eslint&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> pluginVue <span class="keyword">from</span> <span class="string">&quot;eslint-plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> pluginImport <span class="keyword">from</span> <span class="string">&quot;eslint-plugin-import&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineFlatConfig &#125; <span class="keyword">from</span> <span class="string">&quot;eslint-define-config&quot;</span>;</span><br><span class="line"><span class="comment">// 修复 https://eslint.nodejs.cn/blog/2024/05/eslint-compatibility-utilities/</span></span><br><span class="line"><span class="keyword">import</span> &#123; fixupPluginRules &#125; <span class="keyword">from</span> <span class="string">&quot;@eslint/compat&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineFlatConfig</span>([</span><br><span class="line">  <span class="comment">// 上面这一大截是官方的</span></span><br><span class="line">  &#123; <span class="attr">files</span>: [<span class="string">&quot;**/*.&#123;js,mjs,cjs,ts,vue&#125;&quot;</span>] &#125;,</span><br><span class="line">  pluginJs.<span class="property">configs</span>.<span class="property">recommended</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">languageOptions</span>: &#123; <span class="attr">globals</span>: globals.<span class="property">browser</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...tseslint.<span class="property">configs</span>.<span class="property">recommended</span>,</span><br><span class="line">  ...pluginVue.<span class="property">configs</span>[<span class="string">&quot;flat/essential&quot;</span>],</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">files</span>: [<span class="string">&quot;**/*.vue&quot;</span>],</span><br><span class="line">    <span class="attr">languageOptions</span>: &#123;</span><br><span class="line">      <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">        <span class="attr">parser</span>: tseslint.<span class="property">parser</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 这是引入顺序插件</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">files</span>: [<span class="string">&quot;**/*.vue&quot;</span>, <span class="string">&quot;**/*.?([cm])ts&quot;</span>, <span class="string">&quot;**/*.?([cm])tsx&quot;</span>],</span><br><span class="line">    <span class="attr">plugins</span>: &#123;</span><br><span class="line">      <span class="comment">// 修复插件还没升级到9版本</span></span><br><span class="line">      <span class="attr">import</span>: <span class="title function_">fixupPluginRules</span>(pluginImport),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rules</span>: &#123;</span><br><span class="line">      <span class="comment">// 插件还没升级到9x版本</span></span><br><span class="line">      <span class="string">&quot;import/first&quot;</span>: <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">      <span class="string">&quot;import/no-duplicates&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      <span class="string">&quot;import/order&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;error&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">groups</span>: [</span><br><span class="line">            <span class="comment">/* </span></span><br><span class="line"><span class="comment">              builtin ：内置模块，如 path，fs等 Node.js内置模块。</span></span><br><span class="line"><span class="comment">              external ：外部模块，如 lodash ，react 等第三方库。</span></span><br><span class="line"><span class="comment">              internal ：内部模块，如相对路径的模块、包名前缀为 @ 的模块。</span></span><br><span class="line"><span class="comment">              unknown ：未知模块，如模块名没有指定扩展名或模块路径缺失扩展名。</span></span><br><span class="line"><span class="comment">              parent ：父级目录的模块。</span></span><br><span class="line"><span class="comment">              sibling ：同级目录的模块。</span></span><br><span class="line"><span class="comment">              index ：当前目录的 index 文件。</span></span><br><span class="line"><span class="comment">              object ：使用ES6 导入的模块。</span></span><br><span class="line"><span class="comment">              type ：使用 import type 导入的模块。</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            [<span class="string">&quot;builtin&quot;</span>, <span class="string">&quot;external&quot;</span>],</span><br><span class="line">            <span class="string">&quot;internal&quot;</span>,</span><br><span class="line">            [<span class="string">&quot;parent&quot;</span>, <span class="string">&quot;sibling&quot;</span>],</span><br><span class="line">            <span class="string">&quot;index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>,</span><br><span class="line">            <span class="string">&quot;object&quot;</span>,</span><br><span class="line">            <span class="string">&quot;unknown&quot;</span>,</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">pathGroups</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">pattern</span>: <span class="string">&quot;../**&quot;</span>,</span><br><span class="line">              <span class="attr">group</span>: <span class="string">&quot;parent&quot;</span>,</span><br><span class="line">              <span class="attr">position</span>: <span class="string">&quot;after&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">pattern</span>: <span class="string">&quot;./*.scss&quot;</span>,</span><br><span class="line">              <span class="attr">group</span>: <span class="string">&quot;sibling&quot;</span>,</span><br><span class="line">              <span class="attr">position</span>: <span class="string">&quot;after&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">          <span class="comment">// 不同组之间是否换行。</span></span><br><span class="line">          <span class="comment">// &#x27;newlines-between&#x27;: &#x27;always&#x27;,</span></span><br><span class="line">          <span class="comment">// 根据字母顺序对每组内的引用进行排序。</span></span><br><span class="line">          <span class="attr">alphabetize</span>: &#123;</span><br><span class="line">            <span class="attr">order</span>: <span class="string">&quot;asc&quot;</span>,</span><br><span class="line">            <span class="attr">caseInsensitive</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><br><h3 id="10、简化组件命名"><a href="#10、简化组件命名" class="headerlink" title="10、简化组件命名"></a><strong><font color='red'>10、简化组件命名</font></strong></h3><p><strong>正常组件命名</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;person&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>:<span class="string">&#x27;Person&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 下面的写法是setup语法糖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>使用<code>vite-plugin-vue-setup-extend</code></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add vite-plugin-vue-setup-extend -D</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueSetupExtend</span> <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-vue-setup-extend&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [ <span class="title class_">VueSetupExtend</span>() ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>组件中使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Person&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br><h3 id="11、打包环境区分"><a href="#11、打包环境区分" class="headerlink" title="11、打包环境区分"></a><strong><font color='red'>11、打包环境区分</font></strong></h3><p>vite.config.ts</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>返回四个参数：</strong></p><ul><li><code>mode</code>：当前的运行模式（例如 <code>development</code> 或 <code>production</code>），没配置env文件默认就只有这两个值。</li><li><code>command</code>：当前运行的命令（例如 <code>serve</code> 或 <code>build</code>），本地运行返回serve，使用打包之后返回的build</li><li><code>isSsrBuild</code>：是否在进行服务器端渲染的构建。</li><li><code>isPreview</code>：是否在预览模式下运行。</li></ul><p><strong>实践可知：</strong></p><p>在运行本地项目时：</p><p> 有无<code>.env</code>文件时，<code>vite.config.ts</code>文件中res返回都是<code>mode=&quot;development&quot;</code>，<code>command=&quot;serve&quot;</code>；</p><p>在运行打包项目时：</p><p> 默认无<code>.env</code>文件时，<code>vite.config.ts</code>文件中res返回<code>mode=&quot;production&quot;</code>，<code>command=&quot;build&quot;</code>；</p><p> 有<code>.env</code>文件时，根据打包的配置来的 ，如果你打包运行的是<code>.env.sit</code>文件，res返回的则是<code>mode=&quot;sit&quot;</code>，<code>command=&quot;build&quot;</code>；</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-p type-check \&quot;build-only &#123;@&#125;\&quot; --&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build:sit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build -- sit&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build:uat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build -- uat&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build -- production&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type-check&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-tsc --build&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-only&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --mode&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>vite.config.ts 中访问.env文件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> process <span class="keyword">from</span> <span class="string">&#x27;node:process&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig, loadEnv &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(<span class="function">(<span class="params">&#123; mode &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> env = <span class="title function_">loadEnv</span>(mode, process.<span class="title function_">cwd</span>())</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(env)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .env</span></span><br><span class="line"><span class="variable constant_">VITE_NODE_ENV</span> = <span class="string">&#x27;local&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .env.sit</span></span><br><span class="line"><span class="variable constant_">VITE_NODE_ENV</span> = <span class="string">&#x27;sit&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .env.uat</span></span><br><span class="line"><span class="variable constant_">VITE_NODE_ENV</span> = <span class="string">&#x27;sit&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .env.product</span></span><br><span class="line"><span class="variable constant_">VITE_NODE_ENV</span> = <span class="string">&#x27;production&#x27;</span></span><br></pre></td></tr></table></figure><br><h3 id="12、添加基准路径"><a href="#12、添加基准路径" class="headerlink" title="12、添加基准路径"></a><strong><font color='red'>12、添加基准路径</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(<span class="string">&#x27;/pc/&#x27;</span>),</span><br><span class="line">    <span class="attr">routes</span>: [],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(<span class="function">(<span class="params">&#123; mode &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">base</span>: env.<span class="property">VITE_BASE_URL</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="13、添加打包的dist文件预览配置"><a href="#13、添加打包的dist文件预览配置" class="headerlink" title="13、添加打包的dist文件预览配置"></a><strong><font color='red'>13、添加打包的dist文件预览配置</font></strong></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br><h3 id="14、本地代理服务配置"><a href="#14、本地代理服务配置" class="headerlink" title="14、本地代理服务配置"></a><strong><font color='red'>14、本地代理服务配置</font></strong></h3><p>官网<a href="https://cn.vitejs.dev/config/server-options.html#server-proxy">https://cn.vitejs.dev/config/server-options.html#server-proxy</a></p><p><code>vite.config.ts</code>配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="comment">// 监听所有公共ip</span></span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">        <span class="attr">cors</span>: <span class="literal">true</span>, <span class="comment">// 允许所有来源访问本地开发服务器的资源</span></span><br><span class="line">        <span class="attr">port</span>: <span class="number">3300</span>,</span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: &#123; <span class="comment">// 代理前缀</span></span><br><span class="line">                <span class="comment">// 转发地址 前端请求http://localhost:3000/api/users代理后实际请求          http://www.example.com/users </span></span><br><span class="line">                <span class="attr">target</span>: <span class="string">&#x27;http://www.example.com&#x27;</span>,</span><br><span class="line">                <span class="attr">changeOrigin</span>: <span class="literal">true</span>, <span class="comment">// 修改 Origin 头为目标地址</span></span><br><span class="line">                <span class="comment">// 移除路径中开头的 /api 前缀 例如：/api/users → /users</span></span><br><span class="line">                <span class="attr">rewrite</span>: <span class="function">(<span class="params">path: string</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/api/</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>参数解析</strong></p><p>cors和changeOrigin</p><p>在 <code>vite.config.ts</code> 中，<code>cors: true</code> 和 <code>changeOrigin: true</code> 用于解决不同场景下的跨域问题，具体区别如下：</p><p>1、<strong><code>cors: true</code></strong></p><ul><li><strong>作用</strong>：配置开发服务器（Vite Dev Server）的 CORS 响应头，允许浏览器跨域访问本地开发服务器的资源。</li><li><strong>实现方式</strong>：<br>当设置为 <code>true</code> 时，Vite 会默认添加 <code>Access-Control-Allow-Origin: *</code> 响应头，允许所有来源的请求。若需更精细控制（如指定允许的域名），可通过 <code>CorsOptions</code> 对象配置。</li><li><strong>适用场景</strong>：<br>用于本地开发环境，解决前端资源（如静态文件）被其他域名访问时的 CORS 限制。例如，主应用加载微前端子应用的资源时可能需要此配置。</li></ul><p>2、<strong><code>changeOrigin: true</code></strong></p><ul><li><strong>作用</strong>：在代理请求时修改请求头的 <code>Origin</code> 字段为目标服务器的地址，绕过目标服务器的 CORS 校验。</li><li><strong>实现方式</strong>：<br>代理将前端请求的 <code>Origin</code>（如 <code>[http://localhost:3000 ](http://localhost:3000 )</code>）改为目标服务器的域名（如 <code>[https://apiservice.com ](https://apiservice.com )</code>），使目标服务器认为请求来自同源，从而避免 CORS 拦截。</li><li><strong>适用场景</strong>：<br>用于代理接口请求，尤其是当前端与后端分离开发时。例如，将 <code>/api</code> 路径的请求代理到 <code>[http://localhost:8080 ]</code>，并通过 <code>changeOrigin: true</code> 让后端正常响应。</li></ul><p><strong>两者的区别</strong></p><table><thead><tr><th>配置项</th><th>作用对象</th><th>核心目的</th><th>典型使用场景</th></tr></thead><tbody><tr><td><code>cors: true</code></td><td>Vite 开发服务器</td><td>允许浏览器跨域访问本地资源</td><td>微前端资源加载、本地静态服务</td></tr><tr><td><code>changeOrigin: true</code></td><td>代理请求</td><td>绕过目标服务器的 CORS 校验</td><td>接口代理到不同域的后端服务</td></tr></tbody></table><p><strong>注意事项</strong></p><ul><li><strong>优先级</strong>：<br><code>changeOrigin: true</code> 仅影响代理请求的 <code>Origin</code> 头，而 <code>cors: true</code> 影响的是 Vite 开发服务器自身的响应头。两者可同时使用。</li><li><strong>生产环境</strong>：<br><code>cors: true</code> 和代理配置仅在开发环境生效，生产环境需通过后端或 Nginx 配置 CORS。</li><li><strong>冲突处理</strong>：<br>若后端强制校验 <code>Origin</code>，需确保 <code>changeOrigin: true</code> 修改后的值与后端允许的域名一致</li></ul><br><h3 id="15、axios二次封装"><a href="#15、axios二次封装" class="headerlink" title="15、axios二次封装"></a><strong><font color='red'>15、axios二次封装</font></strong></h3><p><code>utils/request.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Base</span> <span class="keyword">from</span> <span class="string">&#x27;@/utils/base&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">30000</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=UTF-8&#x27;</span> &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// request拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">config: customInternalAxiosRequestConfig</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">headersType</span>) &#123;</span><br><span class="line">        config.<span class="property">headers</span>[<span class="string">&#x27;Content-Type&#x27;</span>] = config.<span class="property">headersType</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> base = <span class="title class_">Base</span>()</span><br><span class="line">    base.<span class="property">requestTime</span> = <span class="title function_">dayjs</span>().<span class="title function_">format</span>(<span class="string">&#x27;YYYYDDMMHmmss&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; params, data &#125; = config</span><br><span class="line">    <span class="keyword">const</span> newParams = &#123; ...(data || params), ...base &#125;</span><br><span class="line">    <span class="keyword">if</span> (params) &#123;</span><br><span class="line">        config.<span class="property">params</span> = newParams</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config.<span class="property">data</span> = newParams</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;, <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function">(<span class="params">response: AxiosResponse</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; body, msgCd, msgInfo &#125; = response.<span class="property">data</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果响应是二进制流，则直接返回，用于下载文件、Excel 导出等(待测试)</span></span><br><span class="line">        <span class="keyword">if</span> (response.<span class="property">config</span>.<span class="property">responseType</span> === <span class="string">&#x27;blob&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 接口请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (msgCd.<span class="title function_">slice</span>(-<span class="number">5</span>) === <span class="string">&#x27;00000&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> body</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 登录失效</span></span><br><span class="line">        <span class="keyword">if</span> (msgCd === <span class="string">&#x27;MPL99001&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (router.<span class="property">currentRoute</span>.<span class="property">value</span>.<span class="property">name</span> !== <span class="string">&#x27;login&#x27;</span>) &#123;</span><br><span class="line">                router.<span class="title function_">replace</span>(&#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">                    <span class="attr">query</span>: &#123; <span class="attr">redirect</span>: router.<span class="property">currentRoute</span>.<span class="property">value</span>.<span class="property">fullPath</span> &#125;,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 其他错误</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(msgInfo || <span class="string">&#x27;错误&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[ajax error]&#x27;</span>, error)</span><br><span class="line">        <span class="keyword">let</span> msgInfo = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">const</span> &#123; message &#125; = error</span><br><span class="line">        <span class="keyword">if</span> (message === <span class="string">&#x27;Network Error&#x27;</span>) &#123;</span><br><span class="line">            msgInfo = <span class="string">&#x27;操作失败，网络异常！&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="title function_">includes</span>(<span class="string">&#x27;timeout&#x27;</span>)) &#123;</span><br><span class="line">            msgInfo = <span class="string">&#x27;接口请求超时，请刷新页面后重试！&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="title function_">includes</span>(<span class="string">&#x27;Request failed with status code&#x27;</span>)) &#123;</span><br><span class="line">            msgInfo = <span class="string">`接口请求失败，请稍后重试！<span class="subst">$&#123;message.substr(message.length - <span class="number">3</span>)&#125;</span>`</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(msgInfo)</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure><p><code>api/user/index.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommonAPI</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取首页信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 请求参数，默认为空对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> 包含首页信息的Promise对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">homeInformationQuery</span>(<span class="params">data = &#123;&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> request&lt;any, <span class="title class_">HomeInformationQueryResult</span>&gt;(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/fortune-business/v1/common/home-information-query&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">CommonAPI</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 请求参数 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 响应参数 */</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">HomeInformationQueryResult</span> &#123;</span><br><span class="line">    <span class="attr">fundInfoList</span>: <span class="title class_">FundInfoList</span></span><br><span class="line">    <span class="attr">newUserFlag</span>: boolean</span><br><span class="line">    <span class="attr">userSignFlag</span>: boolean</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">FundInfo</span> &#123;</span><br><span class="line">    <span class="attr">fundDesc</span>: string</span><br><span class="line">    <span class="attr">fundName</span>: string</span><br><span class="line">    <span class="attr">fundDayLy</span>: string</span><br><span class="line">    <span class="attr">fundIcon</span>: string</span><br><span class="line">    fundElectronicAccount?: any</span><br><span class="line">    <span class="attr">fundCorpId</span>: string</span><br><span class="line">    <span class="attr">fundNo</span>: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储全部基金的数组类型</span></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">FundInfoList</span> = <span class="title class_">FundInfo</span>[]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>***.vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">UserAPI</span> <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">login</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title class_">CommonAPI</span>.<span class="title function_">homeInformationQuery</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">login</span>()</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br><h3 id="16、打包分析"><a href="#16、打包分析" class="headerlink" title="16、打包分析"></a><strong><font color='red'>16、打包分析</font></strong></h3><p>插件网站<a href="https://www.npmjs.com/package/rollup-plugin-visualizer">https://www.npmjs.com/package/rollup-plugin-visualizer</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add rollup-plugin-visualizer -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-visualizer&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">visualizer</span>(&#123;</span><br><span class="line">            <span class="comment">// 注意这里要设置为true，否则无效</span></span><br><span class="line">            <span class="attr">open</span>: !!((command === <span class="string">&#x27;build&#x27;</span> &amp;&amp; mode === <span class="string">&#x27;development&#x27;</span>)), </span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;stats.html&#x27;</span>, <span class="comment">// 分析图生成的文件名</span></span><br><span class="line">            <span class="attr">gzipSize</span>: <span class="literal">true</span>, <span class="comment">// 收集 gzip 大小并将其显示</span></span><br><span class="line">            <span class="attr">brotliSize</span>: <span class="literal">true</span>, <span class="comment">// 收集 brotli 大小并将其显示</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="17、gzip压缩"><a href="#17、gzip压缩" class="headerlink" title="17、gzip压缩"></a><strong><font color='red'>17、gzip压缩</font></strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i vite-plugin-compression -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 压缩gzip</span></span><br><span class="line"><span class="keyword">import</span> viteCompression <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-compression&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="title function_">viteCompression</span>(&#123;</span><br><span class="line">        <span class="attr">verbose</span>: <span class="literal">true</span>, <span class="comment">// 是否在控制台输出压缩结果</span></span><br><span class="line">        <span class="attr">disable</span>: <span class="literal">false</span>, <span class="comment">// 是否禁用压缩</span></span><br><span class="line">        <span class="attr">deleteOriginFile</span>: <span class="literal">false</span>, <span class="comment">// 删除源文件</span></span><br><span class="line">        <span class="attr">threshold</span>: <span class="number">10240</span>, <span class="comment">// 文件大小超过此值时进行压缩，单位为字节即10kb</span></span><br><span class="line">        <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span>, <span class="comment">// 压缩算法，可选 &#x27;gzip&#x27; 或 &#x27;brotli&#x27;</span></span><br><span class="line">        <span class="attr">ext</span>: <span class="string">&#x27;.gz&#x27;</span> <span class="comment">// 压缩后的文件扩展名</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>nginx服务器上还要对应配置</strong></p><p>在server节点下新增以下配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    </span><br><span class="line">    # 追加如下配置</span><br><span class="line">    # gzip - 动态压缩配置</span><br><span class="line">    gzip            on;                # 开启gzip压缩</span><br><span class="line">    gzip_vary       on;                # 添加Vary: Accept-Encoding响应头，支持CDN缓存</span><br><span class="line">    gzip_proxied    any;               # 对所有代理请求都进行压缩</span><br><span class="line">    gzip_comp_level 6;                 # 压缩级别6（1-9），平衡压缩率和CPU占用</span><br><span class="line">    # 指定哪些 MIME 类型的文件需要压缩</span><br><span class="line">    gzip_types      text/plain         # .txt文本文件</span><br><span class="line">                    text/css           # .css样式文件</span><br><span class="line">                    text/xml           # .xml文件</span><br><span class="line">                    text/javascript    # .js文件（旧MIME类型）</span><br><span class="line">                    application/json   # .json API响应</span><br><span class="line">                    application/javascript  # .js文件（新MIME类型）</span><br><span class="line">                    application/xml    # XML文件</span><br><span class="line">                    application/xml+rss     # RSS订阅</span><br><span class="line">                    application/rss+xml     # RSS订阅</span><br><span class="line">                    application/atom+xml    # Atom订阅</span><br><span class="line">                    image/svg+xml      # .svg矢量图</span><br><span class="line">                    font/ttf           # .ttf字体文件</span><br><span class="line">                    font/otf           # .otf字体文件</span><br><span class="line">                    font/woff          # .woff字体文件（虽然已压缩，但有时仍可获益）</span><br><span class="line">                    application/x-font-ttf       # 字体文件（兼容旧格式）</span><br><span class="line">                    application/x-javascript;    # JS文件（兼容旧格式）</span><br><span class="line">    </span><br><span class="line">    # gzip_static - 使用预先压缩的.gz文件</span><br><span class="line">    gzip_static     on;  # 优先使用构建时生成的.gz文件，提升性能</span><br><span class="line">    gzip_min_length 1k;  # 小于1KB的文件不压缩</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果是打包成docker镜像，Dockerfile可配置如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx:1.25.2-alpine-slim</span><br><span class="line"></span><br><span class="line">COPY dist /usr/share/nginx/html/</span><br><span class="line"></span><br><span class="line"># 开启gzip压缩配置</span><br><span class="line">RUN sed -i &#x27;/server_name  localhost;/a \</span><br><span class="line"> gzip on;</span><br><span class="line"> gzip_static on;</span><br><span class="line"> gzip_buffers  4 16k;</span><br><span class="line"> gzip_min_length 1k;</span><br><span class="line"> gzip_comp_level 9;</span><br><span class="line"> gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span><br><span class="line"> gzip_proxied    any;</span><br><span class="line"> gzip_vary on;</span><br><span class="line"> gzip_disable &quot;MSIE [1-6]&quot;;&#x27;</span><br><span class="line"></span><br><span class="line"># 指定于外界交互的端口</span><br><span class="line">EXPOSE 80</span><br></pre></td></tr></table></figure><p>这些配置项的作用如下：</p><ul><li><code>gzip on;</code> 启用 Gzip 功能。</li><li><code>gzip_static on;</code> 允许 Nginx 直接返回已压缩的静态文件。</li><li><code>gzip_types</code> 指定需要压缩的文件类型。</li><li><code>gzip_vary on;</code> 添加 <code>Vary: Accept-Encoding</code> 头部，确保浏览器正确处理压缩文件。</li><li><code>gzip_comp_level</code> 设置压缩级别，数值越大压缩率越高，但性能消耗也越大（1-9）</li><li><code>gzip_buffers</code> 设置缓冲区大小。</li><li><code>gzip_http_version</code> 设置 HTTP 版本。</li><li><code>gzip_disable</code> 禁用对特定浏览器的 Gzip 压缩。</li><li><code>gzip_proxied</code> 用于控制 Gzip 压缩的行为，特别是在处理来自代理服务器的请求时。<strong>any</strong>: 对所有请求（包括来自代理的请求）执行 Gzip 压缩</li></ul><br><h3 id="18、图片压缩"><a href="#18、图片压缩" class="headerlink" title="18、图片压缩"></a><strong><font color='red'>18、图片压缩</font></strong></h3><p>插件网站<a href="https://www.npmjs.com/package/vite-plugin-image-optimizer">vite-plugin-image-optimizer </a>（弃用）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm add vite-plugin-image-optimizer -D</span><br><span class="line">pnpm add sharp -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ViteImageOptimizer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-image-optimizer&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title class_">ViteImageOptimizer</span>(&#123; <span class="comment">// 图片压缩</span></span><br><span class="line">            <span class="attr">png</span>: &#123;</span><br><span class="line">                <span class="attr">quality</span>: <span class="number">80</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">jpeg</span>: &#123;</span><br><span class="line">                <span class="attr">quality</span>: <span class="number">80</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">jpg</span>: &#123;</span><br><span class="line">                <span class="attr">quality</span>: <span class="number">80</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">webp</span>: &#123;</span><br><span class="line">                <span class="attr">quality</span>: <span class="number">60</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>插件网站<a href="https://www.npmjs.com/package/vite-plugin-image-tools">vite-plugin-image-tools</a>（推荐）</p><p>vite插件，支持图片压缩和自动转webp，目前只支持’png’, ‘jpg’, ‘webp’, ‘avif’, ‘tiff’, ‘gif’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm add -D vite-plugin-image-tools</span><br><span class="line">pnpm add spritesmith -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VitePluginImageTools</span> <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-image-tools&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title class_">VitePluginImageTools</span>(&#123;</span><br><span class="line">      <span class="attr">quality</span>: <span class="number">80</span>, <span class="comment">// 图片质量</span></span><br><span class="line">        <span class="attr">enableWebp</span>: <span class="literal">true</span>, <span class="comment">// 开启webp转换</span></span><br><span class="line">        <span class="attr">limitSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10KB不做任何压缩转换处理（10KB = 10 * 1024 bytes）</span></span><br><span class="line">        <span class="attr">webpConfig</span>: &#123;</span><br><span class="line">            <span class="attr">deleteOriginImg</span>: <span class="literal">true</span>, <span class="comment">// 打包时删除原图，减少产物体积</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>参数</p><table><thead><tr><th>参数</th><th>类型</th><th>默认值</th><th>Description</th></tr></thead><tbody><tr><td>quality</td><td>number</td><td>80</td><td>图片质量 (1-100)</td></tr><tr><td>includes</td><td>string&#x2F;RegExp</td><td>‘’</td><td>‘<code>xxx.png&#39;.includs(inclouds) includes.test(&#39;xxx.png&#39;)</code>jpe?g</td></tr><tr><td>excludes</td><td>string&#x2F;RegExp</td><td>‘’</td><td>排除项，如：!’<code>xxx.png&#39;.includs(inclouds) !includes.test(&#39;xxx.png&#39;)</code></td></tr><tr><td>filter</td><td>function</td><td>() &#x3D;&gt; true</td><td>过滤方法，可自定义过滤图片逻辑，支持async 参数：图片路径 如： filter: (path) &#x3D;&gt; { return path.includes(‘.png’) }</td></tr><tr><td>compatibility</td><td>boolean</td><td>false</td><td>是否兼容低版本浏览器，生产环境生效， true：只有css中的图片会转webp（暂时只支持打包时候处理css） false：全部转webp</td></tr><tr><td>bodyWebpClassName</td><td>string</td><td>webp</td><td>body标签的webp class，用于生成兼容webp的class</td></tr><tr><td>enableWebp</td><td>boolean</td><td>false</td><td>生产环境是否转webp</td></tr><tr><td>enableDev</td><td>boolean</td><td>false</td><td>开发环境是否开启压缩</td></tr><tr><td>enableDevWebp</td><td>boolean</td><td>false</td><td>开发环境是否开启转webp</td></tr><tr><td>cacheDir</td><td>string</td><td>‘node_modules&#x2F;.cache&#x2F;vite-plugin-image’</td><td>缓存路径， 默认，只在开发环境生效</td></tr><tr><td>sharpConfig</td><td>Object</td><td>{ jpeg?: JpegOptions, jpg?: JpegOptions, png?: PngOptions, webp?: WebpOptions, avif?: AvifOptions, tiff?: TiffOptions, gif?: GifOptions}</td><td><a href="https://sharp.pixelplumbing.com/api-output/#_top">sharp配置</a></td></tr><tr><td>svgoConfig</td><td>Object</td><td>{plugins:[‘preset-default’,{name:’removerXMLNS’},{name:’removeViewBox’}],js2svg:{indent:2, pretty: true}}</td><td><a href="https://svgo.dev/docs/preset-default/">https://svgo.dev/docs/preset-default/</a></td></tr></tbody></table><p>✅ <strong>结论</strong>：<br><code>vite-plugin-image-tools</code> 默认不会删除原图，这是有意设计（兼容性考虑）。<br>如果你确定不需要原图，可以写 Node 脚本删除原图（不建议删除）</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">removeOriginalImages</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;remove-original-images&#x27;</span>,</span><br><span class="line">    <span class="title function_">closeBundle</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> outDir = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>) <span class="comment">// 输出目录</span></span><br><span class="line">      <span class="keyword">const</span> extsToRemove = [<span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>]</span><br><span class="line">      <span class="keyword">const</span> stack = [outDir]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (stack.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> dir = stack.<span class="title function_">pop</span>()!</span><br><span class="line">        <span class="keyword">const</span> files = fs.<span class="title function_">readdirSync</span>(dir)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">          <span class="keyword">const</span> fullPath = path.<span class="title function_">join</span>(dir, file)</span><br><span class="line">          <span class="keyword">const</span> stat = fs.<span class="title function_">statSync</span>(fullPath)</span><br><span class="line">          <span class="keyword">if</span> (stat.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">            stack.<span class="title function_">push</span>(fullPath)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (extsToRemove.<span class="title function_">includes</span>(path.<span class="title function_">extname</span>(fullPath).<span class="title function_">toLowerCase</span>())) &#123;</span><br><span class="line">            fs.<span class="title function_">unlinkSync</span>(fullPath)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;已删除原始图片文件&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 你的其他插件</span></span><br><span class="line">    <span class="title function_">removeOriginalImages</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="19、解决ts无法识别路由中导入的vue组件"><a href="#19、解决ts无法识别路由中导入的vue组件" class="headerlink" title="19、解决ts无法识别路由中导入的vue组件"></a><strong><font color='red'>19、解决ts无法识别路由中导入的vue组件</font></strong></h3><p><code>env.d.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare module &#x27;*.vue&#x27; &#123;</span><br><span class="line">    import type &#123; DefineComponent &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">    const component: DefineComponent</span><br><span class="line">    export default component</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="20、将路由和pinia分离到独立模块"><a href="#20、将路由和pinia分离到独立模块" class="headerlink" title="20、将路由和pinia分离到独立模块"></a><strong><font color='red'>20、将路由和pinia分离到独立模块</font></strong></h3><p>将路由和pinia分离到独立模块，提高可维护性和可扩展性</p><p><code>/src/plugins/index.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; setupRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; setupStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">install</span>(<span class="params">app: App</span>) &#123;</span><br><span class="line">        <span class="comment">// 路由(router)</span></span><br><span class="line">        <span class="title function_">setupRouter</span>(app)</span><br><span class="line">        <span class="comment">// 状态管理(store)</span></span><br><span class="line">        <span class="title function_">setupStore</span>(app)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>src/router/index.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_BASE_URL</span>),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/home/index.vue&#x27;</span>),</span><br><span class="line">            <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span>, <span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span> &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setupRouter</span> = (<span class="params">app: App</span>) =&gt; &#123;</span><br><span class="line">    app.<span class="title function_">use</span>(router)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>src/store/index.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局注册 store</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupStore</span>(<span class="params">app: App</span>) &#123;</span><br><span class="line">    app.<span class="title function_">use</span>(pinia)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>src/main.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> plugins <span class="keyword">from</span> <span class="string">&#x27;@/plugins&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="title function_">use</span>(plugins)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><br><h3 id="21、添加mock工具"><a href="#21、添加mock工具" class="headerlink" title="21、添加mock工具"></a><strong><font color='red'>21、添加mock工具</font></strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add vite-plugin-mock-dev-server -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mockDevServerPlugin <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-mock-dev-server&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        env.<span class="property">VITE_MOCK_DEV_SERVER</span> === <span class="string">&#x27;true&#x27;</span> ? <span class="title function_">mockDevServerPlugin</span>() : <span class="literal">null</span>,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在项目根目录添加mock文件夹</p><p><code>mock/index.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;node:path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createDefineMock &#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-mock-dev-server&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> defineMock = <span class="title function_">createDefineMock</span>(<span class="function">(<span class="params">mock</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 拼接url</span></span><br><span class="line">    mock.<span class="property">url</span> = path.<span class="title function_">join</span>(mock.<span class="property">url</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>tsconfig.app.</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;mock/**/*.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>mock/modules/home.mock.ts</code></p><p>这里命名中间一定要用mock，格式xxx.mock.ts</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineMock &#125; <span class="keyword">from</span> <span class="string">&#x27;../index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineMock</span>([</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取首页信息</span></span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/fortune-business/v1/common/home-information-query&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: [<span class="string">&#x27;POST&#x27;</span>],</span><br><span class="line">        <span class="attr">body</span>: &#123;</span><br><span class="line">            <span class="attr">msgCd</span>: <span class="string">&#x27;00000&#x27;</span>,</span><br><span class="line">            <span class="attr">mockFlag</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;交易成功&#x27;</span>,</span><br><span class="line">            <span class="attr">body</span>: &#123;</span><br><span class="line">                <span class="attr">newUserFlag</span>: <span class="literal">false</span>, <span class="comment">// 是否新用户</span></span><br><span class="line">                <span class="attr">userSignFlag</span>: <span class="literal">true</span>, <span class="comment">// false需要用户签隐私协议</span></span><br><span class="line">                <span class="attr">fundInfoList</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">funType</span>: <span class="string">&#x27;稳健理财&#x27;</span>,</span><br><span class="line">                        <span class="attr">fundDesc</span>: <span class="string">&#x27;稳健理财你真棒&#x27;</span>,</span><br><span class="line">                        <span class="attr">fundName</span>: <span class="string">&#x27;汇添富和聚宝货币市场基金&#x27;</span>,</span><br><span class="line">                        <span class="attr">fundDayLy</span>: <span class="string">&#x27;4.26&#x27;</span>,</span><br><span class="line">                        <span class="attr">fundIcon</span>: <span class="string">&#x27;11&#x27;</span>,</span><br><span class="line">                        <span class="attr">fundElectronicAccount</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">fundCorpId</span>: <span class="string">&#x27;MS-BANK&#x27;</span>,</span><br><span class="line">                        <span class="attr">fundNo</span>: <span class="string">&#x27;000600&#x27;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure><br><h3 id="22、添加ESLint配置检查器-启动项"><a href="#22、添加ESLint配置检查器-启动项" class="headerlink" title="22、添加ESLint配置检查器 启动项"></a><strong><font color='red'>22、添加ESLint配置检查器 启动项</font></strong></h3><p><code>package.json</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;eslint-config-inspector&quot;: &quot;pnpm dlx eslint --inspect-config&quot;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><br><h3 id="23、添加404页"><a href="#23、添加404页" class="headerlink" title="23、添加404页"></a><strong><font color='red'>23、添加404页</font></strong></h3><p><code>src/router/index.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_BASE_URL</span>),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/:pathMatch(.*)*&#x27;</span>, <span class="comment">// Vue3 的写法，兼容子路径</span></span><br><span class="line">            <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/404.vue&#x27;</span>),</span><br><span class="line">            <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">false</span>, <span class="attr">title</span>: <span class="string">&#x27;中国移动支付-404&#x27;</span> &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setupRouter</span> = (<span class="params">app: App</span>) =&gt; &#123;</span><br><span class="line">    app.<span class="title function_">use</span>(router)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="24、引用scss文件"><a href="#24、引用scss文件" class="headerlink" title="24、引用scss文件"></a><strong><font color='red'>24、引用scss文件</font></strong></h3><p>添加scss文件</p><p><code>src/styles/common.scss</code></p><p><code>src/styles/mixin.scss</code></p><p><code>src/styles/variables.scss</code></p><p><strong><code>vite.config.ts</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(<span class="function">(<span class="params">&#123; mode, command &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="attr">css</span>: &#123;</span><br><span class="line">            <span class="comment">// css预处理器</span></span><br><span class="line">            <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">                <span class="attr">scss</span>: &#123;</span><br><span class="line">                    <span class="attr">additionalData</span>: <span class="string">`</span></span><br><span class="line"><span class="string">                        @use &quot;@/styles/variables.scss&quot; as *;</span></span><br><span class="line"><span class="string">                        @use &quot;@/styles/mixin.scss&quot; as *;`</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="25、打包拆分-小图片转base64"><a href="#25、打包拆分-小图片转base64" class="headerlink" title="25、打包拆分 小图片转base64"></a><strong><font color='red'>25、打包拆分 小图片转base64</font></strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add terser -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(<span class="function">(<span class="params">&#123; mode, command &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">assetsInlineLimit</span>: <span class="number">1024</span> * <span class="number">10</span>, <span class="comment">// 10kb以下，转Base64</span></span><br><span class="line">    <span class="attr">chunkSizeWarningLimit</span>: <span class="number">2000</span>, <span class="comment">// 消除打包大小超过500kb警告</span></span><br><span class="line">    <span class="attr">minify</span>: <span class="string">&#x27;terser&#x27;</span>, <span class="comment">// Vite 2.6.x 以上需要配置 minify: &quot;terser&quot;, terserOptions 才能生效</span></span><br><span class="line">    <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">        <span class="attr">compress</span>: &#123;</span><br><span class="line">            <span class="attr">keep_infinity</span>: <span class="literal">true</span>, <span class="comment">// 防止 Infinity 被压缩成 1/0，这可能会导致 Chrome 上的性能问题</span></span><br><span class="line">            <span class="attr">drop_console</span>: mode === <span class="string">&#x27;production&#x27;</span>, <span class="comment">// 生产环境去除 console</span></span><br><span class="line">            <span class="attr">drop_debugger</span>: <span class="literal">true</span>, <span class="comment">// 生产环境去除 debugger</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">format</span>: &#123;</span><br><span class="line">            <span class="attr">comments</span>: <span class="literal">false</span>, <span class="comment">// 删除注释</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">        <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// 每个node_modules模块分成一个js文件</span></span><br><span class="line">            <span class="title function_">manualChunks</span>(<span class="params">id: string</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (id.<span class="title function_">includes</span>(<span class="string">&#x27;node_modules&#x27;</span>)) &#123;</span><br><span class="line">                    <span class="keyword">const</span> packageName = id.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;node_modules/.pnpm/&#x27;</span>)[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>].<span class="title function_">toString</span>()</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 1.第三方依赖合并在一起</span></span><br><span class="line">                    <span class="comment">// return &#x27;vendor&#x27;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 2.把第三方依赖单独抽离出来</span></span><br><span class="line">                    <span class="comment">// return packageName</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 3.将较大型或常用的第三方库单独打包</span></span><br><span class="line">                    <span class="keyword">if</span> (packageName.<span class="title function_">includes</span>(<span class="string">&#x27;pinia&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (packageName.<span class="title function_">includes</span>(<span class="string">&#x27;axios&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (packageName.<span class="title function_">includes</span>(<span class="string">&#x27;dayjs&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (packageName.<span class="title function_">includes</span>(<span class="string">&#x27;bowser&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;bowser&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (packageName.<span class="title function_">includes</span>(<span class="string">&#x27;vue-router&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (packageName.<span class="title function_">includes</span>(<span class="string">&#x27;vue&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;vendor&#x27;</span> <span class="comment">// 其他第三方依赖合并在一起</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">entryFileNames</span>: <span class="string">&#x27;js/[name].[hash].js&#x27;</span>,</span><br><span class="line">            <span class="attr">chunkFileNames</span>: <span class="string">&#x27;js/[name].[hash].js&#x27;</span>,</span><br><span class="line">            <span class="attr">assetFileNames</span>: <span class="function">(<span class="params">assetInfo: any</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> info = assetInfo.<span class="property">name</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">                <span class="keyword">let</span> extType = info[info.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">if</span> (<span class="regexp">/\.(?:png|jpe?g|gif|svg|webp)(?:\?.*)?$/</span>.<span class="title function_">test</span>(assetInfo.<span class="property">name</span>)) &#123;</span><br><span class="line">                    extType = <span class="string">&#x27;img&#x27;</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/\.(?:mp4|webm|ogg|mp3|wav|aac)(?:\?.*)?$/i</span>.<span class="title function_">test</span>(assetInfo.<span class="property">name</span>)) &#123;</span><br><span class="line">                    extType = <span class="string">&#x27;media&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;extType&#125;</span>/[name].[hash].[ext]`</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="26、添加Vconsole打印"><a href="#26、添加Vconsole打印" class="headerlink" title="26、添加Vconsole打印"></a><strong><font color='red'>26、添加Vconsole打印</font></strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add vite-plugin-vconsole vconsole -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> viteVConsole <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-vconsole&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">         <span class="title function_">viteVConsole</span>(&#123;</span><br><span class="line">            <span class="attr">entry</span>: [path.<span class="title function_">resolve</span>(<span class="string">&#x27;src/main.ts&#x27;</span>)], <span class="comment">// 项目入口文件 [[1, 6]]</span></span><br><span class="line">            <span class="attr">enabled</span>: mode !== <span class="string">&#x27;production&#x27;</span>, <span class="comment">// 根据环境启用 [[3, 6]]</span></span><br><span class="line">            <span class="attr">localEnabled</span>: <span class="literal">true</span>, <span class="comment">// 本地开发时强制启用 [[6]]</span></span><br><span class="line">            <span class="attr">config</span>: &#123;</span><br><span class="line">                <span class="attr">theme</span>: <span class="string">&#x27;dark&#x27;</span>, <span class="comment">// 主题配置</span></span><br><span class="line">                <span class="attr">maxLogNumber</span>: <span class="number">1000</span>, <span class="comment">// 日志数量限制</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="27、简化SVG使用"><a href="#27、简化SVG使用" class="headerlink" title="27、简化SVG使用"></a><strong><font color='red'>27、简化SVG使用</font></strong></h3><p>插件网站<a href="https://www.npmjs.com/package/vite-svg-loader">https://www.npmjs.com/package/vite-svg-loader</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add vite-svg-loader -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> svgLoader <span class="keyword">from</span> <span class="string">&#x27;vite-svg-loader&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">svgLoader</span>(&#123;</span><br><span class="line">            <span class="comment">// &#x27;url&#x27;: img标签引入 &#x27;raw&#x27;：demo元素 v-html引入   &#x27;component&#x27;: 组件展示</span></span><br><span class="line">            <span class="attr">defaultImport</span>: <span class="string">&#x27;url&#x27;</span>,</span><br><span class="line">            <span class="attr">svgo</span>: <span class="literal">true</span>, <span class="comment">// 启用SVGO优化</span></span><br><span class="line">            <span class="attr">svgoConfig</span>: &#123;</span><br><span class="line">                <span class="attr">multipass</span>: <span class="literal">false</span>, <span class="comment">// 关闭对SVG文件进行多次优化迭代（更彻底地压缩 SVG，会增加处理时间）</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// env.d.ts 模块声明</span><br><span class="line">/// &lt;reference types=&quot;vite-svg-loader&quot; /&gt;</span><br></pre></td></tr></table></figure><p><code>.vue文件使用</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- defaultImport: &#x27;url&#x27; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">w100</span> <span class="attr">:src</span>=<span class="string">&quot;logo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- defaultImport: &#x27;raw&#x27; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">w100</span> <span class="attr">v-html</span>=<span class="string">&quot;logo&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- defaultImport: &#x27;component&#x27; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logo</span> <span class="attr">w100</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">&#x27;@/assets/logo.svg&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br><h3 id="28、px转换"><a href="#28、px转换" class="headerlink" title="28、px转换"></a><strong><font color='red'>28、px转换</font></strong></h3><h4 id="cnjm-postcss-px-to-viewport"><a href="#cnjm-postcss-px-to-viewport" class="headerlink" title="cnjm-postcss-px-to-viewport"></a><strong><font color='#10c300'>cnjm-postcss-px-to-viewport</font></strong></h4><p><strong><code>px转vw/vh</code></strong></p><p>插件网站<a href="https://www.npmjs.com/package/cnjm-postcss-px-to-viewport">https://www.npmjs.com/package/cnjm-postcss-px-to-viewport</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add cnjm-postcss-px-to-viewport -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import &#123; defineConfig &#125; from &#x27;vite&#x27;</span><br><span class="line">import px2viewport from &#x27;cnjm-postcss-px-to-viewport&#x27;</span><br><span class="line"></span><br><span class="line">// https://vite.dev/config/</span><br><span class="line">export default defineConfig((&#123; mode &#125;) =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        css: &#123;</span><br><span class="line">            postcss: &#123;</span><br><span class="line">                plugins: [</span><br><span class="line">                    px2viewport(&#123;</span><br><span class="line">                        unitToConvert: &#x27;px&#x27;, // 要转化的单位</span><br><span class="line">                        viewportWidth: 750, // UI设计稿的宽度</span><br><span class="line">                        unitPrecision: 6, // 转换后的精度，即小数点位数</span><br><span class="line">                        propList: [&#x27;*&#x27;], // 指定转换的css属性的单位，*代表全部css属性的单位都进行转换</span><br><span class="line">                        viewportUnit: &#x27;vw&#x27;, // 指定需要转换成的视窗单位，默认vw</span><br><span class="line">                        fontViewportUnit: &#x27;vw&#x27;, // 指定字体需要转换成的视窗单位，默认vw</span><br><span class="line">                        selectorBlackList: [&#x27;ignore&#x27;], // 指定不转换为视窗单位的类名，</span><br><span class="line">                        minPixelValue: 1, // 默认值1，小于或等于1px则不进行转换</span><br><span class="line">                        mediaQuery: true, // 是否在媒体查询的css代码中也进行转换，默认false</span><br><span class="line">                        replace: true, // 是否转换后直接更换属性值</span><br><span class="line">                        exclude: [], // 设置忽略文件，用正则做目录名匹配</span><br><span class="line">                        landscape: false, // 是否处理横屏情况</span><br><span class="line">                        // 如果没有使用其他的尺寸来设计，下面这个方法可以不需要， 这个自定义的方法是针对处理vant组件下的设计稿为375问题</span><br><span class="line">                        customFun: (&#123; file &#125;: &#123; file: string &#125;) =&gt; &#123;</span><br><span class="line">                            const designWidth = path.join(file).includes(path.join(&#x27;node_modules&#x27;, &#x27;vant&#x27;))</span><br><span class="line">                                ? 375</span><br><span class="line">                                : 750</span><br><span class="line">                            return designWidth</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;),</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在 TypeScript 中，<code>declare module</code> 用于声明一个模块的类型定义，通常在以下情况下使用：</p><ol><li><strong>没有类型定义文件的第三方库</strong>：如果你正在使用一个第三方库（如 <code>cnjm-postcss-px-to-viewport</code>），但该库没有提供官方的类型定义文件（例如 <code>.d.ts</code> 文件），你可以使用 <code>declare module</code> 来告诉 TypeScript 这个模块存在，从而避免编译时报错。</li><li><strong>临时解决方案</strong>：这是一个临时的声明，通常用于快速解决类型检查问题。它不会为模块提供具体的类型信息，只是告诉 TypeScript 这个模块是有效的。</li></ol><p><code>types/cnjm-postcss-px-to-viewport.d.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare module &#x27;cnjm-postcss-px-to-viewport&#x27;</span><br></pre></td></tr></table></figure><p><code>tsconfig.node.json</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;extends&quot;: &quot;@tsconfig/node22/tsconfig.json&quot;,</span><br><span class="line">    &quot;compilerOptions&quot;: &#123;</span><br><span class="line">        &quot;types&quot;: [&quot;node&quot;, &quot;./types/vite.config.d.ts&quot;],</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;include&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>declare module ‘cnjm-postcss-px-to-viewport</strong></p><p>这行代码的意思是：</p><ul><li>声明一个名为 <code>&#39;cnjm-postcss-px-to-viewport&#39;</code> 的模块。</li><li>TypeScript 不会对该模块的导入进行类型检查。</li><li>你可以在项目中导入并使用这个模块，但它的类型是 <code>any</code>，即没有具体的类型信息。</li></ul><h4 id="vite-plugin-px2rem"><a href="#vite-plugin-px2rem" class="headerlink" title="vite-plugin-px2rem"></a><strong><font color='#10c300'>vite-plugin-px2rem</font></strong></h4><p><strong><code>px转rem</code></strong></p><p>插件网站<a href="https://www.npmjs.com/package/vite-plugin-px2rem#vite-plugin-px2rem">https://www.npmjs.com/package/vite-plugin-px2rem#vite-plugin-px2rem</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add vite-plugin-px2rem -D</span><br></pre></td></tr></table></figure><p><code>vite.config.ts</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">px2rem</span>(&#123;</span><br><span class="line">            <span class="attr">width</span>: <span class="number">750</span>,</span><br><span class="line">            <span class="attr">rootFontSize</span>: <span class="number">16</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="29、预构建的依赖项"><a href="#29、预构建的依赖项" class="headerlink" title="29、预构建的依赖项"></a><strong><font color='red'>29、预构建的依赖项</font></strong></h3><p>强制预构建的依赖项，在开发服务器启动时，Vite 会预先处理这些库，以确保它们快速加载和解析</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [],</span><br><span class="line">    <span class="attr">optimizeDeps</span>: &#123;</span><br><span class="line">        <span class="attr">include</span>: [</span><br><span class="line">            <span class="string">&#x27;vue&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;vue-router&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;pinia&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;axios&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;@vueuse/core&#x27;</span>,</span><br><span class="line">         ],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><h3 id="30、计算白屏时间"><a href="#30、计算白屏时间" class="headerlink" title="30、计算白屏时间"></a><strong><font color='red'>30、计算白屏时间</font></strong></h3><p>白屏时间（First Paint Time）是一个非常重要的指标。它指的是从用户输入网址并按下回车键，到浏览器开始渲染页面内容的时间段。在这段时间内，用户看到的只是一个空白页面，因此白屏时间的长短直接影响了用户的体验。</p><h4 id="30-1、什么是白屏时间？"><a href="#30-1、什么是白屏时间？" class="headerlink" title="30.1、什么是白屏时间？"></a><strong><font color='#10c300'>30.1、什么是白屏时间？</font></strong></h4><p>白屏时间是指从用户发起页面请求到浏览器首次开始渲染页面内容的时间。具体来说，白屏时间包括以下几个阶段：</p><ol><li><strong>DNS解析</strong>：浏览器将域名解析为IP地址。</li><li><strong>建立TCP连接</strong>：浏览器与服务器建立TCP连接（三次握手）。</li><li><strong>发起HTTP请求</strong>：浏览器向服务器发送HTTP请求。</li><li><strong>服务器响应</strong>：服务器处理请求并返回响应数据。</li><li><strong>浏览器解析HTML</strong>：浏览器解析HTML文档并构建DOM树。</li><li><strong>浏览器渲染页面</strong>：浏览器根据DOM树和CSSOM树生成渲染树，并开始渲染页面。</li><li><strong>页面展示第一个标签</strong>：浏览器首次将页面内容渲染到屏幕上。</li></ol><p>白屏时间的长短直接影响了用户对网站的第一印象。如果白屏时间过长，用户可能会感到不耐烦，甚至直接关闭页面。因此，优化白屏时间是前端性能优化的重要目标之一。</p><br><h4 id="30-2、白屏时间的影响因素"><a href="#30-2、白屏时间的影响因素" class="headerlink" title="30.2、白屏时间的影响因素"></a><strong><font color='#10c300'>30.2、白屏时间的影响因素</font></strong></h4><p>白屏时间的长短受到多种因素的影响，主要包括以下几个方面：</p><ol><li><strong>网络性能</strong>：网络延迟、带宽、DNS解析时间等都会影响白屏时间。如果网络状况不佳，DNS解析和TCP连接建立的时间会变长，从而导致白屏时间增加。</li><li><strong>服务器性能</strong>：服务器的响应速度、处理能力等也会影响白屏时间。如果服务器响应缓慢，浏览器需要等待更长的时间才能接收到HTML文档。</li><li><strong>前端页面结构</strong>：HTML文档的大小、复杂度、外部资源的加载顺序等都会影响白屏时间。如果HTML文档过大或包含大量外部资源，浏览器需要更长的时间来解析和渲染页面。</li><li><strong>浏览器性能</strong>：浏览器的渲染引擎性能、缓存机制等也会影响白屏时间。不同浏览器的渲染性能可能存在差异，导致白屏时间不同。</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vite App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/src/main.ts&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 性能 观察器 观察者模式</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 获取所有的 性能 指标</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>()</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// body 里的第一个 标签的渲染</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// &#x27;first-paint&#x27; 表示页面首次开始绘制的时间点，也就是白屏结束的时间点</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-paint&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">const</span> whiteScreenTime = entry.<span class="property">startTime</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 1s=1000ms</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`白屏时间：<span class="subst">$&#123;whiteScreenTime&#125;</span>ms`</span>)</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 首次绘制 first-paint</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 首次内容绘制 first-contentful-paint 事件</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// observe 监听性能指标</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// buffered 属性设置为 true，表示包含性能时间线缓冲区中已经记录的相关事件</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 这样即使在创建 PerformanceObserver 之前事件已经发生，也能被捕获到</span></span></span><br><span class="line"><span class="language-javascript">            observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;paint&#x27;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;)</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;由于vite脚手架要禁止*.cjs 和 eslint版本升级废弃rc配置文件， 故重新搭建。&lt;/p&gt;
&lt;p&gt;核心采用**&lt;code&gt;antfu&lt;/code&gt;**大神预设配置 替代prettier和eslint设置，保留stylelint原因是暂时a</summary>
      
    
    
    
    <category term="框架与生态" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6%E4%B8%8E%E7%94%9F%E6%80%81/"/>
    
    
    <category term="vue3" scheme="http://example.com/tags/vue3/"/>
    
  </entry>
  
</feed>
