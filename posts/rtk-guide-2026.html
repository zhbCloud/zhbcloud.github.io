<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta http-equiv="Cache-Control" content="no-siteapp"><meta http-equiv="Cache-Control" content="no-transform"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="apple-mobile-web-app-capable" content="Hå¤šçœ‹æºç å¤šè¯»ä¹¦ - å‹¤äºæ€è€ƒå–„é¢†æ‚Ÿ"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="browsermode" content="application"><meta name="screen-orientation" content="portrait"><meta name="theme-version" content="1.3.0"><meta name="root" content="/"><link rel="dns-prefetch" href="http://example.com"><meta name="keywords" content="React,Redux,RTK"><meta name="description" content="React Redux å…¨é¢æŒ‡å— (Redux Toolkit)
ğŸ“š æœ¬æŒ‡å—æ—¨åœ¨å¸¦ä½ ä»é›¶å¼€å§‹ Mastering React Reduxï¼Œç‰¹åˆ«æ˜¯ç°ä»£æ ‡å‡†çš„ Redux Toolkit (RTK..."><meta name="robots" content="all"><meta name="google" content="all"><meta name="googlebot" content="all"><meta name="verify" content="all"><title>React Redux å…¨é¢æŒ‡å— (RTK) | Hå¤šçœ‹æºç å¤šè¯»ä¹¦ - å‹¤äºæ€è€ƒå–„é¢†æ‚Ÿ</title><link rel="alternate" href="/atom.xml" title="Hå¤šçœ‹æºç å¤šè¯»ä¹¦ - å‹¤äºæ€è€ƒå–„é¢†æ‚Ÿ" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/bootstrap.min.css?rev=1d1bccdabbf21f3604f985399285f5cf"><link rel="stylesheet" href="/css/font-awesome.min.css?rev=17d35b1ddb5a58cc19379d19f22b9fdc"><link rel="stylesheet" href="/css/style.css?rev=1be479d06cbb29d0c56ae25586ad88bc"><div class="hide"><script type="text/javascript">!function(){var t="https:"===document.location.protocol?"https://":"http://",c=document.createElement("script");c.src="https://s95.cnzz.com/z_stat.php?web_id=1272564536",c.async=!0,document.body.appendChild(c);var e=document.createElement("script");e.src=t+"s19.cnzz.com/z_stat.php?id=1263868967&show=pic1",e.async=!0,document.body.appendChild(e)}()</script></div><meta name="generator" content="Hexo 7.3.0"></head><!--[if lte IE 8]><style>
    html{ font-size: 1em }
</style><![endif]--><!--[if lte IE 9]><div style="ie">ä½ ä½¿ç”¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œä¸ºäº†ä½ æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œè¯·æ›´æ–°æµè§ˆå™¨çš„ç‰ˆæœ¬æˆ–è€…ä½¿ç”¨å…¶ä»–ç°ä»£æµè§ˆå™¨ï¼Œæ¯”å¦‚Chromeã€Firefoxã€Safariç­‰ã€‚</div><![endif]--><body><header class="main-header" style="background-image:url(https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/banner.webp)"><div class="main-header-box"><a class="header-avatar" href="/" title="ZHB"><img src="/img/avatar.webp" alt="logoå¤´åƒ" class="img-responsive center-block"></a><div class="branding"><img src="/img/branding.png" alt="Snippet åšå®¢ä¸»é¢˜" class="img-responsive center-block"></div></div></header><nav class="main-navigation"><div class="container"><div class="row"><div class="col-sm-12"><div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav"><span class="sr-only"></span><i class="fa fa-bars"></i></span> <a class="navbar-brand" href="http://example.com">Hå¤šçœ‹æºç å¤šè¯»ä¹¦ - å‹¤äºæ€è€ƒå–„é¢†æ‚Ÿ</a></div><div class="collapse navbar-collapse" id="main-menu"><ul class="menu"><li role="presentation" class="text-center"><a href="/"><i class="fa"></i> é¦–é¡µ</a></li><li role="presentation" class="text-center"><a href="/categories/"><i class="fa"></i> åˆ†ç±»</a></li><li role="presentation" class="text-center"><a href="/tags/"><i class="fa"></i> æ ‡ç­¾</a></li><li role="presentation" class="text-center"><a href="/archives/"><i class="fa"></i> æ—¶é—´è½´</a></li><li role="presentation" class="text-center"><a href="/about/"><i class="fa"></i> å…³äº</a></li></ul></div></div></div></div></nav><section class="content-wrap"><div class="container"><div class="row"><main class="col-md-9 main-content m-post"><p id="process"></p><article class="post"><div class="post-head"><h1 id="React Redux å…¨é¢æŒ‡å— (RTK)">React Redux å…¨é¢æŒ‡å— (RTK)</h1><div class="post-meta"><span class="categories-meta fa-wrap"><i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</a></span><span class="fa-wrap"><i class="fa fa-tags"></i> <span class="tags-meta"><a class="tag-none-link" href="/tags/RTK/" rel="tag">RTK</a> <a class="tag-none-link" href="/tags/React/" rel="tag">React</a> <a class="tag-none-link" href="/tags/Redux/" rel="tag">Redux</a></span></span><span class="fa-wrap"><i class="fa fa-clock-o"></i> <span class="date-meta">2026/02/22</span></span></div></div><div class="post-body post-content"><h1 id="React-Redux-å…¨é¢æŒ‡å—-Redux-Toolkit"><a href="#React-Redux-å…¨é¢æŒ‡å—-Redux-Toolkit" class="headerlink" title="React Redux å…¨é¢æŒ‡å— (Redux Toolkit)"></a>React Redux å…¨é¢æŒ‡å— (Redux Toolkit)</h1><blockquote><p>ğŸ“š æœ¬æŒ‡å—æ—¨åœ¨å¸¦ä½ ä»é›¶å¼€å§‹ Mastering React Reduxï¼Œç‰¹åˆ«æ˜¯ç°ä»£æ ‡å‡†çš„ <strong>Redux Toolkit (RTK)</strong> å†™æ³•ã€‚</p></blockquote><hr><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ol><li><a href="#%E4%B8%80%E5%9F%BA%E7%A1%80%E7%AF%87rtk-%E6%A0%B8%E5%BF%83%E4%B8%8E%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">åŸºç¡€ç¯‡ï¼šRTK æ ¸å¿ƒä¸å¿«é€Ÿä¸Šæ‰‹</a></li><li><a href="#%E4%BA%8C%E8%BF%9B%E9%98%B6%E7%AF%87%E5%A4%8D%E6%9D%82%E7%8A%B6%E6%80%81%E4%B8%8E%E5%BC%82%E6%AD%A5%E9%80%BB%E8%BE%91">è¿›é˜¶ç¯‡ï¼šå¤æ‚çŠ¶æ€ä¸å¼‚æ­¥é€»è¾‘</a></li><li><a href="#%E4%B8%89%E9%AB%98%E7%BA%A7%E7%AF%87rtk-query-%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">é«˜çº§ç¯‡ï¼šRTK Query ä¸æ€§èƒ½ä¼˜åŒ–</a></li></ol><br><h2 id="ä¸€ã€-åŸºç¡€ç¯‡ï¼šRTK-æ ¸å¿ƒä¸å¿«é€Ÿä¸Šæ‰‹"><a href="#ä¸€ã€-åŸºç¡€ç¯‡ï¼šRTK-æ ¸å¿ƒä¸å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="ä¸€ã€ åŸºç¡€ç¯‡ï¼šRTK æ ¸å¿ƒä¸å¿«é€Ÿä¸Šæ‰‹"></a><strong>ä¸€ã€ åŸºç¡€ç¯‡ï¼šRTK æ ¸å¿ƒä¸å¿«é€Ÿä¸Šæ‰‹</strong></h2><blockquote><p>[!NOTE]</p><ol><li><strong>Store</strong>ï¼šç”¨æ¥å­˜æ•°æ®çš„ã€‚</li><li><strong>Reducer</strong>ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥å¤„ç†æ•°æ®çš„ã€‚</li><li><strong>Action</strong>ï¼šæ˜¯ä¸€ä¸ªå…·æœ‰ <code>type</code> å­—æ®µçš„æ™®é€šå¯¹è±¡ï¼Œç”¨æ¥æè¿°è¦è¿›è¡Œä»€ä¹ˆæ“ä½œã€‚</li><li><strong>Action Creator</strong>ï¼šåˆ›å»ºå¹¶è¿”å› Action å¯¹è±¡çš„å‡½æ•°ã€‚</li><li><strong>Dispatch</strong>ï¼šæ›´æ–° State çš„å”¯ä¸€æ–¹æ³•ï¼Œè°ƒç”¨ <code>store.dispatch(action)</code>ã€‚</li></ol></blockquote><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/image-20260213092945181.png" alt="image-20260213092945181"></p><br><h3 id="1-1-Redux-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-1-Redux-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.1 Redux æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong><font color="red">1.1 Redux æ˜¯ä»€ä¹ˆï¼Ÿ</font></strong></h3><p>Redux æ˜¯ä¸€ä¸ªç”¨äº JavaScript åº”ç”¨çš„çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç†ã€‚</p><ul><li><strong>å•ä¸€æ•°æ®æº</strong>ï¼šåº”ç”¨çš„æ‰€æœ‰çŠ¶æ€éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªå¯¹è±¡æ ‘ä¸­ã€‚</li><li><strong>çŠ¶æ€æ˜¯åªè¯»çš„</strong>ï¼šå”¯ä¸€æ”¹å˜çŠ¶æ€çš„æ–¹æ³•æ˜¯è§¦å‘ä¸€ä¸ª <strong>Action</strong>ã€‚</li><li><strong>ä½¿ç”¨çº¯å‡½æ•°ä¿®æ”¹</strong>ï¼šç¼–å†™ <strong>Reducer</strong> æ¥æè¿° Action å¦‚ä½•è½¬æ¢ Stateã€‚</li></ul><blockquote><p>[!TIP]<br><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ Redux Toolkit (RTK)ï¼Ÿ</strong><br>å®˜æ–¹æ¨èï¼RTK æ˜¯ç°ä»£ Redux çš„æ ‡å‡†å†™æ³•ã€‚å®ƒè§£å†³äº†ä¼ ç»Ÿ Redux é…ç½®å¤æ‚ã€æ ·æ¿ä»£ç å¤šã€éœ€æ‰‹åŠ¨æ·»åŠ ä¸å¯å˜é€»è¾‘ç­‰ç—›ç‚¹ã€‚RTK å†…ç½®äº† <code>Immer</code>ï¼ˆç®€åŒ–ä¸å¯å˜æ›´æ–°ï¼‰ã€<code>Thunk</code>ï¼ˆå¼‚æ­¥ï¼‰ã€<code>DevTools</code> ç­‰å·¥å…·ã€‚</p></blockquote><br><h3 id="1-2-å®‰è£…"><a href="#1-2-å®‰è£…" class="headerlink" title="1.2 å®‰è£…"></a><strong><font color="red">1.2 å®‰è£…</font></strong></h3><p>ä½¿ç”¨ Create React App æˆ– Vite åˆ›å»ºé¡¹ç›®åï¼Œå®‰è£…æ ¸å¿ƒä¾èµ–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @reduxjs/toolkit react-redux</span><br></pre></td></tr></table></figure><br><h3 id="1-3-æ ¸å¿ƒæ¦‚å¿µä¸å®æˆ˜-Counter-Example"><a href="#1-3-æ ¸å¿ƒæ¦‚å¿µä¸å®æˆ˜-Counter-Example" class="headerlink" title="1.3 æ ¸å¿ƒæ¦‚å¿µä¸å®æˆ˜ (Counter Example)"></a><strong><font color="red">1.3 æ ¸å¿ƒæ¦‚å¿µä¸å®æˆ˜ (Counter Example)</font></strong></h3><p>æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨åº”ç”¨æ¥æ¼”ç¤ºæœ€æ ¸å¿ƒçš„ APIã€‚</p><h4 id="1ï¼‰ç¬¬ä¸€æ­¥ï¼šåˆ›å»º-Slice-åˆ‡ç‰‡"><a href="#1ï¼‰ç¬¬ä¸€æ­¥ï¼šåˆ›å»º-Slice-åˆ‡ç‰‡" class="headerlink" title="1ï¼‰ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Slice (åˆ‡ç‰‡)"></a><strong><font color="#10c300">1ï¼‰ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Slice (åˆ‡ç‰‡)</font></strong></h4><p><strong>Slice</strong> æ˜¯ Redux é€»è¾‘çš„é›†åˆï¼ˆåŒ…å« Stateï¼ŒReducersï¼ŒActionsï¼‰</p><p><code>src\redux\modules\counterSlice.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>, <span class="comment">// Slice åç§°ï¼Œç”¨äºç”Ÿæˆ Action Type å‰ç¼€</span></span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="comment">// Redux Toolkit å…è®¸æˆ‘ä»¬åœ¨ reducer ä¸­ç›´æ¥ç¼–å†™&quot;å¯å˜&quot;é€»è¾‘</span></span><br><span class="line">    <span class="comment">// å®ƒåº•å±‚ä½¿ç”¨ Immer åº“å°† these æ“ä½œè½¬æ¢ä¸ºå®‰å…¨çš„ä¸å¯å˜æ›´æ–°</span></span><br><span class="line">    <span class="attr">increment</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// è·å–åˆ°çš„æ˜¯initialState</span></span><br><span class="line">      state.<span class="property">value</span> += <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">decrement</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> -= <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Action Payload åœ¨ action.payload ä¸­</span></span><br><span class="line">    <span class="attr">incrementByAmount</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> += action.<span class="property">payload</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç”Ÿæˆ Action Creators</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increment, decrement, incrementByAmount &#125; = counterSlice.<span class="property">actions</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡º Reducer</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰ç¬¬äºŒæ­¥ï¼šé…ç½®-Store"><a href="#2ï¼‰ç¬¬äºŒæ­¥ï¼šé…ç½®-Store" class="headerlink" title="2ï¼‰ç¬¬äºŒæ­¥ï¼šé…ç½® Store"></a><strong><font color="#10c300">2ï¼‰ç¬¬äºŒæ­¥ï¼šé…ç½® Store</font></strong></h4><p>ä½¿ç”¨ <code>configureStore</code> åˆ›å»º Storeï¼Œå®ƒä¼šè‡ªåŠ¨ç»„åˆ Slice Reducers å¹¶æ·»åŠ å¸¸ç”¨ä¸­é—´ä»¶ã€‚</p><p><code>src\redux\store.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> counterSlice <span class="keyword">from</span> <span class="string">&quot;./modules/counterSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="comment">// é€šå¸¸ä¼šè®© store çš„ key å’Œ slice çš„ name ä¿æŒä¸€è‡´ï¼Œè¿™é‡Œçš„ key &#x27;counter&#x27; å°†å†³å®š state ä¸­çš„å±æ€§å</span></span><br><span class="line">    <span class="attr">counter</span>: counterSlice,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="3ï¼‰ç¬¬ä¸‰æ­¥ï¼šæ³¨å…¥-Store"><a href="#3ï¼‰ç¬¬ä¸‰æ­¥ï¼šæ³¨å…¥-Store" class="headerlink" title="3ï¼‰ç¬¬ä¸‰æ­¥ï¼šæ³¨å…¥ Store"></a><strong><font color="#10c300">3ï¼‰ç¬¬ä¸‰æ­¥ï¼šæ³¨å…¥ Store</font></strong></h4><p>åœ¨åº”ç”¨å…¥å£æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ <code>&lt;Provider&gt;</code> å°† Store æ³¨å…¥åˆ° React ç»„ä»¶æ ‘ä¸­ã€‚</p><p><code>src/main.jsx</code> (æˆ– <code>index.js</code>):</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&quot;./app/store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>)).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="4ï¼‰ç¬¬å››æ­¥ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨-Hooks"><a href="#4ï¼‰ç¬¬å››æ­¥ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨-Hooks" class="headerlink" title="4ï¼‰ç¬¬å››æ­¥ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Hooks"></a><strong><font color="#10c300">4ï¼‰ç¬¬å››æ­¥ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Hooks</font></strong></h4><p>React Redux æä¾›äº†ä¸¤ä¸ªä¸»è¦çš„ Hooksï¼š</p><ul><li><strong><code>useSelector</code></strong>ï¼šä» Store ä¸­è¯»å–æ•°æ®ã€‚</li><li><strong><code>useDispatch</code></strong>ï¼šå‘é€ Action ä»¥è§¦å‘çŠ¶æ€æ›´æ–°ã€‚</li></ul><p><code>src\pages\Home.jsx</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  increment,</span><br><span class="line">  decrement,</span><br><span class="line">  incrementByAmount,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../redux/modules/counterSlice&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è¯»å– Stateï¼šstate.counter å¯¹åº” store é…ç½®ä¸­çš„ reducer key</span></span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counter</span>.<span class="property">value</span>);</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>();</span><br><span class="line">  <span class="keyword">const</span> [incrementAmount, setIncrementAmount] = <span class="title function_">useState</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(decrement())&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(increment())&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;incrementAmount&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setIncrementAmount(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span></span></span><br><span class="line"><span class="language-xml">            dispatch(incrementByAmount(Number(incrementAmount) || 0))</span></span><br><span class="line"><span class="language-xml">          &#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          Add Amount</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><hr><br><h2 id="äºŒã€-è¿›é˜¶ç¯‡ï¼šå¤æ‚çŠ¶æ€ä¸å¼‚æ­¥é€»è¾‘"><a href="#äºŒã€-è¿›é˜¶ç¯‡ï¼šå¤æ‚çŠ¶æ€ä¸å¼‚æ­¥é€»è¾‘" class="headerlink" title="äºŒã€ è¿›é˜¶ç¯‡ï¼šå¤æ‚çŠ¶æ€ä¸å¼‚æ­¥é€»è¾‘"></a><strong>äºŒã€ è¿›é˜¶ç¯‡ï¼šå¤æ‚çŠ¶æ€ä¸å¼‚æ­¥é€»è¾‘</strong></h2><p>å®é™…åº”ç”¨è¿œæ¯”è®¡æ•°å™¨å¤æ‚ã€‚æˆ‘ä»¬éœ€è¦å¤„ç† API è¯·æ±‚ã€åŠ è½½çŠ¶æ€ä»¥åŠæ›´å¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p><h3 id="2-1-å¼‚æ­¥é€»è¾‘ä¸æ•°æ®è¯·æ±‚ï¼šcreateAsyncThunk"><a href="#2-1-å¼‚æ­¥é€»è¾‘ä¸æ•°æ®è¯·æ±‚ï¼šcreateAsyncThunk" class="headerlink" title="2.1 å¼‚æ­¥é€»è¾‘ä¸æ•°æ®è¯·æ±‚ï¼šcreateAsyncThunk"></a><strong><font color="red">2.1 å¼‚æ­¥é€»è¾‘ä¸æ•°æ®è¯·æ±‚ï¼šcreateAsyncThunk</font></strong></h3><p>å¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒRedux çš„å¼‚æ­¥é€»è¾‘å¯èƒ½æœ‰ç‚¹ç»•ã€‚æˆ‘ä»¬å…ˆç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥ç†è§£ã€‚</p><h4 id="1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ"><a href="#1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ" class="headerlink" title="1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ"></a><strong><font color="#10c300">1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ</font></strong></h4><p>Redux çš„æ ‡å‡† <code>dispatch</code> æ˜¯<strong>åŒæ­¥</strong>çš„ï¼šä½ ç‚¹å‡»æŒ‰é’® -&gt; å‘é€ action -&gt; store ç«‹å³æ›´æ–° -&gt; é¡µé¢åˆ·æ–°ã€‚è¿™ä¸€åˆ‡å‘ç”Ÿåœ¨ä¸€ç¬é—´ã€‚</p><p>ä½†è¿™å°±åƒä½ å»å¿«é¤åº—ï¼Œç‚¹å®Œæ±‰å ¡å¦‚æœç«‹åˆ»å°±èƒ½æ‹¿èµ°ï¼Œé‚£å°±æ˜¯åŒæ­¥ã€‚ä½†ç°å®ä¸­ï¼Œå¾ˆå¤šæ“ä½œæ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼š</p><ul><li><strong>ç‚¹å¤–å–</strong>ï¼šä½ ä¸‹å•ï¼ˆdispatch actionï¼‰ï¼Œä½†é¥­ä¸ä¼šç«‹é©¬åˆ°ã€‚ä½ éœ€è¦<strong>ç­‰å¾…</strong>ï¼ˆloadingï¼‰ï¼Œç›´åˆ°éª‘æ‰‹é€åˆ°ï¼ˆsuccessï¼‰æˆ–è€…é¤å…å–æ¶ˆè®¢å•ï¼ˆfailedï¼‰ã€‚</li><li><strong>API è¯·æ±‚</strong>ï¼šå‰ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¤„ç†éœ€è¦å‡ ç™¾æ¯«ç§’ç”šè‡³å‡ ç§’ï¼Œè¿™æ®µæ—¶é—´å†…é¡µé¢é€šå¸¸æ˜¾ç¤ºâ€åŠ è½½ä¸­â€ã€‚</li></ul><p>Redux Toolkit (RTK) æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å·¥å…· <code>createAsyncThunk</code> æ¥ä¸“é—¨å¤„ç†è¿™ç§â€ä¸‹å• -&gt; ç­‰å¾… -&gt; æ”¶åˆ°ç»“æœâ€çš„æµç¨‹ã€‚å®ƒä¸éœ€è¦ä½ æ‰‹åŠ¨é…ç½®å¤æ‚çš„ä¸­é—´ä»¶ã€‚</p><h4 id="2ï¼‰å®æˆ˜ï¼šå®ç°ä¸€ä¸ªâ€æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„åŠ æ³•â€"><a href="#2ï¼‰å®æˆ˜ï¼šå®ç°ä¸€ä¸ªâ€æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„åŠ æ³•â€" class="headerlink" title="2ï¼‰å®æˆ˜ï¼šå®ç°ä¸€ä¸ªâ€æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„åŠ æ³•â€"></a><strong><font color="#10c300">2ï¼‰å®æˆ˜ï¼šå®ç°ä¸€ä¸ªâ€æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„åŠ æ³•â€</font></strong></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªâ€å¼‚æ­¥åŠ æ³•â€æŒ‰é’®ï¼Œç‚¹å‡»åéœ€è¦ç­‰å¾… 1 ç§’é’Ÿï¼ˆæ¨¡æ‹ŸæœåŠ¡å™¨å“åº”ï¼‰ï¼Œç„¶åæ•°å­—æ‰ä¼šåŠ  1ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼šå®šä¹‰å¼‚æ­¥ Action (Thunk)</strong></p><p>åœ¨ <code>counterSlice.js</code> ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªâ€ç‚¹å¤–å–â€çš„åŠ¨ä½œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice, createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createAsyncThunk æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">// 1. Action çš„åå­—å‰ç¼€ï¼š&#x27;counter/fetchCount&#x27;ã€‚è¿™å°±å¥½æ¯”ç»™ä½ çš„è®¢å•èµ·ä¸ªåå­—ã€‚</span></span><br><span class="line"><span class="comment">// 2. ä¸€ä¸ªå¼‚æ­¥å‡½æ•° (payloadCreator)ï¼šåœ¨è¿™é‡Œå‘é€ç½‘ç»œè¯·æ±‚ã€‚</span></span><br><span class="line"><span class="comment">// éœ€è¦å¯¼å‡ºä¾›ç»„ä»¶è°ƒç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementAsync = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/fetchCount&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (amount) =&gt; &#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿå‘é€ç½‘ç»œè¯·æ±‚ï¼Œç­‰å¾… 1 ç§’</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ Promise å°±åƒæ˜¯ä½ åœ¨ç­‰å¾…å¤–å–ï¼Œpending çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(&#123; <span class="attr">data</span>: amount &#125;), <span class="number">1000</span>),</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// è¯·æ±‚æˆåŠŸï¼è¿”å›çš„æ•°æ®ï¼ˆå¤–å–åˆ°äº†ï¼‰</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªè¿”å›å€¼ä¼šè‡ªåŠ¨å˜æˆ action.payload ä¼ ç»™ extraReducers</span></span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒæ­¥ï¼šç›‘å¬çŠ¶æ€å˜åŒ– (Pending &#x2F; Fulfilled &#x2F; Rejected)</strong></p><p>å½“ <code>incrementAsync</code> è¢« dispatch è§¦å‘æ—¶ï¼ŒRedux ä¼šè‡ªåŠ¨æ´¾å‘ä¸‰ç§çŠ¶æ€çš„ actionï¼Œå°±åƒå¤–å–è®¢å•çš„çŠ¶æ€å˜åŒ–ï¼š</p><ol><li><strong>pending</strong> (è¿›è¡Œä¸­)ï¼šå¤–å–åˆšä¸‹å•ï¼Œæ­£åœ¨åšã€‚</li><li><strong>fulfilled</strong> (æˆåŠŸ)ï¼šå¤–å–é€åˆ°äº†ã€‚</li><li><strong>rejected</strong> (å¤±è´¥)ï¼šå¤–å–è¢«å–æ¶ˆäº†ï¼ˆç½‘ç»œé”™è¯¯ç­‰ï¼‰ã€‚</li></ol><p>æˆ‘ä»¬éœ€è¦åœ¨ <code>createSlice</code> çš„ <code>extraReducers</code> å­—æ®µä¸­ç›‘å¬è¿™äº›çŠ¶æ€ï¼Œå¹¶æ›´æ–° storeã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterSlice.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice, createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createAsyncThunk æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">// 1. Action çš„åå­—å‰ç¼€ï¼š&#x27;counter/fetchCount&#x27;ã€‚è¿™å°±å¥½æ¯”ç»™ä½ çš„è®¢å•èµ·ä¸ªåå­—ã€‚</span></span><br><span class="line"><span class="comment">// 2. ä¸€ä¸ªå¼‚æ­¥å‡½æ•° (payloadCreator)ï¼šåœ¨è¿™é‡Œå‘é€ç½‘ç»œè¯·æ±‚ã€‚</span></span><br><span class="line"><span class="comment">// éœ€è¦å¯¼å‡ºä¾›ç»„ä»¶è°ƒç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> incrementAsync = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/fetchCount&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (amount) =&gt; &#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿå‘é€ç½‘ç»œè¯·æ±‚ï¼Œç­‰å¾… 1 ç§’</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ Promise å°±åƒæ˜¯ä½ åœ¨ç­‰å¾…å¤–å–ï¼Œpending çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(&#123; <span class="attr">data</span>: amount &#125;), <span class="number">1000</span>),</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// è¯·æ±‚æˆåŠŸï¼è¿”å›çš„æ•°æ®ï¼ˆå¤–å–åˆ°äº†ï¼‰</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªè¿”å›å€¼ä¼šè‡ªåŠ¨å˜æˆ action.payload ä¼ ç»™ extraReducers</span></span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span>, <span class="comment">// çŠ¶æ€ï¼š&#x27;idle&#x27; (ç©ºé—²) | &#x27;loading&#x27; (åŠ è½½ä¸­) | &#x27;failed&#x27; (å¤±è´¥)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ”¾æ™®é€šçš„åŒæ­¥ reducers (å¦‚ increment, decrement)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// extraReducers ä¸“é—¨ç”¨æ¥å¤„ç†ç”± createAsyncThunk ç”Ÿæˆçš„ action</span></span><br><span class="line">  <span class="comment">// è¿™é‡Œçš„ builder è¯­æ³•ä¸ä»…ç±»å‹å®‰å…¨ï¼Œè€Œä¸”æ›´æ¸…æ™°</span></span><br><span class="line">  <span class="attr">extraReducers</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> &#123;</span><br><span class="line">    builder</span><br><span class="line">      .<span class="title function_">addCase</span>(incrementAsync.<span class="property">pending</span>, <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 1. åˆšå¼€å§‹è¯·æ±‚ (Pending)</span></span><br><span class="line">        state.<span class="property">status</span> = <span class="string">&quot;loading&quot;</span>; <span class="comment">// æ ‡è®°çŠ¶æ€ä¸º&quot;åŠ è½½ä¸­&quot;ï¼Œç•Œé¢å¯ä»¥æ˜¾ç¤ºè½¬åœˆåœˆ</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">addCase</span>(incrementAsync.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 2. è¯·æ±‚æˆåŠŸ (Fulfilled)</span></span><br><span class="line">        state.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>; <span class="comment">// æ¢å¤ä¸ºç©ºé—²çŠ¶æ€</span></span><br><span class="line">        state.<span class="property">value</span> += action.<span class="property">payload</span>; <span class="comment">// æŠŠè¯·æ±‚å›æ¥çš„æ•°æ®åŠ åˆ° value ä¸Š</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">addCase</span>(incrementAsync.<span class="property">rejected</span>, <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 3. è¯·æ±‚å¤±è´¥ (Rejected)</span></span><br><span class="line">        state.<span class="property">status</span> = <span class="string">&quot;failed&quot;</span>; <span class="comment">// æ ‡è®°å¤±è´¥ï¼Œç•Œé¢å¯ä»¥æ˜¾ç¤ºé”™è¯¯æç¤º</span></span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰æ­¥ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨</strong></p><p>ç»„ä»¶ä¸­çš„å†™æ³•å’Œæ™®é€š action ä¸€æ¨¡ä¸€æ ·ï¼Œä½¿ç”¨ <code>dispatch</code> å³å¯ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ state ä¸­çš„ status æ¥æ§åˆ¶æŒ‰é’®çš„ç¦ç”¨çŠ¶æ€ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; incrementAsync &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/modules/counterSlice&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>();</span><br><span class="line">  <span class="comment">// è·å–å½“å‰çŠ¶æ€ï¼Œå¦‚æœæ˜¯ &#x27;loading&#x27;ï¼Œæˆ‘ä»¬å¯ä»¥ç¦ç”¨æŒ‰é’®</span></span><br><span class="line">  <span class="keyword">const</span> &#123; value, status &#125; = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counter</span>);</span><br><span class="line">  <span class="keyword">const</span> [incrementAmount, setIncrementAmount] = <span class="title function_">useState</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;incrementAmount&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setIncrementAmount(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">        &#123;/* ç‚¹å‡»è§¦å‘å¼‚æ­¥æ“ä½œ å¦‚æœæ­£åœ¨åŠ è½½ï¼Œç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»ï¼Œæå‡ç”¨æˆ·ä½“éªŒ */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(incrementAsync(Number(incrementAmount) || 0))&#125;</span></span><br><span class="line"><span class="language-xml">          disabled=&#123;status === &quot;loading&quot;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          &#123;status === &quot;loading&quot; ? &quot;è®¡ç®—ä¸­...&quot; : &quot;å¼‚æ­¥åŠ &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* æ˜¾ç¤ºå½“å‰å€¼ */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>å½“å‰å€¼: &#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“ä¸€ä¸‹æµç¨‹</strong>ï¼š</p><ol><li><strong>Dispatch</strong>: ç”¨æˆ·ç‚¹å‡»æŒ‰é’® -&gt; <code>dispatch(incrementAsync(5))</code></li><li><strong>Pending</strong>: Redux è‡ªåŠ¨è§¦å‘ <code>pending</code> -&gt; <code>status</code> å˜ä¸º <code>&#39;loading&#39;</code> -&gt; æŒ‰é’®å˜ç°ã€‚</li><li><strong>Async Work</strong>: <code>incrementAsync</code> é‡Œçš„ <code>async</code> å‡½æ•°å¼€å§‹æ‰§è¡Œï¼ˆç­‰å¾… 1 ç§’ï¼‰ã€‚</li><li><strong>Fulfilled</strong>: 1 ç§’å Promise å®Œæˆ -&gt; Redux è‡ªåŠ¨è§¦å‘ <code>fulfilled</code> -&gt; <code>status</code>å˜å› <code>&#39;idle&#39;</code>ï¼Œ<code>value</code> æ›´æ–°ã€‚</li><li><strong>Re-render</strong>: ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæ˜¾ç¤ºæœ€æ–°çš„æ•°å­—ã€‚</li></ol><br><h3 id="2-2-å¼‚æ­¥é€»è¾‘çš„ä»£ç ä¼˜åŒ–"><a href="#2-2-å¼‚æ­¥é€»è¾‘çš„ä»£ç ä¼˜åŒ–" class="headerlink" title="2.2 å¼‚æ­¥é€»è¾‘çš„ä»£ç ä¼˜åŒ–"></a><strong><font color="red">2.2 å¼‚æ­¥é€»è¾‘çš„ä»£ç ä¼˜åŒ–</font></strong></h3><p>éšç€é¡¹ç›®è§„æ¨¡æ‰©å¤§ï¼Œå¼‚æ­¥é€»è¾‘ä¼šå˜å¾—è‡ƒè‚¿ã€‚æˆ‘ä»¬å¯ä»¥ä»<strong>ç»“æ„åˆ†ç¦»</strong>ã€<strong>èŒè´£å•ä¸€</strong>å’Œ<strong>é€»è¾‘å¤ç”¨</strong>ä¸‰ä¸ªç»´åº¦è¿›è¡Œä¼˜åŒ–ã€‚</p><h4 id="1-åˆ†ç¦»-Async-Thunk-å®šä¹‰"><a href="#1-åˆ†ç¦»-Async-Thunk-å®šä¹‰" class="headerlink" title="1. åˆ†ç¦» Async Thunk å®šä¹‰"></a><strong><font color="#10c300">1. åˆ†ç¦» Async Thunk å®šä¹‰</font></strong></h4><p>å°†æ‰€æœ‰ Thunk æ”¾åœ¨ <code>Slice</code> æ–‡ä»¶ä¸­ä¼šå¯¼è‡´æ–‡ä»¶è¿‡é•¿ä¸”å®¹æ˜“å¼•å‘<strong>å¾ªç¯ä¾èµ–</strong>ã€‚å»ºè®®å°†å¼‚æ­¥é€»è¾‘æå–åˆ°ç‹¬ç«‹æ–‡ä»¶ä¸­ã€‚</p><ul><li><code>src/features/counter/counterThunks.js</code>: å®šä¹‰å¼‚æ­¥æ“ä½œã€‚</li><li><code>src/features/counter/counterSlice.js</code>: å¼•å…¥å¹¶å¤„ç†çŠ¶æ€ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterThunks.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å½“å¤©æ—¥æœŸçš„å†å²æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHistory = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/getHistory&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (params) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://jsonplaceholder.typicode.com/posts&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="2-èŒè´£å•ä¸€ä¸ç²¾ç»†åŒ–é”™è¯¯å¤„ç†"><a href="#2-èŒè´£å•ä¸€ä¸ç²¾ç»†åŒ–é”™è¯¯å¤„ç†" class="headerlink" title="2. èŒè´£å•ä¸€ä¸ç²¾ç»†åŒ–é”™è¯¯å¤„ç†"></a><strong><font color="#10c300">2. èŒè´£å•ä¸€ä¸ç²¾ç»†åŒ–é”™è¯¯å¤„ç†</font></strong></h4><ul><li><strong>èŒè´£å•ä¸€</strong>ï¼šThunk åªè´Ÿè´£â€œæ‹¿æ•°æ®â€ã€‚å¤æ‚çš„æ•°æ®è½¬æ¢é€»è¾‘åº”æ”¾åœ¨ <code>reducer</code> ä¸­ï¼Œä¿æŒ Thunk æ¸…æ´ã€‚</li><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šä½¿ç”¨ <code>rejectWithValue</code> è¿”å›è‡ªå®šä¹‰é”™è¯¯è½½è·ï¼Œä»¥ä¾¿åœ¨ç•Œé¢ä¸Šå±•ç¤ºæ›´æœ‰æ„ä¹‰çš„æç¤ºã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å½“å¤©æ—¥æœŸçš„å†å²æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHistory = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/getHistory&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (params, &#123; rejectWithValue &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(</span><br><span class="line">        <span class="string">&quot;https://jsonplaceholder.typicode.com/posts&quot;</span>,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">rejectWithValue</span>(err.<span class="property">response</span>.<span class="property">data</span>); <span class="comment">// è¿”å›åç«¯é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="3-ä½¿ç”¨-addMatcher-å‡å°‘æ ·æ¿ä»£ç "><a href="#3-ä½¿ç”¨-addMatcher-å‡å°‘æ ·æ¿ä»£ç " class="headerlink" title="3. ä½¿ç”¨ addMatcher å‡å°‘æ ·æ¿ä»£ç "></a><strong><font color="#10c300">3. ä½¿ç”¨ addMatcher å‡å°‘æ ·æ¿ä»£ç </font></strong></h4><p>å¦‚æœå¤šä¸ªå¼‚æ­¥æ“ä½œéƒ½æœ‰ç›¸åŒçš„ Loading æˆ– Error å¤„ç†é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨ <code>addMatcher</code> è¿›è¡Œç»Ÿä¸€æ‹¦æˆªï¼Œé¿å…åœ¨æ¯ä¸ª <code>addCase</code> ä¸­é‡å¤ç¼–å†™ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterSlice.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getHistory &#125; <span class="keyword">from</span> <span class="string">&quot;../thunks/counterThunks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span>, <span class="comment">// åˆå§‹çŠ¶æ€è®¾ä¸º idle</span></span><br><span class="line">    <span class="attr">error</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">extraReducers</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> &#123;</span><br><span class="line">    builder</span><br><span class="line">      <span class="comment">// å¤„ç†å…·ä½“çš„æˆåŠŸé€»è¾‘</span></span><br><span class="line">      .<span class="title function_">addCase</span>(getHistory.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        state.<span class="property">value</span> = [];</span><br><span class="line">        state.<span class="property">value</span> = action.<span class="property">payload</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ addMatcher ç»Ÿä¸€å¤„ç†æ‰€æœ‰ pending çŠ¶æ€</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/pending&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;loading&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ addMatcher ç»Ÿä¸€å¤„ç†æ‰€æœ‰ fulfilled çŠ¶æ€ï¼ˆä»…æ›´æ–°çŠ¶æ€éƒ¨åˆ†ï¼‰</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/fulfilled&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ addMatcher ç»Ÿä¸€å¤„ç†æ‰€æœ‰ rejected çŠ¶æ€</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/rejected&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">          state.<span class="property">error</span> = action.<span class="property">error</span>.<span class="property">message</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure><p><code>addMatcher</code> åœ¨é¡¹ç›®åæœŸä¼˜åŒ–ä¸­éå¸¸å¼ºå¤§ï¼Œå®ƒå¯ä»¥è®©ä½ åƒå†™â€œæ‹¦æˆªå™¨â€ä¸€æ ·ç»Ÿä¸€ç®¡ç†å…¨å±€çš„å¼‚æ­¥çŠ¶æ€ã€‚</p><br><h3 id="2-3-ç»¼åˆæ¡ˆä¾‹"><a href="#2-3-ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="2.3 ç»¼åˆæ¡ˆä¾‹"></a><strong><font color="red">2.3 ç»¼åˆæ¡ˆä¾‹</font></strong></h3><p>å®šä¹‰å¼‚æ­¥æ“ä½œ<code>src\redux\modules\counterThunks.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å½“å¤©æ—¥æœŸçš„å†å²æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHistory = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/getHistory&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (params, &#123; rejectWithValue &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;/posts&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">rejectWithValue</span>(err.<span class="property">response</span>.<span class="property">data</span>); <span class="comment">// è¿”å›åç«¯é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è¯„è®ºæ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getComments = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;counter/getComments&quot;</span>,</span><br><span class="line">  <span class="title function_">async</span> (postId, &#123; rejectWithValue &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/comments?postId=<span class="subst">$&#123;postId&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">rejectWithValue</span>(err.<span class="property">response</span>.<span class="property">data</span>); <span class="comment">// è¿”å›åç«¯é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å¼•å…¥å¹¶å¤„ç†çŠ¶æ€<code>src\redux\modules\counterSlice.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getHistory, getComments &#125; <span class="keyword">from</span> <span class="string">&quot;./counterThunks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;idle&quot;</span>, <span class="comment">// åˆå§‹çŠ¶æ€è®¾ä¸º idle</span></span><br><span class="line">    <span class="attr">value</span>: [],</span><br><span class="line">    <span class="attr">comments</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">extraReducers</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> &#123;</span><br><span class="line">    builder</span><br><span class="line">      <span class="comment">// å¤„ç†å…·ä½“çš„æˆåŠŸé€»è¾‘</span></span><br><span class="line">      .<span class="title function_">addCase</span>(getHistory.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        state.<span class="property">value</span> = action.<span class="property">payload</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">addCase</span>(getComments.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å‡è®¾è¯„è®ºæ•°æ®å­˜æ”¾åœ¨å¦ä¸€ä¸ªå­—æ®µ</span></span><br><span class="line">        state.<span class="property">value</span> = [];</span><br><span class="line">        state.<span class="property">comments</span> = action.<span class="property">payload</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ addMatcher ç»Ÿä¸€å¤„ç†æ‰€æœ‰ pending çŠ¶æ€</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/pending&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;loading&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ addMatcher ç»Ÿä¸€å¤„ç†æ‰€æœ‰ fulfilled çŠ¶æ€ï¼ˆä»…æ›´æ–°çŠ¶æ€éƒ¨åˆ†ï¼‰</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/fulfilled&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ addMatcher ç»Ÿä¸€å¤„ç†æ‰€æœ‰ rejected çŠ¶æ€</span></span><br><span class="line">      .<span class="title function_">addMatcher</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span> action.<span class="property">type</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;/rejected&quot;</span>),</span><br><span class="line">        <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">status</span> = <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure><p>ç»„ä»¶ä¸­ä½¿ç”¨<code>src\pages\Home.jsx</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getHistory, getComments &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/modules/counterThunks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; value, status, comments &#125; = <span class="title function_">useSelector</span>(</span><br><span class="line">    <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counterSlice</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(getHistory(&#123; count: &quot;5&quot; &#125;))&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        æ•°æ®è¯·æ±‚</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(getComments(1))&#125;&gt;è·å–è¯„è®º<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        çŠ¶æ€ï¼š</span></span><br><span class="line"><span class="language-xml">        &#123;status === &quot;loading&quot;</span></span><br><span class="line"><span class="language-xml">          ? &quot;åŠ è½½ä¸­...&quot;</span></span><br><span class="line"><span class="language-xml">          : status === &quot;idle&quot;</span></span><br><span class="line"><span class="language-xml">            ? &quot;ç©ºé—²&quot;</span></span><br><span class="line"><span class="language-xml">            : &quot;å¤±è´¥&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;value.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;comments.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><br><h3 id="2-4-è®°å¿†åŒ–é€‰æ‹©å™¨ï¼šcreateSelector"><a href="#2-4-è®°å¿†åŒ–é€‰æ‹©å™¨ï¼šcreateSelector" class="headerlink" title="2.4 è®°å¿†åŒ–é€‰æ‹©å™¨ï¼šcreateSelector"></a><strong><font color="red">2.4 è®°å¿†åŒ–é€‰æ‹©å™¨ï¼šcreateSelector</font></strong></h3><p>åœ¨å¤§å‹åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ ¹æ®åŸå§‹æ•°æ®è®¡ç®—å‡ºè¡ç”ŸçŠ¶æ€ï¼ˆå¦‚ï¼šåˆ—è¡¨è¿‡æ»¤ã€æ•°æ®è½¬æ¢ï¼‰ã€‚å¦‚æœç›´æ¥åœ¨ <code>useSelector</code> ä¸­ç¼–å†™å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚</p><h4 id="1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ"><a href="#1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ" class="headerlink" title="1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ"></a><strong><font color="#10c300">1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</font></strong></h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦ Redux Store æ›´æ–°ï¼Œæ‰€æœ‰çš„ <code>useSelector</code> éƒ½ä¼šé‡æ–°è¿è¡Œã€‚å¦‚æœä½ çš„ Selector è¿”å›çš„æ˜¯ä¸€ä¸ª<strong>æ–°å¼•ç”¨</strong>ï¼ˆä¾‹å¦‚ä½¿ç”¨ <code>.filter()</code>ã€<code>.map()</code> æˆ–è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼‰ï¼ŒReact Redux ä¼šè®¤ä¸ºæ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œä»è€Œè§¦å‘ç»„ä»¶é‡æ¸²æŸ“â€”â€”å³ä½¿æ•°æ®å†…å®¹å…¶å®æ²¡å˜ã€‚</p><p><code>createSelector</code> å¯ä»¥**è®°å¿†ï¼ˆMemoizeï¼‰**è®¡ç®—ç»“æœã€‚åªè¦è¾“å…¥å‚æ•°æ²¡å˜ï¼Œå®ƒå°±ä¼šç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœï¼Œä¸ä¼šé‡æ–°è®¡ç®—ï¼Œä¹Ÿä¸ä¼šè§¦å‘é‡æ¸²æŸ“ã€‚</p><h4 id="2ï¼‰åŸºæœ¬ç”¨æ³•ï¼šæ•°æ®é¢„å¤„ç†"><a href="#2ï¼‰åŸºæœ¬ç”¨æ³•ï¼šæ•°æ®é¢„å¤„ç†" class="headerlink" title="2ï¼‰åŸºæœ¬ç”¨æ³•ï¼šæ•°æ®é¢„å¤„ç†"></a><strong><font color="#10c300">2ï¼‰åŸºæœ¬ç”¨æ³•ï¼šæ•°æ®é¢„å¤„ç†</font></strong></h4><p>å‡è®¾åç«¯æ¥å£è¿”å›çš„ç”¨æˆ·ä¿¡æ¯ä¸­ï¼Œæ€§åˆ«æ˜¯æ•°å­—ä»£ç ï¼ˆ1 ä»£è¡¨ç”·ï¼Œ2 ä»£è¡¨å¥³ï¼‰ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ç»„ä»¶ä¸­ç›´æ¥æ‹¿åˆ°æ–‡å­—ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice, createSelector &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">hobby</span>: [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;çœ‹ä¹¦&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;å†™ä»£ç &quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;æ‰“æ¸¸æˆ&quot;</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">genderFn</span> = (<span class="params">state</span>) =&gt; state.<span class="property">user</span>.<span class="property">gender</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hobbyFn</span> = (<span class="params">state</span>) =&gt; state.<span class="property">user</span>.<span class="property">hobby</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªæœ‰ gender æˆ– hobby å˜åŒ–æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œä¸‹é¢é€»è¾‘</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> selectUser = <span class="title function_">createSelector</span>(</span><br><span class="line">  [genderFn, hobbyFn],</span><br><span class="line">  <span class="function">(<span class="params">gender, hobby</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ­£åœ¨è½¬æ¢æ•°æ®...&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> genderText = gender === <span class="string">&quot;1&quot;</span> ? <span class="string">&quot;ç”·&quot;</span> : <span class="string">&quot;å¥³&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">gender</span>: genderText,</span><br><span class="line">      <span class="attr">hobbyList</span>: hobby.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === <span class="number">1</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; selectUser &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/modules/userSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; gender, hobbyList &#125; = <span class="title function_">useSelector</span>(selectUser);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ€§åˆ«ï¼š&#123;gender&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span> // ç›´æ¥ä½¿ç”¨å¤„ç†å¥½çš„å±æ€§</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>çˆ±å¥½ï¼š<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;hobbyList.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><h4 id="3ï¼‰ä¼ å‚çš„æ ‡å‡†å†™æ³•"><a href="#3ï¼‰ä¼ å‚çš„æ ‡å‡†å†™æ³•" class="headerlink" title="3ï¼‰ä¼ å‚çš„æ ‡å‡†å†™æ³•"></a><strong><font color="#10c300">3ï¼‰ä¼ å‚çš„æ ‡å‡†å†™æ³•</font></strong></h4><p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ ¹æ®ç»„ä»¶ä¼ å…¥çš„å‚æ•°ï¼ˆå¦‚ IDï¼‰æ¥åŠ¨æ€æŸ¥è¯¢æ•°æ®ã€‚<strong>æ ‡å‡†åšæ³•æ˜¯å°†å‚æ•°ä½œä¸º Selector çš„ä¸€ä¸ªè¾“å…¥é¡¹ã€‚</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.1 å®šä¹‰è·å–å‚æ•°çš„é€‰æ‹©å™¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">selectItemId</span> = (<span class="params">state, itemId</span>) =&gt; itemId;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.2 åœ¨ createSelector ä¸­å¼•ç”¨è¯¥å‚æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> selectItemById = <span class="title function_">createSelector</span>(</span><br><span class="line">  [<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>.<span class="property">hobby</span>, selectItemId], <span class="comment">// è·å–å¤–éƒ¨ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">  <span class="function">(<span class="params">hobby, id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ id å°±æ˜¯ä¸Šé¢è·å–å‚æ•°é€‰æ‹©å™¨å¯¹åº”çš„ id</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ­£åœ¨æŸ¥æ‰¾ ID ä¸º <span class="subst">$&#123;id&#125;</span> çš„æ•°æ®...`</span>);</span><br><span class="line">    <span class="keyword">return</span> hobby.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === id);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ é€’å‚æ•°ï¼šuseSelector((state) =&gt; selector(state, param))</span></span><br><span class="line"><span class="keyword">const</span> item = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> <span class="title function_">selectItemById</span>(state, props.<span class="property">id</span>));</span><br></pre></td></tr></table></figure><h4 id="4ï¼‰é«˜çº§ç”¨æ³•ï¼šå·¥å‚å‡½æ•°æ¨¡å¼-Factory-Function"><a href="#4ï¼‰é«˜çº§ç”¨æ³•ï¼šå·¥å‚å‡½æ•°æ¨¡å¼-Factory-Function" class="headerlink" title="4ï¼‰é«˜çº§ç”¨æ³•ï¼šå·¥å‚å‡½æ•°æ¨¡å¼ (Factory Function)"></a><strong><font color="#10c300">4ï¼‰é«˜çº§ç”¨æ³•ï¼šå·¥å‚å‡½æ•°æ¨¡å¼ (Factory Function)</font></strong></h4><p>è™½ç„¶ä¸Šè¿°ä¼ å‚æ–¹å¼åœ¨é€»è¾‘ä¸Šæ˜¯é€šç”¨çš„ï¼Œä½†åœ¨ <strong>â€œä¸€ä¸ªé¡µé¢æ¸²æŸ“å¤šä¸ªåŒç±»ç»„ä»¶â€</strong> æ—¶ï¼Œå•ä¾‹ Selector çš„ç¼“å­˜æ·±åº¦åªæœ‰ 1ï¼Œä¼šå¯¼è‡´ä¸åŒç»„ä»¶å®ä¾‹ä¹‹é—´äº’ç›¸ç«äº‰ç¼“å­˜ï¼Œäº§ç”Ÿä¸å¿…è¦çš„é‡è®¡ç®—ã€‚è¿™æ—¶éœ€è¦ä½¿ç”¨å·¥å‚å‡½æ•°ã€‚</p><p><strong>æ ‡å‡†å·¥å‚æ¨¡å¼å†™æ³•ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å·¥å‚å‡½æ•°ï¼šæ¯æ¬¡è°ƒç”¨éƒ½è¿”å›ä¸€ä¸ªâ€œå…¨æ–°ä¸”ç‹¬ç«‹â€çš„ Selector å®ä¾‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">makeSelectTodoById</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="title function_">createSelector</span>(</span><br><span class="line">    [</span><br><span class="line">      <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">todos</span>.<span class="property">list</span>,</span><br><span class="line">      <span class="function">(<span class="params">state, todoId</span>) =&gt;</span> todoId, <span class="comment">// åŠ¨æ€æ’æ§½æå–å‚æ•°</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="function">(<span class="params">todos, id</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å®ä¾‹æ­£åœ¨æŸ¥æ‰¾ ID ä¸º <span class="subst">$&#123;id&#125;</span> çš„å¾…åŠäº‹é¡¹...`</span>);</span><br><span class="line">      <span class="keyword">return</span> todos.<span class="title function_">find</span>(<span class="function">(<span class="params">todo</span>) =&gt;</span> todo.<span class="property">id</span> === id);</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ğŸ’¡ æ·±åº¦æ¢è®¨ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥å†™æˆ makeSelectTodoById(id) ?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * âŒ é”™è¯¯å†™æ³•ï¼šconst make = (id) =&gt; createSelector(...)</span></span><br><span class="line"><span class="comment"> * åŸå› ï¼šè¿™ä¼šå¯¼è‡´è¯¥å®ä¾‹è¢«â€œé”æ­»â€åœ¨ç‰¹å®š ID ä¸Šï¼Œä¸§å¤±äº†ä½œä¸ºé€‰æ‹©å™¨å·¥å…·çš„é€šç”¨æ€§å’Œçµæ´»æ€§ã€‚</span></span><br><span class="line"><span class="comment"> * æ­£ç¡®å†™æ³•ï¼šå®ä¾‹åº”è¯¥æ˜¯é€šç”¨çš„æ’æ§½ï¼Œå…·ä½“çš„ ID åœ¨ç»„ä»¶ useSelector æ—¶åŠ¨æ€ä¼ å…¥ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><strong>åœ¨ç»„ä»¶ä¸­æ­£ç¡®è°ƒç”¨ï¼š</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodoItem</span>(<span class="params">&#123; id &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. ä½¿ç”¨ useMemo ç¡®ä¿ Selector å®ä¾‹åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒå”¯ä¸€</span></span><br><span class="line">  <span class="keyword">const</span> selectTodoById = <span class="title function_">useMemo</span>(makeSelectTodoById, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. åŠ¨æ€ä¼ å‚ï¼šä¸ºè¯¥ç»„ä»¶ä¸“å±çš„å®ä¾‹æ³¨å…¥å½“å‰ id</span></span><br><span class="line">  <span class="keyword">const</span> todo = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> <span class="title function_">selectTodoById</span>(state, id));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;todo?.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5ï¼‰æœ€ä½³å®è·µæ€»ç»“"><a href="#5ï¼‰æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="5ï¼‰æœ€ä½³å®è·µæ€»ç»“"></a><strong><font color="#10c300">5ï¼‰æœ€ä½³å®è·µæ€»ç»“</font></strong></h4><ul><li><strong>ä½ç½®</strong>ï¼šå°½é‡åœ¨å¯¹åº”çš„ <code>Slice</code> æ–‡ä»¶ä¸­å®šä¹‰ Selectorï¼Œä¿æŒé€»è¾‘å†…èšã€‚</li><li><strong>èŒè´£</strong>ï¼šå°†â€œåŸå§‹æ•°æ®è·å–â€ä¸â€œæ•°æ®é¢„å¤„ç†â€åˆ†å¼€è°ƒç”¨ã€‚</li><li><strong>æ€§èƒ½</strong>ï¼šä¸è¦åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨ <code>createSelector</code>ï¼ˆæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºæ–°å®ä¾‹ï¼‰ï¼Œåº”åœ¨ç»„ä»¶å¤–éƒ¨å®šä¹‰ã€‚</li></ul><h3 id="2-5-Redux-DevTools"><a href="#2-5-Redux-DevTools" class="headerlink" title="2.5 Redux DevTools"></a><strong><font color="red">2.5 Redux DevTools</font></strong></h3><p>Redux æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯è°ƒè¯•ä½“éªŒã€‚</p><ul><li>å®‰è£… Chrome æ‰©å±•ç¨‹åº <strong>Redux DevTools</strong>ã€‚</li><li>RTK çš„ <code>configureStore</code> é»˜è®¤å¼€å¯ DevToolsã€‚</li><li>ä½ å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ª Action çš„è§¦å‘æ—¶é—´ã€Payload å†…å®¹ä»¥åŠ State çš„å·®å¼‚ (Diff)ã€‚</li><li><strong>æ—¶é—´æ—…è¡Œ (Time Travel)</strong>ï¼šä½ å¯ä»¥ç‚¹å‡» â€œJumpâ€ è·³è½¬åˆ°ä»»æ„å†å²çŠ¶æ€ï¼Œé‡ç° Bug ç°åœºã€‚</li></ul><hr><br><h2 id="ä¸‰ã€é«˜çº§ç¯‡ï¼šRTK-Query-ä¸æ€§èƒ½ä¼˜åŒ–"><a href="#ä¸‰ã€é«˜çº§ç¯‡ï¼šRTK-Query-ä¸æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ä¸‰ã€é«˜çº§ç¯‡ï¼šRTK Query ä¸æ€§èƒ½ä¼˜åŒ–"></a><strong>ä¸‰ã€é«˜çº§ç¯‡ï¼šRTK Query ä¸æ€§èƒ½ä¼˜åŒ–</strong></h2><p>RTK Query (RTKQ) æ˜¯ RTK å†…ç½®çš„ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®è·å–å’Œç¼“å­˜å·¥å…·ã€‚å®ƒä¸ä»…å¸®ä½ å‘è¯·æ±‚ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯å®ƒèƒ½<strong>è‡ªåŠ¨ç®¡ç†ç¼“å­˜çŠ¶æ€</strong>ã€‚</p><blockquote><p>[!NOTE]<br><strong>ä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Ÿ</strong><br>åœ¨æ²¡æœ‰ RTKQ ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼šè¯·æ±‚åŠ è½½çŠ¶æ€ (<code>isLoading</code>)ã€é”™è¯¯å¤„ç† (<code>error</code>)ã€<code>useEffect</code> ä¸­çš„è¯·æ±‚è§¦å‘ã€ä»¥åŠæœ€å¤´ç–¼çš„â€œè·¨é¡µé¢åŒæ­¥ç¼“å­˜æ•°æ®â€ã€‚RTKQ æŠŠè¿™äº›éƒ½è‡ªåŠ¨å®Œæˆäº†ã€‚</p></blockquote><h3 id="3-1-åŸºç¡€ç”¨æ³•"><a href="#3-1-åŸºç¡€ç”¨æ³•" class="headerlink" title="3.1 åŸºç¡€ç”¨æ³•"></a><strong><font color="red">3.1 åŸºç¡€ç”¨æ³•</font></strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`æ­¥éª¤ä¸€ï¼šåˆ›å»ºapiæ¥å£`</span>;</span><br><span class="line"><span class="comment">// src\redux\api\todoApi.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApi, fetchBaseQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit/query/react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> todoApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">  <span class="comment">// å¯¼å‡ºä¾› Store ä¸­é—´ä»¶ä½¿ç”¨</span></span><br><span class="line">  <span class="attr">reducerPath</span>: <span class="string">&quot;createApi&quot;</span>, <span class="comment">// åœ¨ store ä¸­çš„ key</span></span><br><span class="line">  <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&quot;/api&quot;</span> &#125;), <span class="comment">//é…ç½®åŸºç¡€è·¯å¾„</span></span><br><span class="line">  <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// é…ç½®è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">      <span class="comment">//é»˜è®¤æ„å»ºçš„æ˜¯getè¯·æ±‚</span></span><br><span class="line">      <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>, <span class="comment">// å®é™…è¯·æ±‚çš„è·¯å¾„</span></span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(todoApi);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç”Ÿæˆ hooks ä¾›ç»„ä»¶ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetTodosQuery &#125; = todoApi;</span><br><span class="line"></span><br><span class="line"><span class="string">`æ­¥éª¤äºŒï¼šé…ç½® Store ä¸­é—´ä»¶`</span>;</span><br><span class="line"><span class="comment">// src\redux\store.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; todoApi &#125; <span class="keyword">from</span> <span class="string">&quot;./api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»æ·»åŠ  api çš„ reducer</span></span><br><span class="line">    [todoApi.<span class="property">reducerPath</span>]: todoApi.<span class="property">reducer</span>,</span><br><span class="line">    [xxxx.<span class="property">reducerPath</span>]: xxxx.<span class="property">reducer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å¿…é¡»æ·»åŠ  api çš„ä¸­é—´ä»¶ï¼Œç”¨äºå¯ç”¨ç¼“å­˜ã€è½®è¯¢ã€å¤±æ•ˆç­‰åŠŸèƒ½</span></span><br><span class="line">  <span class="attr">middleware</span>: <span class="function">(<span class="params">gDM</span>) =&gt;</span></span><br><span class="line">    <span class="comment">// å¤šå‚æ•°å†™æ³•ï¼ˆæ¨èï¼Œæ›´æ•´æ´ï¼‰</span></span><br><span class="line">    <span class="title function_">gDM</span>().<span class="title function_">concat</span>(todoApi.<span class="property">middleware</span>, xxxx.<span class="property">middleware</span>),</span><br><span class="line">  <span class="comment">// é“¾å¼è°ƒç”¨å†™æ³•</span></span><br><span class="line">  <span class="comment">// gDM().concat(todoApi.middleware).concat(xxxx.middleware)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="string">`æ­¥éª¤ä¸‰ï¼šç»„ä»¶ä¸­ä½¿ç”¨ Hooks`</span>;</span><br><span class="line"><span class="comment">// src\pages\Home.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useGetTodosQuery &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, isLoading, error &#125; = <span class="title function_">useGetTodosQuery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isLoading &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>åŠ è½½ä¸­...<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;error &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>åŠ è½½å¤±è´¥<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;data &amp;&amp; data.map((todo) =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.title&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><h3 id="3-2-RTK-Query-æ ¸å¿ƒæ¦‚å¿µè¯¦è§£"><a href="#3-2-RTK-Query-æ ¸å¿ƒæ¦‚å¿µè¯¦è§£" class="headerlink" title="3.2 RTK Query æ ¸å¿ƒæ¦‚å¿µè¯¦è§£"></a><strong><font color="red">3.2 RTK Query æ ¸å¿ƒæ¦‚å¿µè¯¦è§£</font></strong></h3><h4 id="1ï¼‰è·å–æ•°æ®ï¼šQuery-æŸ¥è¯¢æ“ä½œ"><a href="#1ï¼‰è·å–æ•°æ®ï¼šQuery-æŸ¥è¯¢æ“ä½œ" class="headerlink" title="1ï¼‰è·å–æ•°æ®ï¼šQuery (æŸ¥è¯¢æ“ä½œ)"></a><strong><font color="#10c300">1ï¼‰è·å–æ•°æ®ï¼šQuery (æŸ¥è¯¢æ“ä½œ)</font></strong></h4><p>Query æ˜¯ RTK Query ä¸­æœ€åŸºç¡€çš„æ•°æ®è·å–æ–¹å¼ï¼Œä¸»è¦ç”¨äºä»æœåŠ¡å™¨ç«¯æ‹‰å–çŠ¶æ€å¹¶ç¼“å­˜åœ¨æœ¬åœ°ã€‚</p><p><strong>ç‰¹ç‚¹ä¸ç”¨æ³•ï¼š</strong></p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹åº”çš„ <code>useXXXQuery</code> Hook åœ¨ç»„ä»¶æŒ‚è½½æ—¶ä¼š<strong>è‡ªåŠ¨å‘èµ·è¯·æ±‚</strong>ã€‚</li><li>å®ƒè¿”å›ä¸€ä¸ªåŒ…å« <code>data</code> (æ•°æ®), <code>isLoading</code> (åˆæ¬¡åŠ è½½çŠ¶æ€), <code>isFetching</code> (æ¯æ¬¡è¯·æ±‚çŠ¶æ€), <code>error</code> (é”™è¯¯ä¿¡æ¯) ç­‰ä¸°å¯Œå±æ€§çš„å¯¹è±¡ã€‚</li><li>ç»å¤§å¤šæ•° Query æ˜¯ <code>GET</code> è¯·æ±‚ï¼Œä½†æœ‰äº›ç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚å¤æ‚çš„æœç´¢æŸ¥è¯¢éœ€è¦ä¼ é€’å¤§é‡å‚æ•°ä½“ï¼‰ä¹Ÿä¼šä½¿ç”¨ <code>POST</code> è¯·æ±‚ä½œä¸º Queryã€‚</li></ul><p><strong>ä»£ç ç¤ºä¾‹æ‹†è§£ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ todoApi.js ä¸­å®šä¹‰</span></span><br><span class="line"><span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="comment">// åŸºç¡€ç”¨æ³•ï¼šé»˜è®¤å‘æ— å‚çš„ GET è¯·æ±‚</span></span><br><span class="line">  <span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¸¦å‚ GET è¯·æ±‚ (å¦‚ï¼š/todos?status=completed)</span></span><br><span class="line">  <span class="attr">getTodosByStatus</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="function">(<span class="params">status</span>) =&gt;</span> <span class="string">`/todos?status=<span class="subst">$&#123;status&#125;</span>`</span>,</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç‰¹æ®Šç”¨æ³•ï¼šä½¿ç”¨ POST è¿›è¡Œå¤æ‚çš„æŸ¥è¯¢</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šè™½ç„¶æ˜¯å‘é€ POSTï¼Œä½†å› ä¸ºæ˜¯&quot;è·å–æŸ¥çœ‹&quot;æ•°æ®è€Œä¸æ˜¯&quot;ä¿®æ”¹&quot;ç³»ç»ŸçŠ¶æ€ï¼Œæ‰€ä»¥ä¾ç„¶ç”¨ builder.query</span></span><br><span class="line"><span class="attr">getTodosById</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/posts&quot;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">body</span>: &#123; <span class="attr">postId</span>: id &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetTodosQuery, useGetTodosByStatusQuery, useGetTodosByIdQuery &#125; = todoApi;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">`ç»„ä»¶ä¸­ä½¿ç”¨`</span></span><br><span class="line"><span class="comment">// 1. æ— å‚ GET ç”¨æ³•ï¼šç»„ä»¶ä¸€æŒ‚è½½å°±è‡ªåŠ¨å‘è¯·æ±‚æ‹‰åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: allTodos, isLoading &#125; = <span class="title function_">useGetTodosQuery</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å¸¦å‚ GET ç”¨æ³•ï¼šå‚æ•°å¦‚æœå˜åŒ–ï¼ŒRTK Query ä¼šè‡ªåŠ¨å‘æ–°è¯·æ±‚</span></span><br><span class="line"><span class="keyword">const</span> [status, setStatus] = <span class="title function_">useState</span>(<span class="string">&quot;completed&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: filteredTodos &#125; = <span class="title function_">useGetTodosByStatusQuery</span>(status);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. POST æŸ¥è¯¢ç”¨æ³•ï¼šå°†å¤æ‚çš„æ£€ç´¢æ¡ä»¶(å¦‚åŒ…å«å„ç§è¿‡æ»¤é¡¹çš„å¯¹è±¡)ä¼ é€’è¿‡å»</span></span><br><span class="line"><span class="keyword">const</span> searchFilters = &#123; <span class="attr">keyword</span>: <span class="string">&quot;React&quot;</span>, <span class="attr">date</span>: <span class="string">&quot;today&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: searchResults, isFetching &#125; = <span class="title function_">useGetTodosByIdQuery</span>(searchFilters);</span><br></pre></td></tr></table></figure><br><h4 id="2ï¼‰ä¿®æ”¹æ•°æ®ï¼šMutation-å˜æ›´æ“ä½œ"><a href="#2ï¼‰ä¿®æ”¹æ•°æ®ï¼šMutation-å˜æ›´æ“ä½œ" class="headerlink" title="2ï¼‰ä¿®æ”¹æ•°æ®ï¼šMutation (å˜æ›´æ“ä½œ)"></a><strong><font color="#10c300">2ï¼‰ä¿®æ”¹æ•°æ®ï¼šMutation (å˜æ›´æ“ä½œ)</font></strong></h4><p>åœ¨ RTK Query ä¸­ï¼Œæ‰€æœ‰çš„ API ç«¯ç‚¹ (endpoints) åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><strong>Query (æŸ¥è¯¢)</strong>ï¼šç”¨äºè·å–æ•°æ®ï¼Œåœ¨ç»„ä»¶æŒ‚è½½æ—¶è‡ªåŠ¨è§¦å‘ï¼ˆå¦‚ GET è¯·æ±‚ï¼‰ã€‚å¯¹åº”çš„ Hook å« <code>useXXXQuery</code>ã€‚</li><li><strong>Mutation (å˜æ›´)</strong>ï¼šç”¨äºä¿®æ”¹æœåŠ¡å™¨æ•°æ®ï¼ˆå¦‚ POSTã€PUTã€DELETE è¯·æ±‚ï¼‰ã€‚å¯¹åº”çš„ Hook å« <code>useXXXMutation</code>ã€‚</li></ul><p><strong>ç‰¹ç‚¹ä¸ç”¨æ³•ï¼š</strong></p><ul><li><code>mutation</code> <strong>ä¸ä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶è‡ªåŠ¨è§¦å‘</strong>ã€‚å®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼š<code>[è§¦å‘å‡½æ•°çš„å¼•ç”¨ (trigger), åŒ…å«çŠ¶æ€çš„å¯¹è±¡ (result)]</code>ã€‚</li><li>å®ƒé€šå¸¸ç»‘å®šåˆ°è¡¨å•æäº¤æˆ–æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸Šã€‚</li></ul><p><strong>ä»£ç ç¤ºä¾‹æ‹†è§£ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ todoApi.js ä¸­å®šä¹‰</span></span><br><span class="line"><span class="attr">addTodo</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">  <span class="comment">// query æ¥æ”¶è°ƒç”¨è§¦å‘å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•° (newTodo)</span></span><br><span class="line">  <span class="attr">query</span>: <span class="function">(<span class="params">newTodo</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>, <span class="comment">// æ˜ç¡®æŒ‡å®šæ˜¯å‘é€ POST è¯·æ±‚</span></span><br><span class="line">    <span class="attr">body</span>: newTodo, <span class="comment">// å‘é€ç»™åç«¯çš„è¯·æ±‚ä½“æ•°æ®</span></span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="attr">addUser</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="function">(<span class="params">user</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/users&quot;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">body</span>: user</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useAddUserMutation &#125; = todoApi;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">`ç»„ä»¶ä¸­ä½¿ç”¨`</span></span><br><span class="line"><span class="keyword">import</span> &#123; useAddUserMutation &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [addUser, &#123; <span class="attr">isLoading</span>: addUserLoading, <span class="attr">isSuccess</span>: addUserSuccess, <span class="attr">error</span>: addUserError &#125;] = <span class="title function_">useAddUserMutation</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fn</span> = <span class="keyword">async</span>(<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">addUser</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;fn&#125;</span>&gt;</span>æ·»åŠ ç”¨æˆ·<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;addUserLoading &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ·»åŠ ä¸­...<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;addUserSuccess &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ·»åŠ æˆåŠŸ<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;addUserError &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ·»åŠ å¤±è´¥<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h4 id="4ï¼‰æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢ï¼šuseLazyXXXQuery"><a href="#4ï¼‰æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢ï¼šuseLazyXXXQuery" class="headerlink" title="4ï¼‰æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢ï¼šuseLazyXXXQuery"></a><strong><font color="#10c300">4ï¼‰æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢ï¼šuseLazyXXXQuery</font></strong></h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>useXXXQuery</code> åœ¨ç»„ä»¶æŒ‚è½½æ—¶å°±ä¼š<strong>ç«‹å³ã€è‡ªåŠ¨</strong>å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚ä½†åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ˆä¾‹å¦‚ï¼šç‚¹å‡»æŒ‰é’®æœç´¢ã€å±•å¼€é¢æ¿æ—¶æ‰åŠ è½½è¯¦æƒ…ï¼‰ï¼Œæˆ‘ä»¬å¸Œæœ›<strong>æ‰‹åŠ¨</strong>å»è§¦å‘è¿™ä¸ª GET è¯·æ±‚ã€‚è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°æ‡’åŠ è½½é’©å­ <code>useLazyXXXQuery</code>ã€‚</p><p><strong>ç‰¹ç‚¹ä¸ç”¨æ³•ï¼š</strong></p><ul><li>ç±»ä¼¼äº Mutation çš„ Hook è®¾è®¡ï¼Œå®ƒè¿”å›ä¸€ä¸ªæ•°ç»„ <code>[è§¦å‘å‡½æ•°(trigger), æŸ¥è¯¢çŠ¶æ€ç»“æœ(result)]</code>ã€‚</li><li>ä¸ä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶è‡ªåŠ¨å‘é€è¯·æ±‚ã€‚</li><li>å½“ä½ éœ€è¦å‘é€è¯·æ±‚æ—¶ï¼Œè°ƒç”¨è§¦å‘å‡½æ•°ï¼Œå¹¶å¯ä»¥ä¼ é€’æŸ¥è¯¢å‚æ•°ã€‚</li></ul><p><strong>ä»£ç ç¤ºä¾‹æ‹†è§£ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„å¯¼å‡ºåå­—çš„å˜åŒ–ï¼šä» todoApi è‡ªåŠ¨ç”Ÿæˆçš„ hooks ä¼šæœ‰ä¸€ä¸ª `useLazy` å¼€å¤´çš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">import</span> &#123; useLazyGetTodosQuery &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è¿”å›æ•°ç»„ï¼šç¬¬ä¸€ä¸ªæ˜¯æ‰‹åŠ¨å‘è¯·æ±‚çš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯åŒ…å«è¯·æ±‚ç»“æœå’ŒçŠ¶æ€çš„å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> [triggerGetTodos, &#123; data, isLoading, isFetching &#125;] = <span class="title function_">useLazyGetTodosQuery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleSearch</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæ‰æ‰‹åŠ¨è§¦å‘ç½‘ç»œè¯·æ±‚</span></span><br><span class="line">    <span class="title function_">triggerGetTodos</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleSearch&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;isLoading || isFetching ? &quot;åŠ è½½ä¸­...&quot; : &quot;ç‚¹å‡»åŠ è½½åˆ—è¡¨&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;data &amp;&amp; data.map((todo) =&gt; <span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.title&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h4 id="4ï¼‰æ•°æ®è½¬æ¢ï¼štransformResponse"><a href="#4ï¼‰æ•°æ®è½¬æ¢ï¼štransformResponse" class="headerlink" title="4ï¼‰æ•°æ®è½¬æ¢ï¼štransformResponse"></a><strong><font color="#10c300">4ï¼‰æ•°æ®è½¬æ¢ï¼štransformResponse</font></strong></h4><p>æœ‰æ—¶åç«¯è¿”å›çš„æ•°æ®æ ¼å¼å¹¶ä¸ç¬¦åˆå‰ç«¯çš„ä½¿ç”¨è¦æ±‚ï¼ˆæ¯”å¦‚å¤–é¢åŒ…è£¹äº†ä¸€å±‚ç‰¹å®šçš„ç»“æ„ï¼Œæˆ–è€…ç¼ºå°‘æŸä¸ªå­—æ®µï¼‰ã€‚<code>transformResponse</code> å…è®¸ä½ åœ¨æ•°æ®è¢«å­˜å…¥ Redux ç¼“å­˜ä¹‹å‰ï¼Œæå‰â€œæ‹¦æˆªâ€å¹¶è½¬æ¢å®ƒã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿ</strong><br>å°†å¤„ç†åç«¯â€œå¥‡è‘©â€æ•°æ®ç»“æ„çš„æ“ä½œé›†ä¸­åœ¨ API åˆ‡ç‰‡é‡Œï¼Œä¿æŒå‰ç«¯ç»„ä»¶çš„æ•°æ®é€»è¾‘çº¯ç²¹ã€‚è¿™æ ·èƒ½é¿å…ä½ åœ¨æ¯ä¸ªç»„ä»¶ <code>useSelector</code> è·å–æ•°æ®æ—¶éƒ½è¦åå¤å»å†™ <code>.map()</code> æˆ–è§£æ„ç‰¹å®šå­—æ®µã€‚</p><p><strong>ä»£ç ç¤ºä¾‹æ‹†è§£ï¼š</strong></p><p>å‡è®¾åç«¯è¿”å›çš„åˆ—è¡¨æ•°æ®é•¿è¿™æ ·ï¼š<br><code>&#123; code: 200, message: &quot;æˆåŠŸ&quot;, data: &#123; list: [ &#123;id:1, title:&quot;å†™ä»£ç &quot;&#125; ] &#125; &#125;</code></p><p>è€Œæˆ‘ä»¬åªæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥ä½¿ç”¨ <code>list</code> æ•°ç»„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">  <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">  <span class="comment">// è½¬æ¢å“åº”ç»“æœï¼ˆå°±åƒ axios çš„å“åº”æ‹¦æˆªå™¨ï¼‰</span></span><br><span class="line">  <span class="attr">transformResponse</span>: <span class="function">(<span class="params">response, meta, arg</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// response å°±æ˜¯åç«¯ç›´æ¥æŠ›å›æ¥çš„åŸå§‹ JSON å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬åªæŠŠæœ€æ ¸å¿ƒçš„ data.list return å‡ºå»</span></span><br><span class="line">    <span class="comment">// è¿™æ ·ç»„ä»¶é‡Œé€šè¿‡ useGetTodosQuery() è§£æ„å‡ºæ¥çš„ data å°±æ˜¯è¿™ä¸ªå¹²å‡€çš„æ•°ç»„ï¼</span></span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><h4 id="5ï¼‰ç¼“å­˜æ“ä½œï¼šprovidesTags-ä¸-invalidatesTags"><a href="#5ï¼‰ç¼“å­˜æ“ä½œï¼šprovidesTags-ä¸-invalidatesTags" class="headerlink" title="5ï¼‰ç¼“å­˜æ“ä½œï¼šprovidesTags ä¸ invalidatesTags"></a><strong><font color="#10c300">5ï¼‰ç¼“å­˜æ“ä½œï¼šprovidesTags ä¸ invalidatesTags</font></strong></h4><p>è¿™æ˜¯ RTK Query é¿å…æ‰‹åŠ¨å†™ <code>dispatch</code> æ¥åˆ·æ–°æ•°æ®çš„æ ¸å¿ƒâ€œé»‘ç§‘æŠ€â€ï¼šåŸºäºæ ‡ç­¾ (Tags) çš„è‡ªåŠ¨åŒ–ç¼“å­˜å¤±æ•ˆç³»ç»Ÿã€‚</p><p>æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ª**â€œè´´æ ‡ç­¾ä¸æ’•æ ‡ç­¾â€**çš„æ¸¸æˆï¼š</p><ul><li><strong><code>providesTags</code></strong>ï¼šç”¨æ¥**â€œè´´æ ‡ç­¾â€**ã€‚å‘Šè¯‰ RTKQï¼Œå½“å‰é€šè¿‡æŸ¥è¯¢è·å¾—å›æ¥çš„è¿™ä»½æ•°æ®ï¼Œå«ä»€ä¹ˆåå­—ã€‚</li><li><strong><code>invalidatesTags</code></strong>ï¼šç”¨æ¥**â€œæ’•æ ‡ç­¾â€** (å®£å‘Šå¤±æ•ˆ)ã€‚å½“æ‰§è¡Œå¢åˆ æ”¹ç­‰ mutating æ“ä½œåï¼Œå‘Šè¯‰ RTKQ å“ªäº›æ ‡ç­¾çš„æ•°æ®å·²ç»è¿‡æ—¶äº†ï¼Œå¿…é¡»é‡æ–°æ‹‰å–ã€‚</li></ul><p><strong>æ¡ˆä¾‹ç”ŸåŠ¨è§£æï¼š</strong></p><p><strong>ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢åˆ—è¡¨æ—¶è´´æ ‡ç­¾</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">  <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">  <span class="comment">// ç»™è¿™ä¸ªåˆ—è¡¨æ•°æ®è´´ä¸Šä¸€ä¸ªå« &quot;Todos&quot; çš„ç‰¹å®šæ ‡ç­¾ï¼ˆä¸”æŒ‡å®š id ä¸º &#x27;LIST&#x27; ä»£è¡¨æ•´ä¸ªåˆ—è¡¨ï¼‰</span></span><br><span class="line">  <span class="attr">providesTags</span>: [&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼ŒRTKQ å†…éƒ¨çš„è®°äº‹æœ¬ä¸Šå†™ç€ï¼š<em>â€œç”¨ <code>getTodos</code> è·å–çš„æ•°æ®ï¼Œè¢«è´´ä¸Šäº† <code>Todos-LIST</code> çš„æ ‡ç­¾ã€‚å¦‚æœä»¥åè°æ’•æ¯äº†è¿™ä¸ªæ ‡ç­¾ï¼Œæˆ‘å°±å¾—å†å‘ä¸€æ¬¡ <code>GET /todos</code> é‡æ–°æ‹¿æ•°æ®ã€‚â€</em></p><p><strong>ç¬¬äºŒæ­¥ï¼šæ·»åŠ æ•°æ®æ—¶æ’•æ ‡ç­¾</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">addTodo</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">  <span class="attr">query</span>: <span class="function">(<span class="params">newTodo</span>) =&gt;</span> (&#123; ... &#125;),</span><br><span class="line">  <span class="comment">// æ·»åŠ æˆåŠŸåï¼Œæ’•æ¯ &#x27;Todos&#x27; çš„ &#x27;LIST&#x27; æ ‡ç­¾</span></span><br><span class="line">  <span class="attr">invalidatesTags</span>: [&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å½“ä½ è°ƒç”¨ <code>addTodo</code> å¹¶åœ¨æœåŠ¡ç«¯åˆ›å»ºæˆåŠŸåï¼ŒRTKQ çœ‹åˆ°ä½ è¦â€œæ’•æ¯â€ <code>Todos-LIST</code> æ ‡ç­¾ã€‚å®ƒä¼šå»æ‰¾è®°äº‹æœ¬ï¼Œå‘ç° <code>getTodos</code> ç»‘å®šäº†è¿™ä¸ªæ ‡ç­¾æ•°æ®ï¼Œäºæ˜¯å®ƒä¼š<strong>è‡ªåŠ¨ä¸”é™é»˜åœ°</strong>åœ¨æ­¤åˆ»è§¦å‘ä¸€æ¬¡ <code>getTodos</code>ï¼Œå®ç°äº†å‰ç«¯åˆ—è¡¨çš„æ— ç¼è‡ªåŠ¨åˆ·æ–°ã€‚</p><blockquote><p>å¦‚æœè¦åšåˆ°æ›´ç»†èŠ‚ç²’åº¦çš„ç¼“å­˜æ§åˆ¶ï¼ˆæ¯”å¦‚åªä¿®æ”¹åˆ—è¡¨ä¸­æŸä¸€é¡¹çš„æ•°æ®ï¼Œä¸å…¨åˆ—è¡¨æ‹‰å–ï¼‰ï¼Œå¯ä»¥é€šè¿‡ç»™æ¯ä¸ªå…·ä½“çš„ item è´´å¸¦ <code>id</code> çš„æ ‡ç­¾ï¼ˆå¦‚ <code>&#123; type: &quot;Todos&quot;, id: todo.id &#125;</code>ï¼‰æ¥å®ç°ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å‰æ–‡åŸºç¡€ä»£ç é‡Œè¦å†™ <code>...result.map((&#123; id &#125;) =&gt; (&#123; type: &quot;Todos&quot;, id &#125;))</code> è¿™æ ·å¤æ‚çš„ç»“æ„ï¼Œè¿™æ­£æ˜¯ä¸ºäº†æè‡´çš„å•æ¡æ•°æ®æŒ‰éœ€æ›´æ–°ã€‚</p></blockquote><br><h3 id="3-3-å®æˆ˜ï¼šæ„å»ºä¸€ä¸ª-Todo-CRUD-API"><a href="#3-3-å®æˆ˜ï¼šæ„å»ºä¸€ä¸ª-Todo-CRUD-API" class="headerlink" title="3.3 å®æˆ˜ï¼šæ„å»ºä¸€ä¸ª Todo CRUD API"></a><strong><font color="red">3.3 å®æˆ˜ï¼šæ„å»ºä¸€ä¸ª Todo CRUD API</font></strong></h3><p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å¾…åŠäº‹é¡¹ç®¡ç† API æ¥å£ã€‚</p><p><code>src/redux/api/todoApi.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApi, fetchBaseQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit/query/react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> todoApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">  <span class="attr">reducerPath</span>: <span class="string">&quot;todoApi&quot;</span>, <span class="comment">// åœ¨ store ä¸­çš„ key</span></span><br><span class="line">  <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&quot;http://localhost:3000&quot;</span> &#125;), <span class="comment">// åŸºç¡€ URL</span></span><br><span class="line">  <span class="comment">// ğŸ·ï¸ å®šä¹‰æ ‡ç­¾ï¼šç”¨äºæ ‡è®°å“ªäº›æ•°æ®æ˜¯ç›¸å…³çš„ï¼Œæ–¹ä¾¿åé¢è‡ªåŠ¨åˆ·æ–°</span></span><br><span class="line">  <span class="attr">tagTypes</span>: [<span class="string">&quot;Todos&quot;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 1. æŸ¥è¯¢åˆ—è¡¨ (query)</span></span><br><span class="line">    <span class="attr">getTodos</span>: builder.<span class="title function_">query</span>(&#123;</span><br><span class="line">      <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">      <span class="comment">// å°†è¿”å›çš„åˆ—è¡¨æ ‡è®°ä¸º &#x27;Todos&#x27; æ ‡ç­¾ï¼Œä¸” ID ä¸º &#x27;LIST&#x27;</span></span><br><span class="line">      <span class="attr">providesTags</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> <span class="comment">// è·å–æ¥å£è¿”å›çš„</span></span><br><span class="line">        result ? [...result.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; id &#125;</span>) =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, id &#125;)),&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;]: [&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;]</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. æ·»åŠ æ•°æ® (mutation)</span></span><br><span class="line">    <span class="attr">addTodo</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">      <span class="attr">query</span>: <span class="function">(<span class="params">newTodo</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/todos&quot;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">body</span>: newTodo,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// å…³é”®ï¼šæ·»åŠ åä½¿ &#x27;LIST&#x27; æ ‡ç­¾å¤±æ•ˆï¼Œè§¦å‘åˆ—è¡¨è‡ªåŠ¨é‡æ–°è¯·æ±‚</span></span><br><span class="line">      <span class="attr">invalidatesTags</span>: [&#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;],</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. åˆ é™¤æ•°æ® (mutation)</span></span><br><span class="line">    <span class="attr">deleteTodo</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">      <span class="attr">query</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/todos/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;DELETE&quot;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// åˆ é™¤åï¼Œè®©è¯¥ç‰¹å®š ID çš„æ•°æ®å’Œåˆ—è¡¨éƒ½å¤±æ•ˆ</span></span><br><span class="line">      <span class="attr">invalidatesTags</span>: <span class="function">(<span class="params">result, error, id</span>) =&gt;</span> [</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, id &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&quot;Todos&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;LIST&quot;</span> &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç”Ÿæˆçš„ Hooks (æ ¼å¼ï¼šuse + ç«¯ç‚¹å + Query/Mutation)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetTodosQuery, useAddTodoMutation, useDeleteTodoMutation &#125; =</span><br><span class="line">  todoApi;</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰é…ç½®-Store-ä¸­é—´ä»¶"><a href="#2ï¼‰é…ç½®-Store-ä¸­é—´ä»¶" class="headerlink" title="2ï¼‰é…ç½® Store ä¸­é—´ä»¶"></a><strong><font color="#10c300">2ï¼‰é…ç½® Store ä¸­é—´ä»¶</font></strong></h4><p>RTKQ éœ€è¦ä¸“é—¨çš„ Reducer å’Œä¸­é—´ä»¶æ¥å¤„ç†ç¼“å­˜ç®¡ç†ã€‚</p><p><code>src/redux/store.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; todoApi &#125; <span class="keyword">from</span> <span class="string">&quot;./api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»æ·»åŠ  api çš„ reducer</span></span><br><span class="line">    [todoApi.<span class="property">reducerPath</span>]: todoApi.<span class="property">reducer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å¿…é¡»æ·»åŠ  api çš„ä¸­é—´ä»¶ï¼Œç”¨äºå¯ç”¨ç¼“å­˜ã€è½®è¯¢ã€å¤±æ•ˆç­‰åŠŸèƒ½</span></span><br><span class="line">  <span class="attr">middleware</span>: <span class="function">(<span class="params">getDefaultMiddleware</span>) =&gt;</span></span><br><span class="line">    <span class="title function_">getDefaultMiddleware</span>().<span class="title function_">concat</span>(todoApi.<span class="property">middleware</span>),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="3ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨-Hooks"><a href="#3ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨-Hooks" class="headerlink" title="3ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Hooks"></a><strong><font color="#10c300">3ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Hooks</font></strong></h4><p>RTKQ è¿”å›çš„ Hook åŒ…å«äº†æ‰€æœ‰ä½ éœ€è¦çš„çŠ¶æ€ï¼Œæ— éœ€é¢å¤–å®šä¹‰ <code>useState</code>ã€‚</p><p><code>src/pages/TodoPage.jsx</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  useGetTodosQuery,</span><br><span class="line">  useAddTodoMutation,</span><br><span class="line">  useDeleteTodoMutation,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../redux/api/todoApi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodoPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. è·å–æ•°æ®ï¼šè‡ªåŠ¨è§¦å‘è¯·æ±‚ï¼Œä¸”å¸¦æœ‰ä¸°å¯Œçš„çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: todos, error, isLoading, isFetching &#125; = <span class="title function_">useGetTodosQuery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. å˜æ›´æ“ä½œï¼šè¿”å›ä¸€ä¸ªè§¦å‘å‡½æ•° (trigger) å’Œæ“ä½œçŠ¶æ€ (rest)</span></span><br><span class="line">  <span class="keyword">const</span> [addTodo, &#123; <span class="attr">isLoading</span>: isAdding &#125;] = <span class="title function_">useAddTodoMutation</span>();</span><br><span class="line">  <span class="keyword">const</span> [deleteTodo] = <span class="title function_">useDeleteTodoMutation</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isLoading) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>åˆæ¬¡åŠ è½½ä¸­...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>è¯·æ±‚å‡ºé”™: &#123;error.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>å¾…åŠäº‹é¡¹ &#123;isFetching &amp;&amp; &quot; (åŒæ­¥ä¸­...)&quot;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">disabled</span>=<span class="string">&#123;isAdding&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> addTodo(&#123; title: &quot;æ–°ä»»åŠ¡&quot;, completed: false &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        &#123;isAdding ? &quot;æ·»åŠ ä¸­...&quot; : &quot;æ·»åŠ ä»»åŠ¡&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;todos.map((todo) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;todo.title&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> deleteTodo(todo.id)&#125;&gt;åˆ é™¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4ï¼‰æ ¸å¿ƒæœºåˆ¶è¯¦è§£ï¼šTags-æ ‡ç­¾-ç³»ç»Ÿ"><a href="#4ï¼‰æ ¸å¿ƒæœºåˆ¶è¯¦è§£ï¼šTags-æ ‡ç­¾-ç³»ç»Ÿ" class="headerlink" title="4ï¼‰æ ¸å¿ƒæœºåˆ¶è¯¦è§£ï¼šTags (æ ‡ç­¾) ç³»ç»Ÿ"></a><strong><font color="#10c300">4ï¼‰æ ¸å¿ƒæœºåˆ¶è¯¦è§£ï¼šTags (æ ‡ç­¾) ç³»ç»Ÿ</font></strong></h4><p>è¿™æ˜¯ RTK Query çš„çµé­‚ã€‚å®ƒé€šè¿‡â€œå‘å¸ƒ-è®¢é˜…â€æ¨¡å¼ç®¡ç†ç¼“å­˜ï¼š</p><ol><li><strong><code>providesTags</code> (å‘å¸ƒ)</strong>ï¼šå‘Šè¯‰ RTKQ è¿™ä»½æ•°æ®è´´äº†ä»€ä¹ˆæ ‡ç­¾ï¼ˆæ¯”å¦‚ <code>Todos</code>ï¼‰ã€‚</li><li><strong><code>invalidatesTags</code> (æ’¤é”€)</strong>ï¼šå½“æ‰§è¡Œä¿®æ”¹æ“ä½œåï¼Œé«˜é€Ÿ RTKQ å“ªäº›æ ‡ç­¾è¿‡æœŸäº†ã€‚</li><li><strong>è‡ªåŠ¨é‡åˆ·æ–°</strong>ï¼šRTKQ å‘ç°å½“å‰é¡µé¢æ­£åœ¨ä½¿ç”¨çš„ <code>getTodos</code> è®¢é˜…äº† <code>Todos</code> æ ‡ç­¾ï¼Œè€Œè¯¥æ ‡ç­¾ç”±äº <code>addTodo</code> å˜æˆäº†â€œå¤±æ•ˆâ€çŠ¶æ€ï¼Œäºæ˜¯ RTKQ ä¼š<strong>è‡ªåŠ¨</strong>é‡æ–°å‘èµ·ç½‘ç»œè¯·æ±‚ï¼ŒåŒæ­¥æœ€æ–°çš„åˆ—è¡¨ã€‚</li></ol><blockquote><p>[!TIP]<br><strong>ç¼“å­˜è‡ªåŠ¨æ¸…ç†</strong><br>å¦‚æœæ²¡æœ‰ä»»ä½•ç»„ä»¶è®¢é˜…æŸä¸ª API ç«¯ç‚¹çš„æ•°æ®ï¼ˆå³æ²¡åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨è¯¥ Hookï¼‰ï¼ŒRTKQ ä¼šåœ¨ä¸€æ®µæ—¶é—´åï¼ˆé»˜è®¤ 60 ç§’ï¼‰è‡ªåŠ¨ä»å†…å­˜ä¸­åˆ é™¤è¿™äº›åƒåœ¾æ•°æ®ã€‚</p></blockquote><br><h3 id="3-4-æ€§èƒ½ä¼˜åŒ–ï¼šMemoization"><a href="#3-4-æ€§èƒ½ä¼˜åŒ–ï¼šMemoization" class="headerlink" title="3.4 æ€§èƒ½ä¼˜åŒ–ï¼šMemoization"></a><strong><font color="red">3.4 æ€§èƒ½ä¼˜åŒ–ï¼šMemoization</font></strong></h3><p>æ¯å½“ Redux Store æ›´æ–°æ—¶ï¼Œæ‰€æœ‰ä½¿ç”¨ <code>useSelector</code> çš„ç»„ä»¶éƒ½ä¼šé‡æ–°è®¡ç®—å…¶ Selectorã€‚</p><ul><li><strong>é¿å…å¼•ç”¨é™·é˜±</strong>ï¼šå¦‚æœåœ¨ Selector ä¸­è¿”å›äº†æ–°æ•°ç»„æˆ–å¯¹è±¡ï¼ˆå¦‚ <code>state.items.filter(...)</code>ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨è®°å¿†åŒ–å·¥å…·ã€‚</li><li><strong>æ¨èæ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ <strong><code>createSelector</code></strong>ã€‚å®ƒä¸ä»…èƒ½ç¼“å­˜æ˜‚è´µçš„è®¡ç®—ç»“æœï¼Œè¿˜èƒ½é€šè¿‡ä¿æŒå¼•ç”¨ä¸€è‡´æ€§æ¥é˜²æ­¢å­ç»„ä»¶çš„ä¸å¿…è¦é‡æ¸²æŸ“ã€‚</li></ul><blockquote><p>[!TIP]<br>è¯¦ç»†çš„ <code>createSelector</code> é…ç½®ä¸ä»£ç ç‰‡æ®µè¯·å‚è€ƒå‰æ–‡ï¼š<a href="#24-%E8%AE%B0%E5%BF%86%E5%8C%96%E9%80%89%E6%8B%A9%E5%99%A8createselector">2.4 è®°å¿†åŒ–é€‰æ‹©å™¨ï¼šcreateSelector</a>ã€‚</p></blockquote><br><h3 id="3-5-ç›®å½•ç»“æ„æœ€ä½³å®è·µ"><a href="#3-5-ç›®å½•ç»“æ„æœ€ä½³å®è·µ" class="headerlink" title="3.5 ç›®å½•ç»“æ„æœ€ä½³å®è·µ"></a><strong><font color="red">3.5 ç›®å½•ç»“æ„æœ€ä½³å®è·µ</font></strong></h3><p>æ¨èåŸºäº<strong>åŠŸèƒ½ (Feature-based)</strong> çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œè€Œä¸æ˜¯æŒ‰æ–‡ä»¶ç±»å‹ï¼ˆactions&#x2F;reducersï¼‰åˆ†ç±»ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ ğŸ“ src/</span><br><span class="line">â”‚   â”œâ”€â”€ ğŸ“ app/                # å…¨å±€é…ç½® (Store, è·¯ç”±é…ç½®)</span><br><span class="line">â”‚   â”‚   â””â”€â”€ store.js</span><br><span class="line">â”‚   â”œâ”€â”€ ğŸ“ assets/             # é™æ€èµ„æº (å›¾ç‰‡, å­—ä½“, å…¨å±€æ ·å¼)</span><br><span class="line">â”‚   â”œâ”€â”€ ğŸ“ components/         # é€šç”¨åŸºç¡€ç»„ä»¶ (éä¸šåŠ¡ logic)</span><br><span class="line">â”‚   â”œâ”€â”€ ğŸ“ features/           # ä¸šåŠ¡åŠŸèƒ½æ¨¡å— (Slice + ä¸šåŠ¡ç»„ä»¶ + API)</span><br><span class="line">â”‚   â”‚   â””â”€â”€ ğŸ“ counter/        # ç¤ºä¾‹åŠŸèƒ½</span><br><span class="line">â”‚   â”‚       â”œâ”€â”€ counterSlice.js</span><br><span class="line">â”‚   â”‚       â””â”€â”€ Counter.jsx</span><br><span class="line">â”‚   â”œâ”€â”€ ğŸ“ hooks/              # é€šç”¨ Hooks (useAuth, useTheme ç­‰)</span><br><span class="line">â”‚   â”œâ”€â”€ ğŸ“ pages/              # é¡µé¢çº§ç»„ä»¶ (è·¯ç”±å…¥å£)</span><br><span class="line">â”‚   â”œâ”€â”€ ğŸ“ utils/              # å·¥å…·å‡½æ•° (formatDate, validators ç­‰)</span><br><span class="line">â”‚   â”œâ”€â”€ App.jsx                # æ ¹ç»„ä»¶</span><br><span class="line">â”‚   â””â”€â”€ index.js               # å…¥å£æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒè¯´æ˜</strong>ï¼š</p><ul><li><strong>Feature-first</strong>: <code>features/</code> ç›®å½•æ˜¯æ ¸å¿ƒã€‚å°†ä¸€ä¸ªåŠŸèƒ½çš„æ‰€æœ‰ç›¸å…³ä»£ç ï¼ˆSlice, ç»„ä»¶, APIï¼‰æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œä¿æŒé«˜å†…èšã€‚</li><li><strong>Layered Structure</strong>: <code>components/</code> å­˜æ”¾çº¯ UI ç»„ä»¶ï¼Œ<code>pages/</code> å­˜æ”¾é¡µé¢å®¹å™¨ï¼Œ<code>features/</code> å­˜æ”¾ä¸šåŠ¡é€»è¾‘ï¼Œå±‚æ¬¡åˆ†æ˜ã€‚</li></ul><br><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><ol><li><strong>å§‹ç»ˆä½¿ç”¨ Redux Toolkit</strong>ï¼šä¸è¦å†æ‰‹å†™ä¼ ç»Ÿçš„ Redux æ ·æ¿ä»£ç ã€‚</li><li><strong>State èŒƒå¼åŒ–</strong>ï¼šå°½é‡ä¿æŒ State æ‰å¹³åŒ–ï¼Œé¿å…æ·±å±‚åµŒå¥—ã€‚</li><li><strong>ä¸è¦æŠŠæ‰€æœ‰æ•°æ®éƒ½æ”¾è¿› Redux</strong>ï¼š<ul><li>Form state -&gt; Local state (<code>useState</code>)</li><li>Server cache -&gt; RTK Query</li><li>Global UI state &#x2F; Shared data -&gt; Redux Slice</li></ul></li><li><strong>TypeScript</strong>ï¼šRTK å¯¹ TypeScript æ”¯æŒæä½³ï¼Œåˆ©ç”¨å®ƒå¯ä»¥è·å¾—å¼ºå¤§çš„ç±»å‹æç¤ºã€‚</li></ol><hr><p><em>Happy Coding with React &amp; Redux!</em></p></div><div class="post-footer"><div>è½¬è½½å£°æ˜ï¼š å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒ,éå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ Â© <a href="" target="_blank">ZHB</a></div><div></div></div></article><div class="article-nav prev-next-wrap clearfix"><a href="/posts/mobx-guide-2026.html" class="pre-post btn btn-default" title="React MobX å…¨é¢æŒ‡å— (MobX 6)"><i class="fa fa-angle-left fa-fw"></i> <span class="hidden-lg">ä¸Šä¸€ç¯‡</span> <span class="hidden-xs">React MobX å…¨é¢æŒ‡å— (MobX 6)</span></a> <a href="/posts/e2d3b4a5wq.html" class="next-post btn btn-default" title="React Router å…¨é¢æŒ‡å— (v6.4+ & v7)"><span class="hidden-lg">ä¸‹ä¸€ç¯‡</span> <span class="hidden-xs">React Router å…¨é¢æŒ‡å— (v6.4+ & v7)</span><i class="fa fa-angle-right fa-fw"></i></a></div><div id="comments"><div class="utteranc"><script src="https://utteranc.es/client.js" repo="shenliyang/snippet-comment" issue-term="pathname" issue-number="" theme="github-light" label="" crossorigin="anonymous" async></script></div></div></main><aside id="article-toc" role="navigation" class="col-md-3"><div class="widget"><h3 class="title">æ–‡ç« ç›®å½•</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#React-Redux-%E5%85%A8%E9%9D%A2%E6%8C%87%E5%8D%97-Redux-Toolkit"><span class="toc-text">React Redux å…¨é¢æŒ‡å— (Redux Toolkit)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-text">ç›®å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E5%9F%BA%E7%A1%80%E7%AF%87%EF%BC%9ARTK-%E6%A0%B8%E5%BF%83%E4%B8%8E%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-text">ä¸€ã€ åŸºç¡€ç¯‡ï¼šRTK æ ¸å¿ƒä¸å¿«é€Ÿä¸Šæ‰‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Redux-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">1.1 Redux æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85"><span class="toc-text">1.2 å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%AE%9E%E6%88%98-Counter-Example"><span class="toc-text">1.3 æ ¸å¿ƒæ¦‚å¿µä¸å®æˆ˜ (Counter Example)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA-Slice-%E5%88%87%E7%89%87"><span class="toc-text">1ï¼‰ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Slice (åˆ‡ç‰‡)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AE-Store"><span class="toc-text">2ï¼‰ç¬¬äºŒæ­¥ï¼šé…ç½® Store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E6%B3%A8%E5%85%A5-Store"><span class="toc-text">3ï¼‰ç¬¬ä¸‰æ­¥ï¼šæ³¨å…¥ Store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%AD%E4%BD%BF%E7%94%A8-Hooks"><span class="toc-text">4ï¼‰ç¬¬å››æ­¥ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Hooks</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E8%BF%9B%E9%98%B6%E7%AF%87%EF%BC%9A%E5%A4%8D%E6%9D%82%E7%8A%B6%E6%80%81%E4%B8%8E%E5%BC%82%E6%AD%A5%E9%80%BB%E8%BE%91"><span class="toc-text">äºŒã€ è¿›é˜¶ç¯‡ï¼šå¤æ‚çŠ¶æ€ä¸å¼‚æ­¥é€»è¾‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%BC%82%E6%AD%A5%E9%80%BB%E8%BE%91%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%EF%BC%9AcreateAsyncThunk"><span class="toc-text">2.1 å¼‚æ­¥é€»è¾‘ä¸æ•°æ®è¯·æ±‚ï¼šcreateAsyncThunk</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%BC%82%E6%AD%A5%EF%BC%9F"><span class="toc-text">1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%AE%9E%E6%88%98%EF%BC%9A%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E2%80%9D%E6%A8%A1%E6%8B%9F%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8A%A0%E6%B3%95%E2%80%9D"><span class="toc-text">2ï¼‰å®æˆ˜ï¼šå®ç°ä¸€ä¸ªâ€æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„åŠ æ³•â€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%BC%82%E6%AD%A5%E9%80%BB%E8%BE%91%E7%9A%84%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="toc-text">2.2 å¼‚æ­¥é€»è¾‘çš„ä»£ç ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%86%E7%A6%BB-Async-Thunk-%E5%AE%9A%E4%B9%89"><span class="toc-text">1. åˆ†ç¦» Async Thunk å®šä¹‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%81%8C%E8%B4%A3%E5%8D%95%E4%B8%80%E4%B8%8E%E7%B2%BE%E7%BB%86%E5%8C%96%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-text">2. èŒè´£å•ä¸€ä¸ç²¾ç»†åŒ–é”™è¯¯å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8-addMatcher-%E5%87%8F%E5%B0%91%E6%A0%B7%E6%9D%BF%E4%BB%A3%E7%A0%81"><span class="toc-text">3. ä½¿ç”¨ addMatcher å‡å°‘æ ·æ¿ä»£ç </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-text">2.3 ç»¼åˆæ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E8%AE%B0%E5%BF%86%E5%8C%96%E9%80%89%E6%8B%A9%E5%99%A8%EF%BC%9AcreateSelector"><span class="toc-text">2.4 è®°å¿†åŒ–é€‰æ‹©å™¨ï¼šcreateSelector</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83%EF%BC%9F"><span class="toc-text">1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-text">2ï¼‰åŸºæœ¬ç”¨æ³•ï¼šæ•°æ®é¢„å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E4%BC%A0%E5%8F%82%E7%9A%84%E6%A0%87%E5%87%86%E5%86%99%E6%B3%95"><span class="toc-text">3ï¼‰ä¼ å‚çš„æ ‡å‡†å†™æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95%EF%BC%9A%E5%B7%A5%E5%8E%82%E5%87%BD%E6%95%B0%E6%A8%A1%E5%BC%8F-Factory-Function"><span class="toc-text">4ï¼‰é«˜çº§ç”¨æ³•ï¼šå·¥å‚å‡½æ•°æ¨¡å¼ (Factory Function)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93"><span class="toc-text">5ï¼‰æœ€ä½³å®è·µæ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Redux-DevTools"><span class="toc-text">2.5 Redux DevTools</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%AB%98%E7%BA%A7%E7%AF%87%EF%BC%9ARTK-Query-%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">ä¸‰ã€é«˜çº§ç¯‡ï¼šRTK Query ä¸æ€§èƒ½ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95"><span class="toc-text">3.1 åŸºç¡€ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-RTK-Query-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3"><span class="toc-text">3.2 RTK Query æ ¸å¿ƒæ¦‚å¿µè¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%9AQuery-%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-text">1ï¼‰è·å–æ•°æ®ï¼šQuery (æŸ¥è¯¢æ“ä½œ)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%EF%BC%9AMutation-%E5%8F%98%E6%9B%B4%E6%93%8D%E4%BD%9C"><span class="toc-text">2ï¼‰ä¿®æ”¹æ•°æ®ï¼šMutation (å˜æ›´æ“ä½œ)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%E6%9F%A5%E8%AF%A2%EF%BC%9AuseLazyXXXQuery"><span class="toc-text">4ï¼‰æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢ï¼šuseLazyXXXQuery</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%EF%BC%9AtransformResponse"><span class="toc-text">4ï¼‰æ•°æ®è½¬æ¢ï¼štransformResponse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E7%BC%93%E5%AD%98%E6%93%8D%E4%BD%9C%EF%BC%9AprovidesTags-%E4%B8%8E-invalidatesTags"><span class="toc-text">5ï¼‰ç¼“å­˜æ“ä½œï¼šprovidesTags ä¸ invalidatesTags</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%AE%9E%E6%88%98%EF%BC%9A%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA-Todo-CRUD-API"><span class="toc-text">3.3 å®æˆ˜ï¼šæ„å»ºä¸€ä¸ª Todo CRUD API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E9%85%8D%E7%BD%AE-Store-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">2ï¼‰é…ç½® Store ä¸­é—´ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%AD%E4%BD%BF%E7%94%A8-Hooks"><span class="toc-text">3ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Hooks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3%EF%BC%9ATags-%E6%A0%87%E7%AD%BE-%E7%B3%BB%E7%BB%9F"><span class="toc-text">4ï¼‰æ ¸å¿ƒæœºåˆ¶è¯¦è§£ï¼šTags (æ ‡ç­¾) ç³»ç»Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%9AMemoization"><span class="toc-text">3.4 æ€§èƒ½ä¼˜åŒ–ï¼šMemoization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">3.5 ç›®å½•ç»“æ„æœ€ä½³å®è·µ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">å››ã€æ€»ç»“</span></a></li></ol></li></ol></div></aside></div></div></section><footer class="main-footer"><div class="container"><div class="row"></div></div></footer><a id="back-to-top" class="icon-btn hide"><i class="fa fa-chevron-up"></i></a><div class="copyright"><div class="container"><div class="row"><div class="col-sm-12"><div class="busuanzi"></div></div><div class="col-sm-12"><span>Copyright &copy; 2017</span> | <span>Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a></span> | <span>Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a></span></div></div></div></div><script src="/js/app.js?rev=2f9097f8c1d5adfecd923b78b47be31b"></script></body></html>