<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta http-equiv="Cache-Control" content="no-siteapp"><meta http-equiv="Cache-Control" content="no-transform"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="apple-mobile-web-app-capable" content="H多看源码多读书 - 勤于思考善领悟"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="browsermode" content="application"><meta name="screen-orientation" content="portrait"><meta name="theme-version" content="1.3.0"><meta name="root" content="/"><link rel="dns-prefetch" href="http://example.com"><meta name="keywords" content="vu2,部署"><meta name="description" content="使用Vue做前后端分离项目时，通常前端是单独部署，用户访问的也是前端项目地址，因此前端开发人员很有必要熟悉一下项目部署的流程与各类问题的解决办法了。
本文介绍一下使用nginx服务器代理前端项目..."><meta name="robots" content="all"><meta name="google" content="all"><meta name="googlebot" content="all"><meta name="verify" content="all"><title>使用nginx部署vue项目 | H多看源码多读书 - 勤于思考善领悟</title><link rel="alternate" href="/atom.xml" title="H多看源码多读书 - 勤于思考善领悟" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/bootstrap.min.css?rev=1d1bccdabbf21f3604f985399285f5cf"><link rel="stylesheet" href="/css/font-awesome.min.css?rev=17d35b1ddb5a58cc19379d19f22b9fdc"><link rel="stylesheet" href="/css/style.css?rev=1be479d06cbb29d0c56ae25586ad88bc"><div class="hide"><script type="text/javascript">!function(){var t="https:"===document.location.protocol?"https://":"http://",c=document.createElement("script");c.src="https://s95.cnzz.com/z_stat.php?web_id=1272564536",c.async=!0,document.body.appendChild(c);var e=document.createElement("script");e.src=t+"s19.cnzz.com/z_stat.php?id=1263868967&show=pic1",e.async=!0,document.body.appendChild(e)}()</script></div><meta name="generator" content="Hexo 7.3.0"></head><!--[if lte IE 8]><style>
    html{ font-size: 1em }
</style><![endif]--><!--[if lte IE 9]><div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div><![endif]--><body><header class="main-header" style="background-image:url(https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/banner.webp)"><div class="main-header-box"><a class="header-avatar" href="/" title="ZHB"><img src="/img/avatar.webp" alt="logo头像" class="img-responsive center-block"></a><div class="branding"><img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block"></div></div></header><nav class="main-navigation"><div class="container"><div class="row"><div class="col-sm-12"><div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav"><span class="sr-only"></span><i class="fa fa-bars"></i></span> <a class="navbar-brand" href="http://example.com">H多看源码多读书 - 勤于思考善领悟</a></div><div class="collapse navbar-collapse" id="main-menu"><ul class="menu"><li role="presentation" class="text-center"><a href="/"><i class="fa"></i> 首页</a></li><li role="presentation" class="text-center"><a href="/categories/"><i class="fa"></i> 分类</a></li><li role="presentation" class="text-center"><a href="/tags/"><i class="fa"></i> 标签</a></li><li role="presentation" class="text-center"><a href="/archives/"><i class="fa"></i> 时间轴</a></li><li role="presentation" class="text-center"><a href="/about/"><i class="fa"></i> 关于</a></li></ul></div></div></div></div></nav><section class="content-wrap"><div class="container"><div class="row"><main class="col-md-9 main-content m-post"><p id="process"></p><article class="post"><div class="post-head"><h1 id="使用nginx部署vue项目">使用nginx部署vue项目</h1><div class="post-meta"><span class="categories-meta fa-wrap"><i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF%E4%B8%8E%E8%BF%90%E7%BB%B4/">后端与运维</a></span><span class="fa-wrap"><i class="fa fa-tags"></i> <span class="tags-meta"><a class="tag-none-link" href="/tags/vu2/" rel="tag">vu2</a> <a class="tag-none-link" href="/tags/%E9%83%A8%E7%BD%B2/" rel="tag">部署</a></span></span><span class="fa-wrap"><i class="fa fa-clock-o"></i> <span class="date-meta">2025/02/17</span></span></div><p class="fa fa-exclamation-triangle warning">本文于 <strong>376</strong> 天之前发表，文中内容可能已经过时。</p></div><div class="post-body post-content"><p>使用Vue做前后端分离项目时，通常前端是单独部署，用户访问的也是前端项目地址，因此前端开发人员很有必要熟悉一下项目部署的流程与各类问题的解决办法了。</p><p>本文介绍一下使用nginx服务器代理前端项目的方法以及项目部署的相关问题</p><br><br><h3 id="一、准备工作——服务器和nginx使用"><a href="#一、准备工作——服务器和nginx使用" class="headerlink" title="一、准备工作——服务器和nginx使用"></a><strong><font color="red">一、准备工作——服务器和nginx使用</font></strong></h3><h4 id="1-准备一台服务器"><a href="#1-准备一台服务器" class="headerlink" title="1. 准备一台服务器"></a><strong><font color="#10c300">1. 准备一台服务器</font></strong></h4><p>**服务器：**腾讯云服务器</p><p>**操作系统：**CentOS &#x2F; 7.6</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140208565.png" alt="image-20230417003452498"></p><br><h4 id="2-宝塔可视化面板配置服务"><a href="#2-宝塔可视化面板配置服务" class="headerlink" title="2.宝塔可视化面板配置服务"></a><strong><font color="#10c300">2.宝塔可视化面板配置服务</font></strong></h4><p>相对于后端，前端对于linux操作还是比较陌生的，使用宝塔可视化面板使操作更加简单。(怎么简单怎么来)</p><p>**宝塔：**<a target="_blank" rel="noopener" href="https://www.bt.cn/">https://www.bt.cn/</a></p><p><strong>1)、选择宝塔linux面板</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140208340.png" alt="image-20230417003459066"></p><br><p><strong>2)、linux面板向下滚动至在线一键快速安装宝塔</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209677.png" alt="image-20230417003504811"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209501.png" alt="image-20230417003508981"></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209297.png" alt="image-20230417003512965"></p><br><p><strong>3)、安装成功</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209866.png" alt="image-20230417003517191"></p><br><p><strong>4)、添加站点</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209494.png" alt="image-20230417003522031"></p><br><br><h3 id="二、hash模式部署发布（同域名部署多环境项目）"><a href="#二、hash模式部署发布（同域名部署多环境项目）" class="headerlink" title="二、hash模式部署发布（同域名部署多环境项目）"></a><strong><font color="red">二、hash模式部署发布（同域名部署多环境项目）</font></strong></h3><h4 id="1、-打包文件同步到服务器"><a href="#1、-打包文件同步到服务器" class="headerlink" title="1、 打包文件同步到服务器"></a><strong><font color="#10c300">1、 打包文件同步到服务器</font></strong></h4><h5 id="1）配置"><a href="#1）配置" class="headerlink" title="1）配置"></a><strong><font color="cornflowerblue">1）配置</font></strong></h5><p>我们使用nginx部署Vue项目，实质上就是将Vue项目打包后的内容同步到nginx指向的文件夹。之前的步骤介绍了添加站点nginx指向我们创建的文件夹，剩下的问题就是怎么把打包好的文件同步到服务器上指定的文件夹里，比如同步到之前步骤中创建的&#x2F;www&#x2F;wwwroot&#x2F;test.shixna.cn。</p><p>同步文件可以在git-bash或者powershell使用scp指令，如果是linux环境开发，还可以使用rsync指令:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wondow环境： <span class="attribute">scp</span> -r dist/* root@<span class="number">124.222.74.47</span>:/www/wwwroot/test.shixna.cn</span><br><span class="line"></span><br><span class="line">理解：dist/*提取dist下面的所有文件到 服务器<span class="number">124.222.74.47</span>:/www/wwwroot/test.shixna.cn文件中</span><br><span class="line">如果想要将dist提取到服务器中则不要dist后面的<span class="string">&#x27;/*&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux环境： <span class="attribute">rsync</span> -avr --delete-after dist/*root@<span class="number">124.222.74.47</span>:/www/wwwroot/test.shixna.cn</span><br></pre></td></tr></table></figure><p>注意这里以及后续步骤是root使用用户远程同步，应该根据你的具体情况替换root和ip(ip换为你自己的服务器IP)。</p><p><strong>为了方便，可以在package.json脚本中加一个push命令，以使用npm为例</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;build&quot;: &quot;vue-cli-service build --mode pro&quot;,</span><br><span class="line">  &quot;push&quot;: &quot;npm run build &amp;&amp; scp -r dist/*root@124.222.74.47:/www/wwwroot/test.shixna.cn&quot;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>这样就可以直接执行yarn push 或者npm run push直接发布了。不过还有一个小问题，就是命令执行的时候要求输入远程服务器的root密码（这里使用root来连接远程的，你可以用别的用户，毕竟root用户权限太高了）。</p><p>为了避免每次执行都要输入root密码，我们可以将本机的ssh同步到远程服务器的<strong>authorized_keys</strong>文件中。</p><br><h5 id="2）同步ssh-key"><a href="#2）同步ssh-key" class="headerlink" title="2）同步ssh key"></a><strong><font color="cornflowerblue">2）同步ssh key</font></strong></h5><p>a、生成ssh key：使用git bash或者powershell执行ssh-keygen可以生成ssh key。会询问生成的key存放地址，直接回车就行，如果已经存在，则会询问是否覆盖：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209808.png" alt="image-20230417003529630"></p><p>生成一个密钥对</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209360.png" alt="image-20230417003533860"></p><p>b、同步ssh key到远程服务器，使用ssh-copy-id指令同步</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@124.221.188.118</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209563.png" alt="image-20230417003537640">输入密码后，之后再次同步就不需要输入密码了。其实ssh_key是同步到了服务器（此处是root用户目录)~&#x2F;.ssh&#x2F;authorized_keys文件里</p><p><strong>注意：输入以上命令可能会报错</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209026.png" alt="image-20230417003542343"></p><p>这里可以手动复制本地C:\Users\ZHB.ssh（注意是pub结尾的公钥）文件内容追加到服务器root&#x2F;.ssh&#x2F;authorized_keys里面去（从命名可以看出该文件可以存储多个ssh key）</p><p><strong>本地id_rsa.pub</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209979.png" alt="image-20230417003546473"></p><br><p><strong>服务器authorized_keys</strong></p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209894.png" alt="image-20230417003550209"></p><p>注意：这里全程使用的是root用户，所以没有文件操作权限问题。如果你的文件夹创建用户不是远程登录用户，或许会存在同步文件失败的问题，此时需要远程服务器修改文件夹的读写权限</p><p>创建了一个测试项目试一下，打包、文件上传一句指令搞定啦：</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209185.png" alt="image-20230417003553802"></p><p>访问一下，果然看到了我们熟悉的界面：</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209139.png" alt="image-20230417003824128"></p><br><h4 id="2、部署多环境项目（sit环境和prod环境）"><a href="#2、部署多环境项目（sit环境和prod环境）" class="headerlink" title="2、部署多环境项目（sit环境和prod环境）"></a><strong><font color="#10c300">2、部署多环境项目（sit环境和prod环境）</font></strong></h4><p>在同一域名下部署sit环境和prod环境的代码。</p><p>在新建站点下设置</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209638.png" alt="image-20230417003907663"></p><h5 id="1）根目录"><a href="#1）根目录" class="headerlink" title="1）根目录 "></a><font color="#0ee3e5" size="3">1）根目录</font></h5><p><code>在域名根目录下部署prod环境的代码：http://mi.shixna.cn/#/index</code></p><p>vue项目中base:’&#x2F;‘ 和 publicPath:’&#x2F;‘ 保持默认值</p><p>配置nginx</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209339.png" alt="image-20230417003913846"></p><br><h5 id="2）子目录"><a href="#2）子目录" class="headerlink" title="2）子目录"></a><strong><font color="cornflowerblue">2）子目录</font></strong></h5><p><code>在域名二级目录下部署sit环境代码：http://mi.shixna.cn/sit/#/index</code></p><p>vue项目中base:’&#x2F;sit&#x2F;‘ 和 publicPath:’&#x2F;sit&#x2F;‘ 尽可能两者保持一致</p><p><strong>配置nginx</strong></p><p>这里的alisa和root的区别以及location ^~ 见内容四</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209273.png" alt="image-20230417003918308"></p><br><br><h3 id="三、history模式部署发布（同域名部署多环境项目）"><a href="#三、history模式部署发布（同域名部署多环境项目）" class="headerlink" title="三、history模式部署发布（同域名部署多环境项目）"></a><strong><font color="red">三、history模式部署发布（同域名部署多环境项目）</font></strong></h3><p>默认情况下，Vue项目使用的是hash路由模式，就是URL中会包含一个#号的这种形式。#号以及之后的内容是路由地址的hash部分。</p><p>正常情况下，当浏览器地址栏地址改变，浏览器会重新加载页面，而如果是hash部分修改的话，则不会，这就是前端路由的原理，允许根据不同的路由页面局部更新而不刷新整个页面。</p><p>H5新增了history的pushState接口，也允许前端操作改变路由地址但是不触发页面刷新，history模式即利用这一接口来实现。因此使用history模式可以去掉路由中的#号。</p><br><h4 id="1、项目配置"><a href="#1、项目配置" class="headerlink" title="1、项目配置"></a><strong><font color="#10c300">1、项目配置</font></strong></h4><p>在vue-router路由选项中配置mode选项和base选项，mode配置为’history’；如果部署到非域名根目录，还需要配置base选项为前文配置的publicPath值（注意：此情况下，publicPath必须使用绝对路径&#x2F;test&#x2F;的配置形式，而不能用相对路径.&#x2F;）</p><p>vue项目中mode:history，base:’&#x2F;sit&#x2F;‘ 和 publicPath:’&#x2F;sit&#x2F;‘ 尽可能两者保持一致</p><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209772.png" alt="image-20230417003923869"></p><br><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209112.png" alt="image-20230417003927682"></p><br><h4 id="2、配置nginx"><a href="#2、配置nginx" class="headerlink" title="2、配置nginx"></a><strong><font color="#10c300">2、配置nginx</font></strong></h4><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209226.png" alt="image-20230417003932707"></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /sit/index.html;</span><br></pre></td></tr></table></figure><p>这句配置的意思就是，拿到一个地址，先根据地址尝试找对应文件，找不到再试探地址对应的文件夹，再找不到就返回&#x2F;sit&#x2F;index.html。</p><br><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202405140209110.png" alt="image-20230417003940428"></p><br><br><h3 id="四、nginx知识"><a href="#四、nginx知识" class="headerlink" title="四、nginx知识"></a><strong><font color="red">四、nginx知识</font></strong></h3><h4 id="1、nginx配置文件中root和alias"><a href="#1、nginx配置文件中root和alias" class="headerlink" title="1、nginx配置文件中root和alias"></a><strong><font color="#10c300">1、nginx配置文件中root和alias</font></strong></h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /img/ &#123;</span><br><span class="line">    <span class="attribute">alias</span> /var/www/image/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若按照上述配置的话，则访问&#x2F;img&#x2F;目录里面的文件时，ningx会自动去&#x2F;var&#x2F;www&#x2F;image&#x2F;目录找文件</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /img/ &#123;</span><br><span class="line">    <span class="attribute">root</span> /var/www/image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若按照这种配置的话，则访问&#x2F;img&#x2F;目录下的文件时，nginx会去&#x2F;var&#x2F;www&#x2F;image&#x2F;img&#x2F;目录下找文件</p><br><p>alias是一个目录别名的定义，root则是最上层目录的定义。</p><p>还有一个重要的区别是alias后面必须要用“&#x2F;”结束，否则会找不到文件的。。。而root则可有可无~~</p><br><h4 id="2、nginx-location配置"><a href="#2、nginx-location配置" class="headerlink" title="2、nginx location配置"></a><strong><font color="#10c300">2、nginx location配置</font></strong></h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Nginx的HTTP配置主要包括三个区块，结构如下：</span><br><span class="line"><span class="section">http</span> &#123; //这个是协议级别</span><br><span class="line">　　<span class="attribute">include</span> mime.types;</span><br><span class="line">　　<span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line">　　<span class="attribute">keepalive_timeout</span> <span class="number">65</span>;</span><br><span class="line">　　<span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">　　　　<span class="section">server</span> &#123; //这个是服务器级别</span><br><span class="line">　　　　　　<span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">　　　　　　<span class="attribute">server_name</span> localhost;</span><br><span class="line">　　　　　　　　<span class="section">location</span> / &#123; //这个是请求级别</span><br><span class="line">　　　　　　　　　　<span class="attribute">root</span> html;</span><br><span class="line">　　　　　　　　　　<span class="attribute">index</span> index.html index.htm;</span><br><span class="line">　　　　　　　　&#125;</span><br><span class="line">　　　　　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="locatin区段"><a href="#locatin区段" class="headerlink" title="locatin区段"></a><strong><font color="cornflowerblue">locatin区段</font></strong></h5><p>通过指定模式来与客户端请求的URI相匹配，基本语法如下：<strong>location [&#x3D;|<del>|</del>*|^~|@] pattern{……}</strong></p><p><strong>1、没有修饰符 表示：必须以指定模式开始，如：</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">　　<span class="attribute">server_name</span> baidu.com;</span><br><span class="line">　　<span class="section">location</span> /abc &#123;</span><br><span class="line">　　　　……</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">那么，如下是对的：</span><br><span class="line">http://baidu.com/<span class="attribute">abc</span></span><br><span class="line">http://baidu.com/abc?p1</span><br><span class="line">http://baidu.com/abc/</span><br><span class="line">http://baidu.com/abcde</span><br></pre></td></tr></table></figure><p><strong>2、&#x3D;表示：必须与指定的模式精确匹配</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">server_name</span> sish</span><br><span class="line">　　location = /abc &#123;</span><br><span class="line">　　　　……</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line">那么，如下是对的：</span><br><span class="line">http://baidu.com/<span class="attribute">abc</span></span><br><span class="line">http://baidu.com/abc?p1</span><br><span class="line">如下是错的：</span><br><span class="line">http://baidu.com/abc/</span><br><span class="line">http://baidu.com/abcde</span><br></pre></td></tr></table></figure><p><strong>3、~ 表示：指定的正则表达式要区分大小写</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">server_name</span> baidu.com;</span><br><span class="line">　　<span class="section">location</span> <span class="regexp">~ ^/abc$</span> &#123;</span><br><span class="line">　　　　……</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line">那么，如下是对的：</span><br><span class="line">http://baidu.com/<span class="attribute">abc</span></span><br><span class="line">http://baidu.com/abc?p1=11&amp;p2=22</span><br><span class="line">如下是错的：</span><br><span class="line">http://baidu.com/ABC</span><br><span class="line">http://baidu.com/abc/</span><br><span class="line">http://baidu.com/abcde</span><br></pre></td></tr></table></figure><p><em><em>4、~</em> 表示：指定的正则表达式不区分大小写</em>*</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">server_name</span> baidu.com;</span><br><span class="line"><span class="section">location</span> <span class="regexp">~* ^/abc$</span> &#123;</span><br><span class="line">　　　　……</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line">那么，如下是对的：</span><br><span class="line">http://baidu.com/<span class="attribute">abc</span></span><br><span class="line">http://baidu..com/ABC</span><br><span class="line">http://baidu..com/abc?p1=11&amp;p2=22</span><br><span class="line">如下是错的：</span><br><span class="line">http://baidu..com/abc/</span><br><span class="line">http://baidu..com/abcde</span><br></pre></td></tr></table></figure><p><strong>5、^~ 类似于无修饰符的行为，也是以指定模式开始，不同的是，如果模式匹配，</strong><br>那么就停止搜索其他模式了。</p><p><strong>6、@ ：定义命名location区段，这些区段客户段不能访问，只可以由内部产生的请</strong><br>求来访问，如try_files或error_page等</p><p><strong>查找顺序和优先级<br>1：带有“&#x3D;“的精确匹配优先<br>2：没有修饰符的精确匹配<br>3：正则表达式按照他们在配置文件中定义的顺序<br>4：带有“^<del>”修饰符的，开头匹配<br>5：带有“</del>” 或“~*” 修饰符的，如果正则表达式与URI匹配<br>6：没有修饰符的，如果指定字符串与URI开头匹配</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Location区段匹配示例<span class="section">location</span> = / &#123;</span><br><span class="line">　　<span class="comment"># 只匹配 / 的查询.</span></span><br><span class="line">　　[ <span class="attribute">configuration</span> A ]</span><br><span class="line">&#125;</span><br><span class="line">location / &#123;</span><br><span class="line">　　<span class="comment"># 匹配任何以 / 开始的查询，但是正则表达式与一些较长的字符串将被首先匹配。</span></span><br><span class="line">　　[ <span class="attribute">configuration</span> B ]</span><br><span class="line">&#125;</span><br><span class="line">location<span class="regexp"> ^~</span> /images/ &#123;</span><br><span class="line">　　<span class="comment"># 匹配任何以 /images/ 开始的查询并且停止搜索，不检查正则表达式。</span></span><br><span class="line">　　[ <span class="attribute">configuration</span> C ]</span><br><span class="line">&#125;</span><br><span class="line">location <span class="regexp">~* \.(gif|jpg|jpeg)$</span> &#123;</span><br><span class="line">　　<span class="comment"># 匹配任何以gif, jpg, or jpeg结尾的文件，但是所有 /images/ 目录的请求将在Configuration C中处</span></span><br><span class="line">　　理。</span><br><span class="line">　　[ <span class="attribute">configuration</span> D ]</span><br><span class="line">&#125; 各</span><br><span class="line">请求的处理如下例：</span><br><span class="line">■/ → configuration A</span><br><span class="line">■/documents/document.html → configuration B</span><br><span class="line">■/images/<span class="number">1</span>.gif → configuration C</span><br><span class="line">■/documents/<span class="number">1</span>.jpg → configuration D</span><br></pre></td></tr></table></figure></div><div class="post-footer"><div>转载声明： 商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">ZHB</a></div><div></div></div></article><div class="article-nav prev-next-wrap clearfix"><a href="/posts/b949808a.html" class="pre-post btn btn-default" title="AutoHotkey1.0实现Typora效率翻倍"><i class="fa fa-angle-left fa-fw"></i> <span class="hidden-lg">上一篇</span> <span class="hidden-xs">AutoHotkey1.0实现Typora效率翻倍</span></a></div><div id="comments"><div class="utteranc"><script src="https://utteranc.es/client.js" repo="shenliyang/snippet-comment" issue-term="pathname" issue-number="" theme="github-light" label="" crossorigin="anonymous" async></script></div></div></main><aside id="article-toc" role="navigation" class="col-md-3"><div class="widget"><h3 class="title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E2%80%94%E2%80%94%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8Cnginx%E4%BD%BF%E7%94%A8"><span class="toc-text">一、准备工作——服务器和nginx使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%87%86%E5%A4%87%E4%B8%80%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">1. 准备一台服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%9D%E5%A1%94%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">2.宝塔可视化面板配置服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81hash%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83%EF%BC%88%E5%90%8C%E5%9F%9F%E5%90%8D%E9%83%A8%E7%BD%B2%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%A1%B9%E7%9B%AE%EF%BC%89"><span class="toc-text">二、hash模式部署发布（同域名部署多环境项目）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81-%E6%89%93%E5%8C%85%E6%96%87%E4%BB%B6%E5%90%8C%E6%AD%A5%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">1、 打包文件同步到服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%EF%BC%89%E9%85%8D%E7%BD%AE"><span class="toc-text">1）配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%89%E5%90%8C%E6%AD%A5ssh-key"><span class="toc-text">2）同步ssh key</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%83%A8%E7%BD%B2%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%A1%B9%E7%9B%AE%EF%BC%88sit%E7%8E%AF%E5%A2%83%E5%92%8Cprod%E7%8E%AF%E5%A2%83%EF%BC%89"><span class="toc-text">2、部署多环境项目（sit环境和prod环境）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%EF%BC%89%E6%A0%B9%E7%9B%AE%E5%BD%95"><span class="toc-text">1）根目录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%89%E5%AD%90%E7%9B%AE%E5%BD%95"><span class="toc-text">2）子目录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81history%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83%EF%BC%88%E5%90%8C%E5%9F%9F%E5%90%8D%E9%83%A8%E7%BD%B2%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%A1%B9%E7%9B%AE%EF%BC%89"><span class="toc-text">三、history模式部署发布（同域名部署多环境项目）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-text">1、项目配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEnginx"><span class="toc-text">2、配置nginx</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81nginx%E7%9F%A5%E8%AF%86"><span class="toc-text">四、nginx知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%ADroot%E5%92%8Calias"><span class="toc-text">1、nginx配置文件中root和alias</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81nginx-location%E9%85%8D%E7%BD%AE"><span class="toc-text">2、nginx location配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#locatin%E5%8C%BA%E6%AE%B5"><span class="toc-text">locatin区段</span></a></li></ol></li></ol></li></ol></div></aside></div></div></section><footer class="main-footer"><div class="container"><div class="row"></div></div></footer><a id="back-to-top" class="icon-btn hide"><i class="fa fa-chevron-up"></i></a><div class="copyright"><div class="container"><div class="row"><div class="col-sm-12"><div class="busuanzi"></div></div><div class="col-sm-12"><span>Copyright &copy; 2017</span> | <span>Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a></span> | <span>Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a></span></div></div></div></div><script src="/js/app.js?rev=2f9097f8c1d5adfecd923b78b47be31b"></script></body></html>