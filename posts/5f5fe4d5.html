<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta http-equiv="Cache-Control" content="no-siteapp"><meta http-equiv="Cache-Control" content="no-transform"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="apple-mobile-web-app-capable" content="H多看源码多读书 - 勤于思考善领悟"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="browsermode" content="application"><meta name="screen-orientation" content="portrait"><meta name="theme-version" content="1.3.0"><meta name="root" content="/"><link rel="dns-prefetch" href="http://example.com"><meta name="keywords" content="typeScript"><meta name="description" content="一、简介
装饰器本质是一种特殊的函数，它可以对：类、属性、方法、参数进行扩展，同时能让代码更简洁。
装饰器自2015年在ECMAScript-6中被提出到现在，已将近10年。
截止目前，装饰器依..."><meta name="robots" content="all"><meta name="google" content="all"><meta name="googlebot" content="all"><meta name="verify" content="all"><title>TypeScrip装饰器 | H多看源码多读书 - 勤于思考善领悟</title><link rel="alternate" href="/atom.xml" title="H多看源码多读书 - 勤于思考善领悟" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/bootstrap.min.css?rev=1d1bccdabbf21f3604f985399285f5cf"><link rel="stylesheet" href="/css/font-awesome.min.css?rev=17d35b1ddb5a58cc19379d19f22b9fdc"><link rel="stylesheet" href="/css/style.css?rev=1be479d06cbb29d0c56ae25586ad88bc"><div class="hide"><script type="text/javascript">!function(){var t="https:"===document.location.protocol?"https://":"http://",c=document.createElement("script");c.src="https://s95.cnzz.com/z_stat.php?web_id=1272564536",c.async=!0,document.body.appendChild(c);var e=document.createElement("script");e.src=t+"s19.cnzz.com/z_stat.php?id=1263868967&show=pic1",e.async=!0,document.body.appendChild(e)}()</script></div><meta name="generator" content="Hexo 7.3.0"></head><!--[if lte IE 8]><style>
    html{ font-size: 1em }
</style><![endif]--><!--[if lte IE 9]><div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div><![endif]--><body><header class="main-header" style="background-image:url(https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/banner.webp)"><div class="main-header-box"><a class="header-avatar" href="/" title="ZHB"><img src="/img/avatar.webp" alt="logo头像" class="img-responsive center-block"></a><div class="branding"><img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block"></div></div></header><nav class="main-navigation"><div class="container"><div class="row"><div class="col-sm-12"><div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav"><span class="sr-only"></span><i class="fa fa-bars"></i></span> <a class="navbar-brand" href="http://example.com">H多看源码多读书 - 勤于思考善领悟</a></div><div class="collapse navbar-collapse" id="main-menu"><ul class="menu"><li role="presentation" class="text-center"><a href="/"><i class="fa"></i> 首页</a></li><li role="presentation" class="text-center"><a href="/categories/"><i class="fa"></i> 分类</a></li><li role="presentation" class="text-center"><a href="/tags/"><i class="fa"></i> 标签</a></li><li role="presentation" class="text-center"><a href="/archives/"><i class="fa"></i> 时间轴</a></li><li role="presentation" class="text-center"><a href="/about/"><i class="fa"></i> 关于</a></li></ul></div></div></div></div></nav><section class="content-wrap"><div class="container"><div class="row"><main class="col-md-9 main-content m-post"><p id="process"></p><article class="post"><div class="post-head"><h1 id="TypeScrip装饰器">TypeScrip装饰器</h1><div class="post-meta"><span class="categories-meta fa-wrap"><i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/HTML-CSS-JS/">HTML/CSS/JS</a></span><span class="fa-wrap"><i class="fa fa-tags"></i> <span class="tags-meta"><a class="tag-none-link" href="/tags/typeScript/" rel="tag">typeScript</a></span></span><span class="fa-wrap"><i class="fa fa-clock-o"></i> <span class="date-meta">2025/08/17</span></span></div></div><div class="post-body post-content"><h3 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a><strong><font color="red">一、简介</font></strong></h3><ol><li>装饰器本质是一种特殊的<strong>函数</strong>，它可以对：类、属性、方法、参数进行扩展，同时能让代码更简洁。</li><li>装饰器自<code>2015</code>年在<code>ECMAScript-6</code>中被提出到现在，已将近10年。</li><li>截止目前，装饰器依然是实验性特性 ，需要开发者手动调整配置，来开启装饰器支持。</li><li>装饰器有 5 种：</li></ol><p>1、类装饰器<br>2、属性装饰器<br>3、方法装饰器<br>4、访问器装饰器<br>5、参数装饰器</p><blockquote><p>备注：虽然<code>TypeScript5.0</code>中可以直接使用<code>**类装饰器**</code>，但为了确保其他装饰器可用，现阶段使用时，仍建议使用<code>experimentalDecorators</code>配置来开启装饰器支持，而且不排除在来的版本中，官方会<strong>进一步调整</strong>装饰器的相关语法！<br>参考：<a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/typescript/announcing-typescript-5-0-rc/"><strong>《TypeScript 5.0发版公告》</strong></a></p></blockquote><br><h3 id="二、类装饰器"><a href="#二、类装饰器" class="headerlink" title="二、类装饰器"></a><strong><font color="red">二、类装饰器</font></strong></h3><h4 id="2-1、基本语法"><a href="#2-1、基本语法" class="headerlink" title="2.1、基本语法"></a><strong><font color="#10c300">2.1、基本语法</font></strong></h4><p>类装饰器是一个应用在<strong>类声明</strong>上的<strong>函数</strong>，可以为类添加额外的功能，或添加额外的逻辑。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  Demo函数会在Person类定义时执行</span></span><br><span class="line"><span class="comment">  target参数是被装饰的类，即：Person</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Demo</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用装饰器</span></span><br><span class="line"><span class="meta">@Demo</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123; <span class="comment">// 被装饰的类</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> <span class="attr">name</span>:<span class="built_in">string</span></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br></pre></td></tr></table></figure><br><h4 id="2-2、应用举例"><a href="#2-2、应用举例" class="headerlink" title="2.2、应用举例"></a><strong><font color="#10c300">2.2、应用举例</font></strong></h4><p>需求：定义一个装饰器，实现<code>Person</code>实例调用<code>toString</code>时返回<code>JSON.stringify</code>的执行结果。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用装饰器重写toString方法 + 封闭其原型对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CustomString</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 向被装饰类的原型上添加自定义的 toString 方法</span></span><br><span class="line">    target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 封闭其原型对象，禁止随意操作其原型对象</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">seal</span>(target.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 CustomString 装饰器</span></span><br><span class="line"><span class="meta">@CustomString</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>, <span class="keyword">public</span> <span class="attr">age</span>: <span class="built_in">number</span></span>) &#123; &#125;</span><br><span class="line">    <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`我叫<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>，今年<span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span>岁了`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;小明&quot;</span>, <span class="number">15</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="title function_">toString</span>()); <span class="comment">// [object Object]  使用装饰器后：&#x27;&#123;&quot;name&quot;:&quot;小明&quot;,&quot;age&quot;:15&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当封闭其原型对象 此行会报错：Cannot add property a, object is not extensible</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="number">100</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">a</span>)</span><br></pre></td></tr></table></figure><br><h4 id="2-3、关于返回值"><a href="#2-3、关于返回值" class="headerlink" title="2.3、关于返回值"></a><strong><font color="#10c300">2.3、关于返回值</font></strong></h4><p><strong>类装饰器有返回值</strong>：若类装饰器返回一个新的类，那这个新类将<strong>替换</strong>掉被装饰的类。<br><strong>类装饰器无返回值</strong>：若类装饰器无返回值或返回<code>undefined</code>，那被装饰的类<strong>不会</strong>被替换。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">demo</span>(<span class="params"><span class="attr">target</span>:<span class="title class_">Function</span></span>)&#123;</span><br><span class="line">  <span class="comment">// 装饰器有返回值时，该返回值会替换掉被装饰的类</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> &#123;</span><br><span class="line">    <span class="title function_">test</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">200</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">300</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">400</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@demo</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">test</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>)</span><br></pre></td></tr></table></figure><br><h4 id="2-4、关于class构造类型"><a href="#2-4、关于class构造类型" class="headerlink" title="2.4、关于class构造类型"></a><strong><font color="#10c300">2.4、关于class构造类型</font></strong></h4><blockquote><p>在 TypeScript 中，<code>Function</code> 类型所表示的范围十分广泛，包括：普通函数、箭头函数、方法等等。但并非<code>Function</code> 类型的函数都可以被 <code>new</code> 关键字实例化，例如箭头函数是不能被实例化的，那么 TypeScript 中概如何声明一个构造类型呢？有以下两种方式：</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  ○ new     表示：该类型是可以用new操作符调用。</span></span><br><span class="line"><span class="comment">  ○ ...args 表示：构造器可以接受【任意数量】的参数。</span></span><br><span class="line"><span class="comment">  ○ any[]   表示：构造器可以接受【任意类型】的参数。</span></span><br><span class="line"><span class="comment">  ○ &#123;&#125;      表示：返回类型是对象(非null、非undefined的对象)。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义Constructor类型，其含义是构造类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Constructor</span> = <span class="title function_">new</span> (...<span class="attr">args</span>: <span class="built_in">any</span>[]) =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"><span class="attr">fn</span>:<span class="title class_">Constructor</span></span>)&#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;&#125;</span><br><span class="line"><span class="title function_">test</span>(<span class="title class_">Person</span>)</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个构造类型，且包含一个静态属性 wife</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Constructor</span> = &#123;</span><br><span class="line">  <span class="title function_">new</span>(...<span class="attr">args</span>: <span class="built_in">any</span>[]): &#123;&#125;; <span class="comment">// 构造签名</span></span><br><span class="line">  <span class="attr">wife</span>: <span class="built_in">string</span>; <span class="comment">// wife属性</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> wife = <span class="string">&#x27;asd&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"><span class="attr">fn</span>:<span class="title class_">Constructor</span></span>)&#123;&#125;</span><br><span class="line"><span class="title function_">test</span>(<span class="title class_">Person</span>)</span><br></pre></td></tr></table></figure><br><h4 id="2-5、替换被装饰的类"><a href="#2-5、替换被装饰的类" class="headerlink" title="2.5、替换被装饰的类"></a><strong><font color="#10c300">2.5、替换被装饰的类</font></strong></h4><p>对于高级一些的装饰器，不仅仅是覆盖一个原型上的方法，还要有更多功能，例如添加新的方法和状态。</p><p>**需求：**设计一个<code>LogTime</code>装饰器，可以给实例添加一个属性，用于记录实例对象的创建时间，再添加一个方法用于读取创建时间。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// User接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="title function_">getTime</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义类型Class</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Constructor</span> = <span class="title function_">new</span> (...<span class="attr">args</span>: <span class="built_in">any</span>[]) =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个装饰器，为类添加日志功能和创建时间</span></span><br><span class="line"><span class="keyword">function</span> <span class="title class_">LogTime</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Constructor</span>&gt;(<span class="attr">target</span>: T) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> target &#123; <span class="comment">// return一个类并且这个类继承了target传来的类</span></span><br><span class="line">        <span class="attr">createdTime</span>: <span class="title class_">Date</span>;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123; <span class="comment">// 构造器可以接受任意数量/类型的参数</span></span><br><span class="line">            <span class="variable language_">super</span>(...args); <span class="comment">// 继承传递的任意参数</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">createdTime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>(); <span class="comment">// 记录对象创建时间</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">getTime</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`该对象创建时间为：<span class="subst">$&#123;<span class="variable language_">this</span>.createdTime&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@LogTime</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>, <span class="keyword">public</span> <span class="attr">age</span>: <span class="built_in">number</span></span>) &#123; &#125;</span><br><span class="line">    <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>说：你好啊！`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user1 = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">13</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user1.<span class="title function_">getTime</span>());</span><br></pre></td></tr></table></figure><br><h3 id="三、装饰器工厂"><a href="#三、装饰器工厂" class="headerlink" title="三、装饰器工厂"></a><strong><font color="red">三、装饰器工厂</font></strong></h3><p><strong>装饰器工厂是一个返回装饰器函数的函数（装饰器工厂中会包含一个装饰器）</strong>，可以为装饰器添加参数，可以更灵活地控制装饰器的行为。</p><p>**需求：**定义一个<code>LogInfo</code>类装饰器工厂，实现<code>Person</code>实例可以调用到<code>introduce</code>方法，且<code>introduce</code>中输出内容的次数，由<code>LogInfo</code>接收的参数决定。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123; <span class="comment">// 因为给原型上添加了个方法，因此要加个类型</span></span><br><span class="line">    <span class="attr">introduce</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个装饰器工厂 LogInfo，它接受一个参数 n，返回一个类装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LogInfo</span>(<span class="params"><span class="attr">n</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123; <span class="comment">// 装饰器函数，target 是被装饰的类</span></span><br><span class="line">        target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">introduce</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`我的名字：<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>，我的年龄：<span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span>`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@LogInfo</span>(<span class="number">5</span>) <span class="comment">// 装饰器工厂需要有个()</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">        <span class="keyword">public</span> <span class="attr">age</span>: <span class="built_in">number</span></span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line">    <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;你好呀！&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="comment">// console.log(p1) // 打印的p1是：_classThis，转换的JS版本比较旧时，会出现，不必纠结</span></span><br><span class="line">p1.<span class="title function_">speak</span>()</span><br><span class="line">p1.<span class="title function_">introduce</span>()</span><br></pre></td></tr></table></figure><br><h3 id="四、装饰器组合"><a href="#四、装饰器组合" class="headerlink" title="四、装饰器组合"></a><strong><font color="red">四、装饰器组合</font></strong></h3><blockquote><p><strong>装饰器组合</strong>即装饰器工厂和装饰器的组合</p></blockquote><h4 id="4-1、执行顺序"><a href="#4-1、执行顺序" class="headerlink" title="4.1、执行顺序"></a><strong><font color="#10c300">4.1、执行顺序</font></strong></h4><p>装饰器可以组合使用，执行顺序为：先【<strong>由上到下</strong>】的执行所有的装饰器工厂，依次获取到装饰器，然后再【<strong>由下到上</strong>】执行所有的装饰器。<strong>（先执行装饰器工厂后执行装饰器，装饰器工厂由上往下，装饰器由下往上执行）</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test1</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test1&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//装饰器工厂</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test2工厂&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test2&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//装饰器工厂</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test3</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test3工厂&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test3&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test4</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test4&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@test1</span></span><br><span class="line"><span class="meta">@test2</span>()</span><br><span class="line"><span class="meta">@test3</span>()</span><br><span class="line"><span class="meta">@test4</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  控制台打印：</span></span><br><span class="line"><span class="comment">    test2工厂</span></span><br><span class="line"><span class="comment">    test3工厂</span></span><br><span class="line"><span class="comment">    test4</span></span><br><span class="line"><span class="comment">    test3</span></span><br><span class="line"><span class="comment">    test2</span></span><br><span class="line"><span class="comment">    test1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><br><h4 id="4-2、应用"><a href="#4-2、应用" class="headerlink" title="4.2、应用"></a><strong><font color="#10c300">4.2、应用</font></strong></h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义类型Class</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Constructor</span> = <span class="title function_">new</span> (...<span class="attr">args</span>: <span class="built_in">any</span>[]) =&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">introduce</span>(): <span class="built_in">void</span></span><br><span class="line">    <span class="title function_">getTime</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用装饰器重写toString方法 + 封闭其原型对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">customToString</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 向被装饰类的原型上添加自定义的 toString 方法</span></span><br><span class="line">    target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 封闭其原型对象，禁止随意操作其原型对象</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">seal</span>(target.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个装饰器，为类添加日志功能和创建时间</span></span><br><span class="line"><span class="keyword">function</span> <span class="title class_">LogTime</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Constructor</span>&gt;(<span class="attr">target</span>: T) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> target &#123;</span><br><span class="line">        <span class="attr">createdTime</span>: <span class="title class_">Date</span>;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">            <span class="variable language_">super</span>(...args);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">createdTime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>(); <span class="comment">// 记录对象创建时间</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">getTime</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`该对象创建时间为：<span class="subst">$&#123;<span class="variable language_">this</span>.createdTime&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个装饰器工厂 LogInfo，它接受一个参数 n，返回一个类装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LogInfo</span>(<span class="params"><span class="attr">n</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 装饰器函数，target 是被装饰的类</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"><span class="attr">target</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">        target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">introduce</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`我的名字：<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>，我的年龄：<span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span>`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@customToString</span></span><br><span class="line"><span class="meta">@LogInfo</span>(<span class="number">3</span>)</span><br><span class="line"><span class="meta">@LogTime</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">        <span class="keyword">public</span> <span class="attr">age</span>: <span class="built_in">number</span></span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line">    <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;你好呀！&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="title function_">toString</span>()) <span class="comment">// &#123;&quot;name&quot;:&quot;张三&quot;,&quot;age&quot;:18,&quot;createdTime&quot;:&quot;2024-11-22T02:49:25.234Z&quot;&#125;</span></span><br><span class="line">p1.<span class="title function_">introduce</span>() <span class="comment">// 打印3次：我的名字：张三，我的年龄：18</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="title function_">getTime</span>()) <span class="comment">// 该对象创建时间为：Fri Nov 22 2024 10:50:19 GMT+0800 (中国标准时间)</span></span><br></pre></td></tr></table></figure><br><h3 id="五、属性装饰器"><a href="#五、属性装饰器" class="headerlink" title="五、属性装饰器"></a><strong><font color="red">五、属性装饰器</font></strong></h3><h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a><strong><font color="#10c300">基本语法</font></strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  参数说明：</span></span><br><span class="line"><span class="comment">    ○ target: 对于静态属性来说值是类，对于实例属性来说值是类的原型对象。</span></span><br><span class="line"><span class="comment">    ○ propertyKey: 属性名。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Demo</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(target, propertyKey)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="meta">@Demo</span> <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="meta">@Demo</span> <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="meta">@Demo</span> <span class="keyword">static</span> <span class="attr">school</span>: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">age</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure><br><h4 id="关于属性遮蔽"><a href="#关于属性遮蔽" class="headerlink" title="关于属性遮蔽"></a><strong><font color="#10c300">关于属性遮蔽</font></strong></h4><blockquote><p>常规逻辑：给实例对象this添加一个age属性，js会先查看是否有这个属性，没有就查看原型对象上是否有。如下代码在给原型对象添加age属性之前就已经new了一个实例对象，因此实例age是18 原型对象的age是130</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/ 常规</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">age</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">P1</span> = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;小明&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> value = <span class="number">130</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;age&#x27;</span>, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">v</span>) &#123;</span><br><span class="line">        value = v</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">P1</span>);  <span class="comment">// &#123;name: &#x27;小明&#x27;, age: 18&#125;  原型对象上age是130</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202411251647729.png" alt="image-20241125164721617"></p><blockquote><p>**属性遮蔽：**如下代码中：当构造器中的<code>this.age = age</code>试图在实例上赋值时，实际上是调用了原型上<code>age</code>属性的<code>set</code>方法。</p><p>逻辑：第一次执行到this.age &#x3D; age的时候。发现没有age就在原型对象找执行get方法这时候发现age是130，往下执行new一个实例对象的时候，因为这时候的age是原型对象中的，因此会执行set函数，将18赋值给age</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">age</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> value = <span class="number">130</span></span><br><span class="line"><span class="comment">// 使用defineProperty给Person原型添加age属性，并配置对应的get与set</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;age&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    value = val</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1)</span><br></pre></td></tr></table></figure><p><img src="https://picgo-2024.oss-cn-beijing.aliyuncs.com/img/202411251701230.png" alt="image-20241125170107136"></p><br><h4 id="应用举例"><a href="#应用举例" class="headerlink" title="应用举例"></a><strong><font color="#10c300">应用举例</font></strong></h4><blockquote><p>需求：定义一个<code>State</code>属性装饰器，来监视属性的修改。</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明一个装饰器函数 State，用于捕获数据的修改</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">State</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 存储属性的内部值</span></span><br><span class="line">    <span class="keyword">let</span> key = <span class="string">`__<span class="subst">$&#123;propertyKey&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 Object.defineProperty 替换类的原始属性</span></span><br><span class="line">    <span class="comment">// 重新定义属性，使其使用自定义的 getter 和 setter</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, propertyKey, &#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params"><span class="attr">newVal</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;propertyKey&#125;</span>的最新值为：<span class="subst">$&#123;newVal&#125;</span>`</span>);</span><br><span class="line">            <span class="variable language_">this</span>[key] = newVal</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="comment">//使用State装饰器</span></span><br><span class="line">    <span class="meta">@State</span> <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">    school = <span class="string">&#x27;atguigu&#x27;</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">age</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">p1.<span class="property">age</span> = <span class="number">80</span></span><br><span class="line">p2.<span class="property">age</span> = <span class="number">90</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;------------------&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">age</span>) <span class="comment">//80</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">age</span>) <span class="comment">//90</span></span><br></pre></td></tr></table></figure><br><h3 id="六、方法装饰器"><a href="#六、方法装饰器" class="headerlink" title="六、方法装饰器"></a><strong><font color="red">六、方法装饰器</font></strong></h3><h4 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a><strong><font color="#10c300">基本语法</font></strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  参数说明：</span></span><br><span class="line"><span class="comment">    ○ target: 对于静态方法来说值是类，对于实例方法来说值是类的原型对象。</span></span><br><span class="line"><span class="comment">    ○ propertyKey:方法的名称。</span></span><br><span class="line"><span class="comment">    ○ descriptor: 方法的描述对象，其中value属性是被装饰的方法。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// PropertyDescriptor  自带的类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Demo</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">descriptor</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(target)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(propertyKey)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(descriptor)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">        <span class="keyword">public</span> <span class="attr">age</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line">    <span class="comment">// Demo装饰实例方法</span></span><br><span class="line">    <span class="meta">@Demo</span> <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`你好，我的名字：<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>，我的年龄：<span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Demo装饰静态方法</span></span><br><span class="line">    <span class="meta">@Demo</span> <span class="keyword">static</span> <span class="title function_">isAdult</span>(<span class="params"><span class="attr">age</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> age &gt;= <span class="number">18</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>)</span><br><span class="line">p1.<span class="title function_">speak</span>()</span><br></pre></td></tr></table></figure><br><h4 id="应用举例-1"><a href="#应用举例-1" class="headerlink" title="应用举例"></a><strong><font color="#10c300">应用举例</font></strong></h4><ol><li>定义一个<code>Logger</code>方法装饰器，用于在方法执行前和执行后，均追加一些额外逻辑。</li><li>定义一个<code>Validate</code>方法装饰器，用于验证数据。</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Logger</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">descriptor</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 保存原始方法</span></span><br><span class="line">    <span class="keyword">const</span> original = descriptor.<span class="property">value</span>;</span><br><span class="line">    <span class="comment">// 替换原始方法</span></span><br><span class="line">    descriptor.<span class="property">value</span> = <span class="keyword">function</span> (<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;propertyKey&#125;</span>开始执行......`</span>)</span><br><span class="line">        <span class="keyword">const</span> result = original.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...args)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;propertyKey&#125;</span>执行完毕......`</span>)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Validate</span>(<span class="params"><span class="attr">maxValue</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"><span class="attr">target</span>: <span class="built_in">object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">descriptor</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">        <span class="comment">// 保存原始方法</span></span><br><span class="line">        <span class="keyword">const</span> original = descriptor.<span class="property">value</span>;</span><br><span class="line">        <span class="comment">// 替换原始方法</span></span><br><span class="line">        descriptor.<span class="property">value</span> = <span class="keyword">function</span> (<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">            <span class="comment">// 自定义的验证逻辑</span></span><br><span class="line">            <span class="keyword">if</span> (args[<span class="number">0</span>] &gt; maxValue) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;年龄非法！&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果所有参数都符合要求，则调用原始方法</span></span><br><span class="line">            <span class="keyword">return</span> original.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">        <span class="keyword">public</span> <span class="attr">age</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line">    <span class="meta">@Logger</span> <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`你好，我的名字：<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>，我的年龄：<span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Validate</span>(<span class="number">120</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">isAdult</span>(<span class="params"><span class="attr">age</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> age &gt;= <span class="number">18</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>)</span><br><span class="line">p1.<span class="title function_">speak</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="title function_">isAdult</span>(<span class="number">100</span>))</span><br></pre></td></tr></table></figure><br><h3 id="七、访问器装饰器"><a href="#七、访问器装饰器" class="headerlink" title="七、访问器装饰器"></a><strong><font color="red">七、访问器装饰器</font></strong></h3><h4 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a><strong><font color="#10c300">基本语法</font></strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  参数说明：</span></span><br><span class="line"><span class="comment">    ○ target: </span></span><br><span class="line"><span class="comment">        1. 对于实例访问器来说值是【所属类的原型对象】。</span></span><br><span class="line"><span class="comment">        2. 对于静态访问器来说值是【所属类】。</span></span><br><span class="line"><span class="comment">    ○ propertyKey:访问器的名称。</span></span><br><span class="line"><span class="comment">    ○ descriptor: 描述对象。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Demo</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">descriptor</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(propertyKey)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(descriptor)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="meta">@Demo</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">address</span>()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;北京宏福科技园&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Demo</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">country</span>()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;中国&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h4 id="应用举例-2"><a href="#应用举例-2" class="headerlink" title="应用举例"></a><strong><font color="#10c300">应用举例</font></strong></h4><p>需求：对<code>Weather</code>类的<code>temp</code>属性的<code>set</code>访问器进行限制，设置的最低温度<code>-50</code>，最高温度<code>50</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">RangeValidate</span>(<span class="params"><span class="attr">min</span>: <span class="built_in">number</span>, <span class="attr">max</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"><span class="attr">target</span>: <span class="built_in">object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">descriptor</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">        <span class="comment">// 保存原始的 setter 方法，以便在后续调用中使用</span></span><br><span class="line">        <span class="keyword">const</span> originalSetter = descriptor.<span class="property">set</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重写 setter 方法，加入范围验证逻辑</span></span><br><span class="line">        descriptor.<span class="property">set</span> = <span class="keyword">function</span> (<span class="params"><span class="attr">value</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">            <span class="comment">// 检查设置的值是否在指定的最小值和最大值之间</span></span><br><span class="line">            <span class="keyword">if</span> (value &lt; min || value &gt; max) &#123;</span><br><span class="line">                <span class="comment">// 如果值不在范围内，抛出错误</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`<span class="subst">$&#123;propertyKey&#125;</span>的值应该在 <span class="subst">$&#123;min&#125;</span> 到 <span class="subst">$&#123;max&#125;</span>之间！`</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果值在范围内，且原始 setter 方法存在，则调用原始 setter 方法</span></span><br><span class="line">            <span class="keyword">if</span> (originalSetter) &#123;</span><br><span class="line">                originalSetter.<span class="title function_">call</span>(<span class="variable language_">this</span>, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Weather</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">_temp</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">_temp</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_temp</span> = _temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置温度范围在 -50 到 50 之间</span></span><br><span class="line">    <span class="meta">@RangeValidate</span>(-<span class="number">50</span>, <span class="number">50</span>)</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">temp</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_temp</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">temp</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_temp</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> w1 = <span class="keyword">new</span> <span class="title class_">Weather</span>(<span class="number">25</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(w1)</span><br><span class="line">w1.<span class="property">temp</span> = <span class="number">67</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(w1)</span><br></pre></td></tr></table></figure><br><h3 id="八、参数装饰器"><a href="#八、参数装饰器" class="headerlink" title="八、参数装饰器"></a><strong><font color="red">八、参数装饰器</font></strong></h3><h4 id="基本语法-3"><a href="#基本语法-3" class="headerlink" title="基本语法"></a><strong><font color="#10c300">基本语法</font></strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  参数说明：</span></span><br><span class="line"><span class="comment">    ○ target:</span></span><br><span class="line"><span class="comment">      1.如果修饰的是【实例方法】的参数，target 是类的【原型对象】。</span></span><br><span class="line"><span class="comment">      2.如果修饰的是【静态方法】的参数，target 是【类】。</span></span><br><span class="line"><span class="comment">    ○ propertyKey：参数所在的方法的名称。</span></span><br><span class="line"><span class="comment">    ○ parameterIndex: 参数在函数参数列表中的索引，从 0 开始。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Demo</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">parameterIndex</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(propertyKey)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(parameterIndex)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类定义</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span></span>) &#123; &#125;</span><br><span class="line">  <span class="title function_">speak</span>(<span class="params"><span class="meta">@Demo</span> <span class="attr">message1</span>: <span class="built_in">any</span>, <span class="attr">mesage2</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>想对说：<span class="subst">$&#123;message1&#125;</span>，<span class="subst">$&#123;mesage2&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h4 id="应用举例-3"><a href="#应用举例-3" class="headerlink" title="应用举例"></a><strong><font color="#10c300">应用举例</font></strong></h4><p>需求：定义方法装饰器<code>Validate</code>，同时搭配参数装饰器<code>NotNumber</code>，来对<code>speak</code>方法的参数类型进行限制。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">NotNumber</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">any</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">parameterIndex</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 初始化或获取当前方法的参数索引列表</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">notNumberArr</span>: <span class="built_in">number</span>[] = target[<span class="string">`__notNumber_<span class="subst">$&#123;propertyKey&#125;</span>`</span>] || [];</span><br><span class="line">    <span class="comment">// 将当前参数索引添加到列表中</span></span><br><span class="line">    notNumberArr.<span class="title function_">push</span>(parameterIndex);</span><br><span class="line">    <span class="comment">// 将列表存储回目标对象</span></span><br><span class="line">    target[<span class="string">`__notNumber_<span class="subst">$&#123;propertyKey&#125;</span>`</span>] = notNumberArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法装饰器定义</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Validate</span>(<span class="params"><span class="attr">target</span>: <span class="built_in">any</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span>, <span class="attr">descriptor</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> method = descriptor.<span class="property">value</span>;</span><br><span class="line">    descriptor.<span class="property">value</span> = <span class="keyword">function</span> (<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取被标记为不能为空的参数索引列表</span></span><br><span class="line">        <span class="keyword">const</span> <span class="attr">notNumberArr</span>: <span class="built_in">number</span>[] = target[<span class="string">`__notNumber_<span class="subst">$&#123;propertyKey&#125;</span>`</span>] || [];</span><br><span class="line">        <span class="comment">// 检查参数是否为 null 或 undefined</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> index <span class="keyword">of</span> notNumberArr) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> args[index] === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`方法 <span class="subst">$&#123;propertyKey&#125;</span> 中索引为 <span class="subst">$&#123;index&#125;</span> 的参数不能是数字！`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调用原始方法</span></span><br><span class="line">        <span class="keyword">return</span> method.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类定义</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Validate</span></span><br><span class="line">    <span class="title function_">speak</span>(<span class="params"><span class="meta">@NotNumber</span> <span class="attr">message1</span>: <span class="built_in">any</span>, <span class="attr">mesage2</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>想对说：<span class="subst">$&#123;message1&#125;</span>，<span class="subst">$&#123;mesage2&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> s1 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">s1.<span class="title function_">speak</span>(<span class="number">100</span>, <span class="number">200</span>);</span><br></pre></td></tr></table></figure></div><div class="post-footer"><div>转载声明： 商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">ZHB</a></div><div></div></div></article><div class="article-nav prev-next-wrap clearfix"><a href="/posts/eb0b56b0.html" class="pre-post btn btn-default" title="0-1搭建vue3项目及配置"><i class="fa fa-angle-left fa-fw"></i> <span class="hidden-lg">上一篇</span> <span class="hidden-xs">0-1搭建vue3项目及配置</span></a> <a href="/posts/9dd4ce81.html" class="next-post btn btn-default" title="TypeScript快速上手"><span class="hidden-lg">下一篇</span> <span class="hidden-xs">TypeScript快速上手</span><i class="fa fa-angle-right fa-fw"></i></a></div><div id="comments"><div class="utteranc"><script src="https://utteranc.es/client.js" repo="shenliyang/snippet-comment" issue-term="pathname" issue-number="" theme="github-light" label="" crossorigin="anonymous" async></script></div></div></main><aside id="article-toc" role="navigation" class="col-md-3"><div class="widget"><h3 class="title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-text">一、简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%B1%BB%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">二、类装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">2.1、基本语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-text">2.2、应用举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81%E5%85%B3%E4%BA%8E%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">2.3、关于返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E3%80%81%E5%85%B3%E4%BA%8Eclass%E6%9E%84%E9%80%A0%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.4、关于class构造类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%E3%80%81%E6%9B%BF%E6%8D%A2%E8%A2%AB%E8%A3%85%E9%A5%B0%E7%9A%84%E7%B1%BB"><span class="toc-text">2.5、替换被装饰的类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8%E5%B7%A5%E5%8E%82"><span class="toc-text">三、装饰器工厂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8%E7%BB%84%E5%90%88"><span class="toc-text">四、装饰器组合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E3%80%81%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-text">4.1、执行顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%E3%80%81%E5%BA%94%E7%94%A8"><span class="toc-text">4.2、应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%B1%9E%E6%80%A7%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">五、属性装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%B1%9E%E6%80%A7%E9%81%AE%E8%94%BD"><span class="toc-text">关于属性遮蔽</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-text">应用举例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%96%B9%E6%B3%95%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">六、方法装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95-1"><span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B-1"><span class="toc-text">应用举例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E8%AE%BF%E9%97%AE%E5%99%A8%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">七、访问器装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95-2"><span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B-2"><span class="toc-text">应用举例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%8F%82%E6%95%B0%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">八、参数装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95-3"><span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B-3"><span class="toc-text">应用举例</span></a></li></ol></li></ol></div></aside></div></div></section><footer class="main-footer"><div class="container"><div class="row"></div></div></footer><a id="back-to-top" class="icon-btn hide"><i class="fa fa-chevron-up"></i></a><div class="copyright"><div class="container"><div class="row"><div class="col-sm-12"><div class="busuanzi"></div></div><div class="col-sm-12"><span>Copyright &copy; 2017</span> | <span>Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a></span> | <span>Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a></span></div></div></div></div><script src="/js/app.js?rev=2f9097f8c1d5adfecd923b78b47be31b"></script></body></html>